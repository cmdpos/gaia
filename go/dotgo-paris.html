<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="author" content="Dave Cheney">
<title>High Performance Go Workshop</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments, .listingblock .pygments code { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sa { color: #BA2121 } /* Literal.String.Affix */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-dl { color: #BA2121 } /* Literal.String.Delimiter */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-fm { color: #0000FF } /* Name.Function.Magic */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-vm { color: #19177C } /* Name.Variable.Magic */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-18618646-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-18618646-1');
</script>
</head>
<body class="book">
<div id="header">
<h1>High Performance Go Workshop</h1>
<div class="details">
<span id="author" class="author">Dave Cheney</span><br>
<span id="email" class="email"><a href="mailto:dave@cheney.net">dave@cheney.net</a></span><br>
<span id="revnumber">version dotgo-2019-3-g660848,</span>
<span id="revdate">2019-04-26</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#overview">Overview</a>
<ul class="sectlevel2">
<li><a href="#schedule">Schedule</a></li>
</ul>
</li>
<li><a href="#welcome">Welcome</a>
<ul class="sectlevel2">
<li><a href="#instructors">Instructors</a></li>
<li><a href="#license_and_materials">License and Materials</a></li>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#one_more_thing">One more thing &#8230;&#8203;</a></li>
</ul>
</li>
<li><a href="#introduction">1. The past, present, and future of Microprocessor performance</a>
<ul class="sectlevel2">
<li><a href="#mechanical_sympathy">1.1. Mechanical Sympathy</a></li>
<li><a href="#six_orders_of_magnitude">1.2. Six orders of magnitude</a></li>
<li><a href="#are_computers_still_getting_faster">1.3. Are computers still getting faster?</a></li>
<li><a href="#clock_speeds">1.4. Clock speeds</a></li>
<li><a href="#heat">1.5. Heat</a></li>
<li><a href="#the_end_of_dennard_scaling">1.6. The end of Dennard scaling</a></li>
<li><a href="#more_cores">1.7. More cores</a></li>
<li><a href="#amdahls_law">1.8. Amdahl&#8217;s law</a></li>
<li><a href="#dynamic_optimisations">1.9. Dynamic Optimisations</a></li>
<li><a href="#modern_cpus_are_optimised_for_bulk_operations">1.10. Modern CPUs are optimised for bulk operations</a></li>
<li><a href="#modern_processors_are_limited_by_memory_latency_not_memory_capacity">1.11. Modern processors are limited by memory latency not memory capacity</a></li>
<li><a href="#cache_rules_everything_around_me">1.12. Cache rules everything around me</a></li>
<li><a href="#the_free_lunch_is_over">1.13. The free lunch is over</a></li>
<li><a href="#conc">1.14. Conclusion</a></li>
</ul>
</li>
<li><a href="#benchmarking">2. Benchmarking</a>
<ul class="sectlevel2">
<li><a href="#benchmarking_ground_rules">2.1. Benchmarking ground rules</a></li>
<li><a href="#using_the_testing_package_for_benchmarking">2.2. Using the testing package for benchmarking</a></li>
<li><a href="#comparing_benchmarks_with_benchstat">2.3. Comparing benchmarks with benchstat</a></li>
<li><a href="#avoiding_benchmarking_start_up_costs">2.4. Avoiding benchmarking start up costs</a></li>
<li><a href="#benchmarking_allocations">2.5. Benchmarking allocations</a></li>
<li><a href="#watch_out_for_compiler_optimisations">2.6. Watch out for compiler optimisations</a></li>
<li><a href="#benchmark_mistakes">2.7. Benchmark mistakes</a></li>
<li><a href="#profiling_benchmarks">2.8. Profiling benchmarks</a></li>
<li><a href="#discussion">2.9. Discussion</a></li>
</ul>
</li>
<li><a href="#profiling">3. Performance measurement and profiling</a>
<ul class="sectlevel2">
<li><a href="#pprof">3.1. pprof</a></li>
<li><a href="#types_of_profiles">3.2. Types of profiles</a></li>
<li><a href="#one_profile_at_at_time">3.3. One profile at at time</a></li>
<li><a href="#collecting_a_profile">3.4. Collecting a profile</a></li>
<li><a href="#analysing_a_profile_with_pprof">3.5. Analysing a profile with pprof</a></li>
</ul>
</li>
<li><a href="#compiler-optimisation">4. Compiler optimisations</a>
<ul class="sectlevel2">
<li><a href="#history_of_the_go_compiler">4.1. History of the Go compiler</a></li>
<li><a href="#escape_analysis">4.2. Escape analysis</a></li>
<li><a href="#inlining">4.3. Inlining</a></li>
<li><a href="#dead_code_elimination">4.4. Dead code elimination</a></li>
<li><a href="#compiler_flags_exercises">4.5. Compiler flags Exercises</a></li>
<li><a href="#bounds_check_elimination">4.6. Bounds check elimination</a></li>
</ul>
</li>
<li><a href="#execution-tracer">5. Execution Tracer</a>
<ul class="sectlevel2">
<li><a href="#what_is_the_execution_tracer_why_do_we_need_it">5.1. What is the execution tracer, why do we need it?</a></li>
<li><a href="#generating_the_profile">5.2. Generating the profile</a></li>
<li><a href="#generating_a_profile_with_runtimepprof">5.3. Generating a profile with runtime/pprof</a></li>
<li><a href="#tracing_vs_profiling">5.4. Tracing vs Profiling</a></li>
<li><a href="#using_more_than_one_cpu">5.5. Using more than one CPU</a></li>
<li><a href="#batching_up_work">5.6. Batching up work</a></li>
<li><a href="#using_workers">5.7. Using workers</a></li>
<li><a href="#using_buffered_channels">5.8. Using buffered channels</a></li>
<li><a href="#mandelbrot_microservice">5.9. Mandelbrot microservice</a></li>
</ul>
</li>
<li><a href="#memory-and-gc">6. Memory and Garbage Collector</a>
<ul class="sectlevel2">
<li><a href="#garbage_collector_world_view">6.1. Garbage collector world view</a></li>
<li><a href="#garbage_collector_design">6.2. Garbage collector design</a></li>
<li><a href="#garbage_collector_monitoring">6.3. Garbage collector monitoring</a></li>
<li><a href="#reducing_allocations">6.4. Reducing allocations</a></li>
<li><a href="#strings_and_bytes">6.5. strings and []bytes</a></li>
<li><a href="#using_byte_as_a_map_key">6.6. Using <code>[]byte</code> as a map key</a></li>
<li><a href="#avoid_string_concatenation">6.7. Avoid string concatenation</a></li>
<li><a href="#preallocate_slices_if_the_length_is_known">6.8. Preallocate slices if the length is known</a></li>
<li><a href="#using_sync_pool">6.9. Using sync.Pool</a></li>
<li><a href="#exercises_3">6.10. Exercises</a></li>
</ul>
</li>
<li><a href="#tips-and-tricks">7. Tips and trips</a>
<ul class="sectlevel2">
<li><a href="#goroutines">7.1. Goroutines</a></li>
<li><a href="#go_uses_efficient_network_polling_for_some_requests">7.2. Go uses efficient network polling for some requests</a></li>
<li><a href="#watch_out_for_io_multipliers_in_your_application">7.3. Watch out for IO multipliers in your application</a></li>
<li><a href="#use_streaming_io_interfaces">7.4. Use streaming IO interfaces</a></li>
<li><a href="#timeouts_timeouts_timeouts">7.5. Timeouts, timeouts, timeouts</a></li>
<li><a href="#defer_is_expensive_or_is_it">7.6. Defer is expensive, or is it?</a></li>
<li><a href="#avoid_finalisers">7.7. Avoid Finalisers</a></li>
<li><a href="#minimise_cgo">7.8. Minimise cgo</a></li>
<li><a href="#always_use_the_latest_released_version_of_go">7.9. Always use the latest released version of Go</a></li>
<li><a href="#discussion_3">7.10. Discussion</a></li>
</ul>
</li>
<li><a href="#conclusion">Final Questions and Conclusion</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="overview"><a class="anchor" href="#overview"></a><a class="link" href="#overview">Overview</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The goal for this workshop is to give you the tools you need to diagnose performance problems in your Go applications and fix them.</p>
</div>
<div class="paragraph">
<p>Through the day we&#8217;ll work from the small&#8201;&#8212;&#8201;learning how to write benchmarks, then profiling a small piece of code. Then step out and talk about the execution tracer, the garbage collector and tracing running applications. The remainder of the day will be a chance for you to ask questions, experiment with your own code.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can find the latest version of this presentation at</p>
</div>
<div class="paragraph">
<p><a href="http://bit.ly/dotgo2019" class="bare">http://bit.ly/dotgo2019</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="schedule"><a class="anchor" href="#schedule"></a><a class="link" href="#schedule">Schedule</a></h3>
<div class="paragraph">
<p>Here&#8217;s the (approximate) schedule for the day.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Start</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">09:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#welcome">Welcome</a> and <a href="#introduction">Introduction</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">09:30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#benchmarking">Benchmarking</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10:45</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Break (15 minutes)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#profiling">Performance measurement and profiling</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">12:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lunch (90 minutes)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">13:30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#compiler-optimisation">Compiler optimisations</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">14:30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#execution-tracer">Execution Tracer</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">15:30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Break (15 minutes)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">15:45</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#memory-and-gc">Memory and Garbage Collector</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">16:15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#tips-and-tricks">Tips and trips</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">16:30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exercises</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">16:45</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#conclusion">Final Questions and Conclusion</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">17:00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Close</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="welcome"><a class="anchor" href="#welcome"></a><a class="link" href="#welcome">Welcome</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hello and welcome! 🎉</p>
</div>
<div class="paragraph">
<p>The goal for this workshop is to give you the tools you need to diagnose performance problems in your Go applications and fix them.</p>
</div>
<div class="paragraph">
<p>Through the day we&#8217;ll work from the small&#8201;&#8212;&#8201;learning how to write benchmarks, then profiling a small piece of code. Then step out and talk about the execution tracer, the garbage collector  and tracing running applications. The remainder of the day will be a chance for you to ask questions, experiment with your own code.</p>
</div>
<div class="sect2">
<h3 id="instructors"><a class="anchor" href="#instructors"></a><a class="link" href="#instructors">Instructors</a></h3>
<div class="ulist">
<ul>
<li>
<p>Dave Cheney <a href="mailto:dave@cheney.net">dave@cheney.net</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="license_and_materials"><a class="anchor" href="#license_and_materials"></a><a class="link" href="#license_and_materials">License and Materials</a></h3>
<div class="paragraph">
<p>This workshop is a collaboration between <a href="https://twitter.com/davecheney">David Cheney</a> and <a href="https://twitter.com/francesc">Francesc Campoy</a>.</p>
</div>
<div class="paragraph">
<p>This presentation is licensed under the <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International</a> licence.</p>
</div>
</div>
<div class="sect2">
<h3 id="prerequisites"><a class="anchor" href="#prerequisites"></a><a class="link" href="#prerequisites">Prerequisites</a></h3>
<div class="paragraph">
<p>The are several software downloads you will need today.</p>
</div>
<div class="sect3">
<h4 id="the_workshop_repository"><a class="anchor" href="#the_workshop_repository"></a><a class="link" href="#the_workshop_repository">The workshop repository</a></h4>
<div class="paragraph">
<p>Download the source to this document and code samples at <a href="https://github.com/davecheney/high-performance-go-workshop" class="bare">https://github.com/davecheney/high-performance-go-workshop</a></p>
</div>
</div>
<div class="sect3">
<h4 id="laptop_power_supplies_etc"><a class="anchor" href="#laptop_power_supplies_etc"></a><a class="link" href="#laptop_power_supplies_etc">Laptop, power supplies, etc.</a></h4>
<div class="paragraph">
<p>The workshop material targets Go 1.12.</p>
</div>
<div class="paragraph">
<p><a href="https://golang.org/dl/">Download Go 1.12</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you&#8217;ve already upgraded to Go 1.13 that&#8217;s ok. There are always some small changes to optimisation choices between minor Go releases and I&#8217;ll try to point those out as we go along.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="graphviz"><a class="anchor" href="#graphviz"></a><a class="link" href="#graphviz">Graphviz</a></h4>
<div class="paragraph">
<p>The section on pprof requires the <code>dot</code> program which ships with the <code>graphviz</code> suite of tools.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Linux: <code>[sudo] apt-get install graphviz</code></p>
</li>
<li>
<p>OSX:</p>
</li>
<li>
<p>MacPorts: <code>sudo port install graphviz</code></p>
</li>
<li>
<p>Homebrew: <code>brew install graphviz</code></p>
</li>
<li>
<p><a href="https://graphviz.gitlab.io/download/#Windows">Windows</a> (untested)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="google_chrome"><a class="anchor" href="#google_chrome"></a><a class="link" href="#google_chrome">Google Chrome</a></h4>
<div class="paragraph">
<p>The section on the execution tracer requires Google Chrome.
It will not work with Safari, Edge, Firefox, or IE 4.01.
Please tell your battery I&#8217;m sorry.</p>
</div>
<div class="paragraph">
<p><a href="https://www.google.com/chrome/">Download Google Chrome</a></p>
</div>
</div>
<div class="sect3">
<h4 id="your_own_code_to_profile_and_optimise"><a class="anchor" href="#your_own_code_to_profile_and_optimise"></a><a class="link" href="#your_own_code_to_profile_and_optimise">Your own code to profile and optimise</a></h4>
<div class="paragraph">
<p>The final section of the day will be an open session where you can experiment with the tools you&#8217;ve learnt.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="one_more_thing"><a class="anchor" href="#one_more_thing"></a><a class="link" href="#one_more_thing">One more thing &#8230;&#8203;</a></h3>
<div class="paragraph">
<p>This isn&#8217;t a lecture, it&#8217;s a conversation.
We&#8217;ll have lots of breaks to ask questions.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t understand something, or think what you&#8217;re hearing not correct, please ask.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a><a class="link" href="#introduction">1. The past, present, and future of Microprocessor performance</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is a workshop about writing high performance code. In other workshops I talk about decoupled design and maintainability, but we’re here today to talk about performance.</p>
</div>
<div class="paragraph">
<p>I want to start today with a short lecture on how I think about the history of the evolution of computers and why I think writing high performance software is important .</p>
</div>
<div class="paragraph">
<p>The reality is that software runs on hardware, so to talk about writing high performance code, first  we need to talk about the hardware that runs our code.</p>
</div>
<div class="sect2">
<h3 id="mechanical_sympathy"><a class="anchor" href="#mechanical_sympathy"></a><a class="link" href="#mechanical_sympathy">1.1. Mechanical Sympathy</a></h3>
<div class="imageblock">
<div class="content">
<img src="images/image-20180818145606919.png" alt="image 20180818145606919">
</div>
</div>
<div class="paragraph">
<p>There is a term in popular use at the moment, you’ll hear people like Martin Thompson or Bill Kennedy talk about “mechanical sympathy”.</p>
</div>
<div class="paragraph">
<p>The name "Mechanical Sympathy" comes from the great racing car driver Jackie Stewart, who was a 3 times world Formula 1 champion. He believed that the best drivers had enough understanding of how a machine worked so they could work in harmony with it.</p>
</div>
<div class="paragraph">
<p>To be a great race car driver, you don’t need to be a great mechanic, but you need to have more than a cursory understanding of how a motor car works.</p>
</div>
<div class="paragraph">
<p>I believe the same is true for us as software engineers.
I don’t think any of us in this room will be a professional CPU designer, but that doesn’t mean we can ignore the problems that CPU designers face.</p>
</div>
</div>
<div class="sect2">
<h3 id="six_orders_of_magnitude"><a class="anchor" href="#six_orders_of_magnitude"></a><a class="link" href="#six_orders_of_magnitude">1.2. Six orders of magnitude</a></h3>
<div class="paragraph">
<p>There’s a common internet meme that goes something like this;</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/jalopnik.png" alt="jalopnik">
</div>
</div>
<div class="paragraph">
<p>Of course this is preposterous, but it underscores just how much has changed in the computing industry.</p>
</div>
<div class="paragraph">
<p>As software authors all of us in this room have benefited from Moore&#8217;s Law, the doubling of the number of available transistors on a chip every 18 months, for 40 years.
No other industry has experienced a <em>six order of magnitude <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></em> improvement in their tools in the space of a lifetime.</p>
</div>
<div class="paragraph">
<p>But this is all changing.</p>
</div>
</div>
<div class="sect2">
<h3 id="are_computers_still_getting_faster"><a class="anchor" href="#are_computers_still_getting_faster"></a><a class="link" href="#are_computers_still_getting_faster">1.3. Are computers still getting faster?</a></h3>
<div class="paragraph">
<p>So the fundamental question is, confronted with statistic like the ones in the image above, should we ask the question <em>are computers still getting faster</em>?</p>
</div>
<div class="paragraph">
<p>If computers are still getting faster then maybe we don’t need to care about the performance of our code, we just wait a bit and the hardware manufacturers will solve our performance problems for us.</p>
</div>
<div class="sect3">
<h4 id="lets_look_at_the_data"><a class="anchor" href="#lets_look_at_the_data"></a><a class="link" href="#lets_look_at_the_data">1.3.1. Let&#8217;s look at the data</a></h4>
<div class="paragraph">
<p>This is the classic data you’ll find in textbooks like <em>Computer Architecture, A Quantitative Approach</em> by John L. Hennessy and David A. Patterson.
This graph was taken from the 5th edition</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://community.cadence.com/cfs-file/__key/communityserver-blogs-components-weblogfiles/00-00-00-01-06/2313.processorperf.jpg" alt="2313.processorperf">
</div>
</div>
<div class="paragraph">
<p>In the 5th edition, Hennessey and Patterson argue that there are three eras of computing performance</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The first was the 1970’s and early 80’s which was the formative years. Microprocessors as we know them today didn’t really exist, computers were built from discrete transistors or small scale integrated circuits. Cost, size, and the limitations in the understanding of material science were the limiting factor.</p>
</li>
<li>
<p>From the mid 80s to 2004 the trend line is clear. Computer integer performance improved on average by 52% each year. Computer power doubled every two years, hence people conflated Moore’s law — the doubling of the number of transistors on a die, with computer performance.</p>
</li>
<li>
<p>Then we come to the third era of computer performance. Things slow down. The aggregate rate of change is 22% per year.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>That previous graph only went up to 2012, but fortunately in 2012 <a href="http://preshing.com/20120208/a-look-back-at-single-threaded-cpu-performance/">Jeff Preshing</a> wrote a <a href="https://github.com/preshing/analyze-spec-benchmarks">tool to scrape the Spec website and build your own graph</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/int_graph.png" alt="int graph">
</div>
</div>
<div class="paragraph">
<p>So this is the same graph using Spec data from 1995 til 2017.</p>
</div>
<div class="paragraph">
<p>To me, rather than the step change we saw in the 2012 data, I’d say that <em>single core</em> performance is approaching a limit.
The numbers are slightly better for floating point, but for us in the room doing line of business applications, this is probably not that relevant.</p>
</div>
</div>
<div class="sect3">
<h4 id="yes_computer_are_still_getting_faster_slowly"><a class="anchor" href="#yes_computer_are_still_getting_faster_slowly"></a><a class="link" href="#yes_computer_are_still_getting_faster_slowly">1.3.2. Yes, computer are still getting faster, slowly</a></h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The first thing to remember about the ending of Moore&#8217;s law is something Gordon Moore told me.
He said "All exponentials come to an end".&#8201;&#8212;&#8201;<a href="https://www.youtube.com/watch?v=Azt8Nc-mtKM">John Hennessy</a></p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This is Hennessy&#8217;s quote from Google Next 18 and his Turing Award lecture.
His contention is yes, CPU performance is still improving.
However, single threaded integer performance is still improving around 2-3% per year.
At this rate its going to take 20 years of compounding growth to double integer performance. Compare that to the go-go days of the 90&#8217;s where performance was doubling every two years.</p>
</div>
<div class="paragraph">
<p>Why is this happening?</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="clock_speeds"><a class="anchor" href="#clock_speeds"></a><a class="link" href="#clock_speeds">1.4. Clock speeds</a></h3>
<div class="imageblock">
<div class="content">
<img src="images/stuttering.png" alt="stuttering">
</div>
</div>
<div class="paragraph">
<p>This graph from 2015 demonstrates this well.
The top line shows the number of transistors on a die.
This has continued in a roughly linear trend line since the 1970&#8217;s.
As this is a log/lin graph this linear series represents exponential growth.</p>
</div>
<div class="paragraph">
<p>However, If we look at the middle line, we see clock speeds have not increased in a decade, we see that cpu speeds stalled around 2004</p>
</div>
<div class="paragraph">
<p>The bottom graph shows thermal dissipation power; that is electrical power that is turned into heat, follows a same pattern&#8212;&#8203;clock speeds and cpu heat dissipation are correlated.</p>
</div>
</div>
<div class="sect2">
<h3 id="heat"><a class="anchor" href="#heat"></a><a class="link" href="#heat">1.5. Heat</a></h3>
<div class="paragraph">
<p>Why does a CPU produce heat?
It&#8217;s a solid state device, there are no moving components, so effects like friction are not (directly) relevant here.</p>
</div>
<div class="paragraph">
<p>This digram is taken from a great <a href="http://www.ti.com/lit/an/scaa035b/scaa035b.pdf">data sheet produced by TI</a>.
In this model the switch in N typed devices is attracted to a positive voltage P type devices are repelled from a positive voltage.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cmos-inverter.png" alt="cmos inverter">
</div>
</div>
<div class="paragraph">
<p>The power consumption of a CMOS device, which is what every transistor in this room, on your desk, and in your pocket, is made from, is combination of three factors.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Static power. When a transistor is static, that is, not changing its state, there is a small amount of current that leaks through the transistor to ground. The smaller the transistor, the more leakage. Leakage increases with temperature. Even a minute amount of leakage adds up when you have billions of transistors!</p>
</li>
<li>
<p>Dynamic power. When a transistor transitions from one state to another, it must charge or discharge the various capacitances it is connected to the gate. Dynamic power per transistor is the voltage squared times the capacitance and the frequency of change. Lowering the voltage can reduce the power consumed by a transistor, but lower voltages causes the transistor to switch slower.</p>
</li>
<li>
<p>Crowbar, or short circuit current. We like to think of transistors as digital devices occupying one state or another, off or on, atomically. In reality a transistor is an analog device. As a switch a transistor starts out <em>mostly</em> off, and transitions, or switches, to a state of being <em>mostly</em> on. This transition or switching time is very fast, in modern processors it is in the order of pico seconds, but that still represents a period of time when there is a low resistance path from Vcc to ground. The faster the transistor  switches, its frequency, the more heat is dissipated.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="the_end_of_dennard_scaling"><a class="anchor" href="#the_end_of_dennard_scaling"></a><a class="link" href="#the_end_of_dennard_scaling">1.6. The end of Dennard scaling</a></h3>
<div class="paragraph">
<p>To understand what happened next we need to look to a paper written in 1974 co-authored by <a href="https://en.wikipedia.org/wiki/Robert_H._Dennard">Robert H. Dennard</a>.
Dennard&#8217;s Scaling law states roughly that as transistors get smaller their <a href="https://en.wikipedia.org/wiki/Power_density">power density</a> stays constant.
Smaller transistors can run at lower voltages, have lower gate capacitance, and switch faster, which helps reduce the amount of dynamic power.</p>
</div>
<div class="paragraph">
<p>So how did that work out?</p>
</div>
<div class="imageblock">
<div class="content">
<img src="http://semiengineering.com/wp-content/uploads/2014/04/Screen-Shot-2014-04-14-at-8.49.48-AM.png" alt="Screen Shot 2014 04 14 at 8.49.48 AM">
</div>
</div>
<div class="paragraph">
<p>It turns out not so great. As the gate length of the transistor approaches the width of a few silicon atom, the relationship between transistor size, voltage, and importantly leakage broke down.</p>
</div>
<div class="paragraph">
<p>It was postulated at the <a href="https://pdfs.semanticscholar.org/6a82/1a3329a60def23235c75b152055c36d40437.pdf">Micro-32 conference in 1999</a> that if we followed the trend line of increasing clock speed and shrinking transistor dimensions then within a processor generation the transistor junction would approach the temperature of the core of a nuclear reactor.
Obviously this is was lunacy.
The Pentium 4 <a href="https://arstechnica.com/uncategorized/2004/10/4311-2/">marked the end of the line</a> for single core, high frequency, consumer CPUs.</p>
</div>
<div class="paragraph">
<p>Returning to this graph, we see that the reason clock speeds have stalled is because cpu’s exceeded our ability to cool them. By 2006 reducing the size of the transistor no longer improved its power efficiency.</p>
</div>
<div class="paragraph">
<p>We now know that CPU feature size reductions are primarily aimed at reducing power consumption.
Reducing power consumption doesn&#8217;t just mean “green”, like recycle, save the planet.
The primary goal is to keep power consumption, and thus heat dissipation, <a href="https://en.wikipedia.org/wiki/Electromigration#Practical_implications_of_electromigration">below levels that will damage the CPU</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/stuttering.png" alt="stuttering">
</div>
</div>
<div class="paragraph">
<p>But, there is one part of the graph that is continuing to increase, the number of transistors on a die.
The march of cpu features size, more transistors in the same given area, has both positive and negative effects.</p>
</div>
<div class="paragraph">
<p>Also, as you can see in the insert, the cost per transistor continued to fall until around 5 years ago, and then the cost per transistor started to go back up again.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://whatsthebigdata.files.wordpress.com/2016/08/moores-law.png" alt="moores law">
</div>
</div>
<div class="paragraph">
<p>Not only is it getting more expensive to create smaller transistors, it’s getting harder.
This report from 2016 shows the prediction of what the chip makers believed would occur in 2013; two years later they had missed all their predictions, and while I don’t have an updated version of this report, there are no signs that they are going to be able to reverse this trend.</p>
</div>
<div class="paragraph">
<p>It is costing intel, TSMC, AMD, and Samsung billions of dollars because they have to build new fabs, buy all new process tooling. So while the number of transistors per die continues to increase, their unit cost has started to increase.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Even the term gate length, measured in nano meters, has become ambiguous.
Various manufacturers measure the size of their transistors in different ways allowing them to demonstrate a smaller number than their competitors without perhaps delivering.
This is the Non-GAAP Earning reporting model of CPU manufacturers.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="more_cores"><a class="anchor" href="#more_cores"></a><a class="link" href="#more_cores">1.7. More cores</a></h3>
<div class="imageblock">
<div class="content">
<img src="https://i.redd.it/y5cdp7nhs2uy.jpg" alt="y5cdp7nhs2uy">
</div>
</div>
<div class="paragraph">
<p>With thermal and frequency limits reached it’s no longer possible to make a single core run twice as fast.
But, if you add another cores you can provide twice the processing capacity — if the software can support it.</p>
</div>
<div class="paragraph">
<p>In truth, the core count of a CPU is dominated by heat dissipation.
The end of Dennard scaling means that the clock speed of a CPU is some arbitrary number between 1 and 4 Ghz depending on how hot it is.
We&#8217;ll see this shortly when we talk about benchmarking.</p>
</div>
</div>
<div class="sect2">
<h3 id="amdahls_law"><a class="anchor" href="#amdahls_law"></a><a class="link" href="#amdahls_law">1.8. Amdahl&#8217;s law</a></h3>
<div class="paragraph">
<p>CPUs are not getting faster, but they are getting wider with hyper threading and multiple cores.
Dual core on mobile parts, quad core on desktop parts, dozens of cores on server parts.
Will this be the future of computer performance? Unfortunately not.</p>
</div>
<div class="paragraph">
<p>Amdahl&#8217;s law, named after the Gene Amdahl the designer of the IBM/360, is a formula which gives the theoretical speedup in latency of the execution of a task at fixed workload that can be expected of a system whose resources are improved.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://upload.wikimedia.org/wikipedia/commons/e/ea/AmdahlsLaw.svg" alt="AmdahlsLaw">
</div>
</div>
<div class="paragraph">
<p>Amdahl&#8217;s law tells us that the maximum speedup of a program is limited by the sequential parts of the program.
If you write a program with 95% of its execution able to be run in parallel, even with thousands of processors the maximum speedup in the programs execution is limited to 20x.</p>
</div>
<div class="paragraph">
<p>Think about the programs that you work on every day, how much of their execution is parralisable?</p>
</div>
</div>
<div class="sect2">
<h3 id="dynamic_optimisations"><a class="anchor" href="#dynamic_optimisations"></a><a class="link" href="#dynamic_optimisations">1.9. Dynamic Optimisations</a></h3>
<div class="paragraph">
<p>With clock speeds stalled and limited returns from throwing extra cores at the problem, where are the speedups coming from?
They are coming from architectural improvements in the chips themselves.
These are the big five to seven year projects with names like <a href="https://en.wikipedia.org/wiki/List_of_Intel_CPU_microarchitectures#Pentium_4_/_Core_Lines">Nehalem, Sandy Bridge, and Skylake</a>.</p>
</div>
<div class="paragraph">
<p>Much of the improvement in performance in the last two decades has come from architectural improvements:</p>
</div>
<div class="sect3">
<h4 id="out_of_order_execution"><a class="anchor" href="#out_of_order_execution"></a><a class="link" href="#out_of_order_execution">1.9.1. Out of order execution</a></h4>
<div class="paragraph">
<p>Out of Order, also known as super scalar, execution is a way of extracting so called <em>Instruction level parallelism</em> from the code the CPU is executing.
Modern CPUs effectively do SSA at the hardware level to identify data dependencies between operations, and where possible run independent instructions in parallel.</p>
</div>
<div class="paragraph">
<p>However there is a limit to the amount of parallelism inherent in any piece of code.
It&#8217;s also tremendously power hungry.
Most modern CPUs have settled on six execution units per core as there is an n squared cost of connecting each execution unit to all others at each stage of the pipeline.</p>
</div>
</div>
<div class="sect3">
<h4 id="speculative_execution"><a class="anchor" href="#speculative_execution"></a><a class="link" href="#speculative_execution">1.9.2. Speculative execution</a></h4>
<div class="paragraph">
<p>Save the smallest micro controllers, all CPUs utilise an <em>instruction pipeline</em> to overlap parts of in the instruction fetch/decode/execute/commit cycle.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/21/Fivestagespipeline.png/800px-Fivestagespipeline.png" alt="800px Fivestagespipeline">
</div>
</div>
<div class="paragraph">
<p>The problem with an instruction pipeline is branch instructions, which occur every 5-8 instructions on average.
When a CPU reaches a branch it cannot look beyond the branch for additional instructions to execute and it cannot start filling its pipeline until it knows where the program counter will branch too.
Speculative execution allows the CPU to "guess" which path the branch will take <em>while the branch instruction is still being processed!</em></p>
</div>
<div class="paragraph">
<p>If the CPU predicts the branch correctly then it can keep its pipeline of instructions full.
If the CPU fails to predict the correct branch then when it realises the mistake it must roll back any change that were made to its <em>architectural state</em>.
As we&#8217;re all learning through Spectre style vulnerabilities, sometimes this rollback isn&#8217;t as seamless as hoped.</p>
</div>
<div class="paragraph">
<p>Speculative execution can be very power hungry when branch prediction rates are low.
If the branch is misprediction, not only must the CPU backtrace to the point of the misprediction, but the energy expended on the incorrect branch is wasted.</p>
</div>
<div class="paragraph">
<p>All these optimisations lead to the improvements in single threaded performance we&#8217;ve seen, at the cost of huge numbers of transistors and power.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Cliff Click has a <a href="https://www.youtube.com/watch?v=OFgxAFdxYAQ">wonderful presentation</a> that argues out of order and speculative execution is most useful for starting cache misses early thereby reducing observed cache latency.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="modern_cpus_are_optimised_for_bulk_operations"><a class="anchor" href="#modern_cpus_are_optimised_for_bulk_operations"></a><a class="link" href="#modern_cpus_are_optimised_for_bulk_operations">1.10. Modern CPUs are optimised for bulk operations</a></h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Modern processors are a like nitro fuelled funny cars, they excel at the quarter mile. Unfortunately modern programming languages are like Monte Carlo, they are full of twists and turns.&#8201;&#8212;&#8201;David Ungar</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This a quote from David Ungar, an influential computer scientist and the developer of the SELF programming language that was referenced in a very old presentation I found online.</p>
</div>
<div class="paragraph">
<p>Thus, modern CPUs are optimised for bulk transfers and bulk operations.
At every level, the setup cost of an operation encourages you to work in bulk. Some examples include</p>
</div>
<div class="ulist">
<ul>
<li>
<p>memory is not loaded per byte, but per multiple of cache lines, this is why alignment is becoming less of an issue than it was in earlier computers.</p>
</li>
<li>
<p>Vector instructions like MMX and SSE allow a single instruction to execute against multiple items of data concurrently providing your program can be expressed in that form.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="modern_processors_are_limited_by_memory_latency_not_memory_capacity"><a class="anchor" href="#modern_processors_are_limited_by_memory_latency_not_memory_capacity"></a><a class="link" href="#modern_processors_are_limited_by_memory_latency_not_memory_capacity">1.11. Modern processors are limited by memory latency not memory capacity</a></h3>
<div class="paragraph">
<p>If the situation in CPU land wasn&#8217;t bad enough, the news from the memory side of the house doesn&#8217;t get much better.</p>
</div>
<div class="paragraph">
<p>Physical memory attached to a server has increased geometrically.
My first computer in the 1980’s had kilobytes of memory.
When I went through high school I wrote all my essays on a 386 with 1.8 megabytes of ram.
Now its commonplace to find servers with tens or hundreds of gigabytes of ram, and the cloud providers are pushing into the terabytes of ram.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://www.extremetech.com/wp-content/uploads/2018/01/mem_gap.png" alt="mem gap">
</div>
</div>
<div class="paragraph">
<p>However, the gap between processor speeds and memory access time continues to grow.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="https://pbs.twimg.com/media/BmBr2mwCIAAhJo1.png" alt="BmBr2mwCIAAhJo1">
</div>
</div>
<div class="paragraph">
<p>But, in terms of processor cycles lost waiting for memory, physical memory is still as far away as ever because memory has not kept pace with the increases in CPU speed.</p>
</div>
<div class="paragraph">
<p>So, most modern processors are limited by memory latency not capacity.</p>
</div>
</div>
<div class="sect2">
<h3 id="cache_rules_everything_around_me"><a class="anchor" href="#cache_rules_everything_around_me"></a><a class="link" href="#cache_rules_everything_around_me">1.12. Cache rules everything around me</a></h3>
<div class="imageblock">
<div class="content">
<img src="https://www.extremetech.com/wp-content/uploads/2014/08/latency.png" alt="latency">
</div>
</div>
<div class="paragraph">
<p>For decades the solution to the processor/memory cap was to add a cache-- a piece of small fast memory located closer, and now directly integrated onto, the CPU.</p>
</div>
<div class="paragraph">
<p>But;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>L1 has been stuck at 32kb per core for decades</p>
</li>
<li>
<p>L2 has slowly crept up to 512kb on the largest intel parts</p>
</li>
<li>
<p>L3 is now measured in 4-32mb range, but its access time is variable</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="https://i3.wp.com/computing.llnl.gov/tutorials/linux_clusters/images/E5v4blockdiagram.png" alt="E5v4blockdiagram">
</div>
</div>
<div class="paragraph">
<p>By caches are limited in size because they are <a href="http://www.itrs.net/Links/2000UpdateFinal/Design2000final.pdf">physically large on the CPU die</a>, consume a lot of power.
To halve the cache miss rate you must <em>quadruple</em> the cache size.</p>
</div>
</div>
<div class="sect2">
<h3 id="the_free_lunch_is_over"><a class="anchor" href="#the_free_lunch_is_over"></a><a class="link" href="#the_free_lunch_is_over">1.13. The free lunch is over</a></h3>
<div class="paragraph">
<p>In 2005 Herb Sutter, the C++ committee leader, wrote an article entitled <a href="http://www.gotw.ca/publications/concurrency-ddj.htm">The free lunch is over</a>.
In his article Sutter discussed all the points I covered and asserted that future programmers will not longer be able to rely on faster hardware to fix slow programs&#8212;&#8203;or slow programming languages.</p>
</div>
<div class="paragraph">
<p>Now, more than a decade later, there is no doubt that Herb Sutter was right.
Memory is slow, caches are too small, CPU clock speeds are going backwards, and the simple world of a single threaded CPU is long gone.</p>
</div>
<div class="paragraph">
<p>Moore&#8217;s Law is still in effect, but for all of us in this room, the free lunch is over.</p>
</div>
</div>
<div class="sect2">
<h3 id="conc"><a class="anchor" href="#conc"></a><a class="link" href="#conc">1.14. Conclusion</a></h3>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The numbers I would cite would be by 2010: 30GHz, 10billion transistors, and 1 tera-instruction per second.&#8201;&#8212;&#8201;<a href="https://www.cnet.com/news/intel-cto-chip-heat-becoming-critical-issue/">Pat Gelsinger, Intel CTO, April 2002</a></p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>It&#8217;s clear that without a breakthrough in material science the likelihood of a return to the days of 52% year on year growth in CPU performance is vanishingly small.
The common consensus is that the fault lies not with the material science itself, but how the transistors are being used.
The logical model of sequential instruction flow as expressed in silicon has lead to this expensive endgame.</p>
</div>
<div class="paragraph">
<p>There are many presentations online that rehash this point.
They all have the same prediction&#8201;&#8212;&#8201;computers in the future will not be programmed like they are today.
Some argue it&#8217;ll look more like graphics cards with hundreds of very dumb, very incoherent processors.
Others argue that Very Long Instruction Word (VLIW) computers will become predominant.
All agree that our current sequential programming languages will not be compatible with these kinds of processors.</p>
</div>
<div class="paragraph">
<p>My view is that these predictions are correct, the outlook for hardware manufacturers saving us at this point is grim.
However, there is <em>enormous</em> scope to optimise the programs today we write for the hardware we have today.
Rick Hudson spoke at GopherCon 2015 about <a href="https://talks.golang.org/2015/go-gc.pdf">reengaging with a "virtuous cycle"</a> of software that works <em>with</em> the hardware we have today, not indiferent of it.</p>
</div>
<div class="paragraph">
<p>Looking at the graphs I showed earlier, from 2015 to 2018 with at best a 5-8% improvement in integer performance and less than that in memory latency, the Go team have decreased the garbage collector pause times by <a href="https://blog.golang.org/ismmkeynote">two orders of magnitude</a>.
A Go 1.11 program exhibits significantly better GC latency than the same program on the same hardware using Go 1.6.
None of this came from hardware.</p>
</div>
<div class="paragraph">
<p>So, for best performance on today&#8217;s hardware in today&#8217;s world, you need a programming language which:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Is compiled, not interpreted, because interpreted programming languages interact poorly with CPU branch predictors and speculative execution.</p>
</li>
<li>
<p>You need a language which permits efficient code to be written, it needs to be able to talk about bits and bytes, and the length of an integer efficiently, rather than pretend every number is an ideal float.</p>
</li>
<li>
<p>You need a language which lets programmers talk about memory effectively, think structs vs java objects, because all that pointer chasing puts pressure on the CPU cache and cache misses burn hundreds of cycles.</p>
</li>
<li>
<p>A programming language that scales to multiple cores as  performance of an application is determined by how efficiently it uses its cache and how efficiently it can parallelise work over multiple cores.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Obviously we&#8217;re here to talk about Go, and I believe that Go inherits many of the traits I just described.</p>
</div>
<div class="sect3">
<h4 id="what_does_that_mean_for_us"><a class="anchor" href="#what_does_that_mean_for_us"></a><a class="link" href="#what_does_that_mean_for_us">1.14.1. What does that mean for us?</a></h4>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>There are only three optimizations: Do less. Do it less often. Do it faster.</p>
</div>
<div class="paragraph">
<p>The largest gains come from 1, but we spend all our time on 3.&#8201;&#8212;&#8201;<a href="https://twitter.com/creachadair/status/1039602865831010305">Michael Fromberger</a></p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The point of this lecture was to illustrate that when you&#8217;re talking about the performance of a program or a system is entirely in the software.
Waiting for faster hardware to save the day is a fool&#8217;s errand.</p>
</div>
<div class="paragraph">
<p>But there is good news, there is a tonne of improvements we can make in software, and that is what we&#8217;re going to talk about today.</p>
</div>
</div>
<div class="sect3">
<h4 id="further_reading"><a class="anchor" href="#further_reading"></a><a class="link" href="#further_reading">1.14.2. Further reading</a></h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.youtube.com/watch?v=zX4ZNfvw1cw">The Future of Microprocessors, Sophie Wilson</a> JuliaCon 2018</p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=HnniEPtNs-4">50 Years of Computer Architecture: From Mainframe CPUs to DNN TPUs, David Patterson</a></p>
</li>
<li>
<p><a href="https://web.stanford.edu/~hennessy/Future%20of%20Computing.pdf">The Future of Computing, John Hennessy</a></p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=Azt8Nc-mtKM">The future of computing: a conversation with John Hennessy</a>  (Google I/O '18)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="benchmarking"><a class="anchor" href="#benchmarking"></a><a class="link" href="#benchmarking">2. Benchmarking</a></h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Measure twice and cut once.&#8201;&#8212;&#8201;Ancient proverb</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Before we attempt to improve the performance of a piece of code, first we must know its current performance.</p>
</div>
<div class="paragraph">
<p>This section focuses on how to construct useful benchmarks using the Go testing framework, and gives practical tips for avoiding the pitfalls.</p>
</div>
<div class="sect2">
<h3 id="benchmarking_ground_rules"><a class="anchor" href="#benchmarking_ground_rules"></a><a class="link" href="#benchmarking_ground_rules">2.1. Benchmarking ground rules</a></h3>
<div class="paragraph">
<p>Before you benchmark, you must have a stable environment to get repeatable results.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The machine must be idle&#8212;&#8203;don&#8217;t profile on shared hardware, don&#8217;t browse the web while waiting for a long benchmark to run.</p>
</li>
<li>
<p>Watch out for power saving and thermal scaling. These are almost unavoidable on modern laptops.</p>
</li>
<li>
<p>Avoid virtual machines and shared cloud hosting; they can be too noisy for consistent measurements.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you can afford it, buy dedicated performance test hardware.
Rack it, disable all the power management and thermal scaling, and never update the software on those machines.
The last point is poor advice from a system adminstration point of view, but if a software update changes the way the kernel or library performs&#8212;&#8203;think the Spectre patches&#8212;&#8203;this will invalidate any previous benchmarking results.</p>
</div>
<div class="paragraph">
<p>For the rest of us, have a before and after sample and run them multiple times to get consistent results.</p>
</div>
</div>
<div class="sect2">
<h3 id="using_the_testing_package_for_benchmarking"><a class="anchor" href="#using_the_testing_package_for_benchmarking"></a><a class="link" href="#using_the_testing_package_for_benchmarking">2.2. Using the testing package for benchmarking</a></h3>
<div class="paragraph">
<p>The <code>testing</code> package has built in support for writing benchmarks.
If we have a simple function like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="go"><span></span><span class="tok-kd">func</span> <span class="tok-nx">Fib</span><span class="tok-p">(</span><span class="tok-nx">n</span> <span class="tok-kt">int</span><span class="tok-p">)</span> <span class="tok-kt">int</span> <span class="tok-p">{</span>
	<span class="tok-k">switch</span> <span class="tok-nx">n</span> <span class="tok-p">{</span>
	<span class="tok-k">case</span> <span class="tok-mi">0</span><span class="tok-p">:</span>
		<span class="tok-k">return</span> <span class="tok-mi">0</span>
	<span class="tok-k">case</span> <span class="tok-mi">1</span><span class="tok-p">:</span>
		<span class="tok-k">return</span> <span class="tok-mi">1</span>
	<span class="tok-k">case</span> <span class="tok-mi">2</span><span class="tok-p">:</span>
		<span class="tok-k">return</span> <span class="tok-mi">2</span>
	<span class="tok-k">default</span><span class="tok-p">:</span>
		<span class="tok-k">return</span> <span class="tok-nx">Fib</span><span class="tok-p">(</span><span class="tok-nx">n</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">)</span> <span class="tok-o">+</span> <span class="tok-nx">Fib</span><span class="tok-p">(</span><span class="tok-nx">n</span><span class="tok-o">-</span><span class="tok-mi">2</span><span class="tok-p">)</span>
	<span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The we can use the <code>testing</code> package to write a <em>benchmark</em> for the function using this form.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="go"><span></span><span class="tok-kd">func</span> <span class="tok-nx">BenchmarkFib20</span><span class="tok-p">(</span><span class="tok-nx">b</span> <span class="tok-o">*</span><span class="tok-nx">testing</span><span class="tok-p">.</span><span class="tok-nx">B</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-k">for</span> <span class="tok-nx">n</span> <span class="tok-o">:=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-nx">n</span> <span class="tok-p">&lt;</span> <span class="tok-nx">b</span><span class="tok-p">.</span><span class="tok-nx">N</span><span class="tok-p">;</span> <span class="tok-nx">n</span><span class="tok-o">++</span> <span class="tok-p">{</span>
		<span class="tok-nx">Fib</span><span class="tok-p">(</span><span class="tok-mi">20</span><span class="tok-p">)</span> <span class="tok-c1">// run the Fib function b.N times</span>
	<span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The benchmark function lives alongside your tests in a <code>_test.go</code> file.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Benchmarks are similar to tests, the only real difference is they take a <code>*testing.B</code> rather than a <code>*testing.T</code>.
Both of these types implement the <code>testing.TB</code> interface which provides crowd favorites like <code>Errorf()</code>, <code>Fatalf()</code>, and <code>FailNow()</code>.</p>
</div>
<div class="sect3">
<h4 id="running_a_packages_benchmarks"><a class="anchor" href="#running_a_packages_benchmarks"></a><a class="link" href="#running_a_packages_benchmarks">2.2.1. Running a package&#8217;s benchmarks</a></h4>
<div class="paragraph">
<p>As benchmarks use the <code>testing</code> package they are executed via the <code>go test</code> subcommand.
However, by default when you invoke <code>go test</code>, benchmarks are excluded.</p>
</div>
<div class="paragraph">
<p>To explicitly run benchmarks in a package use the <code>-bench</code> flag. <code>-bench</code> takes a regular expression that matches the names of the benchmarks you want to run, so the most common way to invoke all benchmarks in a package is <code>-bench=.</code>.
Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% go test -bench=. ./examples/fib/
goos: darwin
goarch: amd64
BenchmarkFib20-8           30000             40865 ns/op
PASS
ok      _/Users/dfc/devel/high-performance-go-workshop/examples/fib     1.671s</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>go test</code> will also run all the tests in a package before matching benchmarks, so if you have a lot of tests in a package, or they take a long time to run, you can exclude them by providing <code>go test&#8217;s `-run</code> flag with a regex that matches nothing; ie.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>go test -run=^$</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="how_benchmarks_work"><a class="anchor" href="#how_benchmarks_work"></a><a class="link" href="#how_benchmarks_work">2.2.2. How benchmarks work</a></h4>
<div class="paragraph">
<p>Each benchmark function is called with different value for <code>b.N</code>, this is the number of iterations the benchmark should run for.</p>
</div>
<div class="paragraph">
<p><code>b.N</code> starts at 1, if the benchmark function completes in under 1 second&#8212;&#8203;the default&#8212;&#8203;then <code>b.N</code> is increased and the benchmark function run again.</p>
</div>
<div class="paragraph">
<p><code>b.N</code> increases in the approximate sequence; 1, 2, 3, 5, 10, 20, 30, 50, 100, and so on. The benchmark framework tries to be smart and if it sees small values of <code>b.N</code> are completing relatively quickly, it will increase the the iteration count faster.</p>
</div>
<div class="paragraph">
<p>Looking at the example above, <code>BenchmarkFib20-8</code> found that around 30,000 iterations of the loop took just over a second.
From there the benchmark framework computed that the average time per operation was 40865ns.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>-8</code> suffix relates to the value of <code>GOMAXPROCS</code> that was used to run this test.
This number, like <code>GOMAXPROCS</code>, defaults to the number of CPUs visible to the Go process on startup.
You can change this value with the <code>-cpu</code> flag which takes a list of values to run the benchmark with.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% go test -bench=. -cpu=1,2,4 ./examples/fib/
goos: darwin
goarch: amd64
BenchmarkFib20             30000             39115 ns/op
BenchmarkFib20-2           30000             39468 ns/op
BenchmarkFib20-4           50000             40728 ns/op
PASS
ok      _/Users/dfc/devel/high-performance-go-workshop/examples/fib     5.531s</code></pre>
</div>
</div>
<div class="paragraph">
<p>This shows running the benchmark with 1, 2, and 4 cores.
In this case the flag has little effect on the outcome because this benchmark is entirely sequential.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="improving_benchmark_accuracy"><a class="anchor" href="#improving_benchmark_accuracy"></a><a class="link" href="#improving_benchmark_accuracy">2.2.3. Improving benchmark accuracy</a></h4>
<div class="paragraph">
<p>The <code>fib</code> function is a slightly contrived example&#8212;&#8203;unless your writing a TechPower web server benchmark&#8212;&#8203;it&#8217;s unlikely your business is going to be gated on how quickly you can compute the 20th number in the Fibonaci sequence.
But, the benchmark does provide a faithful example of a valid benchmark.</p>
</div>
<div class="paragraph">
<p>Specifically you want your benchmark to run for several tens of thousand iterations so you get a good average per operation.
If your benchmark runs for only 100&#8217;s or 10&#8217;s of iterations, the average of those runs may have a high standard deviation.
If your benchmark runs for millions or billions of iterations, the average may be very accurate, but subject to the vaguaries of code layout and alignment.</p>
</div>
<div class="paragraph">
<p>To increase the number of iterations, the benchmark time can be increased with the <code>-benchtime</code> flag. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% go test -bench=. -benchtime=10s ./examples/fib/
goos: darwin
goarch: amd64
BenchmarkFib20-8          300000             39318 ns/op
PASS
ok      _/Users/dfc/devel/high-performance-go-workshop/examples/fib     20.066s</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ran the same benchmark until it reached a value of <code>b.N</code> that took longer than 10 seconds to return.
As we&#8217;re running for 10x longer, the total number of iterations is 10x larger.
The result hasn&#8217;t changed much, which is what we expected.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Why is the total time reporteded to be 20 seconds, not 10?</p>
</div>
</div>
</div>
<div class="paragraph">
<p>If you have a benchmark which runs for millons or billions of iterations resulting in a time per operation in the micro or nano second range, you may find that your benchmark numbers are unstable because thermal scaling, memory locality, background processing, gc activity, etc.</p>
</div>
<div class="paragraph">
<p>For times measured in 10 or single digit nanoseconds per operation the relativistic effects of instruction reordering and code alignment will have an impact on your benchmark times.</p>
</div>
<div class="paragraph">
<p>To address this run benchmarks multiple times with the <code>-count</code> flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% go test -bench=Fib1 -count=10 ./examples/fib/
goos: darwin
goarch: amd64
BenchmarkFib1-8         2000000000               1.99 ns/op
BenchmarkFib1-8         1000000000               1.95 ns/op
BenchmarkFib1-8         2000000000               1.99 ns/op
BenchmarkFib1-8         2000000000               1.97 ns/op
BenchmarkFib1-8         2000000000               1.99 ns/op
BenchmarkFib1-8         2000000000               1.96 ns/op
BenchmarkFib1-8         2000000000               1.99 ns/op
BenchmarkFib1-8         2000000000               2.01 ns/op
BenchmarkFib1-8         2000000000               1.99 ns/op
BenchmarkFib1-8         1000000000               2.00 ns/op</code></pre>
</div>
</div>
<div class="paragraph">
<p>A benchmark of <code>Fib(1)</code> takes around 2 nano seconds with a variance of +/- 2%.</p>
</div>
<div class="paragraph">
<p>New in Go 1.12 is the <code>-benchtime</code> flag now takes a number of iterations, eg. <code>-benchtime=20x</code> which will run your code exactly <code>benchtime</code> times.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Try running the fib bench above with a <code>-benchtime</code> of 10x, 20x, 50x, 100x, and 300x. What do you see?</p>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you find that the defaults that <code>go test</code> applies need to be tweaked for a particular package, I suggest codifying those settings in a <code>Makefile</code> so everyone who wants to run your benchmarks can do so with the same settings.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="comparing_benchmarks_with_benchstat"><a class="anchor" href="#comparing_benchmarks_with_benchstat"></a><a class="link" href="#comparing_benchmarks_with_benchstat">2.3. Comparing benchmarks with benchstat</a></h3>
<div class="paragraph">
<p>In the previous section I suggested running benchmarks more than once to get more data to average.
This is good advice for any benchmark because of the effects of power management, background processes, and thermal management that I mentioned at the start of the chapter.</p>
</div>
<div class="paragraph">
<p>I&#8217;m going to introduce a tool by Russ Cox called <a href="https://godoc.org/golang.org/x/perf/cmd/benchstat">benchstat</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% go get golang.org/x/perf/cmd/benchstat</code></pre>
</div>
</div>
<div class="paragraph">
<p>Benchstat can take a set of benchmark runs and tell you how stable they are. Here is an example of <code>Fib(20)</code> on battery power.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% go test -bench=Fib20 -count=10 ./examples/fib/ | tee old.txt
goos: darwin
goarch: amd64
BenchmarkFib20-8           50000             38479 ns/op
BenchmarkFib20-8           50000             38303 ns/op
BenchmarkFib20-8           50000             38130 ns/op
BenchmarkFib20-8           50000             38636 ns/op
BenchmarkFib20-8           50000             38784 ns/op
BenchmarkFib20-8           50000             38310 ns/op
BenchmarkFib20-8           50000             38156 ns/op
BenchmarkFib20-8           50000             38291 ns/op
BenchmarkFib20-8           50000             38075 ns/op
BenchmarkFib20-8           50000             38705 ns/op
PASS
ok      _/Users/dfc/devel/high-performance-go-workshop/examples/fib     23.125s
% benchstat old.txt
name     time/op
Fib20-8  38.4µs ± 1%</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>benchstat</code> tells us the mean is 38.8 microseconds with a +/- 2% variation across the samples.
This is pretty good for battery power.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The first run is the slowest of all because the operating system had the CPU clocked down to save power.</p>
</li>
<li>
<p>The next two runs are the fastest, because the operating system as decided that this isn&#8217;t a transient spike of work and it has boosted up the clock speed to get through the work as quick as possible in the hope of being able to go back to sleep.</p>
</li>
<li>
<p>The remaining runs are the operating system and the bios trading power consumption for heat production.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="improve_fib"><a class="anchor" href="#improve_fib"></a><a class="link" href="#improve_fib">2.3.1. Improve <code>Fib</code></a></h4>
<div class="paragraph">
<p>Determining the performance delta between two sets of benchmarks can be tedious and error prone. Benchstat can help us with this.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Saving the output from a benchmark run is useful, but you can also save the <em>binary</em> that produced it. This lets you rerun benchmark previous iterations. To do this, use the <code>-c</code> flag to save the test binary&#8212;&#8203;I often rename this binary from <code>.test</code> to <code>.golden</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>% go test -c
% mv fib.test fib.golden</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous <code>Fib</code> fuction had hard coded values for the 0th and 1st numbers in the fibonaci series. After that the code calls itself recursively.
We&#8217;ll talk about the cost of recursion later today, but for the moment, assume it has a cost, especially as our algorithm uses exponential time.</p>
</div>
<div class="paragraph">
<p>As simple fix to this would be to hard code another number from the fibonacci series, reducing the depth of each recusive call by one.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span><span class="tok-kd">func</span> <span class="tok-nx">Fib</span><span class="tok-p">(</span><span class="tok-nx">n</span> <span class="tok-kt">int</span><span class="tok-p">)</span> <span class="tok-kt">int</span> <span class="tok-p">{</span>
	<span class="tok-k">switch</span> <span class="tok-nx">n</span> <span class="tok-p">{</span>
	<span class="tok-k">case</span> <span class="tok-mi">0</span><span class="tok-p">:</span>
		<span class="tok-k">return</span> <span class="tok-mi">0</span>
	<span class="tok-k">case</span> <span class="tok-mi">1</span><span class="tok-p">:</span>
		<span class="tok-k">return</span> <span class="tok-mi">1</span>
	<span class="tok-k">case</span> <span class="tok-mi">2</span><span class="tok-p">:</span>
		<span class="tok-k">return</span> <span class="tok-mi">1</span>
	<span class="tok-k">default</span><span class="tok-p">:</span>
		<span class="tok-k">return</span> <span class="tok-nx">Fib</span><span class="tok-p">(</span><span class="tok-nx">n</span><span class="tok-o">-</span><span class="tok-mi">1</span><span class="tok-p">)</span> <span class="tok-o">+</span> <span class="tok-nx">Fib</span><span class="tok-p">(</span><span class="tok-nx">n</span><span class="tok-o">-</span><span class="tok-mi">2</span><span class="tok-p">)</span>
	<span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This file also includes a comprehensive test for <code>Fib</code>. Don&#8217;t try to improve your benchmarks without a test that verifies the current behaviour.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To compare our new version, we compile a new test binary and benchmark both of them and use <code>benchstat</code> to compare the outputs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% go test -c
% ./fib.golden -test.bench=. -test.count=10 &gt; old.txt
% ./fib.test -test.bench=. -test.count=10 &gt; new.txt
% benchstat old.txt new.txt
name     old time/op  new time/op  delta
Fib20-8  44.3µs ± 6%  25.6µs ± 2%  -42.31%  (p=0.000 n=10+10)</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are three things to check when comparing benchmarks</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The variance ± in the old and new times. 1-2% is good, 3-5% is ok, greater than 5% and some of your samples will be considered unreliable. Be careful when comparing benchmarks where one side has a high variance, you may not be seeing an improvement.</p>
</li>
<li>
<p>p value. p values lower than 0.05 are good, greater than 0.05 means the benchmark may not be statistically significant.</p>
</li>
<li>
<p>Missing samples. benchstat will report how many of the old and new samples it considered to be valid, sometimes you may find only, say, 9 reported, even though you did <code>-count=10</code>. A 10% or lower rejection rate is ok, higher than 10% may indicate your setup is unstable and you may be comparing too few samples.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="avoiding_benchmarking_start_up_costs"><a class="anchor" href="#avoiding_benchmarking_start_up_costs"></a><a class="link" href="#avoiding_benchmarking_start_up_costs">2.4. Avoiding benchmarking start up costs</a></h3>
<div class="paragraph">
<p>Sometimes your benchmark has a once per run setup cost. <code>b.ResetTimer()</code> will can be used to ignore the time accrued in setup.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="go"><span></span><span class="tok-kd">func</span> <span class="tok-nx">BenchmarkExpensive</span><span class="tok-p">(</span><span class="tok-nx">b</span> <span class="tok-o">*</span><span class="tok-nx">testing</span><span class="tok-p">.</span><span class="tok-nx">B</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-nx">boringAndExpensiveSetup</span><span class="tok-p">()</span>
        <span class="tok-nx">b</span><span class="tok-p">.</span><span class="tok-nx">ResetTimer</span><span class="tok-p">()</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="tok-k">for</span> <span class="tok-nx">n</span> <span class="tok-o">:=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-nx">n</span> <span class="tok-p">&lt;</span> <span class="tok-nx">b</span><span class="tok-p">.</span><span class="tok-nx">N</span><span class="tok-p">;</span> <span class="tok-nx">n</span><span class="tok-o">++</span> <span class="tok-p">{</span>
                <span class="tok-c1">// function under test</span>
        <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Reset the benchmark timer</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you have some expensive setup logic <em>per loop</em> iteration, use <code>b.StopTimer()</code> and <code>b.StartTimer()</code> to pause the benchmark timer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="go"><span></span><span class="tok-kd">func</span> <span class="tok-nx">BenchmarkComplicated</span><span class="tok-p">(</span><span class="tok-nx">b</span> <span class="tok-o">*</span><span class="tok-nx">testing</span><span class="tok-p">.</span><span class="tok-nx">B</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-k">for</span> <span class="tok-nx">n</span> <span class="tok-o">:=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-nx">n</span> <span class="tok-p">&lt;</span> <span class="tok-nx">b</span><span class="tok-p">.</span><span class="tok-nx">N</span><span class="tok-p">;</span> <span class="tok-nx">n</span><span class="tok-o">++</span> <span class="tok-p">{</span>
                <span class="tok-nx">b</span><span class="tok-p">.</span><span class="tok-nx">StopTimer</span><span class="tok-p">()</span> <i class="conum" data-value="1"></i><b>(1)</b>
                <span class="tok-nx">complicatedSetup</span><span class="tok-p">()</span>
                <span class="tok-nx">b</span><span class="tok-p">.</span><span class="tok-nx">StartTimer</span><span class="tok-p">()</span> <i class="conum" data-value="2"></i><b>(2)</b>
                <span class="tok-c1">// function under test</span>
        <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Pause benchmark timer</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Resume timer</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="benchmarking_allocations"><a class="anchor" href="#benchmarking_allocations"></a><a class="link" href="#benchmarking_allocations">2.5. Benchmarking allocations</a></h3>
<div class="paragraph">
<p>Allocation count and size is strongly correlated with benchmark time.
You can tell the <code>testing</code> framework to record the number of allocations made by code under test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="go"><span></span><span class="tok-kd">func</span> <span class="tok-nx">BenchmarkRead</span><span class="tok-p">(</span><span class="tok-nx">b</span> <span class="tok-o">*</span><span class="tok-nx">testing</span><span class="tok-p">.</span><span class="tok-nx">B</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-nx">b</span><span class="tok-p">.</span><span class="tok-nx">ReportAllocs</span><span class="tok-p">()</span>
        <span class="tok-k">for</span> <span class="tok-nx">n</span> <span class="tok-o">:=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-nx">n</span> <span class="tok-p">&lt;</span> <span class="tok-nx">b</span><span class="tok-p">.</span><span class="tok-nx">N</span><span class="tok-p">;</span> <span class="tok-nx">n</span><span class="tok-o">++</span> <span class="tok-p">{</span>
                <span class="tok-c1">// function under test</span>
        <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example using the <code>bufio</code> package&#8217;s benchmarks.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% go test -run=^$ -bench=. bufio
goos: darwin
goarch: amd64
pkg: bufio
BenchmarkReaderCopyOptimal-8            20000000               103 ns/op
BenchmarkReaderCopyUnoptimal-8          10000000               159 ns/op
BenchmarkReaderCopyNoWriteTo-8            500000              3644 ns/op
BenchmarkReaderWriteToOptimal-8          5000000               344 ns/op
BenchmarkWriterCopyOptimal-8            20000000                98.6 ns/op
BenchmarkWriterCopyUnoptimal-8          10000000               131 ns/op
BenchmarkWriterCopyNoReadFrom-8           300000              3955 ns/op
BenchmarkReaderEmpty-8                   2000000               789 ns/op            4224 B/op          3 allocs/op
BenchmarkWriterEmpty-8                   2000000               683 ns/op            4096 B/op          1 allocs/op
BenchmarkWriterFlush-8                  100000000               17.0 ns/op             0 B/op          0 allocs/op</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can also use the <code>go test -benchmem</code> flag to force the testing framework to report allocation statistics for all benchmarks run.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% go test -run=^$ -bench=. -benchmem bufio
goos: darwin
goarch: amd64
pkg: bufio
BenchmarkReaderCopyOptimal-8            20000000                93.5 ns/op            16 B/op          1 allocs/op
BenchmarkReaderCopyUnoptimal-8          10000000               155 ns/op              32 B/op          2 allocs/op
BenchmarkReaderCopyNoWriteTo-8            500000              3238 ns/op           32800 B/op          3 allocs/op
BenchmarkReaderWriteToOptimal-8          5000000               335 ns/op              16 B/op          1 allocs/op
BenchmarkWriterCopyOptimal-8            20000000                96.7 ns/op            16 B/op          1 allocs/op
BenchmarkWriterCopyUnoptimal-8          10000000               124 ns/op              32 B/op          2 allocs/op
BenchmarkWriterCopyNoReadFrom-8           500000              3219 ns/op           32800 B/op          3 allocs/op
BenchmarkReaderEmpty-8                   2000000               748 ns/op            4224 B/op          3 allocs/op
BenchmarkWriterEmpty-8                   2000000               662 ns/op            4096 B/op          1 allocs/op
BenchmarkWriterFlush-8                  100000000               16.9 ns/op             0 B/op          0 allocs/op
PASS
ok      bufio   20.366s</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="watch_out_for_compiler_optimisations"><a class="anchor" href="#watch_out_for_compiler_optimisations"></a><a class="link" href="#watch_out_for_compiler_optimisations">2.6. Watch out for compiler optimisations</a></h3>
<div class="paragraph">
<p>This example comes from <a href="https://github.com/golang/go/issues/14813#issue-140603392">issue 14813</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span><span class="tok-kd">const</span> <span class="tok-nx">m1</span> <span class="tok-p">=</span> <span class="tok-mh">0x5555555555555555</span>
<span class="tok-kd">const</span> <span class="tok-nx">m2</span> <span class="tok-p">=</span> <span class="tok-mh">0x3333333333333333</span>
<span class="tok-kd">const</span> <span class="tok-nx">m4</span> <span class="tok-p">=</span> <span class="tok-mh">0x0f0f0f0f0f0f0f0f</span>
<span class="tok-kd">const</span> <span class="tok-nx">h01</span> <span class="tok-p">=</span> <span class="tok-mh">0x0101010101010101</span>

<span class="tok-kd">func</span> <span class="tok-nx">popcnt</span><span class="tok-p">(</span><span class="tok-nx">x</span> <span class="tok-kt">uint64</span><span class="tok-p">)</span> <span class="tok-kt">uint64</span> <span class="tok-p">{</span>
	<span class="tok-nx">x</span> <span class="tok-o">-=</span> <span class="tok-p">(</span><span class="tok-nx">x</span> <span class="tok-o">&gt;&gt;</span> <span class="tok-mi">1</span><span class="tok-p">)</span> <span class="tok-o">&amp;</span> <span class="tok-nx">m1</span>
	<span class="tok-nx">x</span> <span class="tok-p">=</span> <span class="tok-p">(</span><span class="tok-nx">x</span> <span class="tok-o">&amp;</span> <span class="tok-nx">m2</span><span class="tok-p">)</span> <span class="tok-o">+</span> <span class="tok-p">((</span><span class="tok-nx">x</span> <span class="tok-o">&gt;&gt;</span> <span class="tok-mi">2</span><span class="tok-p">)</span> <span class="tok-o">&amp;</span> <span class="tok-nx">m2</span><span class="tok-p">)</span>
	<span class="tok-nx">x</span> <span class="tok-p">=</span> <span class="tok-p">(</span><span class="tok-nx">x</span> <span class="tok-o">+</span> <span class="tok-p">(</span><span class="tok-nx">x</span> <span class="tok-o">&gt;&gt;</span> <span class="tok-mi">4</span><span class="tok-p">))</span> <span class="tok-o">&amp;</span> <span class="tok-nx">m4</span>
	<span class="tok-k">return</span> <span class="tok-p">(</span><span class="tok-nx">x</span> <span class="tok-o">*</span> <span class="tok-nx">h01</span><span class="tok-p">)</span> <span class="tok-o">&gt;&gt;</span> <span class="tok-mi">56</span>
<span class="tok-p">}</span>

<span class="tok-kd">func</span> <span class="tok-nx">BenchmarkPopcnt</span><span class="tok-p">(</span><span class="tok-nx">b</span> <span class="tok-o">*</span><span class="tok-nx">testing</span><span class="tok-p">.</span><span class="tok-nx">B</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-k">for</span> <span class="tok-nx">i</span> <span class="tok-o">:=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-nx">i</span> <span class="tok-p">&lt;</span> <span class="tok-nx">b</span><span class="tok-p">.</span><span class="tok-nx">N</span><span class="tok-p">;</span> <span class="tok-nx">i</span><span class="tok-o">++</span> <span class="tok-p">{</span>
		<span class="tok-nx">popcnt</span><span class="tok-p">(</span><span class="tok-nb">uint64</span><span class="tok-p">(</span><span class="tok-nx">i</span><span class="tok-p">))</span>
	<span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>How fast do you think this function will benchmark? Let&#8217;s find out.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>% go test -bench=. ./examples/popcnt/
goos: darwin
goarch: amd64
BenchmarkPopcnt-8       2000000000               0.30 ns/op
PASS</pre>
</div>
</div>
<div class="paragraph">
<p>0.3 of a nano second; that&#8217;s basically one clock cycle.
Even assuming that the CPU may have a few instructions in flight per clock tick, this number seems unreasonably low.
What happened?</p>
</div>
<div class="paragraph">
<p>To understand what happened, we have to look at the function under benchmake, <code>popcnt</code>.
<code>popcnt</code> is a leaf function&#8201;&#8212;&#8201;it does not call any other functions&#8201;&#8212;&#8201;so the compiler can inline it.</p>
</div>
<div class="paragraph">
<p>Because the function is inlined, the compiler now can see it has no side effects.
<code>popcnt</code> does not affect the state of any global variable.
Thus, the call is eliminated.
This is what the compiler sees:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span><span class="tok-kd">func</span> <span class="tok-nx">BenchmarkPopcnt</span><span class="tok-p">(</span><span class="tok-nx">b</span> <span class="tok-o">*</span><span class="tok-nx">testing</span><span class="tok-p">.</span><span class="tok-nx">B</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-k">for</span> <span class="tok-nx">i</span> <span class="tok-o">:=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-nx">i</span> <span class="tok-p">&lt;</span> <span class="tok-nx">b</span><span class="tok-p">.</span><span class="tok-nx">N</span><span class="tok-p">;</span> <span class="tok-nx">i</span><span class="tok-o">++</span> <span class="tok-p">{</span>
		<span class="tok-c1">// optimised away</span>
	<span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On all versions of the Go compiler that i&#8217;ve tested, the loop is still generated.
But Intel CPUs are really good at optimising loops, especially empty ones.</p>
</div>
<div class="sect3">
<h4 id="exercise_look_at_the_assembly"><a class="anchor" href="#exercise_look_at_the_assembly"></a><a class="link" href="#exercise_look_at_the_assembly">2.6.1. Exercise, look at the assembly</a></h4>
<div class="paragraph">
<p>Before we go on, lets look at the assembly to confirm what we saw</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>% go test -gcflags=-S</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Use `gcflags="-l -S" to disable inlining, how does that affect the assembly output</p>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Optimisation is a good thing</div>
<div class="paragraph">
<p>The thing to take away is the same optimisations that <em>make real code fast</em>, by removing unnecessary computation, are the same ones that remove benchmarks that have no observable side effects.</p>
</div>
<div class="paragraph">
<p>This is only going to get more common as the Go compiler improves.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="fixing_the_benchmark"><a class="anchor" href="#fixing_the_benchmark"></a><a class="link" href="#fixing_the_benchmark">2.6.2. Fixing the benchmark</a></h4>
<div class="paragraph">
<p>Disabling inlining to make the benchmark work is unrealistic; we want to build our code with optimisations on.</p>
</div>
<div class="paragraph">
<p>To fix this benchmark we must ensure that the compiler cannot <em>prove</em> that the body of <code>BenchmarkPopcnt</code> does not cause global state to change.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span><span class="tok-kd">var</span> <span class="tok-nx">Result</span> <span class="tok-kt">uint64</span>

<span class="tok-kd">func</span> <span class="tok-nx">BenchmarkPopcnt</span><span class="tok-p">(</span><span class="tok-nx">b</span> <span class="tok-o">*</span><span class="tok-nx">testing</span><span class="tok-p">.</span><span class="tok-nx">B</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-kd">var</span> <span class="tok-nx">r</span> <span class="tok-kt">uint64</span>
	<span class="tok-k">for</span> <span class="tok-nx">i</span> <span class="tok-o">:=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-nx">i</span> <span class="tok-p">&lt;</span> <span class="tok-nx">b</span><span class="tok-p">.</span><span class="tok-nx">N</span><span class="tok-p">;</span> <span class="tok-nx">i</span><span class="tok-o">++</span> <span class="tok-p">{</span>
		<span class="tok-nx">r</span> <span class="tok-p">=</span> <span class="tok-nx">popcnt</span><span class="tok-p">(</span><span class="tok-nb">uint64</span><span class="tok-p">(</span><span class="tok-nx">i</span><span class="tok-p">))</span>
	<span class="tok-p">}</span>
	<span class="tok-nx">Result</span> <span class="tok-p">=</span> <span class="tok-nx">r</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the recommended way to ensure the compiler cannot optimise away body of the loop.</p>
</div>
<div class="paragraph">
<p>First we <em>use</em> the result of calling <code>popcnt</code> by storing it in <code>r</code>.
Second, because <code>r</code> is declared locally inside the scope of <code>BenchmarkPopcnt</code> once the benchmark is over, the result of <code>r</code> is never visible to another part of the program, so as the final act we assign the value of <code>r</code> to the package public variable <code>Result</code>.</p>
</div>
<div class="paragraph">
<p>Because <code>Result</code> is public the compiler cannot prove that another package importing this one will not be able to see the value of <code>Result</code> changing over time, hence it cannot optimise away any of the operations leading to its assignment.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>What happens if we assign to <code>Result</code> directly? Does this affect the benchmark time? What about if we assign the result of <code>popcnt</code> to <code>_</code>?</p>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
In our earlier <code>Fib</code> benchmark we didn&#8217;t take these precautions, should we have done so?
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="benchmark_mistakes"><a class="anchor" href="#benchmark_mistakes"></a><a class="link" href="#benchmark_mistakes">2.7. Benchmark mistakes</a></h3>
<div class="paragraph">
<p>The <code>for</code> loop is crucial to the operation of the benchmark.</p>
</div>
<div class="paragraph">
<p>Here are two incorrect benchmarks, can you explain what is wrong with them?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>func BenchmarkFibWrong(b *testing.B) {
	Fib(b.N)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>func BenchmarkFibWrong2(b *testing.B) {
	for n := 0; n &lt; b.N; n++ {
		Fib(n)
	}
}</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Run these benchmarks, what do you see?</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="profiling_benchmarks"><a class="anchor" href="#profiling_benchmarks"></a><a class="link" href="#profiling_benchmarks">2.8. Profiling benchmarks</a></h3>
<div class="paragraph">
<p>The <code>testing</code> package has built in support for generating CPU, memory, and block profiles.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-cpuprofile=$FILE</code> writes a CPU profile to <code>$FILE</code>.</p>
</li>
<li>
<p><code>-memprofile=$FILE</code>, writes a memory profile to <code>$FILE</code>, <code>-memprofilerate=N</code> adjusts the profile rate to <code>1/N</code>.</p>
</li>
<li>
<p><code>-blockprofile=$FILE</code>, writes a block profile to <code>$FILE</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using any of these flags also preserves the binary.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>% go test -run=XXX -bench=. -cpuprofile=c.p bytes
% go tool pprof c.p</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="discussion"><a class="anchor" href="#discussion"></a><a class="link" href="#discussion">2.9. Discussion</a></h3>
<div class="paragraph">
<p>Are there any questions?</p>
</div>
<div class="paragraph">
<p>Perhaps it is time for a break.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="profiling"><a class="anchor" href="#profiling"></a><a class="link" href="#profiling">3. Performance measurement and profiling</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the previous section we looked at benchmarking individual functions which is useful when you know ahead of time where the bottlekneck is. However, often you will find yourself in the position of asking</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Why is this program taking so long to run?</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Profiling <em>whole</em> programs which is useful for answering high level questions like. In this section we&#8217;ll use profiling tools built into Go to investigate the operation of the program from the inside.</p>
</div>
<div class="sect2">
<h3 id="pprof"><a class="anchor" href="#pprof"></a><a class="link" href="#pprof">3.1. pprof</a></h3>
<div class="paragraph">
<p>The first tool we&#8217;re going to be talking about today is <em>pprof</em>. <a href="https://github.com/google/pprof">pprof</a> descends from the <a href="https://github.com/gperftools/gperftools">Google Perf Tools</a> suite of tools and has been integrated into the Go runtime since the earliest public releases.</p>
</div>
<div class="paragraph">
<p><code>pprof</code>  consists of two parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>runtime/pprof</code> package built into every Go program</p>
</li>
<li>
<p><code>go tool pprof</code> for investigating profiles.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="types_of_profiles"><a class="anchor" href="#types_of_profiles"></a><a class="link" href="#types_of_profiles">3.2. Types of profiles</a></h3>
<div class="paragraph">
<p>pprof supports several types of profiling, we&#8217;ll discuss three of these today:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CPU profiling.</p>
</li>
<li>
<p>Memory profiling.</p>
</li>
<li>
<p>Block (or blocking) profiling.</p>
</li>
<li>
<p>Mutex contention profiling.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="cpu_profiling"><a class="anchor" href="#cpu_profiling"></a><a class="link" href="#cpu_profiling">3.2.1. CPU profiling</a></h4>
<div class="paragraph">
<p>CPU profiling is the most common type of profile, and the most obvious.</p>
</div>
<div class="paragraph">
<p>When CPU profiling is enabled the runtime will interrupt itself every 10ms and record the stack trace of the currently running goroutines.</p>
</div>
<div class="paragraph">
<p>Once the profile is complete we can analyse it to determine the hottest code paths.</p>
</div>
<div class="paragraph">
<p>The more times a function appears in the profile, the more time that code path is taking as a percentage of the total runtime.</p>
</div>
</div>
<div class="sect3">
<h4 id="memory_profiling"><a class="anchor" href="#memory_profiling"></a><a class="link" href="#memory_profiling">3.2.2. Memory profiling</a></h4>
<div class="paragraph">
<p>Memory profiling records the stack trace when a <em>heap</em> allocation is made.</p>
</div>
<div class="paragraph">
<p>Stack allocations are assumed to be free and are <em>not_tracked</em> in the memory profile.</p>
</div>
<div class="paragraph">
<p>Memory profiling, like CPU profiling is sample based, by default memory profiling samples 1 in every 1000 allocations.
This rate can be changed.</p>
</div>
<div class="paragraph">
<p>Because of memory profiling is sample based and because it tracks <em>allocations</em> not <em>use</em>, using memory profiling to determine your application&#8217;s overall memory usage is difficult.</p>
</div>
<div class="paragraph">
<p><em>Personal Opinion:</em> I do not find memory profiling useful for finding memory leaks.
There are better ways to determine how much memory your application is using.
We will discuss these later in the presentation.</p>
</div>
</div>
<div class="sect3">
<h4 id="block_profiling"><a class="anchor" href="#block_profiling"></a><a class="link" href="#block_profiling">3.2.3. Block profiling</a></h4>
<div class="paragraph">
<p>Block profiling is quite unique to Go.</p>
</div>
<div class="paragraph">
<p>A block profile is similar to a CPU profile, but it records the amount of time a goroutine spent waiting for a shared resource.</p>
</div>
<div class="paragraph">
<p>This can be useful for determining <em>concurrency</em> bottlenecks in your application.</p>
</div>
<div class="paragraph">
<p>Block profiling can show you when a large number of goroutines <em>could</em> make progress, but were <em>blocked</em>.
Blocking includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sending or receiving on a unbuffered channel.</p>
</li>
<li>
<p>Sending to a full channel, receiving from an empty one.</p>
</li>
<li>
<p>Trying to <code>Lock</code> a <code>sync.Mutex</code> that is locked by another goroutine.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Block profiling is a very specialised tool, it should not be used until you believe you have eliminated all your CPU and memory usage bottlenecks.</p>
</div>
</div>
<div class="sect3">
<h4 id="mutex_profiling"><a class="anchor" href="#mutex_profiling"></a><a class="link" href="#mutex_profiling">3.2.4. Mutex profiling</a></h4>
<div class="paragraph">
<p>Mutex profiling is simlar to Block profiling, but is focused exclusively on operations that lead to delays caused by mutex contention.</p>
</div>
<div class="paragraph">
<p>I don&#8217;t have a lot of experience with this type of profile but I have built an example to demonstrate it.
We&#8217;ll look at that example shortly.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="one_profile_at_at_time"><a class="anchor" href="#one_profile_at_at_time"></a><a class="link" href="#one_profile_at_at_time">3.3. One profile at at time</a></h3>
<div class="paragraph">
<p>Profiling is not free.</p>
</div>
<div class="paragraph">
<p>Profiling has a moderate, but measurable impact on program performance—especially if you increase the memory profile sample rate.</p>
</div>
<div class="paragraph">
<p>Most tools will not stop you from enabling multiple profiles at once.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not enable more than one kind of profile at a time.</p>
</div>
<div class="paragraph">
<p>If you enable multiple profile&#8217;s at the same time, they will observe their own interactions and throw off your results.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="collecting_a_profile"><a class="anchor" href="#collecting_a_profile"></a><a class="link" href="#collecting_a_profile">3.4. Collecting a profile</a></h3>
<div class="paragraph">
<p>The Go runtime&#8217;s profiling interface lives in the <code>runtime/pprof</code> package. <code>runtime/pprof</code> is a very low level tool, and for historic reasons the interfaces to the different kinds of profile are not uniform.</p>
</div>
<div class="paragraph">
<p>As we saw in the previous section, pprof profiling is built into the <code>testing</code> package, but sometimes its inconvenient, or difficult, to place the code you want to profile in the context of at <code>testing.B</code> benchmark and must use the <code>runtime/pprof</code> API directly.</p>
</div>
<div class="paragraph">
<p>A few years ago I wrote a [small package][0], to make it easier to profile an existing application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="go"><span></span><span class="tok-kn">import</span> <span class="tok-s">&quot;github.com/pkg/profile&quot;</span>

<span class="tok-kd">func</span> <span class="tok-nx">main</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-k">defer</span> <span class="tok-nx">profile</span><span class="tok-p">.</span><span class="tok-nx">Start</span><span class="tok-p">().</span><span class="tok-nx">Stop</span><span class="tok-p">()</span>
	<span class="tok-c1">// ...</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;ll use the profile package throughout this section. Later in the day we&#8217;ll touch on using the <code>runtime/pprof</code> interface directly.</p>
</div>
</div>
<div class="sect2">
<h3 id="analysing_a_profile_with_pprof"><a class="anchor" href="#analysing_a_profile_with_pprof"></a><a class="link" href="#analysing_a_profile_with_pprof">3.5. Analysing a profile with pprof</a></h3>
<div class="paragraph">
<p>Now that we&#8217;ve talked about what pprof can measure, and how to generate a profile, let&#8217;s talk about how to use pprof to analyse a profile.</p>
</div>
<div class="paragraph">
<p>The analysis is driven by the <code>go pprof</code> subcommand</p>
</div>
<div class="listingblock">
<div class="content">
<pre>go tool pprof /path/to/your/profile</pre>
</div>
</div>
<div class="paragraph">
<p>This tool provides several different representations of the profiling data; textual, graphical, even flame graphs.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you&#8217;ve been using Go for a while, you might have been told that <code>pprof</code> takes two arguments. Since Go 1.9 the profile file contains all the information needed to render the profile. You do no longer need the binary which produced the profile. 🎉</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="further_reading_2"><a class="anchor" href="#further_reading_2"></a><a class="link" href="#further_reading_2">3.5.1. Further reading</a></h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://blog.golang.org/profiling-go-programs">Profiling Go programs</a> (Go Blog)</p>
</li>
<li>
<p><a href="https://software.intel.com/en-us/blogs/2014/05/10/debugging-performance-issues-in-go-programs">Debugging performance issues in Go programs</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="cpu_profiling_exercise"><a class="anchor" href="#cpu_profiling_exercise"></a><a class="link" href="#cpu_profiling_exercise">3.5.2. CPU profiling (exercise)</a></h4>
<div class="paragraph">
<p>Let&#8217;s write a program to count words:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span><span class="tok-kn">package</span> <span class="tok-nx">main</span>

<span class="tok-kn">import</span> <span class="tok-p">(</span>
	<span class="tok-s">&quot;fmt&quot;</span>
	<span class="tok-s">&quot;io&quot;</span>
	<span class="tok-s">&quot;log&quot;</span>
	<span class="tok-s">&quot;os&quot;</span>
	<span class="tok-s">&quot;unicode&quot;</span>

	<span class="tok-s">&quot;github.com/pkg/profile&quot;</span>
<span class="tok-p">)</span>

<span class="tok-kd">func</span> <span class="tok-nx">readbyte</span><span class="tok-p">(</span><span class="tok-nx">r</span> <span class="tok-nx">io</span><span class="tok-p">.</span><span class="tok-nx">Reader</span><span class="tok-p">)</span> <span class="tok-p">(</span><span class="tok-kt">rune</span><span class="tok-p">,</span> <span class="tok-kt">error</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-kd">var</span> <span class="tok-nx">buf</span> <span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">]</span><span class="tok-kt">byte</span>
	<span class="tok-nx">_</span><span class="tok-p">,</span> <span class="tok-nx">err</span> <span class="tok-o">:=</span> <span class="tok-nx">r</span><span class="tok-p">.</span><span class="tok-nx">Read</span><span class="tok-p">(</span><span class="tok-nx">buf</span><span class="tok-p">[:])</span>
	<span class="tok-k">return</span> <span class="tok-nb">rune</span><span class="tok-p">(</span><span class="tok-nx">buf</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">]),</span> <span class="tok-nx">err</span>
<span class="tok-p">}</span>

<span class="tok-kd">func</span> <span class="tok-nx">main</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-k">defer</span> <span class="tok-nx">profile</span><span class="tok-p">.</span><span class="tok-nx">Start</span><span class="tok-p">().</span><span class="tok-nx">Stop</span><span class="tok-p">()</span>

	<span class="tok-nx">f</span><span class="tok-p">,</span> <span class="tok-nx">err</span> <span class="tok-o">:=</span> <span class="tok-nx">os</span><span class="tok-p">.</span><span class="tok-nx">Open</span><span class="tok-p">(</span><span class="tok-nx">os</span><span class="tok-p">.</span><span class="tok-nx">Args</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">])</span>
	<span class="tok-k">if</span> <span class="tok-nx">err</span> <span class="tok-o">!=</span> <span class="tok-kc">nil</span> <span class="tok-p">{</span>
		<span class="tok-nx">log</span><span class="tok-p">.</span><span class="tok-nx">Fatalf</span><span class="tok-p">(</span><span class="tok-s">&quot;could not open file %q: %v&quot;</span><span class="tok-p">,</span> <span class="tok-nx">os</span><span class="tok-p">.</span><span class="tok-nx">Args</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">],</span> <span class="tok-nx">err</span><span class="tok-p">)</span>
	<span class="tok-p">}</span>

	<span class="tok-nx">words</span> <span class="tok-o">:=</span> <span class="tok-mi">0</span>
	<span class="tok-nx">inword</span> <span class="tok-o">:=</span> <span class="tok-kc">false</span>
	<span class="tok-k">for</span> <span class="tok-p">{</span>
		<span class="tok-nx">r</span><span class="tok-p">,</span> <span class="tok-nx">err</span> <span class="tok-o">:=</span> <span class="tok-nx">readbyte</span><span class="tok-p">(</span><span class="tok-nx">f</span><span class="tok-p">)</span>
		<span class="tok-k">if</span> <span class="tok-nx">err</span> <span class="tok-o">==</span> <span class="tok-nx">io</span><span class="tok-p">.</span><span class="tok-nx">EOF</span> <span class="tok-p">{</span>
			<span class="tok-k">break</span>
		<span class="tok-p">}</span>
		<span class="tok-k">if</span> <span class="tok-nx">err</span> <span class="tok-o">!=</span> <span class="tok-kc">nil</span> <span class="tok-p">{</span>
			<span class="tok-nx">log</span><span class="tok-p">.</span><span class="tok-nx">Fatalf</span><span class="tok-p">(</span><span class="tok-s">&quot;could not read file %q: %v&quot;</span><span class="tok-p">,</span> <span class="tok-nx">os</span><span class="tok-p">.</span><span class="tok-nx">Args</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">],</span> <span class="tok-nx">err</span><span class="tok-p">)</span>
		<span class="tok-p">}</span>
		<span class="tok-k">if</span> <span class="tok-nx">unicode</span><span class="tok-p">.</span><span class="tok-nx">IsSpace</span><span class="tok-p">(</span><span class="tok-nx">r</span><span class="tok-p">)</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-nx">inword</span> <span class="tok-p">{</span>
			<span class="tok-nx">words</span><span class="tok-o">++</span>
			<span class="tok-nx">inword</span> <span class="tok-p">=</span> <span class="tok-kc">false</span>
		<span class="tok-p">}</span>
		<span class="tok-nx">inword</span> <span class="tok-p">=</span> <span class="tok-nx">unicode</span><span class="tok-p">.</span><span class="tok-nx">IsLetter</span><span class="tok-p">(</span><span class="tok-nx">r</span><span class="tok-p">)</span>
	<span class="tok-p">}</span>
	<span class="tok-nx">fmt</span><span class="tok-p">.</span><span class="tok-nx">Printf</span><span class="tok-p">(</span><span class="tok-s">&quot;%q: %d words\n&quot;</span><span class="tok-p">,</span> <span class="tok-nx">os</span><span class="tok-p">.</span><span class="tok-nx">Args</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">],</span> <span class="tok-nx">words</span><span class="tok-p">)</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s see how many words there are in Herman Melville&#8217;s classic <a href="https://www.gutenberg.org/ebooks/2701">Moby Dick</a> (sourced from Project Gutenberg)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>% go build &amp;&amp; time ./words moby.txt
"moby.txt": 181275 words

real    0m2.110s
user    0m1.264s
sys     0m0.944s</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s compare that to unix&#8217;s <code>wc -w</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>% time wc -w moby.txt
215829 moby.txt

real    0m0.012s
user    0m0.009s
sys     0m0.002s</code></pre>
</div>
</div>
<div class="paragraph">
<p>So the numbers aren&#8217;t the same.
<code>wc</code> is about 19% higher because what it considers a word is different to what my simple program does.
That&#8217;s not important&#8212;&#8203;both programs take the whole file as input and in a single pass count the number of transitions from word to non word.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s investigate why these programs have different run times using pprof.</p>
</div>
</div>
<div class="sect3">
<h4 id="add_cpu_profiling"><a class="anchor" href="#add_cpu_profiling"></a><a class="link" href="#add_cpu_profiling">3.5.3. Add CPU profiling</a></h4>
<div class="paragraph">
<p>First, edit <code>main.go</code> and enable profiling</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="go"><span></span><span class="tok-kn">import</span> <span class="tok-p">(</span>
        <span class="tok-s">&quot;github.com/pkg/profile&quot;</span>
<span class="tok-p">)</span>

<span class="tok-kd">func</span> <span class="tok-nx">main</span><span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-k">defer</span> <span class="tok-nx">profile</span><span class="tok-p">.</span><span class="tok-nx">Start</span><span class="tok-p">().</span><span class="tok-nx">Stop</span><span class="tok-p">()</span>
        <span class="tok-c1">// ...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now when we run the program a <code>cpu.pprof</code> file is created.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>% go run main.go moby.txt
2018/08/25 14:09:01 profile: cpu profiling enabled, /var/folders/by/3gf34_z95zg05cyj744_vhx40000gn/T/profile239941020/cpu.pprof
"moby.txt": 181275 words
2018/08/25 14:09:03 profile: cpu profiling disabled, /var/folders/by/3gf34_z95zg05cyj744_vhx40000gn/T/profile239941020/cpu.pprof</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we have the profile we can analyse it with <code>go tool pprof</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% go tool pprof /var/folders/by/3gf34_z95zg05cyj744_vhx40000gn/T/profile239941020/cpu.pprof
Type: cpu
Time: Aug 25, 2018 at 2:09pm (AEST)
Duration: 2.05s, Total samples = 1.36s (66.29%)
Entering interactive mode (type "help" for commands, "o" for options)
(pprof) top
Showing nodes accounting for 1.42s, 100% of 1.42s total
      flat  flat%   sum%        cum   cum%
     1.41s 99.30% 99.30%      1.41s 99.30%  syscall.Syscall
     0.01s   0.7%   100%      1.42s   100%  main.readbyte
         0     0%   100%      1.41s 99.30%  internal/poll.(*FD).Read
         0     0%   100%      1.42s   100%  main.main
         0     0%   100%      1.41s 99.30%  os.(*File).Read
         0     0%   100%      1.41s 99.30%  os.(*File).read
         0     0%   100%      1.42s   100%  runtime.main
         0     0%   100%      1.41s 99.30%  syscall.Read
         0     0%   100%      1.41s 99.30%  syscall.read</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>top</code> command is one you&#8217;ll use the most. We can see that 99% of the time this program spends in <code>syscall.Syscall</code>, and a small part in <code>main.readbyte</code>.</p>
</div>
<div class="paragraph">
<p>We can also visualise this call the with the <code>web</code> command.
This will generate a directed graph from the profile data. Under the hood this uses the <code>dot</code> command from Graphviz.</p>
</div>
<div class="paragraph">
<p>However, in Go 1.10 (possibly 1.11) Go ships with a version of pprof that natively supports a http sever</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>% go tool pprof -http=:8080 /var/folders/by/3gf34_z95zg05cyj744_vhx40000gn/T/profile239941020/cpu.pprof</code></pre>
</div>
</div>
<div class="paragraph">
<p>Will open a web browser;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Graph mode</p>
</li>
<li>
<p>Flame graph mode</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>On the graph the box that consumes the <em>most</em> CPU time is the largest&#8201;&#8212;&#8201;we see <code>sys call.Syscall</code> at 99.3% of the total time spent in the program.
The string of boxes leading to <code>syscall.Syscall</code> represent the immediate callers&#8201;&#8212;&#8201;there can be more than one if multiple code paths converge on the same function.
The size of the arrow represents how much time was spent in children of a box, we see that from <code>main.readbyte</code> onwards they account for near 0 of the 1.41 second spent in this arm of the graph.</p>
</div>
<div class="paragraph">
<p><em>Question</em>: Can anyone guess why our version is so much slower than <code>wc</code>?</p>
</div>
</div>
<div class="sect3">
<h4 id="improving_our_version"><a class="anchor" href="#improving_our_version"></a><a class="link" href="#improving_our_version">3.5.4. Improving our version</a></h4>
<div class="paragraph">
<p>The reason our program is slow is not because Go&#8217;s <code>syscall.Syscall</code> is slow.
It is because syscalls in general are expensive operations (and getting more expensive as more Spectre family vulnerabilities are discovered).</p>
</div>
<div class="paragraph">
<p>Each call to <code>readbyte</code> results in a syscall.Read with a buffer size of 1.
So the number of syscalls executed by our program is equal to the size of the input. We can see that in the pprof graph that reading the input dominates everything else.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span><span class="tok-kd">func</span> <span class="tok-nx">main</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-k">defer</span> <span class="tok-nx">profile</span><span class="tok-p">.</span><span class="tok-nx">Start</span><span class="tok-p">(</span><span class="tok-nx">profile</span><span class="tok-p">.</span><span class="tok-nx">MemProfile</span><span class="tok-p">,</span> <span class="tok-nx">profile</span><span class="tok-p">.</span><span class="tok-nx">MemProfileRate</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">)).</span><span class="tok-nx">Stop</span><span class="tok-p">()</span>
	<span class="tok-c1">// defer profile.Start(profile.MemProfile).Stop()</span>

	<span class="tok-nx">f</span><span class="tok-p">,</span> <span class="tok-nx">err</span> <span class="tok-o">:=</span> <span class="tok-nx">os</span><span class="tok-p">.</span><span class="tok-nx">Open</span><span class="tok-p">(</span><span class="tok-nx">os</span><span class="tok-p">.</span><span class="tok-nx">Args</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">])</span>
	<span class="tok-k">if</span> <span class="tok-nx">err</span> <span class="tok-o">!=</span> <span class="tok-kc">nil</span> <span class="tok-p">{</span>
		<span class="tok-nx">log</span><span class="tok-p">.</span><span class="tok-nx">Fatalf</span><span class="tok-p">(</span><span class="tok-s">&quot;could not open file %q: %v&quot;</span><span class="tok-p">,</span> <span class="tok-nx">os</span><span class="tok-p">.</span><span class="tok-nx">Args</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">],</span> <span class="tok-nx">err</span><span class="tok-p">)</span>
	<span class="tok-p">}</span>

	<span class="tok-nx">b</span> <span class="tok-o">:=</span> <span class="tok-nx">bufio</span><span class="tok-p">.</span><span class="tok-nx">NewReader</span><span class="tok-p">(</span><span class="tok-nx">f</span><span class="tok-p">)</span>
	<span class="tok-nx">words</span> <span class="tok-o">:=</span> <span class="tok-mi">0</span>
	<span class="tok-nx">inword</span> <span class="tok-o">:=</span> <span class="tok-kc">false</span>
	<span class="tok-k">for</span> <span class="tok-p">{</span>
		<span class="tok-nx">r</span><span class="tok-p">,</span> <span class="tok-nx">err</span> <span class="tok-o">:=</span> <span class="tok-nx">readbyte</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">)</span>
		<span class="tok-k">if</span> <span class="tok-nx">err</span> <span class="tok-o">==</span> <span class="tok-nx">io</span><span class="tok-p">.</span><span class="tok-nx">EOF</span> <span class="tok-p">{</span>
			<span class="tok-k">break</span>
		<span class="tok-p">}</span>
		<span class="tok-k">if</span> <span class="tok-nx">err</span> <span class="tok-o">!=</span> <span class="tok-kc">nil</span> <span class="tok-p">{</span>
			<span class="tok-nx">log</span><span class="tok-p">.</span><span class="tok-nx">Fatalf</span><span class="tok-p">(</span><span class="tok-s">&quot;could not read file %q: %v&quot;</span><span class="tok-p">,</span> <span class="tok-nx">os</span><span class="tok-p">.</span><span class="tok-nx">Args</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">],</span> <span class="tok-nx">err</span><span class="tok-p">)</span>
		<span class="tok-p">}</span>
		<span class="tok-k">if</span> <span class="tok-nx">unicode</span><span class="tok-p">.</span><span class="tok-nx">IsSpace</span><span class="tok-p">(</span><span class="tok-nx">r</span><span class="tok-p">)</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-nx">inword</span> <span class="tok-p">{</span>
			<span class="tok-nx">words</span><span class="tok-o">++</span>
			<span class="tok-nx">inword</span> <span class="tok-p">=</span> <span class="tok-kc">false</span>
		<span class="tok-p">}</span>
		<span class="tok-nx">inword</span> <span class="tok-p">=</span> <span class="tok-nx">unicode</span><span class="tok-p">.</span><span class="tok-nx">IsLetter</span><span class="tok-p">(</span><span class="tok-nx">r</span><span class="tok-p">)</span>
	<span class="tok-p">}</span>
	<span class="tok-nx">fmt</span><span class="tok-p">.</span><span class="tok-nx">Printf</span><span class="tok-p">(</span><span class="tok-s">&quot;%q: %d words\n&quot;</span><span class="tok-p">,</span> <span class="tok-nx">os</span><span class="tok-p">.</span><span class="tok-nx">Args</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">],</span> <span class="tok-nx">words</span><span class="tok-p">)</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By inserting a <code>bufio.Reader</code> between the input file and <code>readbyte</code> will</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Compare the times of this revised program to <code>wc</code>. How close is it? Take a profile and see what remains.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="memory_profiling_2"><a class="anchor" href="#memory_profiling_2"></a><a class="link" href="#memory_profiling_2">3.5.5. Memory profiling</a></h4>
<div class="paragraph">
<p>The new <code>words</code> profile suggests that something is allocating inside the <code>readbyte</code> function. We can use pprof to investigate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="go"><span></span><span class="tok-k">defer</span> <span class="tok-nx">profile</span><span class="tok-p">.</span><span class="tok-nx">Start</span><span class="tok-p">(</span><span class="tok-nx">profile</span><span class="tok-p">.</span><span class="tok-nx">MemProfile</span><span class="tok-p">).</span><span class="tok-nx">Stop</span><span class="tok-p">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then run the program as usual</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% go run main2.go moby.txt
2018/08/25 14:41:15 profile: memory profiling enabled (rate 4096), /var/folders/by/3gf34_z95zg05cyj744_vhx40000gn/T/profile312088211/mem.pprof
"moby.txt": 181275 words
2018/08/25 14:41:15 profile: memory profiling disabled, /var/folders/by/3gf34_z95zg05cyj744_vhx40000gn/T/profile312088211/mem.pprof</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="100%px" height="100%px">
<script type="text/ecmascript"><![CDATA[
/**
 *  SVGPan library 1.2.2
 * ======================
 *
 * Given an unique existing element with id "viewport" (or when missing, the
 * first g-element), including the library into any SVG adds the following
 * capabilities:
 *
 *  - Mouse panning
 *  - Mouse zooming (using the wheel)
 *  - Object dragging
 *
 * You can configure the behaviour of the pan/zoom/drag with the variables
 * listed in the CONFIGURATION section of this file.
 *
 * Known issues:
 *
 *  - Zooming (while panning) on Safari has still some issues
 *
 * Releases:
 *
 * 1.2.2, Tue Aug 30 17:21:56 CEST 2011, Andrea Leofreddi
 *	- Fixed viewBox on root tag (#7)
 *	- Improved zoom speed (#2)
 *
 * 1.2.1, Mon Jul  4 00:33:18 CEST 2011, Andrea Leofreddi
 *	- Fixed a regression with mouse wheel (now working on Firefox 5)
 *	- Working with viewBox attribute (#4)
 *	- Added "use strict;" and fixed resulting warnings (#5)
 *	- Added configuration variables, dragging is disabled by default (#3)
 *
 * 1.2, Sat Mar 20 08:42:50 GMT 2010, Zeng Xiaohui
 *	Fixed a bug with browser mouse handler interaction
 *
 * 1.1, Wed Feb  3 17:39:33 GMT 2010, Zeng Xiaohui
 *	Updated the zoom code to support the mouse wheel on Safari/Chrome
 *
 * 1.0, Andrea Leofreddi
 *	First release
 *
 * This code is licensed under the following BSD license:
 *
 * Copyright 2009-2017 Andrea Leofreddi <a.leofreddi@vleo.net>. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification, are
 * permitted provided that the following conditions are met:
 *
 *    1. Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *    2. Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *    3. Neither the name of the copyright holder nor the names of its
 *       contributors may be used to endorse or promote products derived from
 *       this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY COPYRIGHT HOLDERS AND CONTRIBUTORS ''AS IS'' AND ANY EXPRESS
 * OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
 * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL COPYRIGHT HOLDERS OR
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
 * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * The views and conclusions contained in the software and documentation are those of the
 * authors and should not be interpreted as representing official policies, either expressed
 * or implied, of Andrea Leofreddi.
 */

"use strict";

/// CONFIGURATION
/// ====>

var enablePan = 1; // 1 or 0: enable or disable panning (default enabled)
var enableZoom = 1; // 1 or 0: enable or disable zooming (default enabled)
var enableDrag = 0; // 1 or 0: enable or disable dragging (default disabled)
var zoomScale = 0.2; // Zoom sensitivity

/// <====
/// END OF CONFIGURATION

var root = document.documentElement;

var state = 'none', svgRoot = null, stateTarget, stateOrigin, stateTf;

setupHandlers(root);

/**
 * Register handlers
 */
function setupHandlers(root){
	setAttributes(root, {
		"onmouseup" : "handleMouseUp(evt)",
		"onmousedown" : "handleMouseDown(evt)",
		"onmousemove" : "handleMouseMove(evt)",
		//"onmouseout" : "handleMouseUp(evt)", // Decomment this to stop the pan functionality when dragging out of the SVG element
	});

	if(navigator.userAgent.toLowerCase().indexOf('webkit') >= 0)
		window.addEventListener('mousewheel', handleMouseWheel, false); // Chrome/Safari
	else
		window.addEventListener('DOMMouseScroll', handleMouseWheel, false); // Others
}

/**
 * Retrieves the root element for SVG manipulation. The element is then cached into the svgRoot global variable.
 */
function getRoot(root) {
	if(svgRoot == null) {
		var r = root.getElementById("viewport") ? root.getElementById("viewport") : root.documentElement, t = r;

		while(t != root) {
			if(t.getAttribute("viewBox")) {
				setCTM(r, t.getCTM());

				t.removeAttribute("viewBox");
			}

			t = t.parentNode;
		}

		svgRoot = r;
	}

	return svgRoot;
}

/**
 * Instance an SVGPoint object with given event coordinates.
 */
function getEventPoint(evt) {
	var p = root.createSVGPoint();

	p.x = evt.clientX;
	p.y = evt.clientY;

	return p;
}

/**
 * Sets the current transform matrix of an element.
 */
function setCTM(element, matrix) {
	var s = "matrix(" + matrix.a + "," + matrix.b + "," + matrix.c + "," + matrix.d + "," + matrix.e + "," + matrix.f + ")";

	element.setAttribute("transform", s);
}

/**
 * Dumps a matrix to a string (useful for debug).
 */
function dumpMatrix(matrix) {
	var s = "[ " + matrix.a + ", " + matrix.c + ", " + matrix.e + "\n  " + matrix.b + ", " + matrix.d + ", " + matrix.f + "\n  0, 0, 1 ]";

	return s;
}

/**
 * Sets attributes of an element.
 */
function setAttributes(element, attributes){
	for (var i in attributes)
		element.setAttributeNS(null, i, attributes[i]);
}

/**
 * Handle mouse wheel event.
 */
function handleMouseWheel(evt) {
	if(!enableZoom)
		return;

	if(evt.preventDefault)
		evt.preventDefault();

	evt.returnValue = false;

	var svgDoc = evt.target.ownerDocument;

	var delta;

	if(evt.wheelDelta)
		delta = evt.wheelDelta / 360; // Chrome/Safari
	else
		delta = evt.detail / -9; // Mozilla

	var z = Math.pow(1 + zoomScale, delta);

	var g = getRoot(svgDoc);

	var p = getEventPoint(evt);

	p = p.matrixTransform(g.getCTM().inverse());

	// Compute new scale matrix in current mouse position
	var k = root.createSVGMatrix().translate(p.x, p.y).scale(z).translate(-p.x, -p.y);

        setCTM(g, g.getCTM().multiply(k));

	if(typeof(stateTf) == "undefined")
		stateTf = g.getCTM().inverse();

	stateTf = stateTf.multiply(k.inverse());
}

/**
 * Handle mouse move event.
 */
function handleMouseMove(evt) {
	if(evt.preventDefault)
		evt.preventDefault();

	evt.returnValue = false;

	var svgDoc = evt.target.ownerDocument;

	var g = getRoot(svgDoc);

	if(state == 'pan' && enablePan) {
		// Pan mode
		var p = getEventPoint(evt).matrixTransform(stateTf);

		setCTM(g, stateTf.inverse().translate(p.x - stateOrigin.x, p.y - stateOrigin.y));
	} else if(state == 'drag' && enableDrag) {
		// Drag mode
		var p = getEventPoint(evt).matrixTransform(g.getCTM().inverse());

		setCTM(stateTarget, root.createSVGMatrix().translate(p.x - stateOrigin.x, p.y - stateOrigin.y).multiply(g.getCTM().inverse()).multiply(stateTarget.getCTM()));

		stateOrigin = p;
	}
}

/**
 * Handle click event.
 */
function handleMouseDown(evt) {
	if(evt.preventDefault)
		evt.preventDefault();

	evt.returnValue = false;

	var svgDoc = evt.target.ownerDocument;

	var g = getRoot(svgDoc);

	if(
		evt.target.tagName == "svg"
		|| !enableDrag // Pan anyway when drag is disabled and the user clicked on an element
	) {
		// Pan mode
		state = 'pan';

		stateTf = g.getCTM().inverse();

		stateOrigin = getEventPoint(evt).matrixTransform(stateTf);
	} else {
		// Drag mode
		state = 'drag';

		stateTarget = evt.target;

		stateTf = g.getCTM().inverse();

		stateOrigin = getEventPoint(evt).matrixTransform(stateTf);
	}
}

/**
 * Handle mouse button release event.
 */
function handleMouseUp(evt) {
	if(evt.preventDefault)
		evt.preventDefault();

	evt.returnValue = false;

	var svgDoc = evt.target.ownerDocument;

	if(state == 'pan' || state == 'drag') {
		// Quit pan mode
		state = '';
	}
}
]]></script><g id="viewport" transform="scale(0.5,0.5) translate(0,0)"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 393)">
<title>unnamed</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-393 616,-393 616,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_L</title>
<polygon fill="none" stroke="#000000" points="8,-303 8,-381 464,-381 464,-303 8,-303"/>
</g>
<!-- Type: inuse_space -->
<g id="node1" class="node">
<title>Type: inuse_space</title>
<polygon fill="#f8f8f8" stroke="#000000" points="456,-373 16,-373 16,-311 456,-311 456,-373"/>
<text text-anchor="start" x="24" y="-356.2" font-family="Times,serif" font-size="16.00" fill="#000000">Type: inuse_space</text>
<text text-anchor="start" x="24" y="-338.2" font-family="Times,serif" font-size="16.00" fill="#000000">Time: Mar 23, 2019 at 6:14pm (CET)</text>
<text text-anchor="start" x="24" y="-320.2" font-family="Times,serif" font-size="16.00" fill="#000000">Showing nodes accounting for 368.72kB, 100% of 368.72kB total</text>
</g>
<!-- N1 -->
<g id="node1" class="node">
<title>N1</title>
<g id="a_node1"><a xlink:title="main.readbyte (368.72kB)">
<polygon fill="#edd5d5" stroke="#b20000" points="612,-173 424,-173 424,-87 612,-87 612,-173"/>
<text text-anchor="middle" x="518" y="-149.8" font-family="Times,serif" font-size="24.00" fill="#000000">main</text>
<text text-anchor="middle" x="518" y="-123.8" font-family="Times,serif" font-size="24.00" fill="#000000">readbyte</text>
<text text-anchor="middle" x="518" y="-97.8" font-family="Times,serif" font-size="24.00" fill="#000000">368.72kB (100%)</text>
</a>
</g>
</g>
<!-- NN1_0 -->
<g id="NN1_0" class="node">
<title>NN1_0</title>
<g id="a_NN1_0"><a xlink:title="368.72kB">
<polygon fill="#f8f8f8" stroke="#000000" points="545,-36 495,-36 491,-32 491,0 541,0 545,-4 545,-36"/>
<polyline fill="none" stroke="#000000" points="541,-32 491,-32 "/>
<polyline fill="none" stroke="#000000" points="541,-32 541,0 "/>
<polyline fill="none" stroke="#000000" points="541,-32 545,-36 "/>
<text text-anchor="middle" x="518" y="-16.1" font-family="Times,serif" font-size="8.00" fill="#000000">16B</text>
</a>
</g>
</g>
<!-- N1&#45;&gt;NN1_0 -->
<g id="edge1" class="edge">
<title>N1&#45;&gt;NN1_0</title>
<g id="a_edge1"><a xlink:title="368.72kB">
<path fill="none" stroke="#000000" d="M518,-86.6979C518,-73.0814 518,-58.4077 518,-46.1319"/>
<polygon fill="#000000" stroke="#000000" points="521.5001,-46.0482 518,-36.0482 514.5001,-46.0482 521.5001,-46.0482"/>
</a>
</g>
<g id="a_edge1&#45;label"><a xlink:title="368.72kB">
<text text-anchor="middle" x="547.5" y="-57.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 368.72kB</text>
</a>
</g>
</g>
<!-- N2 -->
<g id="node2" class="node">
<title>N2</title>
<g id="a_node2"><a xlink:title="runtime.main (368.72kB)">
<polygon fill="#edd5d5" stroke="#b20000" points="562,-360 474,-360 474,-324 562,-324 562,-360"/>
<text text-anchor="middle" x="518" y="-349.1" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="518" y="-340.1" font-family="Times,serif" font-size="8.00" fill="#000000">main</text>
<text text-anchor="middle" x="518" y="-331.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 368.72kB (100%)</text>
</a>
</g>
</g>
<!-- N3 -->
<g id="node3" class="node">
<title>N3</title>
<g id="a_node3"><a xlink:title="main.main (368.72kB)">
<polygon fill="#edd5d5" stroke="#b20000" points="562,-260 474,-260 474,-224 562,-224 562,-260"/>
<text text-anchor="middle" x="518" y="-249.1" font-family="Times,serif" font-size="8.00" fill="#000000">main</text>
<text text-anchor="middle" x="518" y="-240.1" font-family="Times,serif" font-size="8.00" fill="#000000">main</text>
<text text-anchor="middle" x="518" y="-231.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 368.72kB (100%)</text>
</a>
</g>
</g>
<!-- N2&#45;&gt;N3 -->
<g id="edge3" class="edge">
<title>N2&#45;&gt;N3</title>
<g id="a_edge3"><a xlink:title="runtime.main &#45;&gt; main.main (368.72kB)">
<path fill="none" stroke="#b20000" stroke-width="6" d="M518,-323.6585C518,-308.7164 518,-287.3665 518,-270.2446"/>
<polygon fill="#b20000" stroke="#b20000" stroke-width="6" points="523.2501,-270.2252 518,-260.2253 512.7501,-270.2253 523.2501,-270.2252"/>
</a>
</g>
<g id="a_edge3&#45;label"><a xlink:title="runtime.main &#45;&gt; main.main (368.72kB)">
<text text-anchor="middle" x="547.5" y="-281.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 368.72kB</text>
</a>
</g>
</g>
<!-- N3&#45;&gt;N1 -->
<g id="edge2" class="edge">
<title>N3&#45;&gt;N1</title>
<g id="a_edge2"><a xlink:title="main.main &#45;&gt; main.readbyte (368.72kB)">
<path fill="none" stroke="#b20000" stroke-width="6" d="M518,-223.5055C518,-212.5063 518,-197.9346 518,-183.5757"/>
<polygon fill="#b20000" stroke="#b20000" stroke-width="6" points="523.2501,-183.2119 518,-173.212 512.7501,-183.212 523.2501,-183.2119"/>
</a>
</g>
<g id="a_edge2&#45;label"><a xlink:title="main.main &#45;&gt; main.readbyte (368.72kB)">
<text text-anchor="middle" x="547.5" y="-194.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 368.72kB</text>
</a>
</g>
</g>
</g>
</g></svg>
</div>
</div>
<div class="paragraph">
<p>As we suspected the allocation was coming from <code>readbyte</code>&#8201;&#8212;&#8201;this wasn&#8217;t that complicated, readbyte is three lines long:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Use pprof to determine where the allocation is coming from.</p>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="go"><span></span><span class="tok-kd">func</span> <span class="tok-nx">readbyte</span><span class="tok-p">(</span><span class="tok-nx">r</span> <span class="tok-nx">io</span><span class="tok-p">.</span><span class="tok-nx">Reader</span><span class="tok-p">)</span> <span class="tok-p">(</span><span class="tok-kt">rune</span><span class="tok-p">,</span> <span class="tok-kt">error</span><span class="tok-p">)</span> <span class="tok-p">{</span>
        <span class="tok-kd">var</span> <span class="tok-nx">buf</span> <span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">]</span><span class="tok-kt">byte</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="tok-nx">_</span><span class="tok-p">,</span> <span class="tok-nx">err</span> <span class="tok-o">:=</span> <span class="tok-nx">r</span><span class="tok-p">.</span><span class="tok-nx">Read</span><span class="tok-p">(</span><span class="tok-nx">buf</span><span class="tok-p">[:])</span>
        <span class="tok-k">return</span> <span class="tok-nb">rune</span><span class="tok-p">(</span><span class="tok-nx">buf</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">]),</span> <span class="tok-nx">err</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Allocation is here</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We&#8217;ll talk about why this is happening in more detail in the next section, but for the moment what we see is every call to readbyte is allocating a new one byte long <em>array</em> and that array is being allocated on the heap.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>What are some ways we can avoid this? Try them and use CPU and memory profiling to prove it.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="alloc_objects_vs_inuse_objects"><a class="anchor" href="#alloc_objects_vs_inuse_objects"></a><a class="link" href="#alloc_objects_vs_inuse_objects">Alloc objects vs. inuse objects</a></h5>
<div class="paragraph">
<p>Memory profiles come in two varieties, named after their <code>go tool pprof</code> flags</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-alloc_objects</code> reports the call site where each allocation was made.</p>
</li>
<li>
<p><code>-inuse_objects</code> reports the call site where an allocation was made <em>iff</em> it was reachable at the end of the profile.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To demonstrate this, here is a contrived program which will allocate a bunch of memory in a controlled manner.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span><span class="tok-kd">const</span> <span class="tok-nx">count</span> <span class="tok-p">=</span> <span class="tok-mi">100000</span>

<span class="tok-kd">var</span> <span class="tok-nx">y</span> <span class="tok-p">[]</span><span class="tok-kt">byte</span>

<span class="tok-kd">func</span> <span class="tok-nx">main</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-k">defer</span> <span class="tok-nx">profile</span><span class="tok-p">.</span><span class="tok-nx">Start</span><span class="tok-p">(</span><span class="tok-nx">profile</span><span class="tok-p">.</span><span class="tok-nx">MemProfile</span><span class="tok-p">,</span> <span class="tok-nx">profile</span><span class="tok-p">.</span><span class="tok-nx">MemProfileRate</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">)).</span><span class="tok-nx">Stop</span><span class="tok-p">()</span>
	<span class="tok-nx">y</span> <span class="tok-p">=</span> <span class="tok-nx">allocate</span><span class="tok-p">()</span>
	<span class="tok-nx">runtime</span><span class="tok-p">.</span><span class="tok-nx">GC</span><span class="tok-p">()</span>
<span class="tok-p">}</span>

<span class="tok-c1">// allocate allocates count byte slices and returns the first slice allocated.</span>
<span class="tok-kd">func</span> <span class="tok-nx">allocate</span><span class="tok-p">()</span> <span class="tok-p">[]</span><span class="tok-kt">byte</span> <span class="tok-p">{</span>
	<span class="tok-kd">var</span> <span class="tok-nx">x</span> <span class="tok-p">[][]</span><span class="tok-kt">byte</span>
	<span class="tok-k">for</span> <span class="tok-nx">i</span> <span class="tok-o">:=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-nx">i</span> <span class="tok-p">&lt;</span> <span class="tok-nx">count</span><span class="tok-p">;</span> <span class="tok-nx">i</span><span class="tok-o">++</span> <span class="tok-p">{</span>
		<span class="tok-nx">x</span> <span class="tok-p">=</span> <span class="tok-nb">append</span><span class="tok-p">(</span><span class="tok-nx">x</span><span class="tok-p">,</span> <span class="tok-nx">makeByteSlice</span><span class="tok-p">())</span>
	<span class="tok-p">}</span>
	<span class="tok-k">return</span> <span class="tok-nx">x</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">]</span>
<span class="tok-p">}</span>

<span class="tok-c1">// makeByteSlice returns a byte slice of a random length in the range [0, 16384).</span>
<span class="tok-kd">func</span> <span class="tok-nx">makeByteSlice</span><span class="tok-p">()</span> <span class="tok-p">[]</span><span class="tok-kt">byte</span> <span class="tok-p">{</span>
	<span class="tok-k">return</span> <span class="tok-nb">make</span><span class="tok-p">([]</span><span class="tok-kt">byte</span><span class="tok-p">,</span> <span class="tok-nx">rand</span><span class="tok-p">.</span><span class="tok-nx">Intn</span><span class="tok-p">(</span><span class="tok-mi">2</span><span class="tok-p">^</span><span class="tok-mi">14</span><span class="tok-p">))</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The program is annotation with the <code>profile</code> package, and we set the memory profile rate  to <code>1</code>--that is, record a stack trace for every allocation. This is slows down the program a lot, but you&#8217;ll see why in a minute.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% go run main.go
2018/08/25 15:22:05 profile: memory profiling enabled (rate 1), /var/folders/by/3gf34_z95zg05cyj744_vhx40000gn/T/profile730812803/mem.pprof
2018/08/25 15:22:05 profile: memory profiling disabled, /var/folders/by/3gf34_z95zg05cyj744_vhx40000gn/T/profile730812803/mem.pprof</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lets look at the graph of allocated objects, this is the default, and shows the call graphs that lead to the allocation of every object during the profile.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% go tool pprof -http=:8080 /var/folders/by/3gf34_z95zg05cyj744_vhx40000gn/T/profile891268605/mem.pprof</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="100%px" height="100%px">
<script type="text/ecmascript"><![CDATA[
/**
 *  SVGPan library 1.2.2
 * ======================
 *
 * Given an unique existing element with id "viewport" (or when missing, the
 * first g-element), including the library into any SVG adds the following
 * capabilities:
 *
 *  - Mouse panning
 *  - Mouse zooming (using the wheel)
 *  - Object dragging
 *
 * You can configure the behaviour of the pan/zoom/drag with the variables
 * listed in the CONFIGURATION section of this file.
 *
 * Known issues:
 *
 *  - Zooming (while panning) on Safari has still some issues
 *
 * Releases:
 *
 * 1.2.2, Tue Aug 30 17:21:56 CEST 2011, Andrea Leofreddi
 *	- Fixed viewBox on root tag (#7)
 *	- Improved zoom speed (#2)
 *
 * 1.2.1, Mon Jul  4 00:33:18 CEST 2011, Andrea Leofreddi
 *	- Fixed a regression with mouse wheel (now working on Firefox 5)
 *	- Working with viewBox attribute (#4)
 *	- Added "use strict;" and fixed resulting warnings (#5)
 *	- Added configuration variables, dragging is disabled by default (#3)
 *
 * 1.2, Sat Mar 20 08:42:50 GMT 2010, Zeng Xiaohui
 *	Fixed a bug with browser mouse handler interaction
 *
 * 1.1, Wed Feb  3 17:39:33 GMT 2010, Zeng Xiaohui
 *	Updated the zoom code to support the mouse wheel on Safari/Chrome
 *
 * 1.0, Andrea Leofreddi
 *	First release
 *
 * This code is licensed under the following BSD license:
 *
 * Copyright 2009-2017 Andrea Leofreddi <a.leofreddi@vleo.net>. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification, are
 * permitted provided that the following conditions are met:
 *
 *    1. Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *    2. Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *    3. Neither the name of the copyright holder nor the names of its
 *       contributors may be used to endorse or promote products derived from
 *       this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY COPYRIGHT HOLDERS AND CONTRIBUTORS ''AS IS'' AND ANY EXPRESS
 * OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
 * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL COPYRIGHT HOLDERS OR
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
 * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * The views and conclusions contained in the software and documentation are those of the
 * authors and should not be interpreted as representing official policies, either expressed
 * or implied, of Andrea Leofreddi.
 */

"use strict";

/// CONFIGURATION
/// ====>

var enablePan = 1; // 1 or 0: enable or disable panning (default enabled)
var enableZoom = 1; // 1 or 0: enable or disable zooming (default enabled)
var enableDrag = 0; // 1 or 0: enable or disable dragging (default disabled)
var zoomScale = 0.2; // Zoom sensitivity

/// <====
/// END OF CONFIGURATION

var root = document.documentElement;

var state = 'none', svgRoot = null, stateTarget, stateOrigin, stateTf;

setupHandlers(root);

/**
 * Register handlers
 */
function setupHandlers(root){
	setAttributes(root, {
		"onmouseup" : "handleMouseUp(evt)",
		"onmousedown" : "handleMouseDown(evt)",
		"onmousemove" : "handleMouseMove(evt)",
		//"onmouseout" : "handleMouseUp(evt)", // Decomment this to stop the pan functionality when dragging out of the SVG element
	});

	if(navigator.userAgent.toLowerCase().indexOf('webkit') >= 0)
		window.addEventListener('mousewheel', handleMouseWheel, false); // Chrome/Safari
	else
		window.addEventListener('DOMMouseScroll', handleMouseWheel, false); // Others
}

/**
 * Retrieves the root element for SVG manipulation. The element is then cached into the svgRoot global variable.
 */
function getRoot(root) {
	if(svgRoot == null) {
		var r = root.getElementById("viewport") ? root.getElementById("viewport") : root.documentElement, t = r;

		while(t != root) {
			if(t.getAttribute("viewBox")) {
				setCTM(r, t.getCTM());

				t.removeAttribute("viewBox");
			}

			t = t.parentNode;
		}

		svgRoot = r;
	}

	return svgRoot;
}

/**
 * Instance an SVGPoint object with given event coordinates.
 */
function getEventPoint(evt) {
	var p = root.createSVGPoint();

	p.x = evt.clientX;
	p.y = evt.clientY;

	return p;
}

/**
 * Sets the current transform matrix of an element.
 */
function setCTM(element, matrix) {
	var s = "matrix(" + matrix.a + "," + matrix.b + "," + matrix.c + "," + matrix.d + "," + matrix.e + "," + matrix.f + ")";

	element.setAttribute("transform", s);
}

/**
 * Dumps a matrix to a string (useful for debug).
 */
function dumpMatrix(matrix) {
	var s = "[ " + matrix.a + ", " + matrix.c + ", " + matrix.e + "\n  " + matrix.b + ", " + matrix.d + ", " + matrix.f + "\n  0, 0, 1 ]";

	return s;
}

/**
 * Sets attributes of an element.
 */
function setAttributes(element, attributes){
	for (var i in attributes)
		element.setAttributeNS(null, i, attributes[i]);
}

/**
 * Handle mouse wheel event.
 */
function handleMouseWheel(evt) {
	if(!enableZoom)
		return;

	if(evt.preventDefault)
		evt.preventDefault();

	evt.returnValue = false;

	var svgDoc = evt.target.ownerDocument;

	var delta;

	if(evt.wheelDelta)
		delta = evt.wheelDelta / 360; // Chrome/Safari
	else
		delta = evt.detail / -9; // Mozilla

	var z = Math.pow(1 + zoomScale, delta);

	var g = getRoot(svgDoc);

	var p = getEventPoint(evt);

	p = p.matrixTransform(g.getCTM().inverse());

	// Compute new scale matrix in current mouse position
	var k = root.createSVGMatrix().translate(p.x, p.y).scale(z).translate(-p.x, -p.y);

        setCTM(g, g.getCTM().multiply(k));

	if(typeof(stateTf) == "undefined")
		stateTf = g.getCTM().inverse();

	stateTf = stateTf.multiply(k.inverse());
}

/**
 * Handle mouse move event.
 */
function handleMouseMove(evt) {
	if(evt.preventDefault)
		evt.preventDefault();

	evt.returnValue = false;

	var svgDoc = evt.target.ownerDocument;

	var g = getRoot(svgDoc);

	if(state == 'pan' && enablePan) {
		// Pan mode
		var p = getEventPoint(evt).matrixTransform(stateTf);

		setCTM(g, stateTf.inverse().translate(p.x - stateOrigin.x, p.y - stateOrigin.y));
	} else if(state == 'drag' && enableDrag) {
		// Drag mode
		var p = getEventPoint(evt).matrixTransform(g.getCTM().inverse());

		setCTM(stateTarget, root.createSVGMatrix().translate(p.x - stateOrigin.x, p.y - stateOrigin.y).multiply(g.getCTM().inverse()).multiply(stateTarget.getCTM()));

		stateOrigin = p;
	}
}

/**
 * Handle click event.
 */
function handleMouseDown(evt) {
	if(evt.preventDefault)
		evt.preventDefault();

	evt.returnValue = false;

	var svgDoc = evt.target.ownerDocument;

	var g = getRoot(svgDoc);

	if(
		evt.target.tagName == "svg"
		|| !enableDrag // Pan anyway when drag is disabled and the user clicked on an element
	) {
		// Pan mode
		state = 'pan';

		stateTf = g.getCTM().inverse();

		stateOrigin = getEventPoint(evt).matrixTransform(stateTf);
	} else {
		// Drag mode
		state = 'drag';

		stateTarget = evt.target;

		stateTf = g.getCTM().inverse();

		stateOrigin = getEventPoint(evt).matrixTransform(stateTf);
	}
}

/**
 * Handle mouse button release event.
 */
function handleMouseUp(evt) {
	if(evt.preventDefault)
		evt.preventDefault();

	evt.returnValue = false;

	var svgDoc = evt.target.ownerDocument;

	if(state == 'pan' || state == 'drag') {
		// Quit pan mode
		state = '';
	}
}
]]></script><g id="viewport" transform="scale(0.5,0.5) translate(0,0)"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 510)">
<title>unnamed</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-510 573,-510 573,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_L</title>
<polygon fill="none" stroke="#000000" points="8,-402 8,-498 432,-498 432,-402 8,-402"/>
</g>
<!-- Type: alloc_objects -->
<g id="node1" class="node">
<title>Type: alloc_objects</title>
<polygon fill="#f8f8f8" stroke="#000000" points="423.5,-490 16.5,-490 16.5,-410 423.5,-410 423.5,-490"/>
<text text-anchor="start" x="24.5" y="-473.2" font-family="Times,serif" font-size="16.00" fill="#000000">Type: alloc_objects</text>
<text text-anchor="start" x="24.5" y="-455.2" font-family="Times,serif" font-size="16.00" fill="#000000">Time: Mar 23, 2019 at 1:08pm (GMT)</text>
<text text-anchor="start" x="24.5" y="-437.2" font-family="Times,serif" font-size="16.00" fill="#000000">Showing nodes accounting for 43837, 99.83% of 43910 total</text>
<text text-anchor="start" x="24.5" y="-419.2" font-family="Times,serif" font-size="16.00" fill="#000000">Dropped 66 nodes (cum &lt;= 219)</text>
</g>
<!-- N1 -->
<g id="node1" class="node">
<title>N1</title>
<g id="a_node1"><a xlink:title="main.makeByteSlice (43806)">
<polygon fill="#edd5d5" stroke="#b20000" points="569,-173 397,-173 397,-87 569,-87 569,-173"/>
<text text-anchor="middle" x="483" y="-149.8" font-family="Times,serif" font-size="24.00" fill="#000000">main</text>
<text text-anchor="middle" x="483" y="-123.8" font-family="Times,serif" font-size="24.00" fill="#000000">makeByteSlice</text>
<text text-anchor="middle" x="483" y="-97.8" font-family="Times,serif" font-size="24.00" fill="#000000">43806 (99.76%)</text>
</a>
</g>
</g>
<!-- NN1_0 -->
<g id="NN1_0" class="node">
<title>NN1_0</title>
<g id="a_NN1_0"><a xlink:title="43806">
<polygon fill="#f8f8f8" stroke="#000000" points="510,-36 460,-36 456,-32 456,0 506,0 510,-4 510,-36"/>
<polyline fill="none" stroke="#000000" points="506,-32 456,-32 "/>
<polyline fill="none" stroke="#000000" points="506,-32 506,0 "/>
<polyline fill="none" stroke="#000000" points="506,-32 510,-36 "/>
<text text-anchor="middle" x="483" y="-16.1" font-family="Times,serif" font-size="8.00" fill="#000000">16B</text>
</a>
</g>
</g>
<!-- N1&#45;&gt;NN1_0 -->
<g id="edge1" class="edge">
<title>N1&#45;&gt;NN1_0</title>
<g id="a_edge1"><a xlink:title="43806">
<path fill="none" stroke="#000000" d="M483,-86.6979C483,-73.0814 483,-58.4077 483,-46.1319"/>
<polygon fill="#000000" stroke="#000000" points="486.5001,-46.0482 483,-36.0482 479.5001,-46.0482 486.5001,-46.0482"/>
</a>
</g>
<g id="a_edge1&#45;label"><a xlink:title="43806">
<text text-anchor="middle" x="502.5" y="-57.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 43806</text>
</a>
</g>
</g>
<!-- N2 -->
<g id="node2" class="node">
<title>N2</title>
<g id="a_node2"><a xlink:title="runtime.main (43856)">
<polygon fill="#edd5d5" stroke="#b20000" points="524.5,-468 441.5,-468 441.5,-432 524.5,-432 524.5,-468"/>
<text text-anchor="middle" x="483" y="-457.1" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="483" y="-448.1" font-family="Times,serif" font-size="8.00" fill="#000000">main</text>
<text text-anchor="middle" x="483" y="-439.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 43856 (99.88%)</text>
</a>
</g>
</g>
<!-- N4 -->
<g id="node4" class="node">
<title>N4</title>
<g id="a_node4"><a xlink:title="main.main (43856)">
<polygon fill="#edd5d5" stroke="#b20000" points="524.5,-359 441.5,-359 441.5,-323 524.5,-323 524.5,-359"/>
<text text-anchor="middle" x="483" y="-348.1" font-family="Times,serif" font-size="8.00" fill="#000000">main</text>
<text text-anchor="middle" x="483" y="-339.1" font-family="Times,serif" font-size="8.00" fill="#000000">main</text>
<text text-anchor="middle" x="483" y="-330.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 43856 (99.88%)</text>
</a>
</g>
</g>
<!-- N2&#45;&gt;N4 -->
<g id="edge2" class="edge">
<title>N2&#45;&gt;N4</title>
<g id="a_edge2"><a xlink:title="runtime.main &#45;&gt; main.main (43856)">
<path fill="none" stroke="#b20000" stroke-width="5" d="M483,-431.5096C483,-414.4952 483,-389.0055 483,-369.4076"/>
<polygon fill="#b20000" stroke="#b20000" stroke-width="5" points="487.3751,-369.2172 483,-359.2173 478.6251,-369.2173 487.3751,-369.2172"/>
</a>
</g>
<g id="a_edge2&#45;label"><a xlink:title="runtime.main &#45;&gt; main.main (43856)">
<text text-anchor="middle" x="502.5" y="-380.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 43856</text>
</a>
</g>
</g>
<!-- N3 -->
<g id="node3" class="node">
<title>N3</title>
<g id="a_node3"><a xlink:title="main.allocate (43837)">
<polygon fill="#edd5d5" stroke="#b20000" points="525.5,-272 440.5,-272 440.5,-224 525.5,-224 525.5,-272"/>
<text text-anchor="middle" x="483" y="-260.8" font-family="Times,serif" font-size="9.00" fill="#000000">main</text>
<text text-anchor="middle" x="483" y="-250.8" font-family="Times,serif" font-size="9.00" fill="#000000">allocate</text>
<text text-anchor="middle" x="483" y="-240.8" font-family="Times,serif" font-size="9.00" fill="#000000">31 (0.071%)</text>
<text text-anchor="middle" x="483" y="-230.8" font-family="Times,serif" font-size="9.00" fill="#000000">of 43837 (99.83%)</text>
</a>
</g>
</g>
<!-- N3&#45;&gt;N1 -->
<g id="edge4" class="edge">
<title>N3&#45;&gt;N1</title>
<g id="a_edge4"><a xlink:title="main.allocate &#45;&gt; main.makeByteSlice (43806)">
<path fill="none" stroke="#b20000" stroke-width="5" d="M483,-223.8362C483,-212.1166 483,-197.5399 483,-183.3966"/>
<polygon fill="#b20000" stroke="#b20000" stroke-width="5" points="487.3751,-183.2217 483,-173.2218 478.6251,-183.2218 487.3751,-183.2217"/>
</a>
</g>
<g id="a_edge4&#45;label"><a xlink:title="main.allocate &#45;&gt; main.makeByteSlice (43806)">
<text text-anchor="middle" x="502.5" y="-194.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 43806</text>
</a>
</g>
</g>
<!-- N4&#45;&gt;N3 -->
<g id="edge3" class="edge">
<title>N4&#45;&gt;N3</title>
<g id="a_edge3"><a xlink:title="main.main &#45;&gt; main.allocate (43837)">
<path fill="none" stroke="#b20000" stroke-width="5" d="M483,-322.6262C483,-311.1524 483,-296.019 483,-282.3808"/>
<polygon fill="#b20000" stroke="#b20000" stroke-width="5" points="487.3751,-282.3283 483,-272.3284 478.6251,-282.3284 487.3751,-282.3283"/>
</a>
</g>
<g id="a_edge3&#45;label"><a xlink:title="main.main &#45;&gt; main.allocate (43837)">
<text text-anchor="middle" x="502.5" y="-293.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 43837</text>
</a>
</g>
</g>
</g>
</g></svg>
</div>
</div>
<div class="paragraph">
<p>Not surprisingly more than 99% of the allocations were inside <code>makeByteSlice</code>. Now lets look at the same profile using <code>-inuse_objects</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% go tool pprof -http=:8080 /var/folders/by/3gf34_z95zg05cyj744_vhx40000gn/T/profile891268605/mem.pprof</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="100%px" height="100%px">
<script type="text/ecmascript"><![CDATA[
/**
 *  SVGPan library 1.2.2
 * ======================
 *
 * Given an unique existing element with id "viewport" (or when missing, the
 * first g-element), including the library into any SVG adds the following
 * capabilities:
 *
 *  - Mouse panning
 *  - Mouse zooming (using the wheel)
 *  - Object dragging
 *
 * You can configure the behaviour of the pan/zoom/drag with the variables
 * listed in the CONFIGURATION section of this file.
 *
 * Known issues:
 *
 *  - Zooming (while panning) on Safari has still some issues
 *
 * Releases:
 *
 * 1.2.2, Tue Aug 30 17:21:56 CEST 2011, Andrea Leofreddi
 *	- Fixed viewBox on root tag (#7)
 *	- Improved zoom speed (#2)
 *
 * 1.2.1, Mon Jul  4 00:33:18 CEST 2011, Andrea Leofreddi
 *	- Fixed a regression with mouse wheel (now working on Firefox 5)
 *	- Working with viewBox attribute (#4)
 *	- Added "use strict;" and fixed resulting warnings (#5)
 *	- Added configuration variables, dragging is disabled by default (#3)
 *
 * 1.2, Sat Mar 20 08:42:50 GMT 2010, Zeng Xiaohui
 *	Fixed a bug with browser mouse handler interaction
 *
 * 1.1, Wed Feb  3 17:39:33 GMT 2010, Zeng Xiaohui
 *	Updated the zoom code to support the mouse wheel on Safari/Chrome
 *
 * 1.0, Andrea Leofreddi
 *	First release
 *
 * This code is licensed under the following BSD license:
 *
 * Copyright 2009-2017 Andrea Leofreddi <a.leofreddi@vleo.net>. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification, are
 * permitted provided that the following conditions are met:
 *
 *    1. Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *    2. Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *    3. Neither the name of the copyright holder nor the names of its
 *       contributors may be used to endorse or promote products derived from
 *       this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY COPYRIGHT HOLDERS AND CONTRIBUTORS ''AS IS'' AND ANY EXPRESS
 * OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
 * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL COPYRIGHT HOLDERS OR
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
 * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * The views and conclusions contained in the software and documentation are those of the
 * authors and should not be interpreted as representing official policies, either expressed
 * or implied, of Andrea Leofreddi.
 */

"use strict";

/// CONFIGURATION
/// ====>

var enablePan = 1; // 1 or 0: enable or disable panning (default enabled)
var enableZoom = 1; // 1 or 0: enable or disable zooming (default enabled)
var enableDrag = 0; // 1 or 0: enable or disable dragging (default disabled)
var zoomScale = 0.2; // Zoom sensitivity

/// <====
/// END OF CONFIGURATION

var root = document.documentElement;

var state = 'none', svgRoot = null, stateTarget, stateOrigin, stateTf;

setupHandlers(root);

/**
 * Register handlers
 */
function setupHandlers(root){
	setAttributes(root, {
		"onmouseup" : "handleMouseUp(evt)",
		"onmousedown" : "handleMouseDown(evt)",
		"onmousemove" : "handleMouseMove(evt)",
		//"onmouseout" : "handleMouseUp(evt)", // Decomment this to stop the pan functionality when dragging out of the SVG element
	});

	if(navigator.userAgent.toLowerCase().indexOf('webkit') >= 0)
		window.addEventListener('mousewheel', handleMouseWheel, false); // Chrome/Safari
	else
		window.addEventListener('DOMMouseScroll', handleMouseWheel, false); // Others
}

/**
 * Retrieves the root element for SVG manipulation. The element is then cached into the svgRoot global variable.
 */
function getRoot(root) {
	if(svgRoot == null) {
		var r = root.getElementById("viewport") ? root.getElementById("viewport") : root.documentElement, t = r;

		while(t != root) {
			if(t.getAttribute("viewBox")) {
				setCTM(r, t.getCTM());

				t.removeAttribute("viewBox");
			}

			t = t.parentNode;
		}

		svgRoot = r;
	}

	return svgRoot;
}

/**
 * Instance an SVGPoint object with given event coordinates.
 */
function getEventPoint(evt) {
	var p = root.createSVGPoint();

	p.x = evt.clientX;
	p.y = evt.clientY;

	return p;
}

/**
 * Sets the current transform matrix of an element.
 */
function setCTM(element, matrix) {
	var s = "matrix(" + matrix.a + "," + matrix.b + "," + matrix.c + "," + matrix.d + "," + matrix.e + "," + matrix.f + ")";

	element.setAttribute("transform", s);
}

/**
 * Dumps a matrix to a string (useful for debug).
 */
function dumpMatrix(matrix) {
	var s = "[ " + matrix.a + ", " + matrix.c + ", " + matrix.e + "\n  " + matrix.b + ", " + matrix.d + ", " + matrix.f + "\n  0, 0, 1 ]";

	return s;
}

/**
 * Sets attributes of an element.
 */
function setAttributes(element, attributes){
	for (var i in attributes)
		element.setAttributeNS(null, i, attributes[i]);
}

/**
 * Handle mouse wheel event.
 */
function handleMouseWheel(evt) {
	if(!enableZoom)
		return;

	if(evt.preventDefault)
		evt.preventDefault();

	evt.returnValue = false;

	var svgDoc = evt.target.ownerDocument;

	var delta;

	if(evt.wheelDelta)
		delta = evt.wheelDelta / 360; // Chrome/Safari
	else
		delta = evt.detail / -9; // Mozilla

	var z = Math.pow(1 + zoomScale, delta);

	var g = getRoot(svgDoc);

	var p = getEventPoint(evt);

	p = p.matrixTransform(g.getCTM().inverse());

	// Compute new scale matrix in current mouse position
	var k = root.createSVGMatrix().translate(p.x, p.y).scale(z).translate(-p.x, -p.y);

        setCTM(g, g.getCTM().multiply(k));

	if(typeof(stateTf) == "undefined")
		stateTf = g.getCTM().inverse();

	stateTf = stateTf.multiply(k.inverse());
}

/**
 * Handle mouse move event.
 */
function handleMouseMove(evt) {
	if(evt.preventDefault)
		evt.preventDefault();

	evt.returnValue = false;

	var svgDoc = evt.target.ownerDocument;

	var g = getRoot(svgDoc);

	if(state == 'pan' && enablePan) {
		// Pan mode
		var p = getEventPoint(evt).matrixTransform(stateTf);

		setCTM(g, stateTf.inverse().translate(p.x - stateOrigin.x, p.y - stateOrigin.y));
	} else if(state == 'drag' && enableDrag) {
		// Drag mode
		var p = getEventPoint(evt).matrixTransform(g.getCTM().inverse());

		setCTM(stateTarget, root.createSVGMatrix().translate(p.x - stateOrigin.x, p.y - stateOrigin.y).multiply(g.getCTM().inverse()).multiply(stateTarget.getCTM()));

		stateOrigin = p;
	}
}

/**
 * Handle click event.
 */
function handleMouseDown(evt) {
	if(evt.preventDefault)
		evt.preventDefault();

	evt.returnValue = false;

	var svgDoc = evt.target.ownerDocument;

	var g = getRoot(svgDoc);

	if(
		evt.target.tagName == "svg"
		|| !enableDrag // Pan anyway when drag is disabled and the user clicked on an element
	) {
		// Pan mode
		state = 'pan';

		stateTf = g.getCTM().inverse();

		stateOrigin = getEventPoint(evt).matrixTransform(stateTf);
	} else {
		// Drag mode
		state = 'drag';

		stateTarget = evt.target;

		stateTf = g.getCTM().inverse();

		stateOrigin = getEventPoint(evt).matrixTransform(stateTf);
	}
}

/**
 * Handle mouse button release event.
 */
function handleMouseUp(evt) {
	if(evt.preventDefault)
		evt.preventDefault();

	evt.returnValue = false;

	var svgDoc = evt.target.ownerDocument;

	if(state == 'pan' || state == 'drag') {
		// Quit pan mode
		state = '';
	}
}
]]></script><g id="viewport" transform="scale(0.5,0.5) translate(0,0)"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2029)">
<title>unnamed</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-2029 1378,-2029 1378,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_L</title>
<polygon fill="none" stroke="#000000" points="8,-1939 8,-2017 372,-2017 372,-1939 8,-1939"/>
</g>
<!-- Type: inuse_objects -->
<g id="node1" class="node">
<title>Type: inuse_objects</title>
<polygon fill="#f8f8f8" stroke="#000000" points="363.5,-2009 16.5,-2009 16.5,-1947 363.5,-1947 363.5,-2009"/>
<text text-anchor="start" x="24.5" y="-1992.2" font-family="Times,serif" font-size="16.00" fill="#000000">Type: inuse_objects</text>
<text text-anchor="start" x="24.5" y="-1974.2" font-family="Times,serif" font-size="16.00" fill="#000000">Time: Mar 23, 2019 at 1:08pm (GMT)</text>
<text text-anchor="start" x="24.5" y="-1956.2" font-family="Times,serif" font-size="16.00" fill="#000000">Showing nodes accounting for 60, 100% of 60 total</text>
</g>
<!-- N1 -->
<g id="node1" class="node">
<title>N1</title>
<g id="a_node1"><a xlink:title="runtime.malg (24)">
<polygon fill="#eddbd5" stroke="#b22a00" points="639,-823 503,-823 503,-737 639,-737 639,-823"/>
<text text-anchor="middle" x="571" y="-799.8" font-family="Times,serif" font-size="24.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="571" y="-773.8" font-family="Times,serif" font-size="24.00" fill="#000000">malg</text>
<text text-anchor="middle" x="571" y="-747.8" font-family="Times,serif" font-size="24.00" fill="#000000">24 (40.00%)</text>
</a>
</g>
</g>
<!-- NN1_0 -->
<g id="NN1_0" class="node">
<title>NN1_0</title>
<g id="a_NN1_0"><a xlink:title="24">
<polygon fill="#f8f8f8" stroke="#000000" points="598,-682 548,-682 544,-678 544,-646 594,-646 598,-650 598,-682"/>
<polyline fill="none" stroke="#000000" points="594,-678 544,-678 "/>
<polyline fill="none" stroke="#000000" points="594,-678 594,-646 "/>
<polyline fill="none" stroke="#000000" points="594,-678 598,-682 "/>
<text text-anchor="middle" x="571" y="-662.1" font-family="Times,serif" font-size="8.00" fill="#000000">384B</text>
</a>
</g>
</g>
<!-- N1&#45;&gt;NN1_0 -->
<g id="edge1" class="edge">
<title>N1&#45;&gt;NN1_0</title>
<g id="a_edge1"><a xlink:title="24">
<path fill="none" stroke="#000000" d="M571,-736.8059C571,-721.8626 571,-705.5141 571,-692.1016"/>
<polygon fill="#000000" stroke="#000000" points="574.5001,-692.0573 571,-682.0573 567.5001,-692.0574 574.5001,-692.0573"/>
</a>
</g>
<g id="a_edge1&#45;label"><a xlink:title="24">
<text text-anchor="middle" x="580" y="-707.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 24</text>
</a>
</g>
</g>
<!-- N2 -->
<g id="node2" class="node">
<title>N2</title>
<g id="a_node2"><a xlink:title="runtime.allocm (21)">
<polygon fill="#eddbd5" stroke="#b23000" points="686,-1235 566,-1235 566,-1151 686,-1151 686,-1235"/>
<text text-anchor="middle" x="626" y="-1217.4" font-family="Times,serif" font-size="17.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="626" y="-1198.4" font-family="Times,serif" font-size="17.00" fill="#000000">allocm</text>
<text text-anchor="middle" x="626" y="-1179.4" font-family="Times,serif" font-size="17.00" fill="#000000">7 (11.67%)</text>
<text text-anchor="middle" x="626" y="-1160.4" font-family="Times,serif" font-size="17.00" fill="#000000">of 21 (35.00%)</text>
</a>
</g>
</g>
<!-- N2&#45;&gt;N1 -->
<g id="edge32" class="edge">
<title>N2&#45;&gt;N1</title>
<g id="a_edge32"><a xlink:title="runtime.allocm &#45;&gt; runtime.malg (7)">
<path fill="none" stroke="#b27b4a" d="M594.8039,-1150.7397C582.3903,-1129.9153 571,-1103.7828 571,-1078 571,-1078 571,-1078 571,-892 571,-872.8047 571,-851.7589 571,-833.1441"/>
<polygon fill="#b27b4a" stroke="#b27b4a" points="574.5001,-833.0798 571,-823.0799 567.5001,-833.0799 574.5001,-833.0798"/>
</a>
</g>
<g id="a_edge32&#45;label"><a xlink:title="runtime.allocm &#45;&gt; runtime.malg (7)">
<text text-anchor="middle" x="576.5" y="-979.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 7</text>
</a>
</g>
</g>
<!-- NN2_0 -->
<g id="NN2_0" class="node">
<title>NN2_0</title>
<g id="a_NN2_0"><a xlink:title="7">
<polygon fill="#f8f8f8" stroke="#000000" points="653,-1096 603,-1096 599,-1092 599,-1060 649,-1060 653,-1064 653,-1096"/>
<polyline fill="none" stroke="#000000" points="649,-1092 599,-1092 "/>
<polyline fill="none" stroke="#000000" points="649,-1092 649,-1060 "/>
<polyline fill="none" stroke="#000000" points="649,-1092 653,-1096 "/>
<text text-anchor="middle" x="626" y="-1076.1" font-family="Times,serif" font-size="8.00" fill="#000000">1kB</text>
</a>
</g>
</g>
<!-- N2&#45;&gt;NN2_0 -->
<g id="edge2" class="edge">
<title>N2&#45;&gt;NN2_0</title>
<g id="a_edge2"><a xlink:title="7">
<path fill="none" stroke="#000000" d="M626,-1150.8312C626,-1135.9603 626,-1119.6133 626,-1106.1809"/>
<polygon fill="#000000" stroke="#000000" points="629.5001,-1106.117 626,-1096.117 622.5001,-1106.1171 629.5001,-1106.117"/>
</a>
</g>
<g id="a_edge2&#45;label"><a xlink:title="7">
<text text-anchor="middle" x="631.5" y="-1121.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 7</text>
</a>
</g>
</g>
<!-- N34 -->
<g id="node34" class="node">
<title>N34</title>
<g id="a_node34"><a xlink:title="runtime.mcommoninit (7)">
<polygon fill="#ede5df" stroke="#b27b4a" points="708.5,-1001 641.5,-1001 641.5,-965 708.5,-965 708.5,-1001"/>
<text text-anchor="middle" x="675" y="-990.1" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="675" y="-981.1" font-family="Times,serif" font-size="8.00" fill="#000000">mcommoninit</text>
<text text-anchor="middle" x="675" y="-972.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 7 (11.67%)</text>
</a>
</g>
</g>
<!-- N2&#45;&gt;N34 -->
<g id="edge33" class="edge">
<title>N2&#45;&gt;N34</title>
<g id="a_edge33"><a xlink:title="runtime.allocm &#45;&gt; runtime.mcommoninit (7)">
<path fill="none" stroke="#b27b4a" d="M645.0396,-1150.6853C651.3632,-1135.044 657.8435,-1116.9853 662,-1100 669.2881,-1070.2177 672.4987,-1035.1607 673.9079,-1011.2394"/>
<polygon fill="#b27b4a" stroke="#b27b4a" points="677.4115,-1011.2597 674.4368,-1001.091 670.421,-1010.8953 677.4115,-1011.2597"/>
</a>
</g>
<g id="a_edge33&#45;label"><a xlink:title="runtime.allocm &#45;&gt; runtime.mcommoninit (7)">
<text text-anchor="middle" x="675.5" y="-1074.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 7</text>
</a>
</g>
</g>
<!-- N3 -->
<g id="node3" class="node">
<title>N3</title>
<g id="a_node3"><a xlink:title="runtime.mstart (17)">
<polygon fill="#eddcd5" stroke="#b23800" points="452.5,-1996 381.5,-1996 381.5,-1960 452.5,-1960 452.5,-1996"/>
<text text-anchor="middle" x="417" y="-1985.1" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="417" y="-1976.1" font-family="Times,serif" font-size="8.00" fill="#000000">mstart</text>
<text text-anchor="middle" x="417" y="-1967.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 17 (28.33%)</text>
</a>
</g>
</g>
<!-- N8 -->
<g id="node8" class="node">
<title>N8</title>
<g id="a_node8"><a xlink:title="runtime.systemstack (14)">
<polygon fill="#edddd5" stroke="#b23f00" points="468,-1888 366,-1888 366,-1820 468,-1820 468,-1888"/>
<text text-anchor="middle" x="417" y="-1872.8" font-family="Times,serif" font-size="14.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="417" y="-1857.8" font-family="Times,serif" font-size="14.00" fill="#000000">systemstack</text>
<text text-anchor="middle" x="417" y="-1842.8" font-family="Times,serif" font-size="14.00" fill="#000000">3 (5.00%)</text>
<text text-anchor="middle" x="417" y="-1827.8" font-family="Times,serif" font-size="14.00" fill="#000000">of 14 (23.33%)</text>
</a>
</g>
</g>
<!-- N3&#45;&gt;N8 -->
<g id="edge27" class="edge">
<title>N3&#45;&gt;N8</title>
<g id="a_edge27"><a xlink:title="runtime.mstart &#45;&gt; runtime.systemstack (14)">
<path fill="none" stroke="#b23f00" stroke-width="2" d="M417,-1959.9693C417,-1943.8642 417,-1919.6041 417,-1898.3586"/>
<polygon fill="#b23f00" stroke="#b23f00" stroke-width="2" points="420.5001,-1898.2201 417,-1888.2201 413.5001,-1898.2202 420.5001,-1898.2201"/>
</a>
</g>
<g id="a_edge27&#45;label"><a xlink:title="runtime.mstart &#45;&gt; runtime.systemstack (14)">
<text text-anchor="middle" x="426" y="-1909.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 14</text>
</a>
</g>
</g>
<!-- N36 -->
<g id="node36" class="node">
<title>N36</title>
<g id="a_node36"><a xlink:title="runtime.mstart1 (3)">
<polygon fill="#edeae7" stroke="#b2a085" points="561.5,-1872 498.5,-1872 498.5,-1836 561.5,-1836 561.5,-1872"/>
<text text-anchor="middle" x="530" y="-1861.1" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="530" y="-1852.1" font-family="Times,serif" font-size="8.00" fill="#000000">mstart1</text>
<text text-anchor="middle" x="530" y="-1843.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 3 (5.00%)</text>
</a>
</g>
</g>
<!-- N3&#45;&gt;N36 -->
<g id="edge49" class="edge">
<title>N3&#45;&gt;N36</title>
<g id="a_edge49"><a xlink:title="runtime.mstart &#45;&gt; runtime.mstart1 (3)">
<path fill="none" stroke="#b2a085" d="M433.4312,-1959.9693C452.6793,-1938.8475 484.7101,-1903.6986 506.5618,-1879.7198"/>
<polygon fill="#b2a085" stroke="#b2a085" points="509.4003,-1881.8012 513.549,-1872.0524 504.2264,-1877.0863 509.4003,-1881.8012"/>
</a>
</g>
<g id="a_edge49&#45;label"><a xlink:title="runtime.mstart &#45;&gt; runtime.mstart1 (3)">
<text text-anchor="middle" x="486.5" y="-1909.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 3</text>
</a>
</g>
</g>
<!-- N4 -->
<g id="node4" class="node">
<title>N4</title>
<g id="a_node4"><a xlink:title="runtime.gcBgMarkWorker (8)">
<polygon fill="#ede4dd" stroke="#b2713b" points="828,-2012 680,-2012 680,-1944 828,-1944 828,-2012"/>
<text text-anchor="middle" x="754" y="-1993.6" font-family="Times,serif" font-size="18.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="754" y="-1973.6" font-family="Times,serif" font-size="18.00" fill="#000000">gcBgMarkWorker</text>
<text text-anchor="middle" x="754" y="-1953.6" font-family="Times,serif" font-size="18.00" fill="#000000">8 (13.33%)</text>
</a>
</g>
</g>
<!-- NN4_0 -->
<g id="NN4_0" class="node">
<title>NN4_0</title>
<g id="a_NN4_0"><a xlink:title="8">
<polygon fill="#f8f8f8" stroke="#000000" points="781,-1872 731,-1872 727,-1868 727,-1836 777,-1836 781,-1840 781,-1872"/>
<polyline fill="none" stroke="#000000" points="777,-1868 727,-1868 "/>
<polyline fill="none" stroke="#000000" points="777,-1868 777,-1836 "/>
<polyline fill="none" stroke="#000000" points="777,-1868 781,-1872 "/>
<text text-anchor="middle" x="754" y="-1852.1" font-family="Times,serif" font-size="8.00" fill="#000000">16B</text>
</a>
</g>
</g>
<!-- N4&#45;&gt;NN4_0 -->
<g id="edge3" class="edge">
<title>N4&#45;&gt;NN4_0</title>
<g id="a_edge3"><a xlink:title="8">
<path fill="none" stroke="#000000" d="M754,-1943.7882C754,-1924.3725 754,-1900.3726 754,-1882.0717"/>
<polygon fill="#000000" stroke="#000000" points="757.5001,-1882.0327 754,-1872.0327 750.5001,-1882.0328 757.5001,-1882.0327"/>
</a>
</g>
<g id="a_edge3&#45;label"><a xlink:title="8">
<text text-anchor="middle" x="759.5" y="-1909.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 8</text>
</a>
</g>
</g>
<!-- N5 -->
<g id="node5" class="node">
<title>N5</title>
<g id="a_node5"><a xlink:title="runtime.schedule (18)">
<polygon fill="#eddcd5" stroke="#b23600" points="661.5,-1753 590.5,-1753 590.5,-1717 661.5,-1717 661.5,-1753"/>
<text text-anchor="middle" x="626" y="-1742.1" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="626" y="-1733.1" font-family="Times,serif" font-size="8.00" fill="#000000">schedule</text>
<text text-anchor="middle" x="626" y="-1724.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 18 (30.00%)</text>
</a>
</g>
</g>
<!-- N39 -->
<g id="node39" class="node">
<title>N39</title>
<g id="a_node39"><a xlink:title="runtime.resetspinning (15)">
<polygon fill="#edddd5" stroke="#b23c00" points="661.5,-1644.5 590.5,-1644.5 590.5,-1608.5 661.5,-1608.5 661.5,-1644.5"/>
<text text-anchor="middle" x="626" y="-1633.6" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="626" y="-1624.6" font-family="Times,serif" font-size="8.00" fill="#000000">resetspinning</text>
<text text-anchor="middle" x="626" y="-1615.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 15 (25.00%)</text>
</a>
</g>
</g>
<!-- N5&#45;&gt;N39 -->
<g id="edge25" class="edge">
<title>N5&#45;&gt;N39</title>
<g id="a_edge25"><a xlink:title="runtime.schedule &#45;&gt; runtime.resetspinning (15)">
<path fill="none" stroke="#b23c00" stroke-width="2" d="M626,-1716.5945C626,-1699.6581 626,-1674.2853 626,-1654.7773"/>
<polygon fill="#b23c00" stroke="#b23c00" stroke-width="2" points="629.5001,-1654.6337 626,-1644.6337 622.5001,-1654.6338 629.5001,-1654.6337"/>
</a>
</g>
<g id="a_edge25&#45;label"><a xlink:title="runtime.schedule &#45;&gt; runtime.resetspinning (15)">
<text text-anchor="middle" x="635" y="-1671.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 15</text>
</a>
</g>
</g>
<!-- N42 -->
<g id="node42" class="node">
<title>N42</title>
<g id="a_node42"><a xlink:title="runtime.stoplockedm (3)">
<polygon fill="#edeae7" stroke="#b2a085" points="742.5,-1644.5 679.5,-1644.5 679.5,-1608.5 742.5,-1608.5 742.5,-1644.5"/>
<text text-anchor="middle" x="711" y="-1633.6" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="711" y="-1624.6" font-family="Times,serif" font-size="8.00" fill="#000000">stoplockedm</text>
<text text-anchor="middle" x="711" y="-1615.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 3 (5.00%)</text>
</a>
</g>
</g>
<!-- N5&#45;&gt;N42 -->
<g id="edge51" class="edge">
<title>N5&#45;&gt;N42</title>
<g id="a_edge51"><a xlink:title="runtime.schedule &#45;&gt; runtime.stoplockedm (3)">
<path fill="none" stroke="#b2a085" d="M640.4191,-1716.5945C654.1786,-1699.0308 675.0459,-1672.3943 690.5259,-1652.6346"/>
<polygon fill="#b2a085" stroke="#b2a085" points="693.382,-1654.6642 696.7939,-1644.6337 687.8716,-1650.3473 693.382,-1654.6642"/>
</a>
</g>
<g id="a_edge51&#45;label"><a xlink:title="runtime.schedule &#45;&gt; runtime.stoplockedm (3)">
<text text-anchor="middle" x="682.5" y="-1671.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 3</text>
</a>
</g>
</g>
<!-- N6 -->
<g id="node6" class="node">
<title>N6</title>
<g id="a_node6"><a xlink:title="github.com/pkg/profile.Start.func8 (9)">
<polygon fill="#ede3db" stroke="#b2662c" points="942.5,-2017 853.5,-2017 853.5,-1939 942.5,-1939 942.5,-2017"/>
<text text-anchor="middle" x="898" y="-2002.6" font-family="Times,serif" font-size="13.00" fill="#000000">profile</text>
<text text-anchor="middle" x="898" y="-1988.6" font-family="Times,serif" font-size="13.00" fill="#000000">Start</text>
<text text-anchor="middle" x="898" y="-1974.6" font-family="Times,serif" font-size="13.00" fill="#000000">func8</text>
<text text-anchor="middle" x="898" y="-1960.6" font-family="Times,serif" font-size="13.00" fill="#000000">2 (3.33%)</text>
<text text-anchor="middle" x="898" y="-1946.6" font-family="Times,serif" font-size="13.00" fill="#000000">of 9 (15.00%)</text>
</a>
</g>
</g>
<!-- NN6_0 -->
<g id="NN6_0" class="node">
<title>NN6_0</title>
<g id="a_NN6_0"><a xlink:title="1">
<polygon fill="#f8f8f8" stroke="#000000" points="853,-1872 803,-1872 799,-1868 799,-1836 849,-1836 853,-1840 853,-1872"/>
<polyline fill="none" stroke="#000000" points="849,-1868 799,-1868 "/>
<polyline fill="none" stroke="#000000" points="849,-1868 849,-1836 "/>
<polyline fill="none" stroke="#000000" points="849,-1868 853,-1872 "/>
<text text-anchor="middle" x="826" y="-1852.1" font-family="Times,serif" font-size="8.00" fill="#000000">16B</text>
</a>
</g>
</g>
<!-- N6&#45;&gt;NN6_0 -->
<g id="edge4" class="edge">
<title>N6&#45;&gt;NN6_0</title>
<g id="a_edge4"><a xlink:title="1">
<path fill="none" stroke="#000000" d="M875.2188,-1938.7656C864.3037,-1919.9674 851.5059,-1897.9268 841.6965,-1881.0328"/>
<polygon fill="#000000" stroke="#000000" points="844.6333,-1879.1204 836.5852,-1872.23 838.5798,-1882.6354 844.6333,-1879.1204"/>
</a>
</g>
<g id="a_edge4&#45;label"><a xlink:title="1">
<text text-anchor="middle" x="869.5" y="-1909.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1</text>
</a>
</g>
</g>
<!-- NN6_1 -->
<g id="NN6_1" class="node">
<title>NN6_1</title>
<g id="a_NN6_1"><a xlink:title="1">
<polygon fill="#f8f8f8" stroke="#000000" points="925,-1872 875,-1872 871,-1868 871,-1836 921,-1836 925,-1840 925,-1872"/>
<polyline fill="none" stroke="#000000" points="921,-1868 871,-1868 "/>
<polyline fill="none" stroke="#000000" points="921,-1868 921,-1836 "/>
<polyline fill="none" stroke="#000000" points="921,-1868 925,-1872 "/>
<text text-anchor="middle" x="898" y="-1852.1" font-family="Times,serif" font-size="8.00" fill="#000000">96B</text>
</a>
</g>
</g>
<!-- N6&#45;&gt;NN6_1 -->
<g id="edge5" class="edge">
<title>N6&#45;&gt;NN6_1</title>
<g id="a_edge5"><a xlink:title="1">
<path fill="none" stroke="#000000" d="M898,-1938.7656C898,-1920.4896 898,-1899.1488 898,-1882.4524"/>
<polygon fill="#000000" stroke="#000000" points="901.5001,-1882.23 898,-1872.23 894.5001,-1882.23 901.5001,-1882.23"/>
</a>
</g>
<g id="a_edge5&#45;label"><a xlink:title="1">
<text text-anchor="middle" x="903.5" y="-1909.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1</text>
</a>
</g>
</g>
<!-- N12 -->
<g id="node12" class="node">
<title>N12</title>
<g id="a_node12"><a xlink:title="os/signal.Notify (7)">
<polygon fill="#ede5df" stroke="#b27b4a" points="1008.5,-1769 913.5,-1769 913.5,-1701 1008.5,-1701 1008.5,-1769"/>
<text text-anchor="middle" x="961" y="-1753.8" font-family="Times,serif" font-size="14.00" fill="#000000">signal</text>
<text text-anchor="middle" x="961" y="-1738.8" font-family="Times,serif" font-size="14.00" fill="#000000">Notify</text>
<text text-anchor="middle" x="961" y="-1723.8" font-family="Times,serif" font-size="14.00" fill="#000000">3 (5.00%)</text>
<text text-anchor="middle" x="961" y="-1708.8" font-family="Times,serif" font-size="14.00" fill="#000000">of 7 (11.67%)</text>
</a>
</g>
</g>
<!-- N6&#45;&gt;N12 -->
<g id="edge31" class="edge">
<title>N6&#45;&gt;N12</title>
<g id="a_edge31"><a xlink:title="github.com/pkg/profile.Start.func8 &#45;&gt; os/signal.Notify (7)">
<path fill="none" stroke="#b27b4a" d="M915.7452,-1938.7387C922.2314,-1923.1877 929.1577,-1904.9936 934,-1888 944.2602,-1851.9925 951.3319,-1810.0505 955.6563,-1779.1959"/>
<polygon fill="#b27b4a" stroke="#b27b4a" points="959.1386,-1779.5623 957.0182,-1769.1819 952.2025,-1778.619 959.1386,-1779.5623"/>
</a>
</g>
<g id="a_edge31&#45;label"><a xlink:title="github.com/pkg/profile.Start.func8 &#45;&gt; os/signal.Notify (7)">
<text text-anchor="middle" x="954.5" y="-1850.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 7</text>
</a>
</g>
</g>
<!-- N7 -->
<g id="node7" class="node">
<title>N7</title>
<g id="a_node7"><a xlink:title="runtime.mcall (15)">
<polygon fill="#edddd5" stroke="#b23c00" points="661.5,-1996 590.5,-1996 590.5,-1960 661.5,-1960 661.5,-1996"/>
<text text-anchor="middle" x="626" y="-1985.1" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="626" y="-1976.1" font-family="Times,serif" font-size="8.00" fill="#000000">mcall</text>
<text text-anchor="middle" x="626" y="-1967.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 15 (25.00%)</text>
</a>
</g>
</g>
<!-- N38 -->
<g id="node38" class="node">
<title>N38</title>
<g id="a_node38"><a xlink:title="runtime.park_m (15)">
<polygon fill="#edddd5" stroke="#b23c00" points="661.5,-1872 590.5,-1872 590.5,-1836 661.5,-1836 661.5,-1872"/>
<text text-anchor="middle" x="626" y="-1861.1" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="626" y="-1852.1" font-family="Times,serif" font-size="8.00" fill="#000000">park_m</text>
<text text-anchor="middle" x="626" y="-1843.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 15 (25.00%)</text>
</a>
</g>
</g>
<!-- N7&#45;&gt;N38 -->
<g id="edge22" class="edge">
<title>N7&#45;&gt;N38</title>
<g id="a_edge22"><a xlink:title="runtime.mcall &#45;&gt; runtime.park_m (15)">
<path fill="none" stroke="#b23c00" stroke-width="2" d="M626,-1959.9693C626,-1939.5822 626,-1906.1268 626,-1882.2614"/>
<polygon fill="#b23c00" stroke="#b23c00" stroke-width="2" points="629.5001,-1882.0524 626,-1872.0524 622.5001,-1882.0525 629.5001,-1882.0524"/>
</a>
</g>
<g id="a_edge22&#45;label"><a xlink:title="runtime.mcall &#45;&gt; runtime.park_m (15)">
<text text-anchor="middle" x="635" y="-1909.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 15</text>
</a>
</g>
</g>
<!-- NN8_0 -->
<g id="NN8_0" class="node">
<title>NN8_0</title>
<g id="a_NN8_0"><a xlink:title="2">
<polygon fill="#f8f8f8" stroke="#000000" points="372,-1753 322,-1753 318,-1749 318,-1717 368,-1717 372,-1721 372,-1753"/>
<polyline fill="none" stroke="#000000" points="368,-1749 318,-1749 "/>
<polyline fill="none" stroke="#000000" points="368,-1749 368,-1717 "/>
<polyline fill="none" stroke="#000000" points="368,-1749 372,-1753 "/>
<text text-anchor="middle" x="345" y="-1733.1" font-family="Times,serif" font-size="8.00" fill="#000000">64B</text>
</a>
</g>
</g>
<!-- N8&#45;&gt;NN8_0 -->
<g id="edge6" class="edge">
<title>N8&#45;&gt;NN8_0</title>
<g id="a_edge6"><a xlink:title="2">
<path fill="none" stroke="#000000" d="M396.3677,-1819.8994C385.2882,-1801.5875 371.8181,-1779.3243 361.4517,-1762.1909"/>
<polygon fill="#000000" stroke="#000000" points="364.218,-1760.0018 356.0468,-1753.2578 358.2289,-1763.6255 364.218,-1760.0018"/>
</a>
</g>
<g id="a_edge6&#45;label"><a xlink:title="2">
<text text-anchor="middle" x="391.5" y="-1790.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 2</text>
</a>
</g>
</g>
<!-- NN8_1 -->
<g id="NN8_1" class="node">
<title>NN8_1</title>
<g id="a_NN8_1"><a xlink:title="1">
<polygon fill="#f8f8f8" stroke="#000000" points="444,-1753 394,-1753 390,-1749 390,-1717 440,-1717 444,-1721 444,-1753"/>
<polyline fill="none" stroke="#000000" points="440,-1749 390,-1749 "/>
<polyline fill="none" stroke="#000000" points="440,-1749 440,-1717 "/>
<polyline fill="none" stroke="#000000" points="440,-1749 444,-1753 "/>
<text text-anchor="middle" x="417" y="-1733.1" font-family="Times,serif" font-size="8.00" fill="#000000">48B</text>
</a>
</g>
</g>
<!-- N8&#45;&gt;NN8_1 -->
<g id="edge7" class="edge">
<title>N8&#45;&gt;NN8_1</title>
<g id="a_edge7"><a xlink:title="1">
<path fill="none" stroke="#000000" d="M417,-1819.8994C417,-1802.0962 417,-1780.5581 417,-1763.6304"/>
<polygon fill="#000000" stroke="#000000" points="420.5001,-1763.2578 417,-1753.2578 413.5001,-1763.2579 420.5001,-1763.2578"/>
</a>
</g>
<g id="a_edge7&#45;label"><a xlink:title="1">
<text text-anchor="middle" x="422.5" y="-1790.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1</text>
</a>
</g>
</g>
<!-- N37 -->
<g id="node37" class="node">
<title>N37</title>
<g id="a_node37"><a xlink:title="runtime.newproc.func1 (11)">
<polygon fill="#ede0d7" stroke="#b2500e" points="515.5,-1648.5 444.5,-1648.5 444.5,-1604.5 515.5,-1604.5 515.5,-1648.5"/>
<text text-anchor="middle" x="480" y="-1638.1" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="480" y="-1629.1" font-family="Times,serif" font-size="8.00" fill="#000000">newproc</text>
<text text-anchor="middle" x="480" y="-1620.1" font-family="Times,serif" font-size="8.00" fill="#000000">func1</text>
<text text-anchor="middle" x="480" y="-1611.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 11 (18.33%)</text>
</a>
</g>
</g>
<!-- N8&#45;&gt;N37 -->
<g id="edge29" class="edge">
<title>N8&#45;&gt;N37</title>
<g id="a_edge29"><a xlink:title="runtime.systemstack &#45;&gt; runtime.newproc.func1 (11)">
<path fill="none" stroke="#b2500e" d="M433.4212,-1819.8796C440.2591,-1804.5961 447.7997,-1786.1792 453,-1769 464.2403,-1731.8675 471.7309,-1687.8128 475.9136,-1658.6195"/>
<polygon fill="#b2500e" stroke="#b2500e" points="479.3994,-1658.9627 477.3058,-1648.5768 472.4658,-1658.0015 479.3994,-1658.9627"/>
</a>
</g>
<g id="a_edge29&#45;label"><a xlink:title="runtime.systemstack &#45;&gt; runtime.newproc.func1 (11)">
<text text-anchor="middle" x="478" y="-1731.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 11</text>
</a>
</g>
</g>
<!-- N9 -->
<g id="node9" class="node">
<title>N9</title>
<g id="a_node9"><a xlink:title="runtime.newm (21)">
<polygon fill="#eddbd5" stroke="#b23000" points="661.5,-1340.5 590.5,-1340.5 590.5,-1304.5 661.5,-1304.5 661.5,-1340.5"/>
<text text-anchor="middle" x="626" y="-1329.6" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="626" y="-1320.6" font-family="Times,serif" font-size="8.00" fill="#000000">newm</text>
<text text-anchor="middle" x="626" y="-1311.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 21 (35.00%)</text>
</a>
</g>
</g>
<!-- N9&#45;&gt;N2 -->
<g id="edge20" class="edge">
<title>N9&#45;&gt;N2</title>
<g id="a_edge20"><a xlink:title="runtime.newm &#45;&gt; runtime.allocm (21)">
<path fill="none" stroke="#b23000" stroke-width="2" d="M626,-1304.4936C626,-1289.1443 626,-1266.2909 626,-1245.2637"/>
<polygon fill="#b23000" stroke="#b23000" stroke-width="2" points="629.5001,-1245.1288 626,-1235.1288 622.5001,-1245.1289 629.5001,-1245.1288"/>
</a>
</g>
<g id="a_edge20&#45;label"><a xlink:title="runtime.newm &#45;&gt; runtime.allocm (21)">
<text text-anchor="middle" x="635" y="-1256.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 21</text>
</a>
</g>
</g>
<!-- N10 -->
<g id="node10" class="node">
<title>N10</title>
<g id="a_node10"><a xlink:title="runtime.ensureSigM.func1 (5)">
<polygon fill="#ede8e3" stroke="#b28f68" points="825.5,-1648.5 762.5,-1648.5 762.5,-1604.5 825.5,-1604.5 825.5,-1648.5"/>
<text text-anchor="middle" x="794" y="-1638.1" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="794" y="-1629.1" font-family="Times,serif" font-size="8.00" fill="#000000">ensureSigM</text>
<text text-anchor="middle" x="794" y="-1620.1" font-family="Times,serif" font-size="8.00" fill="#000000">func1</text>
<text text-anchor="middle" x="794" y="-1611.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 5 (8.33%)</text>
</a>
</g>
</g>
<!-- N30 -->
<g id="node30" class="node">
<title>N30</title>
<g id="a_node30"><a xlink:title="runtime.LockOSThread (3)">
<polygon fill="#edeae7" stroke="#b2a085" points="827,-1548 761,-1548 761,-1512 827,-1512 827,-1548"/>
<text text-anchor="middle" x="794" y="-1537.1" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="794" y="-1528.1" font-family="Times,serif" font-size="8.00" fill="#000000">LockOSThread</text>
<text text-anchor="middle" x="794" y="-1519.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 3 (5.00%)</text>
</a>
</g>
</g>
<!-- N10&#45;&gt;N30 -->
<g id="edge47" class="edge">
<title>N10&#45;&gt;N30</title>
<g id="a_edge47"><a xlink:title="runtime.ensureSigM.func1 &#45;&gt; runtime.LockOSThread (3)">
<path fill="none" stroke="#b2a085" d="M794,-1604.1184C794,-1590.4086 794,-1572.7427 794,-1558.0969"/>
<polygon fill="#b2a085" stroke="#b2a085" points="797.5001,-1558.066 794,-1548.066 790.5001,-1558.066 797.5001,-1558.066"/>
</a>
</g>
<g id="a_edge47&#45;label"><a xlink:title="runtime.ensureSigM.func1 &#45;&gt; runtime.LockOSThread (3)">
<text text-anchor="middle" x="799.5" y="-1573.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 3</text>
</a>
</g>
</g>
<!-- N32 -->
<g id="node32" class="node">
<title>N32</title>
<g id="a_node32"><a xlink:title="runtime.chansend1 (1)">
<polygon fill="#edeceb" stroke="#b2aea3" points="908.5,-1548 845.5,-1548 845.5,-1512 908.5,-1512 908.5,-1548"/>
<text text-anchor="middle" x="877" y="-1537.1" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="877" y="-1528.1" font-family="Times,serif" font-size="8.00" fill="#000000">chansend1</text>
<text text-anchor="middle" x="877" y="-1519.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 1 (1.67%)</text>
</a>
</g>
</g>
<!-- N10&#45;&gt;N32 -->
<g id="edge65" class="edge">
<title>N10&#45;&gt;N32</title>
<g id="a_edge65"><a xlink:title="runtime.ensureSigM.func1 &#45;&gt; runtime.chansend1 (1)">
<path fill="none" stroke="#b2aea3" d="M813.2505,-1604.1184C825.6148,-1589.7431 841.72,-1571.0183 854.6492,-1555.9862"/>
<polygon fill="#b2aea3" stroke="#b2aea3" points="857.594,-1557.9298 861.4614,-1548.066 852.287,-1553.3652 857.594,-1557.9298"/>
</a>
</g>
<g id="a_edge65&#45;label"><a xlink:title="runtime.ensureSigM.func1 &#45;&gt; runtime.chansend1 (1)">
<text text-anchor="middle" x="845.5" y="-1573.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1</text>
</a>
</g>
</g>
<!-- N40 -->
<g id="node40" class="node">
<title>N40</title>
<g id="a_node40"><a xlink:title="runtime.selectgo (1)">
<polygon fill="#edeceb" stroke="#b2aea3" points="989.5,-1548 926.5,-1548 926.5,-1512 989.5,-1512 989.5,-1548"/>
<text text-anchor="middle" x="958" y="-1537.1" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="958" y="-1528.1" font-family="Times,serif" font-size="8.00" fill="#000000">selectgo</text>
<text text-anchor="middle" x="958" y="-1519.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 1 (1.67%)</text>
</a>
</g>
</g>
<!-- N10&#45;&gt;N40 -->
<g id="edge66" class="edge">
<title>N10&#45;&gt;N40</title>
<g id="a_edge66"><a xlink:title="runtime.ensureSigM.func1 &#45;&gt; runtime.selectgo (1)">
<path fill="none" stroke="#b2aea3" d="M825.6208,-1607.8938C852.0775,-1592.3264 889.9577,-1570.0371 918.4241,-1553.2871"/>
<polygon fill="#b2aea3" stroke="#b2aea3" points="920.4655,-1556.1469 927.3092,-1548.0589 916.9155,-1550.1138 920.4655,-1556.1469"/>
</a>
</g>
<g id="a_edge66&#45;label"><a xlink:title="runtime.ensureSigM.func1 &#45;&gt; runtime.selectgo (1)">
<text text-anchor="middle" x="890.5" y="-1573.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1</text>
</a>
</g>
</g>
<!-- N11 -->
<g id="node11" class="node">
<title>N11</title>
<g id="a_node11"><a xlink:title="runtime.startm (18)">
<polygon fill="#eddcd5" stroke="#b23600" points="661.5,-1451.5 590.5,-1451.5 590.5,-1415.5 661.5,-1415.5 661.5,-1451.5"/>
<text text-anchor="middle" x="626" y="-1440.6" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="626" y="-1431.6" font-family="Times,serif" font-size="8.00" fill="#000000">startm</text>
<text text-anchor="middle" x="626" y="-1422.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 18 (30.00%)</text>
</a>
</g>
</g>
<!-- N11&#45;&gt;N9 -->
<g id="edge21" class="edge">
<title>N11&#45;&gt;N9</title>
<g id="a_edge21"><a xlink:title="runtime.startm &#45;&gt; runtime.newm (18)">
<path fill="none" stroke="#b23600" stroke-width="2" d="M626,-1415.1706C626,-1397.7373 626,-1371.2482 626,-1351.0489"/>
<polygon fill="#b23600" stroke="#b23600" stroke-width="2" points="629.5001,-1350.8566 626,-1340.8566 622.5001,-1350.8567 629.5001,-1350.8566"/>
</a>
</g>
<g id="a_edge21&#45;label"><a xlink:title="runtime.startm &#45;&gt; runtime.newm (18)">
<text text-anchor="middle" x="635" y="-1380.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 18</text>
</a>
</g>
</g>
<!-- NN12_0 -->
<g id="NN12_0" class="node">
<title>NN12_0</title>
<g id="a_NN12_0"><a xlink:title="1">
<polygon fill="#f8f8f8" stroke="#000000" points="916,-1644.5 866,-1644.5 862,-1640.5 862,-1608.5 912,-1608.5 916,-1612.5 916,-1644.5"/>
<polyline fill="none" stroke="#000000" points="912,-1640.5 862,-1640.5 "/>
<polyline fill="none" stroke="#000000" points="912,-1640.5 912,-1608.5 "/>
<polyline fill="none" stroke="#000000" points="912,-1640.5 916,-1644.5 "/>
<text text-anchor="middle" x="889" y="-1624.6" font-family="Times,serif" font-size="8.00" fill="#000000">144B</text>
</a>
</g>
</g>
<!-- N12&#45;&gt;NN12_0 -->
<g id="edge8" class="edge">
<title>N12&#45;&gt;NN12_0</title>
<g id="a_edge8"><a xlink:title="1">
<path fill="none" stroke="#000000" d="M938.4163,-1700.9676C928.1706,-1685.5279 916.2329,-1667.5385 906.6577,-1653.1091"/>
<polygon fill="#000000" stroke="#000000" points="909.4829,-1651.0365 901.0372,-1644.6395 903.6502,-1654.907 909.4829,-1651.0365"/>
</a>
</g>
<g id="a_edge8&#45;label"><a xlink:title="1">
<text text-anchor="middle" x="930.5" y="-1671.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1</text>
</a>
</g>
</g>
<!-- NN12_1 -->
<g id="NN12_1" class="node">
<title>NN12_1</title>
<g id="a_NN12_1"><a xlink:title="1">
<polygon fill="#f8f8f8" stroke="#000000" points="988,-1644.5 938,-1644.5 934,-1640.5 934,-1608.5 984,-1608.5 988,-1612.5 988,-1644.5"/>
<polyline fill="none" stroke="#000000" points="984,-1640.5 934,-1640.5 "/>
<polyline fill="none" stroke="#000000" points="984,-1640.5 984,-1608.5 "/>
<polyline fill="none" stroke="#000000" points="984,-1640.5 988,-1644.5 "/>
<text text-anchor="middle" x="961" y="-1624.6" font-family="Times,serif" font-size="8.00" fill="#000000">16B</text>
</a>
</g>
</g>
<!-- N12&#45;&gt;NN12_1 -->
<g id="edge9" class="edge">
<title>N12&#45;&gt;NN12_1</title>
<g id="a_edge9"><a xlink:title="1">
<path fill="none" stroke="#000000" d="M961,-1700.9676C961,-1686.1105 961,-1668.8926 961,-1654.7575"/>
<polygon fill="#000000" stroke="#000000" points="964.5001,-1654.6394 961,-1644.6395 957.5001,-1654.6395 964.5001,-1654.6394"/>
</a>
</g>
<g id="a_edge9&#45;label"><a xlink:title="1">
<text text-anchor="middle" x="966.5" y="-1671.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1</text>
</a>
</g>
</g>
<!-- NN12_2 -->
<g id="NN12_2" class="node">
<title>NN12_2</title>
<g id="a_NN12_2"><a xlink:title="1">
<polygon fill="#f8f8f8" stroke="#000000" points="1060,-1644.5 1010,-1644.5 1006,-1640.5 1006,-1608.5 1056,-1608.5 1060,-1612.5 1060,-1644.5"/>
<polyline fill="none" stroke="#000000" points="1056,-1640.5 1006,-1640.5 "/>
<polyline fill="none" stroke="#000000" points="1056,-1640.5 1056,-1608.5 "/>
<polyline fill="none" stroke="#000000" points="1056,-1640.5 1060,-1644.5 "/>
<text text-anchor="middle" x="1033" y="-1624.6" font-family="Times,serif" font-size="8.00" fill="#000000">48B</text>
</a>
</g>
</g>
<!-- N12&#45;&gt;NN12_2 -->
<g id="edge10" class="edge">
<title>N12&#45;&gt;NN12_2</title>
<g id="a_edge10"><a xlink:title="1">
<path fill="none" stroke="#000000" d="M983.5837,-1700.9676C993.8294,-1685.5279 1005.7671,-1667.5385 1015.3423,-1653.1091"/>
<polygon fill="#000000" stroke="#000000" points="1018.3498,-1654.907 1020.9628,-1644.6395 1012.5171,-1651.0365 1018.3498,-1654.907"/>
</a>
</g>
<g id="a_edge10&#45;label"><a xlink:title="1">
<text text-anchor="middle" x="1008.5" y="-1671.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1</text>
</a>
</g>
</g>
<!-- N28 -->
<g id="node28" class="node">
<title>N28</title>
<g id="a_node28"><a xlink:title="os/signal.Notify.func1 (4)">
<polygon fill="#ede9e5" stroke="#b29877" points="1127.5,-1552 1064.5,-1552 1064.5,-1508 1127.5,-1508 1127.5,-1552"/>
<text text-anchor="middle" x="1096" y="-1541.6" font-family="Times,serif" font-size="8.00" fill="#000000">signal</text>
<text text-anchor="middle" x="1096" y="-1532.6" font-family="Times,serif" font-size="8.00" fill="#000000">Notify</text>
<text text-anchor="middle" x="1096" y="-1523.6" font-family="Times,serif" font-size="8.00" fill="#000000">func1</text>
<text text-anchor="middle" x="1096" y="-1514.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 4 (6.67%)</text>
</a>
</g>
</g>
<!-- N12&#45;&gt;N28 -->
<g id="edge41" class="edge">
<title>N12&#45;&gt;N28</title>
<g id="a_edge41"><a xlink:title="os/signal.Notify &#45;&gt; os/signal.Notify.func1 (4)">
<path fill="none" stroke="#b29877" d="M1008.7726,-1707.9196C1030.2694,-1693.3971 1054.108,-1673.6132 1069,-1650 1085.745,-1623.4486 1092.1621,-1587.8226 1094.5909,-1562.2983"/>
<polygon fill="#b29877" stroke="#b29877" points="1098.1033,-1562.2794 1095.4061,-1552.0337 1091.1253,-1561.7251 1098.1033,-1562.2794"/>
</a>
</g>
<g id="a_edge41&#45;label"><a xlink:title="os/signal.Notify &#45;&gt; os/signal.Notify.func1 (4)">
<text text-anchor="middle" x="1092.5" y="-1622.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 4</text>
</a>
</g>
</g>
<!-- N13 -->
<g id="node13" class="node">
<title>N13</title>
<g id="a_node13"><a xlink:title="os/signal.signal_enable (4)">
<polygon fill="#ede9e5" stroke="#b29877" points="1145.5,-1352 1046.5,-1352 1046.5,-1293 1145.5,-1293 1145.5,-1352"/>
<text text-anchor="middle" x="1096" y="-1336" font-family="Times,serif" font-size="15.00" fill="#000000">signal</text>
<text text-anchor="middle" x="1096" y="-1319" font-family="Times,serif" font-size="15.00" fill="#000000">signal_enable</text>
<text text-anchor="middle" x="1096" y="-1302" font-family="Times,serif" font-size="15.00" fill="#000000">4 (6.67%)</text>
</a>
</g>
</g>
<!-- NN13_0 -->
<g id="NN13_0" class="node">
<title>NN13_0</title>
<g id="a_NN13_0"><a xlink:title="4">
<polygon fill="#f8f8f8" stroke="#000000" points="1123,-1211 1073,-1211 1069,-1207 1069,-1175 1119,-1175 1123,-1179 1123,-1211"/>
<polyline fill="none" stroke="#000000" points="1119,-1207 1069,-1207 "/>
<polyline fill="none" stroke="#000000" points="1119,-1207 1119,-1175 "/>
<polyline fill="none" stroke="#000000" points="1119,-1207 1123,-1211 "/>
<text text-anchor="middle" x="1096" y="-1191.1" font-family="Times,serif" font-size="8.00" fill="#000000">96B</text>
</a>
</g>
</g>
<!-- N13&#45;&gt;NN13_0 -->
<g id="edge11" class="edge">
<title>N13&#45;&gt;NN13_0</title>
<g id="a_edge11"><a xlink:title="4">
<path fill="none" stroke="#000000" d="M1096,-1292.7901C1096,-1271.4241 1096,-1242.774 1096,-1221.6536"/>
<polygon fill="#000000" stroke="#000000" points="1099.5001,-1221.3737 1096,-1211.3738 1092.5001,-1221.3738 1099.5001,-1221.3737"/>
</a>
</g>
<g id="a_edge11&#45;label"><a xlink:title="4">
<text text-anchor="middle" x="1101.5" y="-1256.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 4</text>
</a>
</g>
</g>
<!-- N14 -->
<g id="node14" class="node">
<title>N14</title>
<g id="a_node14"><a xlink:title="runtime.acquireSudog (2)">
<polygon fill="#edebe9" stroke="#b2a794" points="981,-1347.5 893,-1347.5 893,-1297.5 981,-1297.5 981,-1347.5"/>
<text text-anchor="middle" x="937" y="-1333.1" font-family="Times,serif" font-size="13.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="937" y="-1319.1" font-family="Times,serif" font-size="13.00" fill="#000000">acquireSudog</text>
<text text-anchor="middle" x="937" y="-1305.1" font-family="Times,serif" font-size="13.00" fill="#000000">2 (3.33%)</text>
</a>
</g>
</g>
<!-- NN14_0 -->
<g id="NN14_0" class="node">
<title>NN14_0</title>
<g id="a_NN14_0"><a xlink:title="2">
<polygon fill="#f8f8f8" stroke="#000000" points="964,-1211 914,-1211 910,-1207 910,-1175 960,-1175 964,-1179 964,-1211"/>
<polyline fill="none" stroke="#000000" points="960,-1207 910,-1207 "/>
<polyline fill="none" stroke="#000000" points="960,-1207 960,-1175 "/>
<polyline fill="none" stroke="#000000" points="960,-1207 964,-1211 "/>
<text text-anchor="middle" x="937" y="-1191.1" font-family="Times,serif" font-size="8.00" fill="#000000">96B</text>
</a>
</g>
</g>
<!-- N14&#45;&gt;NN14_0 -->
<g id="edge12" class="edge">
<title>N14&#45;&gt;NN14_0</title>
<g id="a_edge12"><a xlink:title="2">
<path fill="none" stroke="#000000" d="M937,-1297.2237C937,-1275.3646 937,-1243.7999 937,-1221.1423"/>
<polygon fill="#000000" stroke="#000000" points="940.5001,-1221.1214 937,-1211.1214 933.5001,-1221.1215 940.5001,-1221.1214"/>
</a>
</g>
<g id="a_edge12&#45;label"><a xlink:title="2">
<text text-anchor="middle" x="942.5" y="-1256.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 2</text>
</a>
</g>
</g>
<!-- N15 -->
<g id="node15" class="node">
<title>N15</title>
<g id="a_node15"><a xlink:title="runtime.main (6)">
<polygon fill="#ede7e1" stroke="#b28559" points="1185.5,-1996 1118.5,-1996 1118.5,-1960 1185.5,-1960 1185.5,-1996"/>
<text text-anchor="middle" x="1152" y="-1985.1" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="1152" y="-1976.1" font-family="Times,serif" font-size="8.00" fill="#000000">main</text>
<text text-anchor="middle" x="1152" y="-1967.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 6 (10.00%)</text>
</a>
</g>
</g>
<!-- N20 -->
<g id="node20" class="node">
<title>N20</title>
<g id="a_node20"><a xlink:title="main.main (6)">
<polygon fill="#ede7e1" stroke="#b28559" points="1185.5,-1872 1118.5,-1872 1118.5,-1836 1185.5,-1836 1185.5,-1872"/>
<text text-anchor="middle" x="1152" y="-1861.1" font-family="Times,serif" font-size="8.00" fill="#000000">main</text>
<text text-anchor="middle" x="1152" y="-1852.1" font-family="Times,serif" font-size="8.00" fill="#000000">main</text>
<text text-anchor="middle" x="1152" y="-1843.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 6 (10.00%)</text>
</a>
</g>
</g>
<!-- N15&#45;&gt;N20 -->
<g id="edge36" class="edge">
<title>N15&#45;&gt;N20</title>
<g id="a_edge36"><a xlink:title="runtime.main &#45;&gt; main.main (6)">
<path fill="none" stroke="#b28559" d="M1152,-1959.9693C1152,-1939.5822 1152,-1906.1268 1152,-1882.2614"/>
<polygon fill="#b28559" stroke="#b28559" points="1155.5001,-1882.0524 1152,-1872.0524 1148.5001,-1882.0525 1155.5001,-1882.0524"/>
</a>
</g>
<g id="a_edge36&#45;label"><a xlink:title="runtime.main &#45;&gt; main.main (6)">
<text text-anchor="middle" x="1157.5" y="-1909.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 6</text>
</a>
</g>
</g>
<!-- N16 -->
<g id="node16" class="node">
<title>N16</title>
<g id="a_node16"><a xlink:title="github.com/pkg/profile.Start (5)">
<polygon fill="#ede8e3" stroke="#b28f68" points="1190.5,-1765 1113.5,-1765 1113.5,-1705 1190.5,-1705 1190.5,-1765"/>
<text text-anchor="middle" x="1152" y="-1751.4" font-family="Times,serif" font-size="12.00" fill="#000000">profile</text>
<text text-anchor="middle" x="1152" y="-1738.4" font-family="Times,serif" font-size="12.00" fill="#000000">Start</text>
<text text-anchor="middle" x="1152" y="-1725.4" font-family="Times,serif" font-size="12.00" fill="#000000">1 (1.67%)</text>
<text text-anchor="middle" x="1152" y="-1712.4" font-family="Times,serif" font-size="12.00" fill="#000000">of 5 (8.33%)</text>
</a>
</g>
</g>
<!-- NN16_0 -->
<g id="NN16_0" class="node">
<title>NN16_0</title>
<g id="a_NN16_0"><a xlink:title="1">
<polygon fill="#f8f8f8" stroke="#000000" points="1179,-1644.5 1129,-1644.5 1125,-1640.5 1125,-1608.5 1175,-1608.5 1179,-1612.5 1179,-1644.5"/>
<polyline fill="none" stroke="#000000" points="1175,-1640.5 1125,-1640.5 "/>
<polyline fill="none" stroke="#000000" points="1175,-1640.5 1175,-1608.5 "/>
<polyline fill="none" stroke="#000000" points="1175,-1640.5 1179,-1644.5 "/>
<text text-anchor="middle" x="1152" y="-1624.6" font-family="Times,serif" font-size="8.00" fill="#000000">48B</text>
</a>
</g>
</g>
<!-- N16&#45;&gt;NN16_0 -->
<g id="edge13" class="edge">
<title>N16&#45;&gt;NN16_0</title>
<g id="a_edge13"><a xlink:title="1">
<path fill="none" stroke="#000000" d="M1152,-1704.7767C1152,-1689.236 1152,-1670.3988 1152,-1655.0981"/>
<polygon fill="#000000" stroke="#000000" points="1155.5001,-1654.6795 1152,-1644.6796 1148.5001,-1654.6796 1155.5001,-1654.6795"/>
</a>
</g>
<g id="a_edge13&#45;label"><a xlink:title="1">
<text text-anchor="middle" x="1157.5" y="-1671.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1</text>
</a>
</g>
</g>
<!-- N24 -->
<g id="node24" class="node">
<title>N24</title>
<g id="a_node24"><a xlink:title="github.com/pkg/profile.Start.func2 (4)">
<polygon fill="#ede9e5" stroke="#b29877" points="1246.5,-1552 1183.5,-1552 1183.5,-1508 1246.5,-1508 1246.5,-1552"/>
<text text-anchor="middle" x="1215" y="-1541.6" font-family="Times,serif" font-size="8.00" fill="#000000">profile</text>
<text text-anchor="middle" x="1215" y="-1532.6" font-family="Times,serif" font-size="8.00" fill="#000000">Start</text>
<text text-anchor="middle" x="1215" y="-1523.6" font-family="Times,serif" font-size="8.00" fill="#000000">func2</text>
<text text-anchor="middle" x="1215" y="-1514.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 4 (6.67%)</text>
</a>
</g>
</g>
<!-- N16&#45;&gt;N24 -->
<g id="edge38" class="edge">
<title>N16&#45;&gt;N24</title>
<g id="a_edge38"><a xlink:title="github.com/pkg/profile.Start &#45;&gt; github.com/pkg/profile.Start.func2 (4)">
<path fill="none" stroke="#b29877" d="M1166.3474,-1704.8138C1173.5611,-1688.7909 1182.0176,-1668.6139 1188,-1650 1197.3344,-1620.9567 1204.659,-1586.9587 1209.31,-1562.5803"/>
<polygon fill="#b29877" stroke="#b29877" points="1212.8089,-1562.9083 1211.197,-1552.4369 1205.927,-1561.628 1212.8089,-1562.9083"/>
</a>
</g>
<g id="a_edge38&#45;label"><a xlink:title="github.com/pkg/profile.Start &#45;&gt; github.com/pkg/profile.Start.func2 (4)">
<text text-anchor="middle" x="1205.5" y="-1622.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 4</text>
</a>
</g>
</g>
<!-- N17 -->
<g id="node17" class="node">
<title>N17</title>
<g id="a_node17"><a xlink:title="log.(*Logger).Output (4)">
<polygon fill="#ede9e5" stroke="#b29877" points="1253.5,-1359 1176.5,-1359 1176.5,-1286 1253.5,-1286 1253.5,-1359"/>
<text text-anchor="middle" x="1215" y="-1345.4" font-family="Times,serif" font-size="12.00" fill="#000000">log</text>
<text text-anchor="middle" x="1215" y="-1332.4" font-family="Times,serif" font-size="12.00" fill="#000000">(*Logger)</text>
<text text-anchor="middle" x="1215" y="-1319.4" font-family="Times,serif" font-size="12.00" fill="#000000">Output</text>
<text text-anchor="middle" x="1215" y="-1306.4" font-family="Times,serif" font-size="12.00" fill="#000000">1 (1.67%)</text>
<text text-anchor="middle" x="1215" y="-1293.4" font-family="Times,serif" font-size="12.00" fill="#000000">of 4 (6.67%)</text>
</a>
</g>
</g>
<!-- NN17_0 -->
<g id="NN17_0" class="node">
<title>NN17_0</title>
<g id="a_NN17_0"><a xlink:title="1">
<polygon fill="#f8f8f8" stroke="#000000" points="1242,-1211 1192,-1211 1188,-1207 1188,-1175 1238,-1175 1242,-1179 1242,-1211"/>
<polyline fill="none" stroke="#000000" points="1238,-1207 1188,-1207 "/>
<polyline fill="none" stroke="#000000" points="1238,-1207 1238,-1175 "/>
<polyline fill="none" stroke="#000000" points="1238,-1207 1242,-1211 "/>
<text text-anchor="middle" x="1215" y="-1191.1" font-family="Times,serif" font-size="8.00" fill="#000000">144B</text>
</a>
</g>
</g>
<!-- N17&#45;&gt;NN17_0 -->
<g id="edge14" class="edge">
<title>N17&#45;&gt;NN17_0</title>
<g id="a_edge14"><a xlink:title="1">
<path fill="none" stroke="#000000" d="M1215,-1285.7369C1215,-1265.2637 1215,-1240.1681 1215,-1221.2481"/>
<polygon fill="#000000" stroke="#000000" points="1218.5001,-1221.1726 1215,-1211.1727 1211.5001,-1221.1727 1218.5001,-1221.1726"/>
</a>
</g>
<g id="a_edge14&#45;label"><a xlink:title="1">
<text text-anchor="middle" x="1220.5" y="-1256.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1</text>
</a>
</g>
</g>
<!-- N25 -->
<g id="node25" class="node">
<title>N25</title>
<g id="a_node25"><a xlink:title="log.(*Logger).formatHeader (3)">
<polygon fill="#edeae7" stroke="#b2a085" points="1309.5,-1100 1246.5,-1100 1246.5,-1056 1309.5,-1056 1309.5,-1100"/>
<text text-anchor="middle" x="1278" y="-1089.6" font-family="Times,serif" font-size="8.00" fill="#000000">log</text>
<text text-anchor="middle" x="1278" y="-1080.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*Logger)</text>
<text text-anchor="middle" x="1278" y="-1071.6" font-family="Times,serif" font-size="8.00" fill="#000000">formatHeader</text>
<text text-anchor="middle" x="1278" y="-1062.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 3 (5.00%)</text>
</a>
</g>
</g>
<!-- N17&#45;&gt;N25 -->
<g id="edge44" class="edge">
<title>N17&#45;&gt;N25</title>
<g id="a_edge44"><a xlink:title="log.(*Logger).Output &#45;&gt; log.(*Logger).formatHeader (3)">
<path fill="none" stroke="#b2a085" d="M1232.2632,-1285.6734C1238.9178,-1270.285 1246.0919,-1252.0481 1251,-1235 1263.1677,-1192.7354 1270.6372,-1142.3973 1274.5501,-1110.3247"/>
<polygon fill="#b2a085" stroke="#b2a085" points="1278.0504,-1110.5266 1275.7424,-1100.1862 1271.0983,-1109.7089 1278.0504,-1110.5266"/>
</a>
</g>
<g id="a_edge44&#45;label"><a xlink:title="log.(*Logger).Output &#45;&gt; log.(*Logger).formatHeader (3)">
<text text-anchor="middle" x="1273.5" y="-1189.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 3</text>
</a>
</g>
</g>
<!-- N18 -->
<g id="node18" class="node">
<title>N18</title>
<g id="a_node18"><a xlink:title="runtime.newproc1 (11)">
<polygon fill="#ede0d7" stroke="#b2500e" points="515.5,-1548 444.5,-1548 444.5,-1512 515.5,-1512 515.5,-1548"/>
<text text-anchor="middle" x="480" y="-1537.1" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="480" y="-1528.1" font-family="Times,serif" font-size="8.00" fill="#000000">newproc1</text>
<text text-anchor="middle" x="480" y="-1519.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 11 (18.33%)</text>
</a>
</g>
</g>
<!-- N18&#45;&gt;N1 -->
<g id="edge30" class="edge">
<title>N18&#45;&gt;N1</title>
<g id="a_edge30"><a xlink:title="runtime.newproc1 &#45;&gt; runtime.malg (10)">
<path fill="none" stroke="#b25b1d" d="M480,-1511.8587C480,-1492.4632 480,-1460.8082 480,-1433.5 480,-1433.5 480,-1433.5 480,-892 480,-869.0789 491.6223,-848.2363 506.5599,-830.9141"/>
<polygon fill="#b25b1d" stroke="#b25b1d" points="509.4473,-832.9439 513.6265,-823.2081 504.2882,-828.2128 509.4473,-832.9439"/>
</a>
</g>
<g id="a_edge30&#45;label"><a xlink:title="runtime.newproc1 &#45;&gt; runtime.malg (10)">
<text text-anchor="middle" x="489" y="-1121.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 10</text>
</a>
</g>
</g>
<!-- N22 -->
<g id="node22" class="node">
<title>N22</title>
<g id="a_node22"><a xlink:title="runtime.allgadd (1)">
<polygon fill="#edeceb" stroke="#b2aea3" points="572,-1457 508,-1457 508,-1410 572,-1410 572,-1457"/>
<text text-anchor="middle" x="540" y="-1443.4" font-family="Times,serif" font-size="12.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="540" y="-1430.4" font-family="Times,serif" font-size="12.00" fill="#000000">allgadd</text>
<text text-anchor="middle" x="540" y="-1417.4" font-family="Times,serif" font-size="12.00" fill="#000000">1 (1.67%)</text>
</a>
</g>
</g>
<!-- N18&#45;&gt;N22 -->
<g id="edge67" class="edge">
<title>N18&#45;&gt;N22</title>
<g id="a_edge67"><a xlink:title="runtime.newproc1 &#45;&gt; runtime.allgadd (1)">
<path fill="none" stroke="#b2aea3" d="M491.2855,-1511.8491C499.3446,-1498.8874 510.4037,-1481.1007 519.948,-1465.7503"/>
<polygon fill="#b2aea3" stroke="#b2aea3" points="523.0504,-1467.3891 525.3583,-1457.0487 517.1058,-1463.6929 523.0504,-1467.3891"/>
</a>
</g>
<g id="a_edge67&#45;label"><a xlink:title="runtime.newproc1 &#45;&gt; runtime.allgadd (1)">
<text text-anchor="middle" x="519.5" y="-1478.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1</text>
</a>
</g>
</g>
<!-- N19 -->
<g id="node19" class="node">
<title>N19</title>
<g id="a_node19"><a xlink:title="time.LoadLocationFromTZData (3)">
<polygon fill="#edeae7" stroke="#b2a085" points="1357,-322 1199,-322 1199,-258 1357,-258 1357,-322"/>
<text text-anchor="middle" x="1278" y="-307.6" font-family="Times,serif" font-size="13.00" fill="#000000">time</text>
<text text-anchor="middle" x="1278" y="-293.6" font-family="Times,serif" font-size="13.00" fill="#000000">LoadLocationFromTZData</text>
<text text-anchor="middle" x="1278" y="-279.6" font-family="Times,serif" font-size="13.00" fill="#000000">2 (3.33%)</text>
<text text-anchor="middle" x="1278" y="-265.6" font-family="Times,serif" font-size="13.00" fill="#000000">of 3 (5.00%)</text>
</a>
</g>
</g>
<!-- NN19_0 -->
<g id="NN19_0" class="node">
<title>NN19_0</title>
<g id="a_NN19_0"><a xlink:title="1">
<polygon fill="#f8f8f8" stroke="#000000" points="1233,-207 1183,-207 1179,-203 1179,-171 1229,-171 1233,-175 1233,-207"/>
<polyline fill="none" stroke="#000000" points="1229,-203 1179,-203 "/>
<polyline fill="none" stroke="#000000" points="1229,-203 1229,-171 "/>
<polyline fill="none" stroke="#000000" points="1229,-203 1233,-207 "/>
<text text-anchor="middle" x="1206" y="-187.1" font-family="Times,serif" font-size="8.00" fill="#000000">224B</text>
</a>
</g>
</g>
<!-- N19&#45;&gt;NN19_0 -->
<g id="edge15" class="edge">
<title>N19&#45;&gt;NN19_0</title>
<g id="a_edge15"><a xlink:title="1">
<path fill="none" stroke="#000000" d="M1255.0208,-257.7653C1245.3237,-244.1624 1234.1698,-228.516 1224.9538,-215.588"/>
<polygon fill="#000000" stroke="#000000" points="1227.5795,-213.2417 1218.9248,-207.1306 1221.8796,-217.305 1227.5795,-213.2417"/>
</a>
</g>
<g id="a_edge15&#45;label"><a xlink:title="1">
<text text-anchor="middle" x="1247.5" y="-228.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1</text>
</a>
</g>
</g>
<!-- NN19_1 -->
<g id="NN19_1" class="node">
<title>NN19_1</title>
<g id="a_NN19_1"><a xlink:title="1">
<polygon fill="#f8f8f8" stroke="#000000" points="1305,-207 1255,-207 1251,-203 1251,-171 1301,-171 1305,-175 1305,-207"/>
<polyline fill="none" stroke="#000000" points="1301,-203 1251,-203 "/>
<polyline fill="none" stroke="#000000" points="1301,-203 1301,-171 "/>
<polyline fill="none" stroke="#000000" points="1301,-203 1305,-207 "/>
<text text-anchor="middle" x="1278" y="-187.1" font-family="Times,serif" font-size="8.00" fill="#000000">4kB</text>
</a>
</g>
</g>
<!-- N19&#45;&gt;NN19_1 -->
<g id="edge16" class="edge">
<title>N19&#45;&gt;NN19_1</title>
<g id="a_edge16"><a xlink:title="1">
<path fill="none" stroke="#000000" d="M1278,-257.7653C1278,-244.8164 1278,-230.0157 1278,-217.4709"/>
<polygon fill="#000000" stroke="#000000" points="1281.5001,-217.1305 1278,-207.1306 1274.5001,-217.1306 1281.5001,-217.1305"/>
</a>
</g>
<g id="a_edge16&#45;label"><a xlink:title="1">
<text text-anchor="middle" x="1283.5" y="-228.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1</text>
</a>
</g>
</g>
<!-- N23 -->
<g id="node23" class="node">
<title>N23</title>
<g id="a_node23"><a xlink:title="time.byteString (1)">
<polygon fill="#edeceb" stroke="#b2aea3" points="1374,-134 1308,-134 1308,-87 1374,-87 1374,-134"/>
<text text-anchor="middle" x="1341" y="-120.4" font-family="Times,serif" font-size="12.00" fill="#000000">time</text>
<text text-anchor="middle" x="1341" y="-107.4" font-family="Times,serif" font-size="12.00" fill="#000000">byteString</text>
<text text-anchor="middle" x="1341" y="-94.4" font-family="Times,serif" font-size="12.00" fill="#000000">1 (1.67%)</text>
</a>
</g>
</g>
<!-- N19&#45;&gt;N23 -->
<g id="edge69" class="edge">
<title>N19&#45;&gt;N23</title>
<g id="a_edge69"><a xlink:title="time.LoadLocationFromTZData &#45;&gt; time.byteString (1)">
<path fill="none" stroke="#b2aea3" d="M1293.2347,-257.6914C1300.0805,-242.5006 1307.9587,-224.0226 1314,-207 1321.315,-186.3884 1327.9569,-162.7483 1332.8227,-144.0251"/>
<polygon fill="#b2aea3" stroke="#b2aea3" points="1336.2537,-144.7347 1335.3362,-134.1797 1329.4713,-143.0031 1336.2537,-144.7347"/>
</a>
</g>
<g id="a_edge69&#45;label"><a xlink:title="time.LoadLocationFromTZData &#45;&gt; time.byteString (1)">
<text text-anchor="middle" x="1330.5" y="-185.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 1</text>
</a>
</g>
</g>
<!-- N20&#45;&gt;N16 -->
<g id="edge37" class="edge">
<title>N20&#45;&gt;N16</title>
<g id="a_edge37"><a xlink:title="main.main &#45;&gt; github.com/pkg/profile.Start (5)">
<path fill="none" stroke="#b28f68" d="M1152,-1835.9265C1152,-1819.9073 1152,-1795.9351 1152,-1775.3731"/>
<polygon fill="#b28f68" stroke="#b28f68" points="1155.5001,-1775.2981 1152,-1765.2981 1148.5001,-1775.2981 1155.5001,-1775.2981"/>
</a>
</g>
<g id="a_edge37&#45;label"><a xlink:title="main.main &#45;&gt; github.com/pkg/profile.Start (5)">
<text text-anchor="middle" x="1157.5" y="-1790.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 5</text>
</a>
</g>
</g>
<!-- N27 -->
<g id="node27" class="node">
<title>N27</title>
<g id="a_node27"><a xlink:title="main.allocate (1)">
<polygon fill="#edeceb" stroke="#b2aea3" points="1286.5,-1753 1223.5,-1753 1223.5,-1717 1286.5,-1717 1286.5,-1753"/>
<text text-anchor="middle" x="1255" y="-1742.1" font-family="Times,serif" font-size="8.00" fill="#000000">main</text>
<text text-anchor="middle" x="1255" y="-1733.1" font-family="Times,serif" font-size="8.00" fill="#000000">allocate</text>
<text text-anchor="middle" x="1255" y="-1724.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 1 (1.67%)</text>
</a>
</g>
</g>
<!-- N20&#45;&gt;N27 -->
<g id="edge62" class="edge">
<title>N20&#45;&gt;N27</title>
<g id="a_edge62"><a xlink:title="main.main &#45;&gt; main.allocate (1)">
<path fill="none" stroke="#b2aea3" d="M1167.6435,-1835.9265C1184.961,-1815.9188 1213.0171,-1783.5045 1232.6483,-1760.8238"/>
<polygon fill="#b2aea3" stroke="#b2aea3" points="1235.3112,-1763.0953 1239.2093,-1753.2436 1230.0184,-1758.5142 1235.3112,-1763.0953"/>
</a>
</g>
<g id="a_edge62&#45;label"><a xlink:title="main.main &#45;&gt; main.allocate (1)">
<text text-anchor="middle" x="1214.5" y="-1790.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1</text>
</a>
</g>
</g>
<!-- N21 -->
<g id="node21" class="node">
<title>N21</title>
<g id="a_node21"><a xlink:title="main.makeByteSlice (1)">
<polygon fill="#edeceb" stroke="#b2aea3" points="1336.5,-1650 1247.5,-1650 1247.5,-1603 1336.5,-1603 1336.5,-1650"/>
<text text-anchor="middle" x="1292" y="-1636.4" font-family="Times,serif" font-size="12.00" fill="#000000">main</text>
<text text-anchor="middle" x="1292" y="-1623.4" font-family="Times,serif" font-size="12.00" fill="#000000">makeByteSlice</text>
<text text-anchor="middle" x="1292" y="-1610.4" font-family="Times,serif" font-size="12.00" fill="#000000">1 (1.67%)</text>
</a>
</g>
</g>
<!-- NN21_0 -->
<g id="NN21_0" class="node">
<title>NN21_0</title>
<g id="a_NN21_0"><a xlink:title="1">
<polygon fill="#f8f8f8" stroke="#000000" points="1319,-1548 1269,-1548 1265,-1544 1265,-1512 1315,-1512 1319,-1516 1319,-1548"/>
<polyline fill="none" stroke="#000000" points="1315,-1544 1265,-1544 "/>
<polyline fill="none" stroke="#000000" points="1315,-1544 1315,-1512 "/>
<polyline fill="none" stroke="#000000" points="1315,-1544 1319,-1548 "/>
<text text-anchor="middle" x="1292" y="-1528.1" font-family="Times,serif" font-size="8.00" fill="#000000">16B</text>
</a>
</g>
</g>
<!-- N21&#45;&gt;NN21_0 -->
<g id="edge17" class="edge">
<title>N21&#45;&gt;NN21_0</title>
<g id="a_edge17"><a xlink:title="1">
<path fill="none" stroke="#000000" d="M1292,-1602.6461C1292,-1589.2142 1292,-1572.3595 1292,-1558.2671"/>
<polygon fill="#000000" stroke="#000000" points="1295.5001,-1558.1314 1292,-1548.1314 1288.5001,-1558.1315 1295.5001,-1558.1314"/>
</a>
</g>
<g id="a_edge17&#45;label"><a xlink:title="1">
<text text-anchor="middle" x="1297.5" y="-1573.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1</text>
</a>
</g>
</g>
<!-- NN22_0 -->
<g id="NN22_0" class="node">
<title>NN22_0</title>
<g id="a_NN22_0"><a xlink:title="1">
<polygon fill="#f8f8f8" stroke="#000000" points="567,-1340.5 517,-1340.5 513,-1336.5 513,-1304.5 563,-1304.5 567,-1308.5 567,-1340.5"/>
<polyline fill="none" stroke="#000000" points="563,-1336.5 513,-1336.5 "/>
<polyline fill="none" stroke="#000000" points="563,-1336.5 563,-1304.5 "/>
<polyline fill="none" stroke="#000000" points="563,-1336.5 567,-1340.5 "/>
<text text-anchor="middle" x="540" y="-1320.6" font-family="Times,serif" font-size="8.00" fill="#000000">128B</text>
</a>
</g>
</g>
<!-- N22&#45;&gt;NN22_0 -->
<g id="edge18" class="edge">
<title>N22&#45;&gt;NN22_0</title>
<g id="a_edge18"><a xlink:title="1">
<path fill="none" stroke="#000000" d="M540,-1409.9598C540,-1392.6172 540,-1368.9589 540,-1350.6212"/>
<polygon fill="#000000" stroke="#000000" points="543.5001,-1350.5269 540,-1340.527 536.5001,-1350.527 543.5001,-1350.5269"/>
</a>
</g>
<g id="a_edge18&#45;label"><a xlink:title="1">
<text text-anchor="middle" x="545.5" y="-1380.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1</text>
</a>
</g>
</g>
<!-- NN23_0 -->
<g id="NN23_0" class="node">
<title>NN23_0</title>
<g id="a_NN23_0"><a xlink:title="1">
<polygon fill="#f8f8f8" stroke="#000000" points="1368,-36 1318,-36 1314,-32 1314,0 1364,0 1368,-4 1368,-36"/>
<polyline fill="none" stroke="#000000" points="1364,-32 1314,-32 "/>
<polyline fill="none" stroke="#000000" points="1364,-32 1364,0 "/>
<polyline fill="none" stroke="#000000" points="1364,-32 1368,-36 "/>
<text text-anchor="middle" x="1341" y="-16.1" font-family="Times,serif" font-size="8.00" fill="#000000">16B</text>
</a>
</g>
</g>
<!-- N23&#45;&gt;NN23_0 -->
<g id="edge19" class="edge">
<title>N23&#45;&gt;NN23_0</title>
<g id="a_edge19"><a xlink:title="1">
<path fill="none" stroke="#000000" d="M1341,-86.679C1341,-74.3839 1341,-59.2986 1341,-46.4008"/>
<polygon fill="#000000" stroke="#000000" points="1344.5001,-46.1905 1341,-36.1905 1337.5001,-46.1905 1344.5001,-46.1905"/>
</a>
</g>
<g id="a_edge19&#45;label"><a xlink:title="1">
<text text-anchor="middle" x="1346.5" y="-57.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1</text>
</a>
</g>
</g>
<!-- N26 -->
<g id="node26" class="node">
<title>N26</title>
<g id="a_node26"><a xlink:title="log.Printf (4)">
<polygon fill="#ede9e5" stroke="#b29877" points="1246.5,-1451.5 1183.5,-1451.5 1183.5,-1415.5 1246.5,-1415.5 1246.5,-1451.5"/>
<text text-anchor="middle" x="1215" y="-1440.6" font-family="Times,serif" font-size="8.00" fill="#000000">log</text>
<text text-anchor="middle" x="1215" y="-1431.6" font-family="Times,serif" font-size="8.00" fill="#000000">Printf</text>
<text text-anchor="middle" x="1215" y="-1422.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 4 (6.67%)</text>
</a>
</g>
</g>
<!-- N24&#45;&gt;N26 -->
<g id="edge39" class="edge">
<title>N24&#45;&gt;N26</title>
<g id="a_edge39"><a xlink:title="github.com/pkg/profile.Start.func2 &#45;&gt; log.Printf (4)">
<path fill="none" stroke="#b29877" d="M1215,-1507.6184C1215,-1493.9086 1215,-1476.2427 1215,-1461.5969"/>
<polygon fill="#b29877" stroke="#b29877" points="1218.5001,-1461.566 1215,-1451.566 1211.5001,-1461.566 1218.5001,-1461.566"/>
</a>
</g>
<g id="a_edge39&#45;label"><a xlink:title="github.com/pkg/profile.Start.func2 &#45;&gt; log.Printf (4)">
<text text-anchor="middle" x="1220.5" y="-1478.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 4</text>
</a>
</g>
</g>
<!-- N46 -->
<g id="node46" class="node">
<title>N46</title>
<g id="a_node46"><a xlink:title="time.Time.Date (3)">
<polygon fill="#edeae7" stroke="#b2a085" points="1309.5,-1005 1246.5,-1005 1246.5,-961 1309.5,-961 1309.5,-1005"/>
<text text-anchor="middle" x="1278" y="-994.6" font-family="Times,serif" font-size="8.00" fill="#000000">time</text>
<text text-anchor="middle" x="1278" y="-985.6" font-family="Times,serif" font-size="8.00" fill="#000000">Time</text>
<text text-anchor="middle" x="1278" y="-976.6" font-family="Times,serif" font-size="8.00" fill="#000000">Date</text>
<text text-anchor="middle" x="1278" y="-967.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 3 (5.00%)</text>
</a>
</g>
</g>
<!-- N25&#45;&gt;N46 -->
<g id="edge45" class="edge">
<title>N25&#45;&gt;N46</title>
<g id="a_edge45"><a xlink:title="log.(*Logger).formatHeader &#45;&gt; time.Time.Date (3)">
<path fill="none" stroke="#b2a085" d="M1278,-1055.9663C1278,-1043.9427 1278,-1028.8283 1278,-1015.4785"/>
<polygon fill="#b2a085" stroke="#b2a085" points="1281.5001,-1015.2433 1278,-1005.2433 1274.5001,-1015.2433 1281.5001,-1015.2433"/>
</a>
</g>
<g id="a_edge45&#45;label"><a xlink:title="log.(*Logger).formatHeader &#45;&gt; time.Time.Date (3)">
<text text-anchor="middle" x="1283.5" y="-1026.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 3</text>
</a>
</g>
</g>
<!-- N26&#45;&gt;N17 -->
<g id="edge40" class="edge">
<title>N26&#45;&gt;N17</title>
<g id="a_edge40"><a xlink:title="log.Printf &#45;&gt; log.(*Logger).Output (4)">
<path fill="none" stroke="#b29877" d="M1215,-1415.1706C1215,-1402.7447 1215,-1385.7181 1215,-1369.6477"/>
<polygon fill="#b29877" stroke="#b29877" points="1218.5001,-1369.2831 1215,-1359.2831 1211.5001,-1369.2832 1218.5001,-1369.2831"/>
</a>
</g>
<g id="a_edge40&#45;label"><a xlink:title="log.Printf &#45;&gt; log.(*Logger).Output (4)">
<text text-anchor="middle" x="1220.5" y="-1380.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 4</text>
</a>
</g>
</g>
<!-- N27&#45;&gt;N21 -->
<g id="edge61" class="edge">
<title>N27&#45;&gt;N21</title>
<g id="a_edge61"><a xlink:title="main.allocate &#45;&gt; main.makeByteSlice (1)">
<path fill="none" stroke="#b2aea3" d="M1261.2765,-1716.5945C1266.5545,-1701.1172 1274.2351,-1678.5945 1280.5963,-1659.9406"/>
<polygon fill="#b2aea3" stroke="#b2aea3" points="1283.9616,-1660.9158 1283.8766,-1650.3213 1277.3362,-1658.6564 1283.9616,-1660.9158"/>
</a>
</g>
<g id="a_edge61&#45;label"><a xlink:title="main.allocate &#45;&gt; main.makeByteSlice (1)">
<text text-anchor="middle" x="1281.5" y="-1671.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1</text>
</a>
</g>
</g>
<!-- N29 -->
<g id="node29" class="node">
<title>N29</title>
<g id="a_node29"><a xlink:title="os/signal.enableSignal (4)">
<polygon fill="#ede9e5" stroke="#b29877" points="1127.5,-1451.5 1064.5,-1451.5 1064.5,-1415.5 1127.5,-1415.5 1127.5,-1451.5"/>
<text text-anchor="middle" x="1096" y="-1440.6" font-family="Times,serif" font-size="8.00" fill="#000000">signal</text>
<text text-anchor="middle" x="1096" y="-1431.6" font-family="Times,serif" font-size="8.00" fill="#000000">enableSignal</text>
<text text-anchor="middle" x="1096" y="-1422.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 4 (6.67%)</text>
</a>
</g>
</g>
<!-- N28&#45;&gt;N29 -->
<g id="edge42" class="edge">
<title>N28&#45;&gt;N29</title>
<g id="a_edge42"><a xlink:title="os/signal.Notify.func1 &#45;&gt; os/signal.enableSignal (4)">
<path fill="none" stroke="#b29877" d="M1096,-1507.6184C1096,-1493.9086 1096,-1476.2427 1096,-1461.5969"/>
<polygon fill="#b29877" stroke="#b29877" points="1099.5001,-1461.566 1096,-1451.566 1092.5001,-1461.566 1099.5001,-1461.566"/>
</a>
</g>
<g id="a_edge42&#45;label"><a xlink:title="os/signal.Notify.func1 &#45;&gt; os/signal.enableSignal (4)">
<text text-anchor="middle" x="1101.5" y="-1478.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 4</text>
</a>
</g>
</g>
<!-- N29&#45;&gt;N13 -->
<g id="edge43" class="edge">
<title>N29&#45;&gt;N13</title>
<g id="a_edge43"><a xlink:title="os/signal.enableSignal &#45;&gt; os/signal.signal_enable (4)">
<path fill="none" stroke="#b29877" d="M1096,-1415.1706C1096,-1400.794 1096,-1380.2588 1096,-1362.1713"/>
<polygon fill="#b29877" stroke="#b29877" points="1099.5001,-1362.1502 1096,-1352.1503 1092.5001,-1362.1503 1099.5001,-1362.1502"/>
</a>
</g>
<g id="a_edge43&#45;label"><a xlink:title="os/signal.enableSignal &#45;&gt; os/signal.signal_enable (4)">
<text text-anchor="middle" x="1101.5" y="-1380.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 4</text>
</a>
</g>
</g>
<!-- N41 -->
<g id="node41" class="node">
<title>N41</title>
<g id="a_node41"><a xlink:title="runtime.startTemplateThread (3)">
<polygon fill="#edeae7" stroke="#b2a085" points="799.5,-1451.5 716.5,-1451.5 716.5,-1415.5 799.5,-1415.5 799.5,-1451.5"/>
<text text-anchor="middle" x="758" y="-1440.6" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="758" y="-1431.6" font-family="Times,serif" font-size="8.00" fill="#000000">startTemplateThread</text>
<text text-anchor="middle" x="758" y="-1422.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 3 (5.00%)</text>
</a>
</g>
</g>
<!-- N30&#45;&gt;N41 -->
<g id="edge46" class="edge">
<title>N30&#45;&gt;N41</title>
<g id="a_edge46"><a xlink:title="runtime.LockOSThread &#45;&gt; runtime.startTemplateThread (3)">
<path fill="none" stroke="#b2a085" d="M787.2287,-1511.8491C781.8987,-1497.5617 774.3816,-1477.4119 768.3055,-1461.1246"/>
<polygon fill="#b2a085" stroke="#b2a085" points="771.5155,-1459.7154 764.741,-1451.5695 764.9571,-1462.1622 771.5155,-1459.7154"/>
</a>
</g>
<g id="a_edge46&#45;label"><a xlink:title="runtime.LockOSThread &#45;&gt; runtime.startTemplateThread (3)">
<text text-anchor="middle" x="784.5" y="-1478.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 3</text>
</a>
</g>
</g>
<!-- N31 -->
<g id="node31" class="node">
<title>N31</title>
<g id="a_node31"><a xlink:title="runtime.chansend (1)">
<polygon fill="#edeceb" stroke="#b2aea3" points="913.5,-1451.5 850.5,-1451.5 850.5,-1415.5 913.5,-1415.5 913.5,-1451.5"/>
<text text-anchor="middle" x="882" y="-1440.6" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="882" y="-1431.6" font-family="Times,serif" font-size="8.00" fill="#000000">chansend</text>
<text text-anchor="middle" x="882" y="-1422.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 1 (1.67%)</text>
</a>
</g>
</g>
<!-- N31&#45;&gt;N14 -->
<g id="edge63" class="edge">
<title>N31&#45;&gt;N14</title>
<g id="a_edge63"><a xlink:title="runtime.chansend &#45;&gt; runtime.acquireSudog (1)">
<path fill="none" stroke="#b2aea3" d="M891.0821,-1415.1706C898.9482,-1399.2954 910.5351,-1375.911 920.1012,-1356.6049"/>
<polygon fill="#b2aea3" stroke="#b2aea3" points="923.306,-1358.02 924.6098,-1347.5057 917.0338,-1354.9121 923.306,-1358.02"/>
</a>
</g>
<g id="a_edge63&#45;label"><a xlink:title="runtime.chansend &#45;&gt; runtime.acquireSudog (1)">
<text text-anchor="middle" x="914.5" y="-1380.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1</text>
</a>
</g>
</g>
<!-- N32&#45;&gt;N31 -->
<g id="edge64" class="edge">
<title>N32&#45;&gt;N31</title>
<g id="a_edge64"><a xlink:title="runtime.chansend1 &#45;&gt; runtime.chansend (1)">
<path fill="none" stroke="#b2aea3" d="M877.9405,-1511.8491C878.6738,-1497.6965 879.7051,-1477.7915 880.5447,-1461.5866"/>
<polygon fill="#b2aea3" stroke="#b2aea3" points="884.0415,-1461.7373 881.0638,-1451.5695 877.0509,-1461.375 884.0415,-1461.7373"/>
</a>
</g>
<g id="a_edge64&#45;label"><a xlink:title="runtime.chansend1 &#45;&gt; runtime.chansend (1)">
<text text-anchor="middle" x="884.5" y="-1478.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1</text>
</a>
</g>
</g>
<!-- N33 -->
<g id="node33" class="node">
<title>N33</title>
<g id="a_node33"><a xlink:title="runtime.handoffp (3)">
<polygon fill="#edeae7" stroke="#b2a085" points="742.5,-1548 679.5,-1548 679.5,-1512 742.5,-1512 742.5,-1548"/>
<text text-anchor="middle" x="711" y="-1537.1" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="711" y="-1528.1" font-family="Times,serif" font-size="8.00" fill="#000000">handoffp</text>
<text text-anchor="middle" x="711" y="-1519.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 3 (5.00%)</text>
</a>
</g>
</g>
<!-- N33&#45;&gt;N11 -->
<g id="edge48" class="edge">
<title>N33&#45;&gt;N11</title>
<g id="a_edge48"><a xlink:title="runtime.handoffp &#45;&gt; runtime.startm (3)">
<path fill="none" stroke="#b2a085" d="M695.0122,-1511.8491C681.9525,-1497.0226 663.332,-1475.8828 648.7234,-1459.2978"/>
<polygon fill="#b2a085" stroke="#b2a085" points="651.1524,-1456.7602 641.9162,-1451.5695 645.8996,-1461.387 651.1524,-1456.7602"/>
</a>
</g>
<g id="a_edge48&#45;label"><a xlink:title="runtime.handoffp &#45;&gt; runtime.startm (3)">
<text text-anchor="middle" x="679.5" y="-1478.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 3</text>
</a>
</g>
</g>
<!-- N35 -->
<g id="node35" class="node">
<title>N35</title>
<g id="a_node35"><a xlink:title="runtime.mpreinit (7)">
<polygon fill="#ede5df" stroke="#b27b4a" points="673.5,-910 606.5,-910 606.5,-874 673.5,-874 673.5,-910"/>
<text text-anchor="middle" x="640" y="-899.1" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="640" y="-890.1" font-family="Times,serif" font-size="8.00" fill="#000000">mpreinit</text>
<text text-anchor="middle" x="640" y="-881.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 7 (11.67%)</text>
</a>
</g>
</g>
<!-- N34&#45;&gt;N35 -->
<g id="edge34" class="edge">
<title>N34&#45;&gt;N35</title>
<g id="a_edge34"><a xlink:title="runtime.mcommoninit &#45;&gt; runtime.mpreinit (7)">
<path fill="none" stroke="#b27b4a" d="M667.9172,-964.5848C662.951,-951.6726 656.2249,-934.1849 650.6193,-919.6101"/>
<polygon fill="#b27b4a" stroke="#b27b4a" points="653.8094,-918.1543 646.9528,-910.0773 647.2759,-920.6672 653.8094,-918.1543"/>
</a>
</g>
<g id="a_edge34&#45;label"><a xlink:title="runtime.mcommoninit &#45;&gt; runtime.mpreinit (7)">
<text text-anchor="middle" x="665.5" y="-931.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 7</text>
</a>
</g>
</g>
<!-- N35&#45;&gt;N1 -->
<g id="edge35" class="edge">
<title>N35&#45;&gt;N1</title>
<g id="a_edge35"><a xlink:title="runtime.mpreinit &#45;&gt; runtime.malg (7)">
<path fill="none" stroke="#b27b4a" d="M628.6061,-873.5055C621.5666,-862.0792 612.152,-846.7974 602.9766,-831.904"/>
<polygon fill="#b27b4a" stroke="#b27b4a" points="605.8468,-829.8901 597.6217,-823.212 599.887,-833.5618 605.8468,-829.8901"/>
</a>
</g>
<g id="a_edge35&#45;label"><a xlink:title="runtime.mpreinit &#45;&gt; runtime.malg (7)">
<text text-anchor="middle" x="623.5" y="-844.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 7</text>
</a>
</g>
</g>
<!-- N36&#45;&gt;N5 -->
<g id="edge50" class="edge">
<title>N36&#45;&gt;N5</title>
<g id="a_edge50"><a xlink:title="runtime.mstart1 &#45;&gt; runtime.schedule (3)">
<path fill="none" stroke="#b2a085" d="M544.5803,-1835.9265C560.6505,-1816.0062 586.6421,-1783.7874 604.9272,-1761.1215"/>
<polygon fill="#b2a085" stroke="#b2a085" points="607.7277,-1763.2243 611.2825,-1753.2436 602.2795,-1758.8292 607.7277,-1763.2243"/>
</a>
</g>
<g id="a_edge50&#45;label"><a xlink:title="runtime.mstart1 &#45;&gt; runtime.schedule (3)">
<text text-anchor="middle" x="589.5" y="-1790.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 3</text>
</a>
</g>
</g>
<!-- N37&#45;&gt;N18 -->
<g id="edge28" class="edge">
<title>N37&#45;&gt;N18</title>
<g id="a_edge28"><a xlink:title="runtime.newproc.func1 &#45;&gt; runtime.newproc1 (11)">
<path fill="none" stroke="#b2500e" d="M480,-1604.1184C480,-1590.4086 480,-1572.7427 480,-1558.0969"/>
<polygon fill="#b2500e" stroke="#b2500e" points="483.5001,-1558.066 480,-1548.066 476.5001,-1558.066 483.5001,-1558.066"/>
</a>
</g>
<g id="a_edge28&#45;label"><a xlink:title="runtime.newproc.func1 &#45;&gt; runtime.newproc1 (11)">
<text text-anchor="middle" x="489" y="-1573.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 11</text>
</a>
</g>
</g>
<!-- N38&#45;&gt;N5 -->
<g id="edge23" class="edge">
<title>N38&#45;&gt;N5</title>
<g id="a_edge23"><a xlink:title="runtime.park_m &#45;&gt; runtime.schedule (15)">
<path fill="none" stroke="#b23c00" stroke-width="2" d="M626,-1835.9265C626,-1816.7051 626,-1786.0332 626,-1763.5417"/>
<polygon fill="#b23c00" stroke="#b23c00" stroke-width="2" points="629.5001,-1763.2436 626,-1753.2436 622.5001,-1763.2437 629.5001,-1763.2436"/>
</a>
</g>
<g id="a_edge23&#45;label"><a xlink:title="runtime.park_m &#45;&gt; runtime.schedule (15)">
<text text-anchor="middle" x="635" y="-1790.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 15</text>
</a>
</g>
</g>
<!-- N43 -->
<g id="node43" class="node">
<title>N43</title>
<g id="a_node43"><a xlink:title="runtime.wakep (15)">
<polygon fill="#edddd5" stroke="#b23c00" points="661.5,-1548 590.5,-1548 590.5,-1512 661.5,-1512 661.5,-1548"/>
<text text-anchor="middle" x="626" y="-1537.1" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="626" y="-1528.1" font-family="Times,serif" font-size="8.00" fill="#000000">wakep</text>
<text text-anchor="middle" x="626" y="-1519.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 15 (25.00%)</text>
</a>
</g>
</g>
<!-- N39&#45;&gt;N43 -->
<g id="edge24" class="edge">
<title>N39&#45;&gt;N43</title>
<g id="a_edge24"><a xlink:title="runtime.resetspinning &#45;&gt; runtime.wakep (15)">
<path fill="none" stroke="#b23c00" stroke-width="2" d="M626,-1608.3491C626,-1594.1965 626,-1574.2915 626,-1558.0866"/>
<polygon fill="#b23c00" stroke="#b23c00" stroke-width="2" points="629.5001,-1558.0695 626,-1548.0695 622.5001,-1558.0696 629.5001,-1558.0695"/>
</a>
</g>
<g id="a_edge24&#45;label"><a xlink:title="runtime.resetspinning &#45;&gt; runtime.wakep (15)">
<text text-anchor="middle" x="635" y="-1573.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 15</text>
</a>
</g>
</g>
<!-- N40&#45;&gt;N14 -->
<g id="edge68" class="edge">
<title>N40&#45;&gt;N14</title>
<g id="a_edge68"><a xlink:title="runtime.selectgo &#45;&gt; runtime.acquireSudog (1)">
<path fill="none" stroke="#b2aea3" d="M956.1731,-1511.9487C952.6995,-1477.6265 945.0869,-1402.4059 940.5687,-1357.7626"/>
<polygon fill="#b2aea3" stroke="#b2aea3" points="944.0347,-1357.2488 939.5455,-1347.652 937.0703,-1357.9537 944.0347,-1357.2488"/>
</a>
</g>
<g id="a_edge68&#45;label"><a xlink:title="runtime.selectgo &#45;&gt; runtime.acquireSudog (1)">
<text text-anchor="middle" x="955.5" y="-1429.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1</text>
</a>
</g>
</g>
<!-- N41&#45;&gt;N9 -->
<g id="edge52" class="edge">
<title>N41&#45;&gt;N9</title>
<g id="a_edge52"><a xlink:title="runtime.startTemplateThread &#45;&gt; runtime.newm (3)">
<path fill="none" stroke="#b2a085" d="M736.4981,-1415.4189C714.4449,-1396.8741 679.9846,-1367.8961 655.414,-1347.2345"/>
<polygon fill="#b2a085" stroke="#b2a085" points="657.3989,-1344.3306 647.4927,-1340.5734 652.8937,-1349.6882 657.3989,-1344.3306"/>
</a>
</g>
<g id="a_edge52&#45;label"><a xlink:title="runtime.startTemplateThread &#45;&gt; runtime.newm (3)">
<text text-anchor="middle" x="713.5" y="-1380.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 3</text>
</a>
</g>
</g>
<!-- N42&#45;&gt;N33 -->
<g id="edge53" class="edge">
<title>N42&#45;&gt;N33</title>
<g id="a_edge53"><a xlink:title="runtime.stoplockedm &#45;&gt; runtime.handoffp (3)">
<path fill="none" stroke="#b2a085" d="M711,-1608.3491C711,-1594.1965 711,-1574.2915 711,-1558.0866"/>
<polygon fill="#b2a085" stroke="#b2a085" points="714.5001,-1558.0695 711,-1548.0695 707.5001,-1558.0696 714.5001,-1558.0695"/>
</a>
</g>
<g id="a_edge53&#45;label"><a xlink:title="runtime.stoplockedm &#45;&gt; runtime.handoffp (3)">
<text text-anchor="middle" x="716.5" y="-1573.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 3</text>
</a>
</g>
</g>
<!-- N43&#45;&gt;N11 -->
<g id="edge26" class="edge">
<title>N43&#45;&gt;N11</title>
<g id="a_edge26"><a xlink:title="runtime.wakep &#45;&gt; runtime.startm (15)">
<path fill="none" stroke="#b23c00" stroke-width="2" d="M626,-1511.8491C626,-1497.6965 626,-1477.7915 626,-1461.5866"/>
<polygon fill="#b23c00" stroke="#b23c00" stroke-width="2" points="629.5001,-1461.5695 626,-1451.5695 622.5001,-1461.5696 629.5001,-1461.5695"/>
</a>
</g>
<g id="a_edge26&#45;label"><a xlink:title="runtime.wakep &#45;&gt; runtime.startm (15)">
<text text-anchor="middle" x="635" y="-1478.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 15</text>
</a>
</g>
</g>
<!-- N44 -->
<g id="node44" class="node">
<title>N44</title>
<g id="a_node44"><a xlink:title="sync.(*Once).Do (3)">
<polygon fill="#edeae7" stroke="#b2a085" points="1309.5,-591 1246.5,-591 1246.5,-547 1309.5,-547 1309.5,-591"/>
<text text-anchor="middle" x="1278" y="-580.6" font-family="Times,serif" font-size="8.00" fill="#000000">sync</text>
<text text-anchor="middle" x="1278" y="-571.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*Once)</text>
<text text-anchor="middle" x="1278" y="-562.6" font-family="Times,serif" font-size="8.00" fill="#000000">Do</text>
<text text-anchor="middle" x="1278" y="-553.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 3 (5.00%)</text>
</a>
</g>
</g>
<!-- N49 -->
<g id="node49" class="node">
<title>N49</title>
<g id="a_node49"><a xlink:title="time.initLocal (3)">
<polygon fill="#edeae7" stroke="#b2a085" points="1309.5,-496 1246.5,-496 1246.5,-460 1309.5,-460 1309.5,-496"/>
<text text-anchor="middle" x="1278" y="-485.1" font-family="Times,serif" font-size="8.00" fill="#000000">time</text>
<text text-anchor="middle" x="1278" y="-476.1" font-family="Times,serif" font-size="8.00" fill="#000000">initLocal</text>
<text text-anchor="middle" x="1278" y="-467.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 3 (5.00%)</text>
</a>
</g>
</g>
<!-- N44&#45;&gt;N49 -->
<g id="edge54" class="edge">
<title>N44&#45;&gt;N49</title>
<g id="a_edge54"><a xlink:title="sync.(*Once).Do &#45;&gt; time.initLocal (3)">
<path fill="none" stroke="#b2a085" d="M1278,-546.9714C1278,-534.8075 1278,-519.5615 1278,-506.499"/>
<polygon fill="#b2a085" stroke="#b2a085" points="1281.5001,-506.1556 1278,-496.1556 1274.5001,-506.1556 1281.5001,-506.1556"/>
</a>
</g>
<g id="a_edge54&#45;label"><a xlink:title="sync.(*Once).Do &#45;&gt; time.initLocal (3)">
<text text-anchor="middle" x="1283.5" y="-517.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 3</text>
</a>
</g>
</g>
<!-- N45 -->
<g id="node45" class="node">
<title>N45</title>
<g id="a_node45"><a xlink:title="time.(*Location).get (3)">
<polygon fill="#edeae7" stroke="#b2a085" points="1309.5,-686 1246.5,-686 1246.5,-642 1309.5,-642 1309.5,-686"/>
<text text-anchor="middle" x="1278" y="-675.6" font-family="Times,serif" font-size="8.00" fill="#000000">time</text>
<text text-anchor="middle" x="1278" y="-666.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*Location)</text>
<text text-anchor="middle" x="1278" y="-657.6" font-family="Times,serif" font-size="8.00" fill="#000000">get</text>
<text text-anchor="middle" x="1278" y="-648.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 3 (5.00%)</text>
</a>
</g>
</g>
<!-- N45&#45;&gt;N44 -->
<g id="edge55" class="edge">
<title>N45&#45;&gt;N44</title>
<g id="a_edge55"><a xlink:title="time.(*Location).get &#45;&gt; sync.(*Once).Do (3)">
<path fill="none" stroke="#b2a085" d="M1278,-641.9663C1278,-629.9427 1278,-614.8283 1278,-601.4785"/>
<polygon fill="#b2a085" stroke="#b2a085" points="1281.5001,-601.2433 1278,-591.2433 1274.5001,-601.2433 1281.5001,-601.2433"/>
</a>
</g>
<g id="a_edge55&#45;label"><a xlink:title="time.(*Location).get &#45;&gt; sync.(*Once).Do (3)">
<text text-anchor="middle" x="1283.5" y="-612.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 3</text>
</a>
</g>
</g>
<!-- N48 -->
<g id="node48" class="node">
<title>N48</title>
<g id="a_node48"><a xlink:title="time.Time.date (3)">
<polygon fill="#edeae7" stroke="#b2a085" points="1309.5,-910 1246.5,-910 1246.5,-874 1309.5,-874 1309.5,-910"/>
<text text-anchor="middle" x="1278" y="-899.1" font-family="Times,serif" font-size="8.00" fill="#000000">Time</text>
<text text-anchor="middle" x="1278" y="-890.1" font-family="Times,serif" font-size="8.00" fill="#000000">date</text>
<text text-anchor="middle" x="1278" y="-881.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 3 (5.00%)</text>
</a>
</g>
</g>
<!-- N46&#45;&gt;N48 -->
<g id="edge56" class="edge">
<title>N46&#45;&gt;N48</title>
<g id="a_edge56"><a xlink:title="time.Time.Date &#45;&gt; time.Time.date (3)">
<path fill="none" stroke="#b2a085" d="M1278,-960.9714C1278,-948.8075 1278,-933.5615 1278,-920.499"/>
<polygon fill="#b2a085" stroke="#b2a085" points="1281.5001,-920.1556 1278,-910.1556 1274.5001,-920.1556 1281.5001,-920.1556"/>
</a>
</g>
<g id="a_edge56&#45;label"><a xlink:title="time.Time.Date &#45;&gt; time.Time.date (3)">
<text text-anchor="middle" x="1283.5" y="-931.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 3</text>
</a>
</g>
</g>
<!-- N47 -->
<g id="node47" class="node">
<title>N47</title>
<g id="a_node47"><a xlink:title="time.Time.abs (3)">
<polygon fill="#edeae7" stroke="#b2a085" points="1309.5,-798 1246.5,-798 1246.5,-762 1309.5,-762 1309.5,-798"/>
<text text-anchor="middle" x="1278" y="-787.1" font-family="Times,serif" font-size="8.00" fill="#000000">Time</text>
<text text-anchor="middle" x="1278" y="-778.1" font-family="Times,serif" font-size="8.00" fill="#000000">abs</text>
<text text-anchor="middle" x="1278" y="-769.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 3 (5.00%)</text>
</a>
</g>
</g>
<!-- N47&#45;&gt;N45 -->
<g id="edge57" class="edge">
<title>N47&#45;&gt;N45</title>
<g id="a_edge57"><a xlink:title="time.Time.abs &#45;&gt; time.(*Location).get (3)">
<path fill="none" stroke="#b2a085" d="M1278,-761.875C1278,-744.4315 1278,-717.6614 1278,-696.5246"/>
<polygon fill="#b2a085" stroke="#b2a085" points="1281.5001,-696.3659 1278,-686.366 1274.5001,-696.366 1281.5001,-696.3659"/>
</a>
</g>
<g id="a_edge57&#45;label"><a xlink:title="time.Time.abs &#45;&gt; time.(*Location).get (3)">
<text text-anchor="middle" x="1283.5" y="-707.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 3</text>
</a>
</g>
</g>
<!-- N48&#45;&gt;N47 -->
<g id="edge58" class="edge">
<title>N48&#45;&gt;N47</title>
<g id="a_edge58"><a xlink:title="time.Time.date &#45;&gt; time.Time.abs (3)">
<path fill="none" stroke="#b2a085" d="M1278,-873.5055C1278,-855.7282 1278,-828.6184 1278,-808.1587"/>
<polygon fill="#b2a085" stroke="#b2a085" points="1281.5001,-808.1503 1278,-798.1504 1274.5001,-808.1504 1281.5001,-808.1503"/>
</a>
</g>
<g id="a_edge58&#45;label"><a xlink:title="time.Time.date &#45;&gt; time.Time.abs (3)">
<text text-anchor="middle" x="1283.5" y="-844.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 3</text>
</a>
</g>
</g>
<!-- N50 -->
<g id="node50" class="node">
<title>N50</title>
<g id="a_node50"><a xlink:title="time.loadLocation (3)">
<polygon fill="#edeae7" stroke="#b2a085" points="1309.5,-409 1246.5,-409 1246.5,-373 1309.5,-373 1309.5,-409"/>
<text text-anchor="middle" x="1278" y="-398.1" font-family="Times,serif" font-size="8.00" fill="#000000">time</text>
<text text-anchor="middle" x="1278" y="-389.1" font-family="Times,serif" font-size="8.00" fill="#000000">loadLocation</text>
<text text-anchor="middle" x="1278" y="-380.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 3 (5.00%)</text>
</a>
</g>
</g>
<!-- N49&#45;&gt;N50 -->
<g id="edge59" class="edge">
<title>N49&#45;&gt;N50</title>
<g id="a_edge59"><a xlink:title="time.initLocal &#45;&gt; time.loadLocation (3)">
<path fill="none" stroke="#b2a085" d="M1278,-459.9735C1278,-448.1918 1278,-432.5607 1278,-419.1581"/>
<polygon fill="#b2a085" stroke="#b2a085" points="1281.5001,-419.0033 1278,-409.0034 1274.5001,-419.0034 1281.5001,-419.0033"/>
</a>
</g>
<g id="a_edge59&#45;label"><a xlink:title="time.initLocal &#45;&gt; time.loadLocation (3)">
<text text-anchor="middle" x="1283.5" y="-430.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 3</text>
</a>
</g>
</g>
<!-- N50&#45;&gt;N19 -->
<g id="edge60" class="edge">
<title>N50&#45;&gt;N19</title>
<g id="a_edge60"><a xlink:title="time.loadLocation &#45;&gt; time.LoadLocationFromTZData (3)">
<path fill="none" stroke="#b2a085" d="M1278,-372.9432C1278,-361.6199 1278,-346.5228 1278,-332.3139"/>
<polygon fill="#b2a085" stroke="#b2a085" points="1281.5001,-332.1913 1278,-322.1913 1274.5001,-332.1913 1281.5001,-332.1913"/>
</a>
</g>
<g id="a_edge60&#45;label"><a xlink:title="time.loadLocation &#45;&gt; time.LoadLocationFromTZData (3)">
<text text-anchor="middle" x="1283.5" y="-343.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 3</text>
</a>
</g>
</g>
</g>
</g></svg>
</div>
</div>
<div class="paragraph">
<p>What we see is not the objects that were <em>allocated</em> during the profile, but the objects that remain <em>in use</em>, at the time the profile was taken&#8201;&#8212;&#8201;this ignores the stack trace for objects which have been reclaimed by the garbage collector.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="block_profiling_2"><a class="anchor" href="#block_profiling_2"></a><a class="link" href="#block_profiling_2">3.5.6. Block profiling</a></h4>
<div class="paragraph">
<p>The last profile type we&#8217;ll look at is block profiling. We&#8217;ll use the <code>ClientServer</code> benchmark from the <code>net/http</code> package</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% go test -run=XXX -bench=ClientServer$ -blockprofile=/tmp/block.p net/http
% go tool pprof -http=:8080 /tmp/block.p</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="100%px" height="100%px">
<script type="text/ecmascript"><![CDATA[
/**
 *  SVGPan library 1.2.2
 * ======================
 *
 * Given an unique existing element with id "viewport" (or when missing, the
 * first g-element), including the library into any SVG adds the following
 * capabilities:
 *
 *  - Mouse panning
 *  - Mouse zooming (using the wheel)
 *  - Object dragging
 *
 * You can configure the behaviour of the pan/zoom/drag with the variables
 * listed in the CONFIGURATION section of this file.
 *
 * Known issues:
 *
 *  - Zooming (while panning) on Safari has still some issues
 *
 * Releases:
 *
 * 1.2.2, Tue Aug 30 17:21:56 CEST 2011, Andrea Leofreddi
 *	- Fixed viewBox on root tag (#7)
 *	- Improved zoom speed (#2)
 *
 * 1.2.1, Mon Jul  4 00:33:18 CEST 2011, Andrea Leofreddi
 *	- Fixed a regression with mouse wheel (now working on Firefox 5)
 *	- Working with viewBox attribute (#4)
 *	- Added "use strict;" and fixed resulting warnings (#5)
 *	- Added configuration variables, dragging is disabled by default (#3)
 *
 * 1.2, Sat Mar 20 08:42:50 GMT 2010, Zeng Xiaohui
 *	Fixed a bug with browser mouse handler interaction
 *
 * 1.1, Wed Feb  3 17:39:33 GMT 2010, Zeng Xiaohui
 *	Updated the zoom code to support the mouse wheel on Safari/Chrome
 *
 * 1.0, Andrea Leofreddi
 *	First release
 *
 * This code is licensed under the following BSD license:
 *
 * Copyright 2009-2017 Andrea Leofreddi <a.leofreddi@vleo.net>. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification, are
 * permitted provided that the following conditions are met:
 *
 *    1. Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *    2. Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *    3. Neither the name of the copyright holder nor the names of its
 *       contributors may be used to endorse or promote products derived from
 *       this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY COPYRIGHT HOLDERS AND CONTRIBUTORS ''AS IS'' AND ANY EXPRESS
 * OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
 * AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL COPYRIGHT HOLDERS OR
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
 * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * The views and conclusions contained in the software and documentation are those of the
 * authors and should not be interpreted as representing official policies, either expressed
 * or implied, of Andrea Leofreddi.
 */

"use strict";

/// CONFIGURATION
/// ====>

var enablePan = 1; // 1 or 0: enable or disable panning (default enabled)
var enableZoom = 1; // 1 or 0: enable or disable zooming (default enabled)
var enableDrag = 0; // 1 or 0: enable or disable dragging (default disabled)
var zoomScale = 0.2; // Zoom sensitivity

/// <====
/// END OF CONFIGURATION

var root = document.documentElement;

var state = 'none', svgRoot = null, stateTarget, stateOrigin, stateTf;

setupHandlers(root);

/**
 * Register handlers
 */
function setupHandlers(root){
	setAttributes(root, {
		"onmouseup" : "handleMouseUp(evt)",
		"onmousedown" : "handleMouseDown(evt)",
		"onmousemove" : "handleMouseMove(evt)",
		//"onmouseout" : "handleMouseUp(evt)", // Decomment this to stop the pan functionality when dragging out of the SVG element
	});

	if(navigator.userAgent.toLowerCase().indexOf('webkit') >= 0)
		window.addEventListener('mousewheel', handleMouseWheel, false); // Chrome/Safari
	else
		window.addEventListener('DOMMouseScroll', handleMouseWheel, false); // Others
}

/**
 * Retrieves the root element for SVG manipulation. The element is then cached into the svgRoot global variable.
 */
function getRoot(root) {
	if(svgRoot == null) {
		var r = root.getElementById("viewport") ? root.getElementById("viewport") : root.documentElement, t = r;

		while(t != root) {
			if(t.getAttribute("viewBox")) {
				setCTM(r, t.getCTM());

				t.removeAttribute("viewBox");
			}

			t = t.parentNode;
		}

		svgRoot = r;
	}

	return svgRoot;
}

/**
 * Instance an SVGPoint object with given event coordinates.
 */
function getEventPoint(evt) {
	var p = root.createSVGPoint();

	p.x = evt.clientX;
	p.y = evt.clientY;

	return p;
}

/**
 * Sets the current transform matrix of an element.
 */
function setCTM(element, matrix) {
	var s = "matrix(" + matrix.a + "," + matrix.b + "," + matrix.c + "," + matrix.d + "," + matrix.e + "," + matrix.f + ")";

	element.setAttribute("transform", s);
}

/**
 * Dumps a matrix to a string (useful for debug).
 */
function dumpMatrix(matrix) {
	var s = "[ " + matrix.a + ", " + matrix.c + ", " + matrix.e + "\n  " + matrix.b + ", " + matrix.d + ", " + matrix.f + "\n  0, 0, 1 ]";

	return s;
}

/**
 * Sets attributes of an element.
 */
function setAttributes(element, attributes){
	for (var i in attributes)
		element.setAttributeNS(null, i, attributes[i]);
}

/**
 * Handle mouse wheel event.
 */
function handleMouseWheel(evt) {
	if(!enableZoom)
		return;

	if(evt.preventDefault)
		evt.preventDefault();

	evt.returnValue = false;

	var svgDoc = evt.target.ownerDocument;

	var delta;

	if(evt.wheelDelta)
		delta = evt.wheelDelta / 360; // Chrome/Safari
	else
		delta = evt.detail / -9; // Mozilla

	var z = Math.pow(1 + zoomScale, delta);

	var g = getRoot(svgDoc);

	var p = getEventPoint(evt);

	p = p.matrixTransform(g.getCTM().inverse());

	// Compute new scale matrix in current mouse position
	var k = root.createSVGMatrix().translate(p.x, p.y).scale(z).translate(-p.x, -p.y);

        setCTM(g, g.getCTM().multiply(k));

	if(typeof(stateTf) == "undefined")
		stateTf = g.getCTM().inverse();

	stateTf = stateTf.multiply(k.inverse());
}

/**
 * Handle mouse move event.
 */
function handleMouseMove(evt) {
	if(evt.preventDefault)
		evt.preventDefault();

	evt.returnValue = false;

	var svgDoc = evt.target.ownerDocument;

	var g = getRoot(svgDoc);

	if(state == 'pan' && enablePan) {
		// Pan mode
		var p = getEventPoint(evt).matrixTransform(stateTf);

		setCTM(g, stateTf.inverse().translate(p.x - stateOrigin.x, p.y - stateOrigin.y));
	} else if(state == 'drag' && enableDrag) {
		// Drag mode
		var p = getEventPoint(evt).matrixTransform(g.getCTM().inverse());

		setCTM(stateTarget, root.createSVGMatrix().translate(p.x - stateOrigin.x, p.y - stateOrigin.y).multiply(g.getCTM().inverse()).multiply(stateTarget.getCTM()));

		stateOrigin = p;
	}
}

/**
 * Handle click event.
 */
function handleMouseDown(evt) {
	if(evt.preventDefault)
		evt.preventDefault();

	evt.returnValue = false;

	var svgDoc = evt.target.ownerDocument;

	var g = getRoot(svgDoc);

	if(
		evt.target.tagName == "svg"
		|| !enableDrag // Pan anyway when drag is disabled and the user clicked on an element
	) {
		// Pan mode
		state = 'pan';

		stateTf = g.getCTM().inverse();

		stateOrigin = getEventPoint(evt).matrixTransform(stateTf);
	} else {
		// Drag mode
		state = 'drag';

		stateTarget = evt.target;

		stateTf = g.getCTM().inverse();

		stateOrigin = getEventPoint(evt).matrixTransform(stateTf);
	}
}

/**
 * Handle mouse button release event.
 */
function handleMouseUp(evt) {
	if(evt.preventDefault)
		evt.preventDefault();

	evt.returnValue = false;

	var svgDoc = evt.target.ownerDocument;

	if(state == 'pan' || state == 'drag') {
		// Quit pan mode
		state = '';
	}
}
]]></script><g id="viewport" transform="scale(0.5,0.5) translate(0,0)"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1715)">
<title>unnamed</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1715 606,-1715 606,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_L</title>
<polygon fill="none" stroke="#000000" points="18,-1607 18,-1703 418,-1703 418,-1607 18,-1607"/>
</g>
<!-- Type: delay -->
<g id="node1" class="node">
<title>Type: delay</title>
<polygon fill="#f8f8f8" stroke="#000000" points="409.5,-1695 26.5,-1695 26.5,-1615 409.5,-1615 409.5,-1695"/>
<text text-anchor="start" x="34.5" y="-1678.2" font-family="Times,serif" font-size="16.00" fill="#000000">Type: delay</text>
<text text-anchor="start" x="34.5" y="-1660.2" font-family="Times,serif" font-size="16.00" fill="#000000">Time: Mar 23, 2019 at 6:05pm (CET)</text>
<text text-anchor="start" x="34.5" y="-1642.2" font-family="Times,serif" font-size="16.00" fill="#000000">Showing nodes accounting for 7.82s, 100% of 7.82s total</text>
<text text-anchor="start" x="34.5" y="-1624.2" font-family="Times,serif" font-size="16.00" fill="#000000">Dropped 39 nodes (cum &lt;= 0.04s)</text>
</g>
<!-- N1 -->
<g id="node1" class="node">
<title>N1</title>
<g id="a_node1"><a xlink:title="runtime.selectgo (4.55s)">
<polygon fill="#edd8d5" stroke="#b21a00" points="164,-86 0,-86 0,0 164,0 164,-86"/>
<text text-anchor="middle" x="82" y="-62.8" font-family="Times,serif" font-size="24.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="82" y="-36.8" font-family="Times,serif" font-size="24.00" fill="#000000">selectgo</text>
<text text-anchor="middle" x="82" y="-10.8" font-family="Times,serif" font-size="24.00" fill="#000000">4.55s (58.18%)</text>
</a>
</g>
</g>
<!-- N2 -->
<g id="node2" class="node">
<title>N2</title>
<g id="a_node2"><a xlink:title="testing.(*B).runN (5.06s)">
<polygon fill="#edd8d5" stroke="#b21500" points="508,-1176 428,-1176 428,-1132 508,-1132 508,-1176"/>
<text text-anchor="middle" x="468" y="-1165.6" font-family="Times,serif" font-size="8.00" fill="#000000">testing</text>
<text text-anchor="middle" x="468" y="-1156.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*B)</text>
<text text-anchor="middle" x="468" y="-1147.6" font-family="Times,serif" font-size="8.00" fill="#000000">runN</text>
<text text-anchor="middle" x="468" y="-1138.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 5.06s (64.63%)</text>
</a>
</g>
</g>
<!-- N7 -->
<g id="node7" class="node">
<title>N7</title>
<g id="a_node7"><a xlink:title="net/http_test.BenchmarkClientServer (1.94s)">
<polygon fill="#edddd5" stroke="#b23c00" points="410,-1077 316,-1077 316,-1041 410,-1041 410,-1077"/>
<text text-anchor="middle" x="363" y="-1066.1" font-family="Times,serif" font-size="8.00" fill="#000000">http_test</text>
<text text-anchor="middle" x="363" y="-1057.1" font-family="Times,serif" font-size="8.00" fill="#000000">BenchmarkClientServer</text>
<text text-anchor="middle" x="363" y="-1048.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 1.94s (24.83%)</text>
</a>
</g>
</g>
<!-- N2&#45;&gt;N7 -->
<g id="edge13" class="edge">
<title>N2&#45;&gt;N7</title>
<g id="a_edge13"><a xlink:title="testing.(*B).runN &#45;&gt; net/http_test.BenchmarkClientServer (1.94s)">
<path fill="none" stroke="#b23c00" stroke-width="2" d="M443.647,-1131.9663C427.8199,-1117.6466 407.1473,-1098.9428 390.6948,-1084.0572"/>
<polygon fill="#b23c00" stroke="#b23c00" stroke-width="2" points="392.7604,-1081.2062 382.9968,-1077.0924 388.064,-1086.3969 392.7604,-1081.2062"/>
</a>
</g>
<g id="a_edge13&#45;label"><a xlink:title="testing.(*B).runN &#45;&gt; net/http_test.BenchmarkClientServer (1.94s)">
<text text-anchor="middle" x="439" y="-1102.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1.94s</text>
</a>
</g>
</g>
<!-- N36 -->
<g id="node36" class="node">
<title>N36</title>
<g id="a_node36"><a xlink:title="testing.runBenchmarks.func1 (3.11s)">
<polygon fill="#eddbd5" stroke="#b22b00" points="508,-1081 428,-1081 428,-1037 508,-1037 508,-1081"/>
<text text-anchor="middle" x="468" y="-1070.6" font-family="Times,serif" font-size="8.00" fill="#000000">testing</text>
<text text-anchor="middle" x="468" y="-1061.6" font-family="Times,serif" font-size="8.00" fill="#000000">runBenchmarks</text>
<text text-anchor="middle" x="468" y="-1052.6" font-family="Times,serif" font-size="8.00" fill="#000000">func1</text>
<text text-anchor="middle" x="468" y="-1043.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 3.11s (39.80%)</text>
</a>
</g>
</g>
<!-- N2&#45;&gt;N36 -->
<g id="edge4" class="edge">
<title>N2&#45;&gt;N36</title>
<g id="a_edge4"><a xlink:title="testing.(*B).runN &#45;&gt; testing.runBenchmarks.func1 (3.11s)">
<path fill="none" stroke="#b22b00" stroke-width="2" d="M468,-1131.9663C468,-1119.9427 468,-1104.8283 468,-1091.4785"/>
<polygon fill="#b22b00" stroke="#b22b00" stroke-width="2" points="471.5001,-1091.2433 468,-1081.2433 464.5001,-1091.2433 471.5001,-1091.2433"/>
</a>
</g>
<g id="a_edge4&#45;label"><a xlink:title="testing.(*B).runN &#45;&gt; testing.runBenchmarks.func1 (3.11s)">
<text text-anchor="middle" x="485" y="-1102.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 3.11s</text>
</a>
</g>
</g>
<!-- N3 -->
<g id="node3" class="node">
<title>N3</title>
<g id="a_node3"><a xlink:title="runtime.chanrecv1 (3.23s)">
<polygon fill="#eddad5" stroke="#b22900" points="544,-407 392,-407 392,-327 544,-327 544,-407"/>
<text text-anchor="middle" x="468" y="-385.4" font-family="Times,serif" font-size="22.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="468" y="-361.4" font-family="Times,serif" font-size="22.00" fill="#000000">chanrecv1</text>
<text text-anchor="middle" x="468" y="-337.4" font-family="Times,serif" font-size="22.00" fill="#000000">3.23s (41.25%)</text>
</a>
</g>
</g>
<!-- N4 -->
<g id="node4" class="node">
<title>N4</title>
<g id="a_node4"><a xlink:title="runtime.main (3.11s)">
<polygon fill="#eddbd5" stroke="#b22b00" points="508,-1673 428,-1673 428,-1637 508,-1637 508,-1673"/>
<text text-anchor="middle" x="468" y="-1662.1" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="468" y="-1653.1" font-family="Times,serif" font-size="8.00" fill="#000000">main</text>
<text text-anchor="middle" x="468" y="-1644.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 3.11s (39.80%)</text>
</a>
</g>
</g>
<!-- N16 -->
<g id="node16" class="node">
<title>N16</title>
<g id="a_node16"><a xlink:title="main.main (3.11s)">
<polygon fill="#eddbd5" stroke="#b22b00" points="508,-1560 428,-1560 428,-1524 508,-1524 508,-1560"/>
<text text-anchor="middle" x="468" y="-1549.1" font-family="Times,serif" font-size="8.00" fill="#000000">main</text>
<text text-anchor="middle" x="468" y="-1540.1" font-family="Times,serif" font-size="8.00" fill="#000000">main</text>
<text text-anchor="middle" x="468" y="-1531.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 3.11s (39.80%)</text>
</a>
</g>
</g>
<!-- N4&#45;&gt;N16 -->
<g id="edge3" class="edge">
<title>N4&#45;&gt;N16</title>
<g id="a_edge3"><a xlink:title="runtime.main &#45;&gt; main.main (3.11s)">
<path fill="none" stroke="#b22b00" stroke-width="2" d="M468,-1636.8446C468,-1618.8877 468,-1591.1466 468,-1570.2969"/>
<polygon fill="#b22b00" stroke="#b22b00" stroke-width="2" points="471.5001,-1570.1103 468,-1560.1103 464.5001,-1570.1104 471.5001,-1570.1103"/>
</a>
</g>
<g id="a_edge3&#45;label"><a xlink:title="runtime.main &#45;&gt; main.main (3.11s)">
<text text-anchor="middle" x="485" y="-1585.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 3.11s</text>
</a>
</g>
</g>
<!-- N5 -->
<g id="node5" class="node">
<title>N5</title>
<g id="a_node5"><a xlink:title="net/http.(*persistConn).writeLoop (2.54s)">
<polygon fill="#eddcd5" stroke="#b23300" points="122,-181 42,-181 42,-137 122,-137 122,-181"/>
<text text-anchor="middle" x="82" y="-170.6" font-family="Times,serif" font-size="8.00" fill="#000000">http</text>
<text text-anchor="middle" x="82" y="-161.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*persistConn)</text>
<text text-anchor="middle" x="82" y="-152.6" font-family="Times,serif" font-size="8.00" fill="#000000">writeLoop</text>
<text text-anchor="middle" x="82" y="-143.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 2.54s (32.44%)</text>
</a>
</g>
</g>
<!-- N5&#45;&gt;N1 -->
<g id="edge12" class="edge">
<title>N5&#45;&gt;N1</title>
<g id="a_edge12"><a xlink:title="net/http.(*persistConn).writeLoop &#45;&gt; runtime.selectgo (2.54s)">
<path fill="none" stroke="#b23300" stroke-width="2" d="M82,-136.9082C82,-125.3769 82,-110.7235 82,-96.4411"/>
<polygon fill="#b23300" stroke="#b23300" stroke-width="2" points="85.5001,-96.1567 82,-86.1568 78.5001,-96.1568 85.5001,-96.1567"/>
</a>
</g>
<g id="a_edge12&#45;label"><a xlink:title="net/http.(*persistConn).writeLoop &#45;&gt; runtime.selectgo (2.54s)">
<text text-anchor="middle" x="99" y="-107.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 2.54s</text>
</a>
</g>
</g>
<!-- N6 -->
<g id="node6" class="node">
<title>N6</title>
<g id="a_node6"><a xlink:title="testing.(*B).launch (1.94s)">
<polygon fill="#edddd5" stroke="#b23c00" points="410,-1271 330,-1271 330,-1227 410,-1227 410,-1271"/>
<text text-anchor="middle" x="370" y="-1260.6" font-family="Times,serif" font-size="8.00" fill="#000000">testing</text>
<text text-anchor="middle" x="370" y="-1251.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*B)</text>
<text text-anchor="middle" x="370" y="-1242.6" font-family="Times,serif" font-size="8.00" fill="#000000">launch</text>
<text text-anchor="middle" x="370" y="-1233.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 1.94s (24.82%)</text>
</a>
</g>
</g>
<!-- N6&#45;&gt;N2 -->
<g id="edge14" class="edge">
<title>N6&#45;&gt;N2</title>
<g id="a_edge14"><a xlink:title="testing.(*B).launch &#45;&gt; testing.(*B).runN (1.94s)">
<path fill="none" stroke="#b23c00" stroke-width="2" d="M392.7295,-1226.9663C406.1152,-1213.9903 423.2145,-1197.4145 437.7315,-1183.3419"/>
<polygon fill="#b23c00" stroke="#b23c00" stroke-width="2" points="440.3103,-1185.7167 445.0543,-1176.2433 435.438,-1180.6906 440.3103,-1185.7167"/>
</a>
</g>
<g id="a_edge14&#45;label"><a xlink:title="testing.(*B).launch &#45;&gt; testing.(*B).runN (1.94s)">
<text text-anchor="middle" x="442" y="-1197.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1.94s</text>
</a>
</g>
</g>
<!-- N14 -->
<g id="node14" class="node">
<title>N14</title>
<g id="a_node14"><a xlink:title="io/ioutil.ReadAll (0.11s)">
<polygon fill="#edeceb" stroke="#b2aea5" points="409,-982 333,-982 333,-946 409,-946 409,-982"/>
<text text-anchor="middle" x="371" y="-971.1" font-family="Times,serif" font-size="8.00" fill="#000000">ioutil</text>
<text text-anchor="middle" x="371" y="-962.1" font-family="Times,serif" font-size="8.00" fill="#000000">ReadAll</text>
<text text-anchor="middle" x="371" y="-953.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.11s (1.46%)</text>
</a>
</g>
</g>
<!-- N7&#45;&gt;N14 -->
<g id="edge32" class="edge">
<title>N7&#45;&gt;N14</title>
<g id="a_edge32"><a xlink:title="net/http_test.BenchmarkClientServer &#45;&gt; io/ioutil.ReadAll (0.11s)">
<path fill="none" stroke="#b2aea5" d="M364.5425,-1040.683C365.6935,-1027.0149 367.2877,-1008.0833 368.6041,-992.4508"/>
<polygon fill="#b2aea5" stroke="#b2aea5" points="372.1107,-992.5192 369.4623,-982.2607 365.1354,-991.9317 372.1107,-992.5192"/>
</a>
</g>
<g id="a_edge32&#45;label"><a xlink:title="net/http_test.BenchmarkClientServer &#45;&gt; io/ioutil.ReadAll (0.11s)">
<text text-anchor="middle" x="385" y="-1007.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.11s</text>
</a>
</g>
</g>
<!-- N28 -->
<g id="node28" class="node">
<title>N28</title>
<g id="a_node28"><a xlink:title="net/http.Get (1.83s)">
<polygon fill="#edddd5" stroke="#b23f00" points="315,-982 235,-982 235,-946 315,-946 315,-982"/>
<text text-anchor="middle" x="275" y="-971.1" font-family="Times,serif" font-size="8.00" fill="#000000">http</text>
<text text-anchor="middle" x="275" y="-962.1" font-family="Times,serif" font-size="8.00" fill="#000000">Get</text>
<text text-anchor="middle" x="275" y="-953.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 1.83s (23.37%)</text>
</a>
</g>
</g>
<!-- N7&#45;&gt;N28 -->
<g id="edge22" class="edge">
<title>N7&#45;&gt;N28</title>
<g id="a_edge22"><a xlink:title="net/http_test.BenchmarkClientServer &#45;&gt; net/http.Get (1.83s)">
<path fill="none" stroke="#b23f00" stroke-width="2" d="M346.0327,-1040.683C332.6412,-1026.2263 313.7953,-1005.8813 298.8802,-989.7798"/>
<polygon fill="#b23f00" stroke="#b23f00" stroke-width="2" points="301.2785,-987.2185 291.9152,-982.2607 296.1432,-991.9754 301.2785,-987.2185"/>
</a>
</g>
<g id="a_edge22&#45;label"><a xlink:title="net/http_test.BenchmarkClientServer &#45;&gt; net/http.Get (1.83s)">
<text text-anchor="middle" x="342" y="-1007.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1.83s</text>
</a>
</g>
</g>
<!-- N8 -->
<g id="node8" class="node">
<title>N8</title>
<g id="a_node8"><a xlink:title="net/http.(*persistConn).readLoop (0.18s)">
<polygon fill="#edecea" stroke="#b2ab9d" points="216,-181 140,-181 140,-137 216,-137 216,-181"/>
<text text-anchor="middle" x="178" y="-170.6" font-family="Times,serif" font-size="8.00" fill="#000000">http</text>
<text text-anchor="middle" x="178" y="-161.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*persistConn)</text>
<text text-anchor="middle" x="178" y="-152.6" font-family="Times,serif" font-size="8.00" fill="#000000">readLoop</text>
<text text-anchor="middle" x="178" y="-143.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.18s (2.36%)</text>
</a>
</g>
</g>
<!-- N8&#45;&gt;N1 -->
<g id="edge25" class="edge">
<title>N8&#45;&gt;N1</title>
<g id="a_edge25"><a xlink:title="net/http.(*persistConn).readLoop &#45;&gt; runtime.selectgo (0.18s)">
<path fill="none" stroke="#b2ab9d" d="M159.7172,-136.9082C149.6181,-124.7052 136.6254,-109.0057 124.1652,-93.9496"/>
<polygon fill="#b2ab9d" stroke="#b2ab9d" points="126.788,-91.6292 117.7159,-86.1568 121.3953,-96.0922 126.788,-91.6292"/>
</a>
</g>
<g id="a_edge25&#45;label"><a xlink:title="net/http.(*persistConn).readLoop &#45;&gt; runtime.selectgo (0.18s)">
<text text-anchor="middle" x="162" y="-107.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.18s</text>
</a>
</g>
</g>
<!-- N9 -->
<g id="node9" class="node">
<title>N9</title>
<g id="a_node9"><a xlink:title="sync.(*Cond).Wait (0.04s)">
<polygon fill="#ededec" stroke="#b2b1ad" points="600.5,-1374 527.5,-1374 527.5,-1322 600.5,-1322 600.5,-1374"/>
<text text-anchor="middle" x="564" y="-1362" font-family="Times,serif" font-size="10.00" fill="#000000">sync</text>
<text text-anchor="middle" x="564" y="-1351" font-family="Times,serif" font-size="10.00" fill="#000000">(*Cond)</text>
<text text-anchor="middle" x="564" y="-1340" font-family="Times,serif" font-size="10.00" fill="#000000">Wait</text>
<text text-anchor="middle" x="564" y="-1329" font-family="Times,serif" font-size="10.00" fill="#000000">0.04s (0.57%)</text>
</a>
</g>
</g>
<!-- N10 -->
<g id="node10" class="node">
<title>N10</title>
<g id="a_node10"><a xlink:title="net/http.(*conn).serve (0.04s)">
<polygon fill="#ededec" stroke="#b2b1ad" points="602,-1677 526,-1677 526,-1633 602,-1633 602,-1677"/>
<text text-anchor="middle" x="564" y="-1666.6" font-family="Times,serif" font-size="8.00" fill="#000000">http</text>
<text text-anchor="middle" x="564" y="-1657.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*conn)</text>
<text text-anchor="middle" x="564" y="-1648.6" font-family="Times,serif" font-size="8.00" fill="#000000">serve</text>
<text text-anchor="middle" x="564" y="-1639.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.04s (0.57%)</text>
</a>
</g>
</g>
<!-- N27 -->
<g id="node27" class="node">
<title>N27</title>
<g id="a_node27"><a xlink:title="net/http.(*response).finishRequest (0.04s)">
<polygon fill="#ededec" stroke="#b2b1ad" points="602,-1564 526,-1564 526,-1520 602,-1520 602,-1564"/>
<text text-anchor="middle" x="564" y="-1553.6" font-family="Times,serif" font-size="8.00" fill="#000000">http</text>
<text text-anchor="middle" x="564" y="-1544.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*response)</text>
<text text-anchor="middle" x="564" y="-1535.6" font-family="Times,serif" font-size="8.00" fill="#000000">finishRequest</text>
<text text-anchor="middle" x="564" y="-1526.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.04s (0.57%)</text>
</a>
</g>
</g>
<!-- N10&#45;&gt;N27 -->
<g id="edge33" class="edge">
<title>N10&#45;&gt;N27</title>
<g id="a_edge33"><a xlink:title="net/http.(*conn).serve &#45;&gt; net/http.(*response).finishRequest (0.04s)">
<path fill="none" stroke="#b2b1ad" d="M564,-1632.9442C564,-1616.2222 564,-1592.9909 564,-1574.194"/>
<polygon fill="#b2b1ad" stroke="#b2b1ad" points="567.5001,-1574.0001 564,-1564.0002 560.5001,-1574.0002 567.5001,-1574.0001"/>
</a>
</g>
<g id="a_edge33&#45;label"><a xlink:title="net/http.(*conn).serve &#45;&gt; net/http.(*response).finishRequest (0.04s)">
<text text-anchor="middle" x="581" y="-1585.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.04s</text>
</a>
</g>
</g>
<!-- N11 -->
<g id="node11" class="node">
<title>N11</title>
<g id="a_node11"><a xlink:title="testing.(*B).Run (3.11s)">
<polygon fill="#eddbd5" stroke="#b22b00" points="508,-986 428,-986 428,-942 508,-942 508,-986"/>
<text text-anchor="middle" x="468" y="-975.6" font-family="Times,serif" font-size="8.00" fill="#000000">testing</text>
<text text-anchor="middle" x="468" y="-966.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*B)</text>
<text text-anchor="middle" x="468" y="-957.6" font-family="Times,serif" font-size="8.00" fill="#000000">Run</text>
<text text-anchor="middle" x="468" y="-948.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 3.11s (39.80%)</text>
</a>
</g>
</g>
<!-- N32 -->
<g id="node32" class="node">
<title>N32</title>
<g id="a_node32"><a xlink:title="testing.(*B).run (3.11s)">
<polygon fill="#eddbd5" stroke="#b22b00" points="508,-891 428,-891 428,-847 508,-847 508,-891"/>
<text text-anchor="middle" x="468" y="-880.6" font-family="Times,serif" font-size="8.00" fill="#000000">testing</text>
<text text-anchor="middle" x="468" y="-871.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*B)</text>
<text text-anchor="middle" x="468" y="-862.6" font-family="Times,serif" font-size="8.00" fill="#000000">run</text>
<text text-anchor="middle" x="468" y="-853.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 3.11s (39.77%)</text>
</a>
</g>
</g>
<!-- N11&#45;&gt;N32 -->
<g id="edge8" class="edge">
<title>N11&#45;&gt;N32</title>
<g id="a_edge8"><a xlink:title="testing.(*B).Run &#45;&gt; testing.(*B).run (3.11s)">
<path fill="none" stroke="#b22b00" stroke-width="2" d="M468,-941.9663C468,-929.9427 468,-914.8283 468,-901.4785"/>
<polygon fill="#b22b00" stroke="#b22b00" stroke-width="2" points="471.5001,-901.2433 468,-891.2433 464.5001,-901.2433 471.5001,-901.2433"/>
</a>
</g>
<g id="a_edge8&#45;label"><a xlink:title="testing.(*B).Run &#45;&gt; testing.(*B).run (3.11s)">
<text text-anchor="middle" x="485" y="-912.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 3.11s</text>
</a>
</g>
</g>
<!-- N12 -->
<g id="node12" class="node">
<title>N12</title>
<g id="a_node12"><a xlink:title="net/http.(*Transport).roundTrip (1.83s)">
<polygon fill="#edddd5" stroke="#b23f00" points="314,-276 234,-276 234,-232 314,-232 314,-276"/>
<text text-anchor="middle" x="274" y="-265.6" font-family="Times,serif" font-size="8.00" fill="#000000">http</text>
<text text-anchor="middle" x="274" y="-256.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*Transport)</text>
<text text-anchor="middle" x="274" y="-247.6" font-family="Times,serif" font-size="8.00" fill="#000000">roundTrip</text>
<text text-anchor="middle" x="274" y="-238.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 1.83s (23.37%)</text>
</a>
</g>
</g>
<!-- N26 -->
<g id="node26" class="node">
<title>N26</title>
<g id="a_node26"><a xlink:title="net/http.(*persistConn).roundTrip (1.83s)">
<polygon fill="#edddd5" stroke="#b23f00" points="314,-181 234,-181 234,-137 314,-137 314,-181"/>
<text text-anchor="middle" x="274" y="-170.6" font-family="Times,serif" font-size="8.00" fill="#000000">http</text>
<text text-anchor="middle" x="274" y="-161.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*persistConn)</text>
<text text-anchor="middle" x="274" y="-152.6" font-family="Times,serif" font-size="8.00" fill="#000000">roundTrip</text>
<text text-anchor="middle" x="274" y="-143.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 1.83s (23.36%)</text>
</a>
</g>
</g>
<!-- N12&#45;&gt;N26 -->
<g id="edge23" class="edge">
<title>N12&#45;&gt;N26</title>
<g id="a_edge23"><a xlink:title="net/http.(*Transport).roundTrip &#45;&gt; net/http.(*persistConn).roundTrip (1.83s)">
<path fill="none" stroke="#b23f00" stroke-width="2" d="M274,-231.9663C274,-219.9427 274,-204.8283 274,-191.4785"/>
<polygon fill="#b23f00" stroke="#b23f00" stroke-width="2" points="277.5001,-191.2433 274,-181.2433 270.5001,-191.2433 277.5001,-191.2433"/>
</a>
</g>
<g id="a_edge23&#45;label"><a xlink:title="net/http.(*Transport).roundTrip &#45;&gt; net/http.(*persistConn).roundTrip (1.83s)">
<text text-anchor="middle" x="291" y="-202.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1.83s</text>
</a>
</g>
</g>
<!-- N13 -->
<g id="node13" class="node">
<title>N13</title>
<g id="a_node13"><a xlink:title="bytes.(*Buffer).ReadFrom (0.11s)">
<polygon fill="#edeceb" stroke="#b2aea5" points="409,-796 333,-796 333,-752 409,-752 409,-796"/>
<text text-anchor="middle" x="371" y="-785.6" font-family="Times,serif" font-size="8.00" fill="#000000">bytes</text>
<text text-anchor="middle" x="371" y="-776.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*Buffer)</text>
<text text-anchor="middle" x="371" y="-767.6" font-family="Times,serif" font-size="8.00" fill="#000000">ReadFrom</text>
<text text-anchor="middle" x="371" y="-758.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.11s (1.46%)</text>
</a>
</g>
</g>
<!-- N22 -->
<g id="node22" class="node">
<title>N22</title>
<g id="a_node22"><a xlink:title="net/http.(*bodyEOFSignal).Read (0.11s)">
<polygon fill="#edeceb" stroke="#b2aea5" points="409.5,-701 332.5,-701 332.5,-657 409.5,-657 409.5,-701"/>
<text text-anchor="middle" x="371" y="-690.6" font-family="Times,serif" font-size="8.00" fill="#000000">http</text>
<text text-anchor="middle" x="371" y="-681.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*bodyEOFSignal)</text>
<text text-anchor="middle" x="371" y="-672.6" font-family="Times,serif" font-size="8.00" fill="#000000">Read</text>
<text text-anchor="middle" x="371" y="-663.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.11s (1.46%)</text>
</a>
</g>
</g>
<!-- N13&#45;&gt;N22 -->
<g id="edge26" class="edge">
<title>N13&#45;&gt;N22</title>
<g id="a_edge26"><a xlink:title="bytes.(*Buffer).ReadFrom &#45;&gt; net/http.(*bodyEOFSignal).Read (0.11s)">
<path fill="none" stroke="#b2aea5" d="M371,-751.9663C371,-739.9427 371,-724.8283 371,-711.4785"/>
<polygon fill="#b2aea5" stroke="#b2aea5" points="374.5001,-711.2433 371,-701.2433 367.5001,-711.2433 374.5001,-711.2433"/>
</a>
</g>
<g id="a_edge26&#45;label"><a xlink:title="bytes.(*Buffer).ReadFrom &#45;&gt; net/http.(*bodyEOFSignal).Read (0.11s)">
<text text-anchor="middle" x="388" y="-722.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.11s</text>
</a>
</g>
</g>
<!-- N15 -->
<g id="node15" class="node">
<title>N15</title>
<g id="a_node15"><a xlink:title="io/ioutil.readAll (0.11s)">
<polygon fill="#edeceb" stroke="#b2aea5" points="409,-887 333,-887 333,-851 409,-851 409,-887"/>
<text text-anchor="middle" x="371" y="-876.1" font-family="Times,serif" font-size="8.00" fill="#000000">ioutil</text>
<text text-anchor="middle" x="371" y="-867.1" font-family="Times,serif" font-size="8.00" fill="#000000">readAll</text>
<text text-anchor="middle" x="371" y="-858.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.11s (1.46%)</text>
</a>
</g>
</g>
<!-- N14&#45;&gt;N15 -->
<g id="edge27" class="edge">
<title>N14&#45;&gt;N15</title>
<g id="a_edge27"><a xlink:title="io/ioutil.ReadAll &#45;&gt; io/ioutil.readAll (0.11s)">
<path fill="none" stroke="#b2aea5" d="M371,-945.683C371,-932.0149 371,-913.0833 371,-897.4508"/>
<polygon fill="#b2aea5" stroke="#b2aea5" points="374.5001,-897.2607 371,-887.2607 367.5001,-897.2608 374.5001,-897.2607"/>
</a>
</g>
<g id="a_edge27&#45;label"><a xlink:title="io/ioutil.ReadAll &#45;&gt; io/ioutil.readAll (0.11s)">
<text text-anchor="middle" x="388" y="-912.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.11s</text>
</a>
</g>
</g>
<!-- N15&#45;&gt;N13 -->
<g id="edge28" class="edge">
<title>N15&#45;&gt;N13</title>
<g id="a_edge28"><a xlink:title="io/ioutil.readAll &#45;&gt; bytes.(*Buffer).ReadFrom (0.11s)">
<path fill="none" stroke="#b2aea5" d="M371,-850.683C371,-838.1876 371,-821.2931 371,-806.542"/>
<polygon fill="#b2aea5" stroke="#b2aea5" points="374.5001,-806.2732 371,-796.2733 367.5001,-806.2733 374.5001,-806.2732"/>
</a>
</g>
<g id="a_edge28&#45;label"><a xlink:title="io/ioutil.readAll &#45;&gt; bytes.(*Buffer).ReadFrom (0.11s)">
<text text-anchor="middle" x="388" y="-817.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.11s</text>
</a>
</g>
</g>
<!-- N30 -->
<g id="node30" class="node">
<title>N30</title>
<g id="a_node30"><a xlink:title="net/http_test.TestMain (3.11s)">
<polygon fill="#eddbd5" stroke="#b22b00" points="508,-1465 428,-1465 428,-1429 508,-1429 508,-1465"/>
<text text-anchor="middle" x="468" y="-1454.1" font-family="Times,serif" font-size="8.00" fill="#000000">http_test</text>
<text text-anchor="middle" x="468" y="-1445.1" font-family="Times,serif" font-size="8.00" fill="#000000">TestMain</text>
<text text-anchor="middle" x="468" y="-1436.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 3.11s (39.80%)</text>
</a>
</g>
</g>
<!-- N16&#45;&gt;N30 -->
<g id="edge1" class="edge">
<title>N16&#45;&gt;N30</title>
<g id="a_edge1"><a xlink:title="main.main &#45;&gt; net/http_test.TestMain (3.11s)">
<path fill="none" stroke="#b22b00" stroke-width="2" d="M468,-1523.683C468,-1510.0149 468,-1491.0833 468,-1475.4508"/>
<polygon fill="#b22b00" stroke="#b22b00" stroke-width="2" points="471.5001,-1475.2607 468,-1465.2607 464.5001,-1475.2608 471.5001,-1475.2607"/>
</a>
</g>
<g id="a_edge1&#45;label"><a xlink:title="main.main &#45;&gt; net/http_test.TestMain (3.11s)">
<text text-anchor="middle" x="485" y="-1490.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 3.11s</text>
</a>
</g>
</g>
<!-- N17 -->
<g id="node17" class="node">
<title>N17</title>
<g id="a_node17"><a xlink:title="net/http.(*Client).Do (1.83s)">
<polygon fill="#edddd5" stroke="#b23f00" points="314,-796 234,-796 234,-752 314,-752 314,-796"/>
<text text-anchor="middle" x="274" y="-785.6" font-family="Times,serif" font-size="8.00" fill="#000000">http</text>
<text text-anchor="middle" x="274" y="-776.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*Client)</text>
<text text-anchor="middle" x="274" y="-767.6" font-family="Times,serif" font-size="8.00" fill="#000000">Do</text>
<text text-anchor="middle" x="274" y="-758.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 1.83s (23.37%)</text>
</a>
</g>
</g>
<!-- N19 -->
<g id="node19" class="node">
<title>N19</title>
<g id="a_node19"><a xlink:title="net/http.(*Client).do (1.83s)">
<polygon fill="#edddd5" stroke="#b23f00" points="314,-701 234,-701 234,-657 314,-657 314,-701"/>
<text text-anchor="middle" x="274" y="-690.6" font-family="Times,serif" font-size="8.00" fill="#000000">http</text>
<text text-anchor="middle" x="274" y="-681.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*Client)</text>
<text text-anchor="middle" x="274" y="-672.6" font-family="Times,serif" font-size="8.00" fill="#000000">do</text>
<text text-anchor="middle" x="274" y="-663.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 1.83s (23.37%)</text>
</a>
</g>
</g>
<!-- N17&#45;&gt;N19 -->
<g id="edge15" class="edge">
<title>N17&#45;&gt;N19</title>
<g id="a_edge15"><a xlink:title="net/http.(*Client).Do &#45;&gt; net/http.(*Client).do (1.83s)">
<path fill="none" stroke="#b23f00" stroke-width="2" d="M274,-751.9663C274,-739.9427 274,-724.8283 274,-711.4785"/>
<polygon fill="#b23f00" stroke="#b23f00" stroke-width="2" points="277.5001,-711.2433 274,-701.2433 270.5001,-711.2433 277.5001,-711.2433"/>
</a>
</g>
<g id="a_edge15&#45;label"><a xlink:title="net/http.(*Client).Do &#45;&gt; net/http.(*Client).do (1.83s)">
<text text-anchor="middle" x="291" y="-722.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1.83s</text>
</a>
</g>
</g>
<!-- N18 -->
<g id="node18" class="node">
<title>N18</title>
<g id="a_node18"><a xlink:title="net/http.(*Client).Get (1.83s)">
<polygon fill="#edddd5" stroke="#b23f00" points="314,-891 234,-891 234,-847 314,-847 314,-891"/>
<text text-anchor="middle" x="274" y="-880.6" font-family="Times,serif" font-size="8.00" fill="#000000">http</text>
<text text-anchor="middle" x="274" y="-871.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*Client)</text>
<text text-anchor="middle" x="274" y="-862.6" font-family="Times,serif" font-size="8.00" fill="#000000">Get</text>
<text text-anchor="middle" x="274" y="-853.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 1.83s (23.37%)</text>
</a>
</g>
</g>
<!-- N18&#45;&gt;N17 -->
<g id="edge16" class="edge">
<title>N18&#45;&gt;N17</title>
<g id="a_edge16"><a xlink:title="net/http.(*Client).Get &#45;&gt; net/http.(*Client).Do (1.83s)">
<path fill="none" stroke="#b23f00" stroke-width="2" d="M274,-846.9663C274,-834.9427 274,-819.8283 274,-806.4785"/>
<polygon fill="#b23f00" stroke="#b23f00" stroke-width="2" points="277.5001,-806.2433 274,-796.2433 270.5001,-806.2433 277.5001,-806.2433"/>
</a>
</g>
<g id="a_edge16&#45;label"><a xlink:title="net/http.(*Client).Get &#45;&gt; net/http.(*Client).Do (1.83s)">
<text text-anchor="middle" x="291" y="-817.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1.83s</text>
</a>
</g>
</g>
<!-- N20 -->
<g id="node20" class="node">
<title>N20</title>
<g id="a_node20"><a xlink:title="net/http.(*Client).send (1.83s)">
<polygon fill="#edddd5" stroke="#b23f00" points="314,-606 234,-606 234,-562 314,-562 314,-606"/>
<text text-anchor="middle" x="274" y="-595.6" font-family="Times,serif" font-size="8.00" fill="#000000">http</text>
<text text-anchor="middle" x="274" y="-586.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*Client)</text>
<text text-anchor="middle" x="274" y="-577.6" font-family="Times,serif" font-size="8.00" fill="#000000">send</text>
<text text-anchor="middle" x="274" y="-568.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 1.83s (23.37%)</text>
</a>
</g>
</g>
<!-- N19&#45;&gt;N20 -->
<g id="edge17" class="edge">
<title>N19&#45;&gt;N20</title>
<g id="a_edge17"><a xlink:title="net/http.(*Client).do &#45;&gt; net/http.(*Client).send (1.83s)">
<path fill="none" stroke="#b23f00" stroke-width="2" d="M274,-656.9663C274,-644.9427 274,-629.8283 274,-616.4785"/>
<polygon fill="#b23f00" stroke="#b23f00" stroke-width="2" points="277.5001,-616.2433 274,-606.2433 270.5001,-616.2433 277.5001,-616.2433"/>
</a>
</g>
<g id="a_edge17&#45;label"><a xlink:title="net/http.(*Client).do &#45;&gt; net/http.(*Client).send (1.83s)">
<text text-anchor="middle" x="291" y="-627.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1.83s</text>
</a>
</g>
</g>
<!-- N29 -->
<g id="node29" class="node">
<title>N29</title>
<g id="a_node29"><a xlink:title="net/http.send (1.83s)">
<polygon fill="#edddd5" stroke="#b23f00" points="314,-502.5 234,-502.5 234,-466.5 314,-466.5 314,-502.5"/>
<text text-anchor="middle" x="274" y="-491.6" font-family="Times,serif" font-size="8.00" fill="#000000">http</text>
<text text-anchor="middle" x="274" y="-482.6" font-family="Times,serif" font-size="8.00" fill="#000000">send</text>
<text text-anchor="middle" x="274" y="-473.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 1.83s (23.37%)</text>
</a>
</g>
</g>
<!-- N20&#45;&gt;N29 -->
<g id="edge18" class="edge">
<title>N20&#45;&gt;N29</title>
<g id="a_edge18"><a xlink:title="net/http.(*Client).send &#45;&gt; net/http.send (1.83s)">
<path fill="none" stroke="#b23f00" stroke-width="2" d="M274,-561.9177C274,-547.4041 274,-528.2841 274,-512.677"/>
<polygon fill="#b23f00" stroke="#b23f00" stroke-width="2" points="277.5001,-512.5331 274,-502.5331 270.5001,-512.5331 277.5001,-512.5331"/>
</a>
</g>
<g id="a_edge18&#45;label"><a xlink:title="net/http.(*Client).send &#45;&gt; net/http.send (1.83s)">
<text text-anchor="middle" x="291" y="-532.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1.83s</text>
</a>
</g>
</g>
<!-- N21 -->
<g id="node21" class="node">
<title>N21</title>
<g id="a_node21"><a xlink:title="net/http.(*Transport).RoundTrip (1.83s)">
<polygon fill="#edddd5" stroke="#b23f00" points="314,-389 234,-389 234,-345 314,-345 314,-389"/>
<text text-anchor="middle" x="274" y="-378.6" font-family="Times,serif" font-size="8.00" fill="#000000">http</text>
<text text-anchor="middle" x="274" y="-369.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*Transport)</text>
<text text-anchor="middle" x="274" y="-360.6" font-family="Times,serif" font-size="8.00" fill="#000000">RoundTrip</text>
<text text-anchor="middle" x="274" y="-351.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 1.83s (23.37%)</text>
</a>
</g>
</g>
<!-- N21&#45;&gt;N12 -->
<g id="edge19" class="edge">
<title>N21&#45;&gt;N12</title>
<g id="a_edge19"><a xlink:title="net/http.(*Transport).RoundTrip &#45;&gt; net/http.(*Transport).roundTrip (1.83s)">
<path fill="none" stroke="#b23f00" stroke-width="2" d="M274,-344.9442C274,-328.2222 274,-304.9909 274,-286.194"/>
<polygon fill="#b23f00" stroke="#b23f00" stroke-width="2" points="277.5001,-286.0001 274,-276.0002 270.5001,-286.0002 277.5001,-286.0001"/>
</a>
</g>
<g id="a_edge19&#45;label"><a xlink:title="net/http.(*Transport).RoundTrip &#45;&gt; net/http.(*Transport).roundTrip (1.83s)">
<text text-anchor="middle" x="291" y="-297.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1.83s</text>
</a>
</g>
</g>
<!-- N23 -->
<g id="node23" class="node">
<title>N23</title>
<g id="a_node23"><a xlink:title="net/http.(*bodyEOFSignal).condfn (0.11s)">
<polygon fill="#edeceb" stroke="#b2aea5" points="424.5,-606 347.5,-606 347.5,-562 424.5,-562 424.5,-606"/>
<text text-anchor="middle" x="386" y="-595.6" font-family="Times,serif" font-size="8.00" fill="#000000">http</text>
<text text-anchor="middle" x="386" y="-586.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*bodyEOFSignal)</text>
<text text-anchor="middle" x="386" y="-577.6" font-family="Times,serif" font-size="8.00" fill="#000000">condfn</text>
<text text-anchor="middle" x="386" y="-568.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.11s (1.46%)</text>
</a>
</g>
</g>
<!-- N22&#45;&gt;N23 -->
<g id="edge29" class="edge">
<title>N22&#45;&gt;N23</title>
<g id="a_edge29"><a xlink:title="net/http.(*bodyEOFSignal).Read &#45;&gt; net/http.(*bodyEOFSignal).condfn (0.11s)">
<path fill="none" stroke="#b2aea5" d="M374.479,-656.9663C376.3775,-644.9427 378.764,-629.8283 380.8718,-616.4785"/>
<polygon fill="#b2aea5" stroke="#b2aea5" points="384.3854,-616.6668 382.4879,-606.2433 377.471,-615.575 384.3854,-616.6668"/>
</a>
</g>
<g id="a_edge29&#45;label"><a xlink:title="net/http.(*bodyEOFSignal).Read &#45;&gt; net/http.(*bodyEOFSignal).condfn (0.11s)">
<text text-anchor="middle" x="397" y="-627.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.11s</text>
</a>
</g>
</g>
<!-- N25 -->
<g id="node25" class="node">
<title>N25</title>
<g id="a_node25"><a xlink:title="net/http.(*persistConn).readLoop.func4 (0.11s)">
<polygon fill="#edeceb" stroke="#b2aea5" points="440,-511 364,-511 364,-458 440,-458 440,-511"/>
<text text-anchor="middle" x="402" y="-500.6" font-family="Times,serif" font-size="8.00" fill="#000000">http</text>
<text text-anchor="middle" x="402" y="-491.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*persistConn)</text>
<text text-anchor="middle" x="402" y="-482.6" font-family="Times,serif" font-size="8.00" fill="#000000">readLoop</text>
<text text-anchor="middle" x="402" y="-473.6" font-family="Times,serif" font-size="8.00" fill="#000000">func4</text>
<text text-anchor="middle" x="402" y="-464.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.11s (1.46%)</text>
</a>
</g>
</g>
<!-- N23&#45;&gt;N25 -->
<g id="edge30" class="edge">
<title>N23&#45;&gt;N25</title>
<g id="a_edge30"><a xlink:title="net/http.(*bodyEOFSignal).condfn &#45;&gt; net/http.(*persistConn).readLoop.func4 (0.11s)">
<path fill="none" stroke="#b2aea5" d="M389.5509,-561.9177C391.4731,-549.9644 393.8976,-534.8865 396.0953,-521.2199"/>
<polygon fill="#b2aea5" stroke="#b2aea5" points="399.5874,-521.5481 397.7195,-511.1192 392.6762,-520.4367 399.5874,-521.5481"/>
</a>
</g>
<g id="a_edge30&#45;label"><a xlink:title="net/http.(*bodyEOFSignal).condfn &#45;&gt; net/http.(*persistConn).readLoop.func4 (0.11s)">
<text text-anchor="middle" x="412" y="-532.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.11s</text>
</a>
</g>
</g>
<!-- N24 -->
<g id="node24" class="node">
<title>N24</title>
<g id="a_node24"><a xlink:title="net/http.(*connReader).abortPendingRead (0.04s)">
<polygon fill="#ededec" stroke="#b2b1ad" points="602,-1469 526,-1469 526,-1425 602,-1425 602,-1469"/>
<text text-anchor="middle" x="564" y="-1458.6" font-family="Times,serif" font-size="8.00" fill="#000000">http</text>
<text text-anchor="middle" x="564" y="-1449.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*connReader)</text>
<text text-anchor="middle" x="564" y="-1440.6" font-family="Times,serif" font-size="8.00" fill="#000000">abortPendingRead</text>
<text text-anchor="middle" x="564" y="-1431.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.04s (0.57%)</text>
</a>
</g>
</g>
<!-- N24&#45;&gt;N9 -->
<g id="edge34" class="edge">
<title>N24&#45;&gt;N9</title>
<g id="a_edge34"><a xlink:title="net/http.(*connReader).abortPendingRead &#45;&gt; sync.(*Cond).Wait (0.04s)">
<path fill="none" stroke="#b2b1ad" d="M564,-1424.5354C564,-1412.7414 564,-1397.9936 564,-1384.6003"/>
<polygon fill="#b2b1ad" stroke="#b2b1ad" points="567.5001,-1384.2317 564,-1374.2317 560.5001,-1384.2318 567.5001,-1384.2317"/>
</a>
</g>
<g id="a_edge34&#45;label"><a xlink:title="net/http.(*connReader).abortPendingRead &#45;&gt; sync.(*Cond).Wait (0.04s)">
<text text-anchor="middle" x="581" y="-1395.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.04s</text>
</a>
</g>
</g>
<!-- N25&#45;&gt;N3 -->
<g id="edge31" class="edge">
<title>N25&#45;&gt;N3</title>
<g id="a_edge31"><a xlink:title="net/http.(*persistConn).readLoop.func4 &#45;&gt; runtime.chanrecv1 (0.11s)">
<path fill="none" stroke="#b2aea5" d="M407.6455,-457.835C410.4989,-447.2388 414.5394,-435.175 420,-425 421.7403,-421.7573 423.6784,-418.5263 425.7497,-415.3436"/>
<polygon fill="#b2aea5" stroke="#b2aea5" points="428.6744,-417.2682 431.4997,-407.057 422.9232,-413.2776 428.6744,-417.2682"/>
</a>
</g>
<g id="a_edge31&#45;label"><a xlink:title="net/http.(*persistConn).readLoop.func4 &#45;&gt; runtime.chanrecv1 (0.11s)">
<text text-anchor="middle" x="437" y="-428.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.11s</text>
</a>
</g>
</g>
<!-- N26&#45;&gt;N1 -->
<g id="edge24" class="edge">
<title>N26&#45;&gt;N1</title>
<g id="a_edge24"><a xlink:title="net/http.(*persistConn).roundTrip &#45;&gt; runtime.selectgo (1.83s)">
<path fill="none" stroke="#b23f00" stroke-width="2" d="M237.2515,-136.7857C220.6768,-126.7674 200.8542,-114.7871 183,-104 176.2813,-99.9407 169.3109,-95.7299 162.3148,-91.5038"/>
<polygon fill="#b23f00" stroke="#b23f00" stroke-width="2" points="163.8256,-88.3274 153.4563,-86.1529 160.2063,-94.3192 163.8256,-88.3274"/>
</a>
</g>
<g id="a_edge24&#45;label"><a xlink:title="net/http.(*persistConn).roundTrip &#45;&gt; runtime.selectgo (1.83s)">
<text text-anchor="middle" x="223" y="-107.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1.83s</text>
</a>
</g>
</g>
<!-- N27&#45;&gt;N24 -->
<g id="edge35" class="edge">
<title>N27&#45;&gt;N24</title>
<g id="a_edge35"><a xlink:title="net/http.(*response).finishRequest &#45;&gt; net/http.(*connReader).abortPendingRead (0.04s)">
<path fill="none" stroke="#b2b1ad" d="M564,-1519.9663C564,-1507.9427 564,-1492.8283 564,-1479.4785"/>
<polygon fill="#b2b1ad" stroke="#b2b1ad" points="567.5001,-1479.2433 564,-1469.2433 560.5001,-1479.2433 567.5001,-1479.2433"/>
</a>
</g>
<g id="a_edge35&#45;label"><a xlink:title="net/http.(*response).finishRequest &#45;&gt; net/http.(*connReader).abortPendingRead (0.04s)">
<text text-anchor="middle" x="581" y="-1490.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.04s</text>
</a>
</g>
</g>
<!-- N28&#45;&gt;N18 -->
<g id="edge20" class="edge">
<title>N28&#45;&gt;N18</title>
<g id="a_edge20"><a xlink:title="net/http.Get &#45;&gt; net/http.(*Client).Get (1.83s)">
<path fill="none" stroke="#b23f00" stroke-width="2" d="M274.8072,-945.683C274.6757,-933.1876 274.4978,-916.2931 274.3425,-901.542"/>
<polygon fill="#b23f00" stroke="#b23f00" stroke-width="2" points="277.8396,-901.2359 274.2345,-891.2733 270.84,-901.3096 277.8396,-901.2359"/>
</a>
</g>
<g id="a_edge20&#45;label"><a xlink:title="net/http.Get &#45;&gt; net/http.(*Client).Get (1.83s)">
<text text-anchor="middle" x="292" y="-912.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1.83s</text>
</a>
</g>
</g>
<!-- N29&#45;&gt;N21 -->
<g id="edge21" class="edge">
<title>N29&#45;&gt;N21</title>
<g id="a_edge21"><a xlink:title="net/http.send &#45;&gt; net/http.(*Transport).RoundTrip (1.83s)">
<path fill="none" stroke="#b23f00" stroke-width="2" d="M274,-466.3981C274,-448.5845 274,-420.9917 274,-399.3937"/>
<polygon fill="#b23f00" stroke="#b23f00" stroke-width="2" points="277.5001,-399.3417 274,-389.3417 270.5001,-399.3417 277.5001,-399.3417"/>
</a>
</g>
<g id="a_edge21&#45;label"><a xlink:title="net/http.send &#45;&gt; net/http.(*Transport).RoundTrip (1.83s)">
<text text-anchor="middle" x="291" y="-428.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1.83s</text>
</a>
</g>
</g>
<!-- N33 -->
<g id="node33" class="node">
<title>N33</title>
<g id="a_node33"><a xlink:title="testing.(*M).Run (3.11s)">
<polygon fill="#eddbd5" stroke="#b22b00" points="508,-1370 428,-1370 428,-1326 508,-1326 508,-1370"/>
<text text-anchor="middle" x="468" y="-1359.6" font-family="Times,serif" font-size="8.00" fill="#000000">testing</text>
<text text-anchor="middle" x="468" y="-1350.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*M)</text>
<text text-anchor="middle" x="468" y="-1341.6" font-family="Times,serif" font-size="8.00" fill="#000000">Run</text>
<text text-anchor="middle" x="468" y="-1332.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 3.11s (39.80%)</text>
</a>
</g>
</g>
<!-- N30&#45;&gt;N33 -->
<g id="edge2" class="edge">
<title>N30&#45;&gt;N33</title>
<g id="a_edge2"><a xlink:title="net/http_test.TestMain &#45;&gt; testing.(*M).Run (3.11s)">
<path fill="none" stroke="#b22b00" stroke-width="2" d="M468,-1428.8419C468,-1415.2878 468,-1396.4077 468,-1380.3016"/>
<polygon fill="#b22b00" stroke="#b22b00" stroke-width="2" points="471.5001,-1380.2021 468,-1370.2021 464.5001,-1380.2022 471.5001,-1380.2021"/>
</a>
</g>
<g id="a_edge2&#45;label"><a xlink:title="net/http_test.TestMain &#45;&gt; testing.(*M).Run (3.11s)">
<text text-anchor="middle" x="485" y="-1395.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 3.11s</text>
</a>
</g>
</g>
<!-- N31 -->
<g id="node31" class="node">
<title>N31</title>
<g id="a_node31"><a xlink:title="testing.(*B).doBench (3.11s)">
<polygon fill="#eddbd5" stroke="#b22b00" points="508,-701 428,-701 428,-657 508,-657 508,-701"/>
<text text-anchor="middle" x="468" y="-690.6" font-family="Times,serif" font-size="8.00" fill="#000000">testing</text>
<text text-anchor="middle" x="468" y="-681.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*B)</text>
<text text-anchor="middle" x="468" y="-672.6" font-family="Times,serif" font-size="8.00" fill="#000000">doBench</text>
<text text-anchor="middle" x="468" y="-663.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 3.11s (39.77%)</text>
</a>
</g>
</g>
<!-- N31&#45;&gt;N3 -->
<g id="edge9" class="edge">
<title>N31&#45;&gt;N3</title>
<g id="a_edge9"><a xlink:title="testing.(*B).doBench &#45;&gt; runtime.chanrecv1 (3.11s)">
<path fill="none" stroke="#b22b00" stroke-width="2" d="M468,-656.5617C468,-606.79 468,-486.1141 468,-417.2858"/>
<polygon fill="#b22b00" stroke="#b22b00" stroke-width="2" points="471.5001,-417.1125 468,-407.1125 464.5001,-417.1125 471.5001,-417.1125"/>
</a>
</g>
<g id="a_edge9&#45;label"><a xlink:title="testing.(*B).doBench &#45;&gt; runtime.chanrecv1 (3.11s)">
<text text-anchor="middle" x="485" y="-532.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 3.11s</text>
</a>
</g>
</g>
<!-- N34 -->
<g id="node34" class="node">
<title>N34</title>
<g id="a_node34"><a xlink:title="testing.(*benchContext).processBench (3.11s)">
<polygon fill="#eddbd5" stroke="#b22b00" points="508,-796 428,-796 428,-752 508,-752 508,-796"/>
<text text-anchor="middle" x="468" y="-785.6" font-family="Times,serif" font-size="8.00" fill="#000000">testing</text>
<text text-anchor="middle" x="468" y="-776.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*benchContext)</text>
<text text-anchor="middle" x="468" y="-767.6" font-family="Times,serif" font-size="8.00" fill="#000000">processBench</text>
<text text-anchor="middle" x="468" y="-758.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 3.11s (39.77%)</text>
</a>
</g>
</g>
<!-- N32&#45;&gt;N34 -->
<g id="edge10" class="edge">
<title>N32&#45;&gt;N34</title>
<g id="a_edge10"><a xlink:title="testing.(*B).run &#45;&gt; testing.(*benchContext).processBench (3.11s)">
<path fill="none" stroke="#b22b00" stroke-width="2" d="M468,-846.9663C468,-834.9427 468,-819.8283 468,-806.4785"/>
<polygon fill="#b22b00" stroke="#b22b00" stroke-width="2" points="471.5001,-806.2433 468,-796.2433 464.5001,-806.2433 471.5001,-806.2433"/>
</a>
</g>
<g id="a_edge10&#45;label"><a xlink:title="testing.(*B).run &#45;&gt; testing.(*benchContext).processBench (3.11s)">
<text text-anchor="middle" x="485" y="-817.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 3.11s</text>
</a>
</g>
</g>
<!-- N35 -->
<g id="node35" class="node">
<title>N35</title>
<g id="a_node35"><a xlink:title="testing.runBenchmarks (3.11s)">
<polygon fill="#eddbd5" stroke="#b22b00" points="508,-1267 428,-1267 428,-1231 508,-1231 508,-1267"/>
<text text-anchor="middle" x="468" y="-1256.1" font-family="Times,serif" font-size="8.00" fill="#000000">testing</text>
<text text-anchor="middle" x="468" y="-1247.1" font-family="Times,serif" font-size="8.00" fill="#000000">runBenchmarks</text>
<text text-anchor="middle" x="468" y="-1238.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 3.11s (39.80%)</text>
</a>
</g>
</g>
<!-- N33&#45;&gt;N35 -->
<g id="edge5" class="edge">
<title>N33&#45;&gt;N35</title>
<g id="a_edge5"><a xlink:title="testing.(*M).Run &#45;&gt; testing.runBenchmarks (3.11s)">
<path fill="none" stroke="#b22b00" stroke-width="2" d="M468,-1325.5354C468,-1311.3043 468,-1292.7726 468,-1277.5091"/>
<polygon fill="#b22b00" stroke="#b22b00" stroke-width="2" points="471.5001,-1277.0807 468,-1267.0808 464.5001,-1277.0808 471.5001,-1277.0807"/>
</a>
</g>
<g id="a_edge5&#45;label"><a xlink:title="testing.(*M).Run &#45;&gt; testing.runBenchmarks (3.11s)">
<text text-anchor="middle" x="485" y="-1292.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 3.11s</text>
</a>
</g>
</g>
<!-- N34&#45;&gt;N31 -->
<g id="edge11" class="edge">
<title>N34&#45;&gt;N31</title>
<g id="a_edge11"><a xlink:title="testing.(*benchContext).processBench &#45;&gt; testing.(*B).doBench (3.11s)">
<path fill="none" stroke="#b22b00" stroke-width="2" d="M468,-751.9663C468,-739.9427 468,-724.8283 468,-711.4785"/>
<polygon fill="#b22b00" stroke="#b22b00" stroke-width="2" points="471.5001,-711.2433 468,-701.2433 464.5001,-711.2433 471.5001,-711.2433"/>
</a>
</g>
<g id="a_edge11&#45;label"><a xlink:title="testing.(*benchContext).processBench &#45;&gt; testing.(*B).doBench (3.11s)">
<text text-anchor="middle" x="485" y="-722.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 3.11s</text>
</a>
</g>
</g>
<!-- N35&#45;&gt;N2 -->
<g id="edge6" class="edge">
<title>N35&#45;&gt;N2</title>
<g id="a_edge6"><a xlink:title="testing.runBenchmarks &#45;&gt; testing.(*B).runN (3.11s)">
<path fill="none" stroke="#b22b00" stroke-width="2" d="M468,-1230.683C468,-1218.1876 468,-1201.2931 468,-1186.542"/>
<polygon fill="#b22b00" stroke="#b22b00" stroke-width="2" points="471.5001,-1186.2732 468,-1176.2733 464.5001,-1186.2733 471.5001,-1186.2732"/>
</a>
</g>
<g id="a_edge6&#45;label"><a xlink:title="testing.runBenchmarks &#45;&gt; testing.(*B).runN (3.11s)">
<text text-anchor="middle" x="485" y="-1197.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 3.11s</text>
</a>
</g>
</g>
<!-- N36&#45;&gt;N11 -->
<g id="edge7" class="edge">
<title>N36&#45;&gt;N11</title>
<g id="a_edge7"><a xlink:title="testing.runBenchmarks.func1 &#45;&gt; testing.(*B).Run (3.11s)">
<path fill="none" stroke="#b22b00" stroke-width="2" d="M468,-1036.9663C468,-1024.9427 468,-1009.8283 468,-996.4785"/>
<polygon fill="#b22b00" stroke="#b22b00" stroke-width="2" points="471.5001,-996.2433 468,-986.2433 464.5001,-996.2433 471.5001,-996.2433"/>
</a>
</g>
<g id="a_edge7&#45;label"><a xlink:title="testing.runBenchmarks.func1 &#45;&gt; testing.(*B).Run (3.11s)">
<text text-anchor="middle" x="485" y="-1007.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 3.11s</text>
</a>
</g>
</g>
</g>
</g></svg>
</div>
</div>
</div>
<div class="sect3">
<h4 id="thread_creation_profiling"><a class="anchor" href="#thread_creation_profiling"></a><a class="link" href="#thread_creation_profiling">3.5.7. Thread creation profiling</a></h4>
<div class="paragraph">
<p>Go 1.11 (?) added support for profiling the creation of operating system threads.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Add thread creation profiling to <code>godoc</code> and observe the results of profiling <code>godoc -http=:8080 -index</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="framepointers"><a class="anchor" href="#framepointers"></a><a class="link" href="#framepointers">3.5.8. Framepointers</a></h4>
<div class="paragraph">
<p>Go 1.7 has been released and along with a new compiler for amd64, the compiler now enables frame pointers by default.</p>
</div>
<div class="paragraph">
<p>The frame pointer is a register that always points to the top of the current stack frame.</p>
</div>
<div class="paragraph">
<p>Framepointers enable tools like <code>gdb(1)</code>, and <code>perf(1)</code> to understand the Go call stack.</p>
</div>
<div class="paragraph">
<p>We won&#8217;t cover these tools in this workshop, but you can read and watch a presentation I gave on seven different ways to profile Go programs.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://talks.godoc.org/github.com/davecheney/presentations/seven.slide">Seven ways to profile a Go program</a> (slides)</p>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=2h_NFBFrciI">Seven ways to profile a Go program</a> (video, 30 mins)</p>
</li>
<li>
<p><a href="https://www.bigmarker.com/remote-meetup-go/Seven-ways-to-profile-a-Go-program">Seven ways to profile a Go program</a> (webcast, 60 mins)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="exercise"><a class="anchor" href="#exercise"></a><a class="link" href="#exercise">3.5.9. Exercise</a></h4>
<div class="ulist">
<ul>
<li>
<p>Generate a profile from a piece of code you know well. If you don&#8217;t have a code sample, try profiling <code>godoc</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>% go get golang.org/x/tools/cmd/godoc
% cd $GOPATH/src/golang.org/x/tools/cmd/godoc
% vim main.go</code></pre>
</div>
</div>
</li>
<li>
<p>If you were to generate a profile on one machine and inspect it on another, how would you do it?</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="compiler-optimisation"><a class="anchor" href="#compiler-optimisation"></a><a class="link" href="#compiler-optimisation">4. Compiler optimisations</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section covers some of the optimisations that the Go compiler performs.</p>
</div>
<div class="paragraph">
<p>For example;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Escape analysis</p>
</li>
<li>
<p>Inlining</p>
</li>
<li>
<p>Dead code elimination</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>are all handled in the front end of the compiler, while the code is still in its AST form; then the code is passed to the SSA compiler for further optimisation.</p>
</div>
<div class="sect2">
<h3 id="history_of_the_go_compiler"><a class="anchor" href="#history_of_the_go_compiler"></a><a class="link" href="#history_of_the_go_compiler">4.1. History of the Go compiler</a></h3>
<div class="paragraph">
<p>The Go compiler started as a fork of the Plan9 compiler tool chain circa 2007. The compiler at that time bore a strong resemblance to Aho and Ullman&#8217;s <a href="https://www.goodreads.com/book/show/112269.Principles_of_Compiler_Design"><em>Dragon Book</em></a>.</p>
</div>
<div class="paragraph">
<p>In 2015 the then Go 1.5 compiler was mechanically translated from <a href="https://golang.org/doc/go1.5#c">C into Go</a>.</p>
</div>
<div class="paragraph">
<p>A year later, Go 1.7 introduced a <a href="https://blog.golang.org/go1.7">new compiler backend</a> based on <a href="https://en.wikipedia.org/wiki/Static_single_assignment_form">SSA</a> techniques replaced the previous Plan 9 style code generation.
This new backend introduced many opportunities for generic and architecture specific optimistions.</p>
</div>
</div>
<div class="sect2">
<h3 id="escape_analysis"><a class="anchor" href="#escape_analysis"></a><a class="link" href="#escape_analysis">4.2. Escape analysis</a></h3>
<div class="paragraph">
<p>The first optimisation we&#8217;re doing to discuss is <em>escape analysis</em>.</p>
</div>
<div class="paragraph">
<p>To illustrate what escape analysis does recall that the <a href="https://golang.org/ref/spec">Go spec</a> does not mention the heap or the stack.
It only mentions that the language is garbage collected in the introduction, and gives no hints as to how this is to be achieved.</p>
</div>
<div class="paragraph">
<p>A compliant Go implementation of the Go spec <em>could</em> store every allocation on the heap.
That would put a lot of pressure on the the garbage collector, but it is in no way incorrect&#8201;&#8212;&#8201;for several years, gccgo had very limited support for escape analysis so could effectively be considered to be operating in this mode.</p>
</div>
<div class="paragraph">
<p>However, a goroutine&#8217;s stack exists as a cheap place to store local variables; there is no need to garbage collect things on the stack. Therefore, where it is safe to do so, an allocation placed on the stack will be more efficient.</p>
</div>
<div class="paragraph">
<p>In some languages, for example C and C++, the choice of allocating on the stack or on the heap is a manual exercise for the programmer&#8212;&#8203;heap allocations are made with <code>malloc</code> and <code>free</code>, stack allocation is via <code>alloca</code>.
Mistakes using these mechanisms are a common cause of memory corruption bugs.</p>
</div>
<div class="paragraph">
<p>In Go, the compiler automatically moves a value to the heap if it lives beyond the lifetime of the function call. It is said that the value  <em>escapes</em> to the heap.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span><span class="tok-kd">type</span> <span class="tok-nx">Foo</span> <span class="tok-kd">struct</span> <span class="tok-p">{</span>
	<span class="tok-nx">a</span><span class="tok-p">,</span> <span class="tok-nx">b</span><span class="tok-p">,</span> <span class="tok-nx">c</span><span class="tok-p">,</span> <span class="tok-nx">d</span> <span class="tok-kt">int</span>
<span class="tok-p">}</span>

<span class="tok-kd">func</span> <span class="tok-nx">NewFoo</span><span class="tok-p">()</span> <span class="tok-o">*</span><span class="tok-nx">Foo</span> <span class="tok-p">{</span>
	<span class="tok-k">return</span> <span class="tok-o">&amp;</span><span class="tok-nx">Foo</span><span class="tok-p">{</span><span class="tok-nx">a</span><span class="tok-p">:</span> <span class="tok-mi">3</span><span class="tok-p">,</span> <span class="tok-nx">b</span><span class="tok-p">:</span> <span class="tok-mi">1</span><span class="tok-p">,</span> <span class="tok-nx">c</span><span class="tok-p">:</span> <span class="tok-mi">4</span><span class="tok-p">,</span> <span class="tok-nx">d</span><span class="tok-p">:</span> <span class="tok-mi">7</span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example the <code>Foo</code> allocated in <code>NewFoo</code> will be moved to the heap so its contents remain valid after <code>NewFoo</code> has returned.</p>
</div>
<div class="paragraph">
<p>This has been present since the earliest days of Go.
It isn&#8217;t so much an optimisation as an automatic correctness feature.
Accidentally returning the address of a stack allocated variable is not possible in Go.</p>
</div>
<div class="paragraph">
<p>But the compiler can also do the opposite; it can find things which would be assumed to be allocated on the heap, and move them to stack.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at an example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span><span class="tok-kd">func</span> <span class="tok-nx">Sum</span><span class="tok-p">()</span> <span class="tok-kt">int</span> <span class="tok-p">{</span>
	<span class="tok-kd">const</span> <span class="tok-nx">count</span> <span class="tok-p">=</span> <span class="tok-mi">100</span>
	<span class="tok-nx">numbers</span> <span class="tok-o">:=</span> <span class="tok-nb">make</span><span class="tok-p">([]</span><span class="tok-kt">int</span><span class="tok-p">,</span> <span class="tok-nx">count</span><span class="tok-p">)</span>
	<span class="tok-k">for</span> <span class="tok-nx">i</span> <span class="tok-o">:=</span> <span class="tok-k">range</span> <span class="tok-nx">numbers</span> <span class="tok-p">{</span>
		<span class="tok-nx">numbers</span><span class="tok-p">[</span><span class="tok-nx">i</span><span class="tok-p">]</span> <span class="tok-p">=</span> <span class="tok-nx">i</span> <span class="tok-o">+</span> <span class="tok-mi">1</span>
	<span class="tok-p">}</span>

	<span class="tok-kd">var</span> <span class="tok-nx">sum</span> <span class="tok-kt">int</span>
	<span class="tok-k">for</span> <span class="tok-nx">_</span><span class="tok-p">,</span> <span class="tok-nx">i</span> <span class="tok-o">:=</span> <span class="tok-k">range</span> <span class="tok-nx">numbers</span> <span class="tok-p">{</span>
		<span class="tok-nx">sum</span> <span class="tok-o">+=</span> <span class="tok-nx">i</span>
	<span class="tok-p">}</span>
	<span class="tok-k">return</span> <span class="tok-nx">sum</span>
<span class="tok-p">}</span>

<span class="tok-kd">func</span> <span class="tok-nx">main</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-nx">answer</span> <span class="tok-o">:=</span> <span class="tok-nx">Sum</span><span class="tok-p">()</span>
	<span class="tok-nx">fmt</span><span class="tok-p">.</span><span class="tok-nx">Println</span><span class="tok-p">(</span><span class="tok-nx">answer</span><span class="tok-p">)</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Sum</code> adds the `int`s between 1 and 100 and returns the result.</p>
</div>
<div class="paragraph">
<p>Because the <code>numbers</code> slice is only referenced inside <code>Sum</code>, the compiler will arrange to store the 100 integers for that slice on the stack, rather than the heap. There is no need to garbage collect <code>numbers</code>, it is automatically freed when <code>Sum</code> returns.</p>
</div>
<div class="sect3">
<h4 id="prove_it"><a class="anchor" href="#prove_it"></a><a class="link" href="#prove_it">4.2.1. Prove it!</a></h4>
<div class="paragraph">
<p>To print the compilers escape analysis decisions, use the <code>-m</code> flag.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% go build -gcflags=-m examples/esc/sum.go
# command-line-arguments
examples/esc/sum.go:22:13: inlining call to fmt.Println
examples/esc/sum.go:8:17: Sum make([]int, count) does not escape
examples/esc/sum.go:22:13: answer escapes to heap
examples/esc/sum.go:22:13: io.Writer(os.Stdout) escapes to heap
examples/esc/sum.go:22:13: main []interface {} literal does not escape
&lt;autogenerated&gt;:1: os.(*File).close .this does not escape</code></pre>
</div>
</div>
<div class="paragraph">
<p>Line 8 shows the compiler has correctly deduced that the result of <code>make([]int, 100)</code> does not escape to the heap. The reason it did no</p>
</div>
<div class="paragraph">
<p>The reason line 22 reports that <code>answer</code> escapes to the heap is <code>fmt.Println</code> is a <em>variadic</em> function.
The parameters to a variadic function are <em>boxed</em> into a slice, in this case a <code>[]interface{}</code>, so <code>answer</code> is placed into a interface value because it is referenced by the call to <code>fmt.Println</code>.
Since Go 1.6 the garbage collector requires <em>all</em> values passed via an interface to be pointers, what the compiler sees is <em>approximately</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>var answer = Sum()
fmt.Println([]interface{&amp;answer}...)</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can confirm this using the <code>-gcflags="-m -m"</code> flag. Which returns</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% go build -gcflags='-m -m' examples/esc/sum.go 2&gt;&amp;1 | grep sum.go:22
examples/esc/sum.go:22:13: inlining call to fmt.Println func(...interface {}) (int, error) { return fmt.Fprintln(io.Writer(os.Stdout), fmt.a...) }
examples/esc/sum.go:22:13: answer escapes to heap
examples/esc/sum.go:22:13:      from ~arg0 (assign-pair) at examples/esc/sum.go:22:13
examples/esc/sum.go:22:13: io.Writer(os.Stdout) escapes to heap
examples/esc/sum.go:22:13:      from io.Writer(os.Stdout) (passed to call[argument escapes]) at examples/esc/sum.go:22:13
examples/esc/sum.go:22:13: main []interface {} literal does not escape</code></pre>
</div>
</div>
<div class="paragraph">
<p>In short, don&#8217;t worry about line 22, its not important to this discussion.</p>
</div>
</div>
<div class="sect3">
<h4 id="exercises"><a class="anchor" href="#exercises"></a><a class="link" href="#exercises">4.2.2. Exercises</a></h4>
<div class="ulist">
<ul>
<li>
<p>Does this optimisation hold true for all values of <code>count</code>?</p>
</li>
<li>
<p>Does this optimisation hold true if <code>count</code> is a variable, not a constant?</p>
</li>
<li>
<p>Does this optimisation hold true if <code>count</code> is a parameter to <code>Sum</code>?</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="escape_analysis_continued"><a class="anchor" href="#escape_analysis_continued"></a><a class="link" href="#escape_analysis_continued">4.2.3. Escape analysis (continued)</a></h4>
<div class="paragraph">
<p>This example is a little contrived. It is not intended to be real code, just an example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span><span class="tok-kd">type</span> <span class="tok-nx">Point</span> <span class="tok-kd">struct</span><span class="tok-p">{</span> <span class="tok-nx">X</span><span class="tok-p">,</span> <span class="tok-nx">Y</span> <span class="tok-kt">int</span> <span class="tok-p">}</span>

<span class="tok-kd">const</span> <span class="tok-nx">Width</span> <span class="tok-p">=</span> <span class="tok-mi">640</span>
<span class="tok-kd">const</span> <span class="tok-nx">Height</span> <span class="tok-p">=</span> <span class="tok-mi">480</span>

<span class="tok-kd">func</span> <span class="tok-nx">Center</span><span class="tok-p">(</span><span class="tok-nx">p</span> <span class="tok-o">*</span><span class="tok-nx">Point</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-nx">p</span><span class="tok-p">.</span><span class="tok-nx">X</span> <span class="tok-p">=</span> <span class="tok-nx">Width</span> <span class="tok-o">/</span> <span class="tok-mi">2</span>
	<span class="tok-nx">p</span><span class="tok-p">.</span><span class="tok-nx">Y</span> <span class="tok-p">=</span> <span class="tok-nx">Height</span> <span class="tok-o">/</span> <span class="tok-mi">2</span>
<span class="tok-p">}</span>

<span class="tok-kd">func</span> <span class="tok-nx">NewPoint</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-nx">p</span> <span class="tok-o">:=</span> <span class="tok-nb">new</span><span class="tok-p">(</span><span class="tok-nx">Point</span><span class="tok-p">)</span>
	<span class="tok-nx">Center</span><span class="tok-p">(</span><span class="tok-nx">p</span><span class="tok-p">)</span>
	<span class="tok-nx">fmt</span><span class="tok-p">.</span><span class="tok-nx">Println</span><span class="tok-p">(</span><span class="tok-nx">p</span><span class="tok-p">.</span><span class="tok-nx">X</span><span class="tok-p">,</span> <span class="tok-nx">p</span><span class="tok-p">.</span><span class="tok-nx">Y</span><span class="tok-p">)</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>NewPoint</code> creates a new <code>*Point</code> value, <code>p</code>. We pass <code>p</code> to the <code>Center</code> function which moves the point to a position in the center of the screen. Finally we print the values of <code>p.X</code> and <code>p.Y</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% go build -gcflags=-m examples/esc/center.go
# command-line-arguments
examples/esc/center.go:11:6: can inline Center
examples/esc/center.go:18:8: inlining call to Center
examples/esc/center.go:19:13: inlining call to fmt.Println
examples/esc/center.go:11:13: Center p does not escape
examples/esc/center.go:19:15: p.X escapes to heap
examples/esc/center.go:19:20: p.Y escapes to heap
examples/esc/center.go:19:13: io.Writer(os.Stdout) escapes to heap
examples/esc/center.go:17:10: NewPoint new(Point) does not escape
examples/esc/center.go:19:13: NewPoint []interface {} literal does not escape
&lt;autogenerated&gt;:1: os.(*File).close .this does not escape</code></pre>
</div>
</div>
<div class="paragraph">
<p>Even though <code>p</code> was allocated with the <code>new</code> function, it will not be stored on the heap, because no reference <code>p</code> escapes the <code>Center</code> function.</p>
</div>
<div class="paragraph">
<p><em>Question</em>: What about line 19, if <code>p</code> doesn&#8217;t escape, what is escaping to the heap?</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Write a benchmark to provide that <code>Sum</code> does not allocate.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="inlining"><a class="anchor" href="#inlining"></a><a class="link" href="#inlining">4.3. Inlining</a></h3>
<div class="paragraph">
<p>In Go function calls in have a fixed overhead; stack and preemption checks.</p>
</div>
<div class="paragraph">
<p>Some of this is ameliorated by hardware branch predictors, but it&#8217;s still a cost in terms of function size and clock cycles.</p>
</div>
<div class="paragraph">
<p>Inlining is the classical optimisation that avoids these costs.</p>
</div>
<div class="paragraph">
<p>Until Go 1.11 inlining only worked on <em>leaf functions</em>, a function that does not call another. The justification for this is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If your function does a lot of work, then the preamble overhead will be negligible. That&#8217;s why functions over a certain size (currently some count of instructions, plus a few operations which prevent inlining all together (eg. switch before Go 1.7)</p>
</li>
<li>
<p>Small functions on the other hand pay a fixed overhead for a relatively small amount of useful work performed. These are the functions that inlining targets as they benefit the most.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The other reason is that heavy inlining makes stack traces harder to follow.</p>
</div>
<div class="sect3">
<h4 id="inlining_example"><a class="anchor" href="#inlining_example"></a><a class="link" href="#inlining_example">4.3.1. Inlining (example)</a></h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span><span class="tok-kd">func</span> <span class="tok-nx">Max</span><span class="tok-p">(</span><span class="tok-nx">a</span><span class="tok-p">,</span> <span class="tok-nx">b</span> <span class="tok-kt">int</span><span class="tok-p">)</span> <span class="tok-kt">int</span> <span class="tok-p">{</span>
	<span class="tok-k">if</span> <span class="tok-nx">a</span> <span class="tok-p">&gt;</span> <span class="tok-nx">b</span> <span class="tok-p">{</span>
		<span class="tok-k">return</span> <span class="tok-nx">a</span>
	<span class="tok-p">}</span>
	<span class="tok-k">return</span> <span class="tok-nx">b</span>
<span class="tok-p">}</span>

<span class="tok-kd">func</span> <span class="tok-nx">F</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-kd">const</span> <span class="tok-nx">a</span><span class="tok-p">,</span> <span class="tok-nx">b</span> <span class="tok-p">=</span> <span class="tok-mi">100</span><span class="tok-p">,</span> <span class="tok-mi">20</span>
	<span class="tok-k">if</span> <span class="tok-nx">Max</span><span class="tok-p">(</span><span class="tok-nx">a</span><span class="tok-p">,</span> <span class="tok-nx">b</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-nx">b</span> <span class="tok-p">{</span>
		<span class="tok-nb">panic</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">)</span>
	<span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Again we use the <code>-gcflags=-m</code> flag to view the compilers optimisation decision.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>% go build -gcflags=-m examples/inl/max.go
# command-line-arguments
examples/inl/max.go:4:6: can inline Max
examples/inl/max.go:11:6: can inline F
examples/inl/max.go:13:8: inlining call to Max
examples/inl/max.go:20:6: can inline main
examples/inl/max.go:21:3: inlining call to F
examples/inl/max.go:21:3: inlining call to Max</code></pre>
</div>
</div>
<div class="paragraph">
<p>The compiler printed two lines.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The first at line 3, the declaration of <code>Max</code>, telling us that it can be inlined.</p>
</li>
<li>
<p>The second is reporting that the body of <code>Max</code> has been inlined into the caller at line 12.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><em>Without</em> using the <code>//go:noinline</code> comment, rewrite <code>Max</code> such that it still returns the right answer, but is no longer considered inlineable by the compiler.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="what_does_inlining_look_like"><a class="anchor" href="#what_does_inlining_look_like"></a><a class="link" href="#what_does_inlining_look_like">4.3.2. What does inlining look like?</a></h4>
<div class="paragraph">
<p>Compile <code>max.go</code> and see what the optimised version of <code>F()</code> became.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% go build -gcflags=-S examples/inl/max.go 2&gt;&amp;1 | grep -A5 '"".F STEXT'
"".F STEXT nosplit size=2 args=0x0 locals=0x0
        0x0000 00000 (/Users/dfc/devel/high-performance-go-workshop/examples/inl/max.go:11)     TEXT    "".F(SB), NOSPLIT|ABIInternal, $0-0
        0x0000 00000 (/Users/dfc/devel/high-performance-go-workshop/examples/inl/max.go:11)     FUNCDATA        $0, gclocals·33cdeccccebe80329f1fdbee7f5874cb(SB)
        0x0000 00000 (/Users/dfc/devel/high-performance-go-workshop/examples/inl/max.go:11)     FUNCDATA        $1, gclocals·33cdeccccebe80329f1fdbee7f5874cb(SB)
        0x0000 00000 (/Users/dfc/devel/high-performance-go-workshop/examples/inl/max.go:11)     FUNCDATA        $3, gclocals·33cdeccccebe80329f1fdbee7f5874cb(SB)
        0x0000 00000 (/Users/dfc/devel/high-performance-go-workshop/examples/inl/max.go:13)     PCDATA  $2, $0</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the body of <code>F</code> once <code>Max</code> has been inlined into it&#8201;&#8212;&#8201;there&#8217;s nothing happening in this function.
I know there&#8217;s a lot of text on the screen for nothing, but take my word for it, the only thing happening is the <code>RET</code>.
In effect <code>F</code> became:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="go"><span></span><span class="tok-kd">func</span> <span class="tok-nx">F</span><span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-k">return</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">What are FUNCDATA and PCDATA?</div>
<div class="paragraph">
<p>The output from <code>-S</code> is not the final machine code that goes into your binary.
The linker does some processing during the final link stage.
Lines like <code>FUNCDATA</code> and <code>PCDATA</code> are metadata for the garbage collector which are moved elsewhere when linking.
If you&#8217;re reading the output of <code>-S</code>, just ignore <code>FUNCDATA</code> and <code>PCDATA</code> lines; they&#8217;re not part of the final binary.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="discussion_2"><a class="anchor" href="#discussion_2"></a><a class="link" href="#discussion_2">4.3.3. Discussion</a></h4>
<div class="paragraph">
<p>Why did I declare <code>a</code> and <code>b</code> in <code>F()</code> to be constants?</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Experiment with the output of What happens if <code>a</code> and <code>b</code> are declared as  are variables?  What happens if <code>a</code> and <code>b</code> are passing into <code>F()</code> as parameters?</p>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>-gcflags=-S</code> doesn&#8217;t prevent the final binary being build in your working directory. If you find that subsequent runs of <code>go build &#8230;&#8203;</code> produce no output, delete the <code>./max</code> binary in your working directory.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="adjusting_the_level_of_inlining"><a class="anchor" href="#adjusting_the_level_of_inlining"></a><a class="link" href="#adjusting_the_level_of_inlining">4.3.4. Adjusting the level of inlining</a></h4>
<div class="paragraph">
<p>Adjusting the <em>inlining level</em> is performed with the <code>-gcflags=-l</code> flag. Somewhat confusingly passing a single <code>-l</code> will disable inlining, and two or more will enable inlining at more aggressive settings.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-gcflags=-l</code>, inlining disabled.</p>
</li>
<li>
<p>nothing, regular inlining.</p>
</li>
<li>
<p><code>-gcflags='-l -l'</code> inlining level 2, more aggressive, might be faster, may make bigger binaries.</p>
</li>
<li>
<p><code>-gcflags='-l -l -l'</code> inlining level 3, more aggressive again, binaries definitely bigger, maybe faster again, but might also be buggy.</p>
</li>
<li>
<p><code>-gcflags=-l=4</code> (four `-l`s) in Go 1.11 will enable the experimental <a href="https://github.com/golang/go/issues/19348#issuecomment-393654429"><em>mid stack</em> inlining optimisation</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="mid_stack_inlining"><a class="anchor" href="#mid_stack_inlining"></a><a class="link" href="#mid_stack_inlining">4.3.5. Mid Stack inlining</a></h4>
<div class="paragraph">
<p>Since Go 1.12 so called <em>mid stack</em> inlining has been enabled (it was previously available in preview in Go 1.11 with the <code>-gcflags='-l -l -l -l'</code> flag).</p>
</div>
<div class="paragraph">
<p>We can see an example of mid stack inlining in the previous example. In Go 1.11 and earlier <code>F</code> would not have been a leaf function&#8201;&#8212;&#8201;it called <code>max</code>.
However because of inlining improvements <code>F</code> is now inlined into its caller.
This is for two reasons;
. When <code>max</code> is inlined into <code>F</code>, <code>F</code> contains no other function calls thus it becomes a potential <em>leaf function</em>, assuming its complexity budget has not been exceeded.
. Because <code>F</code> is a simple function&#8212;&#8203;inlining and dead code elimination has eliminated much of its complexity budget&#8212;&#8203;it is eligable for <em>mid stack</em> inlining irrispective of calling <code>max</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Mid stack inlining can be used to inline the fast path of a function, eliminating the function call overhead in the fast path.
<a href="https://go-review.googlesource.com/c/go/+/152698">This recent CL which landed in for Go 1.13</a> shows this technique applied to <code>sync.RWMutex.Unlock()</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="further_reading_3"><a class="anchor" href="#further_reading_3"></a><a class="link" href="#further_reading_3">Further reading</a></h5>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.google.com/presentation/d/1Wcblp3jpfeKwA0Y4FOmj63PW52M_qmNqlQkNaLj0P5o/edit#slide=id.p">Mid-stack inlining in the Go compiler presentation by David Lazar</a></p>
</li>
<li>
<p><a href="https://github.com/golang/proposal/blob/master/design/19348-midstack-inlining.md">Proposal: Mid-stack inlining in the Go compiler</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dead_code_elimination"><a class="anchor" href="#dead_code_elimination"></a><a class="link" href="#dead_code_elimination">4.4. Dead code elimination</a></h3>
<div class="paragraph">
<p>Why is it important that <code>a</code> and <code>b</code> are constants?</p>
</div>
<div class="paragraph">
<p>To understand what happened lets look at what the compiler sees once its inlined <code>Max</code> into <code>F</code>. We can&#8217;t get this from the compiler easily, but it&#8217;s straight forward to do it by hand.</p>
</div>
<div class="paragraph">
<p>Before:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span><span class="tok-kd">func</span> <span class="tok-nx">Max</span><span class="tok-p">(</span><span class="tok-nx">a</span><span class="tok-p">,</span> <span class="tok-nx">b</span> <span class="tok-kt">int</span><span class="tok-p">)</span> <span class="tok-kt">int</span> <span class="tok-p">{</span>
	<span class="tok-k">if</span> <span class="tok-nx">a</span> <span class="tok-p">&gt;</span> <span class="tok-nx">b</span> <span class="tok-p">{</span>
		<span class="tok-k">return</span> <span class="tok-nx">a</span>
	<span class="tok-p">}</span>
	<span class="tok-k">return</span> <span class="tok-nx">b</span>
<span class="tok-p">}</span>

<span class="tok-kd">func</span> <span class="tok-nx">F</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-kd">const</span> <span class="tok-nx">a</span><span class="tok-p">,</span> <span class="tok-nx">b</span> <span class="tok-p">=</span> <span class="tok-mi">100</span><span class="tok-p">,</span> <span class="tok-mi">20</span>
	<span class="tok-k">if</span> <span class="tok-nx">Max</span><span class="tok-p">(</span><span class="tok-nx">a</span><span class="tok-p">,</span> <span class="tok-nx">b</span><span class="tok-p">)</span> <span class="tok-o">==</span> <span class="tok-nx">b</span> <span class="tok-p">{</span>
		<span class="tok-nb">panic</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">)</span>
	<span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span><span class="tok-kd">func</span> <span class="tok-nx">F</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-kd">const</span> <span class="tok-nx">a</span><span class="tok-p">,</span> <span class="tok-nx">b</span> <span class="tok-p">=</span> <span class="tok-mi">100</span><span class="tok-p">,</span> <span class="tok-mi">20</span>
	<span class="tok-kd">var</span> <span class="tok-nx">result</span> <span class="tok-kt">int</span>
	<span class="tok-k">if</span> <span class="tok-nx">a</span> <span class="tok-p">&gt;</span> <span class="tok-nx">b</span> <span class="tok-p">{</span>
		<span class="tok-nx">result</span> <span class="tok-p">=</span> <span class="tok-nx">a</span>
	<span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
		<span class="tok-nx">result</span> <span class="tok-p">=</span> <span class="tok-nx">b</span>
	<span class="tok-p">}</span>
	<span class="tok-k">if</span> <span class="tok-nx">result</span> <span class="tok-o">==</span> <span class="tok-nx">b</span> <span class="tok-p">{</span>
		<span class="tok-nb">panic</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">)</span>
	<span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Because <code>a</code> and <code>b</code> are constants the compiler can prove at compile time that the branch will never be false; <code>100</code> is always greater than <code>20</code>.
So the compiler can further optimise <code>F</code> to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span><span class="tok-kd">func</span> <span class="tok-nx">F</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-kd">const</span> <span class="tok-nx">a</span><span class="tok-p">,</span> <span class="tok-nx">b</span> <span class="tok-p">=</span> <span class="tok-mi">100</span><span class="tok-p">,</span> <span class="tok-mi">20</span>
	<span class="tok-kd">var</span> <span class="tok-nx">result</span> <span class="tok-kt">int</span>
	<span class="tok-k">if</span> <span class="tok-kc">true</span> <span class="tok-p">{</span>
		<span class="tok-nx">result</span> <span class="tok-p">=</span> <span class="tok-nx">a</span>
	<span class="tok-p">}</span> <span class="tok-k">else</span> <span class="tok-p">{</span>
		<span class="tok-nx">result</span> <span class="tok-p">=</span> <span class="tok-nx">b</span>
	<span class="tok-p">}</span>
	<span class="tok-k">if</span> <span class="tok-nx">result</span> <span class="tok-o">==</span> <span class="tok-nx">b</span> <span class="tok-p">{</span>
		<span class="tok-nb">panic</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">)</span>
	<span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that the result of the branch is know then then the contents of <code>result</code> are also known. This is call <em>branch elimination</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span><span class="tok-kd">func</span> <span class="tok-nx">F</span><span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-kd">const</span> <span class="tok-nx">a</span><span class="tok-p">,</span> <span class="tok-nx">b</span> <span class="tok-p">=</span> <span class="tok-mi">100</span><span class="tok-p">,</span> <span class="tok-mi">20</span>
        <span class="tok-kd">const</span> <span class="tok-nx">result</span> <span class="tok-p">=</span> <span class="tok-nx">a</span>
        <span class="tok-k">if</span> <span class="tok-nx">result</span> <span class="tok-o">==</span> <span class="tok-nx">b</span> <span class="tok-p">{</span>
                <span class="tok-nb">panic</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">)</span>
        <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the branch is eliminated we know that <code>result</code> is always equal to <code>a</code>, and because <code>a</code> was a constant, we know that <code>result</code> is a constant. The compiler applies this proof to the second branch</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span><span class="tok-kd">func</span> <span class="tok-nx">F</span><span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-kd">const</span> <span class="tok-nx">a</span><span class="tok-p">,</span> <span class="tok-nx">b</span> <span class="tok-p">=</span> <span class="tok-mi">100</span><span class="tok-p">,</span> <span class="tok-mi">20</span>
        <span class="tok-kd">const</span> <span class="tok-nx">result</span> <span class="tok-p">=</span> <span class="tok-nx">a</span>
        <span class="tok-k">if</span> <span class="tok-kc">false</span> <span class="tok-p">{</span>
                <span class="tok-nb">panic</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">)</span>
        <span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And using branch elimination again the final form of <code>F</code> is reduced to.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span><span class="tok-kd">func</span> <span class="tok-nx">F</span><span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-kd">const</span> <span class="tok-nx">a</span><span class="tok-p">,</span> <span class="tok-nx">b</span> <span class="tok-p">=</span> <span class="tok-mi">100</span><span class="tok-p">,</span> <span class="tok-mi">20</span>
        <span class="tok-kd">const</span> <span class="tok-nx">result</span> <span class="tok-p">=</span> <span class="tok-nx">a</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And finally just</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span><span class="tok-kd">func</span> <span class="tok-nx">F</span><span class="tok-p">()</span> <span class="tok-p">{</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="dead_code_elimination_cont"><a class="anchor" href="#dead_code_elimination_cont"></a><a class="link" href="#dead_code_elimination_cont">4.4.1. Dead code elimination (cont.)</a></h4>
<div class="paragraph">
<p>Branch elimination is one of a category of optimisations known as <em>dead code elimination</em>. In effect, using static proofs to show that a piece of code is never reachable, colloquially known as <em>dead</em>, therefore it need not be compiled, optimised, or emitted in the final binary.</p>
</div>
<div class="paragraph">
<p>We saw how dead code elimination works together with inlining to reduce the amount of code generated by removing loops and branches that are proven unreachable.</p>
</div>
<div class="paragraph">
<p>You can take advantage of this to implement expensive debugging, and hide it behind</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span><span class="tok-kd">const</span> <span class="tok-nx">debug</span> <span class="tok-p">=</span> <span class="tok-kc">false</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Combined with build tags this can be very useful.</p>
</div>
</div>
<div class="sect3">
<h4 id="further_reading_4"><a class="anchor" href="#further_reading_4"></a><a class="link" href="#further_reading_4">4.4.2. Further reading</a></h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://dave.cheney.net/2014/09/28/using-build-to-switch-between-debug-and-release">Using // +build to switch between debug and release builds</a></p>
</li>
<li>
<p><a href="http://dave.cheney.net/2013/10/12/how-to-use-conditional-compilation-with-the-go-build-tool">How to use conditional compilation with the go build tool</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="compiler_flags_exercises"><a class="anchor" href="#compiler_flags_exercises"></a><a class="link" href="#compiler_flags_exercises">4.5. Compiler flags Exercises</a></h3>
<div class="paragraph">
<p>Compiler flags are provided with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>go build -gcflags=$FLAGS</code></pre>
</div>
</div>
<div class="paragraph">
<p>Investigate the operation of the following compiler functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-S</code> prints the (Go flavoured) assembly of the <em>package</em> being compiled.</p>
</li>
<li>
<p><code>-l</code> controls the behaviour of the inliner; <code>-l</code> disables inlining, <code>-l -l</code> increases it (more <code>-l</code> 's increases the compiler&#8217;s appetite for inlining code). Experiment with the difference in compile time, program size, and run time.</p>
</li>
<li>
<p><code>-m</code> controls printing of optimisation decision like inlining, escape analysis. <code>-m</code>-m` prints more details about what the compiler was thinking.</p>
</li>
<li>
<p><code>-l -N</code> disables all optimisations.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you find that subsequent runs of <code>go build &#8230;&#8203;</code> produce no output, delete the <code>./max</code> binary in your working directory.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="further_reading_5"><a class="anchor" href="#further_reading_5"></a><a class="link" href="#further_reading_5">4.5.1. Further reading</a></h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://go-talks.appspot.com/github.com/rakyll/talks/gcinspect/talk.slide#1">Codegen Inspection by Jaana Burcu Dogan</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bounds_check_elimination"><a class="anchor" href="#bounds_check_elimination"></a><a class="link" href="#bounds_check_elimination">4.6. Bounds check elimination</a></h3>
<div class="paragraph">
<p>Go is a bounds checked language.
This means array and slice subscript operations are checked to ensure they are within the bounds of the respective types.</p>
</div>
<div class="paragraph">
<p>For arrays, this can be done at compile time.
For slices, this must be done at run time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span><span class="tok-kd">var</span> <span class="tok-nx">v</span> <span class="tok-p">=</span> <span class="tok-nb">make</span><span class="tok-p">([]</span><span class="tok-kt">int</span><span class="tok-p">,</span> <span class="tok-mi">9</span><span class="tok-p">)</span>

<span class="tok-kd">var</span> <span class="tok-nx">A</span><span class="tok-p">,</span> <span class="tok-nx">B</span><span class="tok-p">,</span> <span class="tok-nx">C</span><span class="tok-p">,</span> <span class="tok-nx">D</span><span class="tok-p">,</span> <span class="tok-nx">E</span><span class="tok-p">,</span> <span class="tok-nx">F</span><span class="tok-p">,</span> <span class="tok-nx">G</span><span class="tok-p">,</span> <span class="tok-nx">H</span><span class="tok-p">,</span> <span class="tok-nx">I</span> <span class="tok-kt">int</span>

<span class="tok-kd">func</span> <span class="tok-nx">BenchmarkBoundsCheckInOrder</span><span class="tok-p">(</span><span class="tok-nx">b</span> <span class="tok-o">*</span><span class="tok-nx">testing</span><span class="tok-p">.</span><span class="tok-nx">B</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-k">for</span> <span class="tok-nx">n</span> <span class="tok-o">:=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-nx">n</span> <span class="tok-p">&lt;</span> <span class="tok-nx">b</span><span class="tok-p">.</span><span class="tok-nx">N</span><span class="tok-p">;</span> <span class="tok-nx">n</span><span class="tok-o">++</span> <span class="tok-p">{</span>
		<span class="tok-nx">A</span> <span class="tok-p">=</span> <span class="tok-nx">v</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">]</span>
		<span class="tok-nx">B</span> <span class="tok-p">=</span> <span class="tok-nx">v</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">]</span>
		<span class="tok-nx">C</span> <span class="tok-p">=</span> <span class="tok-nx">v</span><span class="tok-p">[</span><span class="tok-mi">2</span><span class="tok-p">]</span>
		<span class="tok-nx">D</span> <span class="tok-p">=</span> <span class="tok-nx">v</span><span class="tok-p">[</span><span class="tok-mi">3</span><span class="tok-p">]</span>
		<span class="tok-nx">E</span> <span class="tok-p">=</span> <span class="tok-nx">v</span><span class="tok-p">[</span><span class="tok-mi">4</span><span class="tok-p">]</span>
		<span class="tok-nx">F</span> <span class="tok-p">=</span> <span class="tok-nx">v</span><span class="tok-p">[</span><span class="tok-mi">5</span><span class="tok-p">]</span>
		<span class="tok-nx">G</span> <span class="tok-p">=</span> <span class="tok-nx">v</span><span class="tok-p">[</span><span class="tok-mi">6</span><span class="tok-p">]</span>
		<span class="tok-nx">H</span> <span class="tok-p">=</span> <span class="tok-nx">v</span><span class="tok-p">[</span><span class="tok-mi">7</span><span class="tok-p">]</span>
		<span class="tok-nx">I</span> <span class="tok-p">=</span> <span class="tok-nx">v</span><span class="tok-p">[</span><span class="tok-mi">8</span><span class="tok-p">]</span>
	<span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Use <code>-gcflags=-S</code> to disassemble <code>BenchmarkBoundsCheckInOrder</code>. How many bounds check operations are performed per loop?</p>
</div>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span><span class="tok-kd">func</span> <span class="tok-nx">BenchmarkBoundsCheckOutOfOrder</span><span class="tok-p">(</span><span class="tok-nx">b</span> <span class="tok-o">*</span><span class="tok-nx">testing</span><span class="tok-p">.</span><span class="tok-nx">B</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-k">for</span> <span class="tok-nx">n</span> <span class="tok-o">:=</span> <span class="tok-mi">0</span><span class="tok-p">;</span> <span class="tok-nx">n</span> <span class="tok-p">&lt;</span> <span class="tok-nx">b</span><span class="tok-p">.</span><span class="tok-nx">N</span><span class="tok-p">;</span> <span class="tok-nx">n</span><span class="tok-o">++</span> <span class="tok-p">{</span>
		<span class="tok-nx">I</span> <span class="tok-p">=</span> <span class="tok-nx">v</span><span class="tok-p">[</span><span class="tok-mi">8</span><span class="tok-p">]</span>
		<span class="tok-nx">A</span> <span class="tok-p">=</span> <span class="tok-nx">v</span><span class="tok-p">[</span><span class="tok-mi">0</span><span class="tok-p">]</span>
		<span class="tok-nx">B</span> <span class="tok-p">=</span> <span class="tok-nx">v</span><span class="tok-p">[</span><span class="tok-mi">1</span><span class="tok-p">]</span>
		<span class="tok-nx">C</span> <span class="tok-p">=</span> <span class="tok-nx">v</span><span class="tok-p">[</span><span class="tok-mi">2</span><span class="tok-p">]</span>
		<span class="tok-nx">D</span> <span class="tok-p">=</span> <span class="tok-nx">v</span><span class="tok-p">[</span><span class="tok-mi">3</span><span class="tok-p">]</span>
		<span class="tok-nx">E</span> <span class="tok-p">=</span> <span class="tok-nx">v</span><span class="tok-p">[</span><span class="tok-mi">4</span><span class="tok-p">]</span>
		<span class="tok-nx">F</span> <span class="tok-p">=</span> <span class="tok-nx">v</span><span class="tok-p">[</span><span class="tok-mi">5</span><span class="tok-p">]</span>
		<span class="tok-nx">G</span> <span class="tok-p">=</span> <span class="tok-nx">v</span><span class="tok-p">[</span><span class="tok-mi">6</span><span class="tok-p">]</span>
		<span class="tok-nx">H</span> <span class="tok-p">=</span> <span class="tok-nx">v</span><span class="tok-p">[</span><span class="tok-mi">7</span><span class="tok-p">]</span>
	<span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Does rearranging the order in which we assign the <code>A</code> through <code>I</code> affect the assembly. Disassemble <code>BenchmarkBoundsCheckOutOfOrder</code> and find out.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="exercises_2"><a class="anchor" href="#exercises_2"></a><a class="link" href="#exercises_2">4.6.1. Exercises</a></h4>
<div class="ulist">
<ul>
<li>
<p>Does rearranging the order of subscript operations affect the size of the function? Does it affect the speed of the function?</p>
</li>
<li>
<p>What happens if <code>v</code> is moved inside the <code>Benchmark</code> function?</p>
</li>
<li>
<p>What happens if <code>v</code> was declared as an array, <code>var v [9]int</code>?</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="execution-tracer"><a class="anchor" href="#execution-tracer"></a><a class="link" href="#execution-tracer">5. Execution Tracer</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The execution tracer was developed by <a href="https://github.com/dvyukov">Dmitry Vyukov</a> for Go 1.5 and remained under documented, and under utilised, for several years.</p>
</div>
<div class="paragraph">
<p>Unlike sample based profiling, the execution tracer is integrated into the Go runtime, so it does just know what a Go program is doing at a particular point in time, but <em>why</em>.</p>
</div>
<div class="sect2">
<h3 id="what_is_the_execution_tracer_why_do_we_need_it"><a class="anchor" href="#what_is_the_execution_tracer_why_do_we_need_it"></a><a class="link" href="#what_is_the_execution_tracer_why_do_we_need_it">5.1. What is the execution tracer, why do we need it?</a></h3>
<div class="paragraph">
<p>I think its easiest to explain what the execution tracer does, and why it&#8217;s important by looking at a piece of code where the pprof, <code>go tool pprof</code> performs poorly.</p>
</div>
<div class="paragraph">
<p>The <code>examples/mandelbrot</code> directory contains a simple mandelbrot generator.
This code is derived from <a href="https://github.com/campoy/mandelbrot">Francesc Campoy&#8217;s mandelbrot package</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>cd examples/mandelbrot
go build &amp;&amp; ./mandelbrot</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we build it, then run it, it generates something like this</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mandelbrot.png" alt="mandelbrot">
</div>
</div>
<div class="sect3">
<h4 id="how_long_does_it_take"><a class="anchor" href="#how_long_does_it_take"></a><a class="link" href="#how_long_does_it_take">5.1.1. How long does it take?</a></h4>
<div class="paragraph">
<p>So, how long does this program take to generate a 1024 x 1024 pixel image?</p>
</div>
<div class="paragraph">
<p>The simplest way I know how to do this is to use something like <code>time(1)</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>% time ./mandelbrot
real    0m1.654s
user    0m1.630s
sys     0m0.015s</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Don&#8217;t use <code>time go run mandebrot.go</code> or you&#8217;ll time how long it takes to <em>compile</em> the program as well as run it.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="what_is_the_program_doing"><a class="anchor" href="#what_is_the_program_doing"></a><a class="link" href="#what_is_the_program_doing">5.1.2. What is the program doing?</a></h4>
<div class="paragraph">
<p>So, in this example the program took 1.6 seconds to generate the mandelbrot and write to to a png.</p>
</div>
<div class="paragraph">
<p>Is that good? Could we make it faster?</p>
</div>
<div class="paragraph">
<p>One way to answer that question would be to use Go&#8217;s built in pprof support to profile the program.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s try that.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="generating_the_profile"><a class="anchor" href="#generating_the_profile"></a><a class="link" href="#generating_the_profile">5.2. Generating the profile</a></h3>
<div class="paragraph">
<p>To turn generate a profile we need to either</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the <code>runtime/pprof</code> package directly.</p>
</li>
<li>
<p>Use a wrapper like <code>github.com/pkg/profile</code> to automate this.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="generating_a_profile_with_runtimepprof"><a class="anchor" href="#generating_a_profile_with_runtimepprof"></a><a class="link" href="#generating_a_profile_with_runtimepprof">5.3. Generating a profile with runtime/pprof</a></h3>
<div class="paragraph">
<p>To show you that there&#8217;s no magic, let&#8217;s modify the program to write a CPU profile to <code>os.Stdout</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span>
<span class="tok-kn">import</span> <span class="tok-s">&quot;runtime/pprof&quot;</span>

<span class="tok-kd">func</span> <span class="tok-nx">main</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-nx">pprof</span><span class="tok-p">.</span><span class="tok-nx">StartCPUProfile</span><span class="tok-p">(</span><span class="tok-nx">os</span><span class="tok-p">.</span><span class="tok-nx">Stdout</span><span class="tok-p">)</span>
	<span class="tok-k">defer</span> <span class="tok-nx">pprof</span><span class="tok-p">.</span><span class="tok-nx">StopCPUProfile</span><span class="tok-p">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By adding this code to the top of the <code>main</code> function, this program will write a profile to <code>os.Stdout</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>cd examples/mandelbrot-runtime-pprof
go run mandelbrot.go &gt; cpu.pprof</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We can use <code>go run</code> in this case because the cpu profile will only include the execution of <code>mandelbrot.go</code>, not its compilation.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="generating_a_profile_with_github_compkgprofile"><a class="anchor" href="#generating_a_profile_with_github_compkgprofile"></a><a class="link" href="#generating_a_profile_with_github_compkgprofile">5.3.1. Generating a profile with github.com/pkg/profile</a></h4>
<div class="paragraph">
<p>The previous slide showed a super cheap way to generate a profile, but it has a few problems.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you forget to redirect the output to a file then you&#8217;ll blow up that terminal session. 😞 (hint: <code>reset(1)</code> is your friend)</p>
</li>
<li>
<p>If you write anything else to <code>os.Stdout</code>, for example, <code>fmt.Println</code> you&#8217;ll corrupt the trace.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The recommended way to use <code>runtime/pprof</code> is to <a href="https://godoc.org/runtime/pprof#hdr-Profiling_a_Go_program">write the trace to a file</a>.
But, then you have to make sure the trace is stopped, and file is closed before your program stops, including if someone `^C&#8217;s it.</p>
</div>
<div class="paragraph">
<p>So, a few years ago I wrote a <a href="https://godoc.org/github.gom/pkg/profile">package</a> to take care of it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span>
<span class="tok-kn">import</span> <span class="tok-s">&quot;github.com/pkg/profile&quot;</span>

<span class="tok-kd">func</span> <span class="tok-nx">main</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-k">defer</span> <span class="tok-nx">profile</span><span class="tok-p">.</span><span class="tok-nx">Start</span><span class="tok-p">(</span><span class="tok-nx">profile</span><span class="tok-p">.</span><span class="tok-nx">CPUProfile</span><span class="tok-p">,</span> <span class="tok-nx">profile</span><span class="tok-p">.</span><span class="tok-nx">ProfilePath</span><span class="tok-p">(</span><span class="tok-s">&quot;.&quot;</span><span class="tok-p">)).</span><span class="tok-nx">Stop</span><span class="tok-p">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we run this version, we get a profile written to the current working directory</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>% go run mandelbrot.go
2017/09/17 12:22:06 profile: cpu profiling enabled, cpu.pprof
2017/09/17 12:22:08 profile: cpu profiling disabled, cpu.pprof</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Using <code>pkg/profile</code> is not mandatory, but it takes care of a lot of the boilerplate around collecting and recording traces, so we&#8217;ll use it for the rest of this workshop.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="analysing_the_profile"><a class="anchor" href="#analysing_the_profile"></a><a class="link" href="#analysing_the_profile">5.3.2. Analysing the profile</a></h4>
<div class="paragraph">
<p>Now we have a profile, we can use <code>go tool pprof</code> to analyse it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>% go tool pprof -http=:8080 cpu.pprof</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this run we see that the program ran for 1.81s seconds (profiling adds a small overhead).
We can also see that pprof only captured data for 1.53 seconds, as pprof is sample based, relying on the operating system&#8217;s <code>SIGPROF</code> timer.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Since Go 1.9 the <code>pprof</code> trace contains all the information you need to analyse the trace. You no longer need to also have the matching binary which produced the trace. 🎉
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We can use the <code>top</code> pprof function to sort functions recorded by the trace</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% go tool pprof cpu.pprof
Type: cpu
Time: Mar 24, 2019 at 5:18pm (CET)
Duration: 2.16s, Total samples = 1.91s (88.51%)
Entering interactive mode (type "help" for commands, "o" for options)
(pprof) top
Showing nodes accounting for 1.90s, 99.48% of 1.91s total
Showing top 10 nodes out of 35
      flat  flat%   sum%        cum   cum%
     0.82s 42.93% 42.93%      1.63s 85.34%  main.fillPixel
     0.81s 42.41% 85.34%      0.81s 42.41%  main.paint
     0.11s  5.76% 91.10%      0.12s  6.28%  runtime.mallocgc
     0.04s  2.09% 93.19%      0.04s  2.09%  runtime.memmove
     0.04s  2.09% 95.29%      0.04s  2.09%  runtime.nanotime
     0.03s  1.57% 96.86%      0.03s  1.57%  runtime.pthread_cond_signal
     0.02s  1.05% 97.91%      0.04s  2.09%  compress/flate.(*compressor).deflate
     0.01s  0.52% 98.43%      0.01s  0.52%  compress/flate.(*compressor).findMatch
     0.01s  0.52% 98.95%      0.01s  0.52%  compress/flate.hash4
     0.01s  0.52% 99.48%      0.01s  0.52%  image/png.filter</code></pre>
</div>
</div>
<div class="paragraph">
<p>We see that the <code>main.fillPixel</code> function was on the CPU the most when pprof captured the stack.</p>
</div>
<div class="paragraph">
<p>Finding <code>main.paint</code> on the stack isn&#8217;t a surprise, this is what the program does; it paints pixels. But what is causing <code>paint</code> to spend so much time? We can check that with the <em>cummulative</em> flag to <code>top</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>(pprof) top --cum
Showing nodes accounting for 1630ms, 85.34% of 1910ms total
Showing top 10 nodes out of 35
      flat  flat%   sum%        cum   cum%
         0     0%     0%     1840ms 96.34%  main.main
         0     0%     0%     1840ms 96.34%  runtime.main
     820ms 42.93% 42.93%     1630ms 85.34%  main.fillPixel
         0     0% 42.93%     1630ms 85.34%  main.seqFillImg
     810ms 42.41% 85.34%      810ms 42.41%  main.paint
         0     0% 85.34%      210ms 10.99%  image/png.(*Encoder).Encode
         0     0% 85.34%      210ms 10.99%  image/png.Encode
         0     0% 85.34%      160ms  8.38%  main.(*img).At
         0     0% 85.34%      160ms  8.38%  runtime.convT2Inoptr
         0     0% 85.34%      150ms  7.85%  image/png.(*encoder).writeIDATs</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is sort of suggesting that <code>main.fillPixed</code> is actually doing most of the work.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can also visualise the profile with the <code>web</code> command, which looks like this:</p>
</div>
<div class="imageblock">
<div class="content">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="100%px" height="100%px">
<script type="text/ecmascript"><![CDATA[
/**
 *  SVGPan library 1.2.1
 * ======================
 *
 * Given an unique existing element with id "viewport" (or when missing, the first g
 * element), including the the library into any SVG adds the following capabilities:
 *
 *  - Mouse panning
 *  - Mouse zooming (using the wheel)
 *  - Object dragging
 *
 * You can configure the behaviour of the pan/zoom/drag with the variables
 * listed in the CONFIGURATION section of this file.
 *
 * Known issues:
 *
 *  - Zooming (while panning) on Safari has still some issues
 *
 * Releases:
 *
 * 1.2.1, Mon Jul  4 00:33:18 CEST 2011, Andrea Leofreddi
 *	- Fixed a regression with mouse wheel (now working on Firefox 5)
 *	- Working with viewBox attribute (#4)
 *	- Added "use strict;" and fixed resulting warnings (#5)
 *	- Added configuration variables, dragging is disabled by default (#3)
 *
 * 1.2, Sat Mar 20 08:42:50 GMT 2010, Zeng Xiaohui
 *	Fixed a bug with browser mouse handler interaction
 *
 * 1.1, Wed Feb  3 17:39:33 GMT 2010, Zeng Xiaohui
 *	Updated the zoom code to support the mouse wheel on Safari/Chrome
 *
 * 1.0, Andrea Leofreddi
 *	First release
 *
 * This code is licensed under the following BSD license:
 *
 * Copyright 2009-2010 Andrea Leofreddi <a.leofreddi@itcharm.com>. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification, are
 * permitted provided that the following conditions are met:
 *
 *    1. Redistributions of source code must retain the above copyright notice, this list of
 *       conditions and the following disclaimer.
 *
 *    2. Redistributions in binary form must reproduce the above copyright notice, this list
 *       of conditions and the following disclaimer in the documentation and/or other materials
 *       provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY Andrea Leofreddi ``AS IS'' AND ANY EXPRESS OR IMPLIED
 * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
 * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL Andrea Leofreddi OR
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
 * ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * The views and conclusions contained in the software and documentation are those of the
 * authors and should not be interpreted as representing official policies, either expressed
 * or implied, of Andrea Leofreddi.
 */

"use strict";

/// CONFIGURATION
/// ====>

var enablePan = 1; // 1 or 0: enable or disable panning (default enabled)
var enableZoom = 1; // 1 or 0: enable or disable zooming (default enabled)
var enableDrag = 0; // 1 or 0: enable or disable dragging (default disabled)

/// <====
/// END OF CONFIGURATION

var root = document.documentElement;

var state = 'none', svgRoot, stateTarget, stateOrigin, stateTf;

setupHandlers(root);

/**
 * Register handlers
 */
function setupHandlers(root){
	setAttributes(root, {
		"onmouseup" : "handleMouseUp(evt)",
		"onmousedown" : "handleMouseDown(evt)",
		"onmousemove" : "handleMouseMove(evt)",
		//"onmouseout" : "handleMouseUp(evt)", // Decomment this to stop the pan functionality when dragging out of the SVG element
	});

	if(navigator.userAgent.toLowerCase().indexOf('webkit') >= 0)
		window.addEventListener('mousewheel', handleMouseWheel, false); // Chrome/Safari
	else
		window.addEventListener('DOMMouseScroll', handleMouseWheel, false); // Others
}

/**
 * Retrieves the root element for SVG manipulation. The element is then cached into the svgRoot global variable.
 */
function getRoot(root) {
	if(typeof(svgRoot) == "undefined") {
		var g = null;

		g = root.getElementById("viewport");

		if(g == null)
			g = root.getElementsByTagName('g')[0];

		if(g == null)
			alert('Unable to obtain SVG root element');

		setCTM(g, g.getCTM());

		g.removeAttribute("viewBox");

		svgRoot = g;
	}

	return svgRoot;
}

/**
 * Instance an SVGPoint object with given event coordinates.
 */
function getEventPoint(evt) {
	var p = root.createSVGPoint();

	p.x = evt.clientX;
	p.y = evt.clientY;

	return p;
}

/**
 * Sets the current transform matrix of an element.
 */
function setCTM(element, matrix) {
	var s = "matrix(" + matrix.a + "," + matrix.b + "," + matrix.c + "," + matrix.d + "," + matrix.e + "," + matrix.f + ")";

	element.setAttribute("transform", s);
}

/**
 * Dumps a matrix to a string (useful for debug).
 */
function dumpMatrix(matrix) {
	var s = "[ " + matrix.a + ", " + matrix.c + ", " + matrix.e + "\n  " + matrix.b + ", " + matrix.d + ", " + matrix.f + "\n  0, 0, 1 ]";

	return s;
}

/**
 * Sets attributes of an element.
 */
function setAttributes(element, attributes){
	for (var i in attributes)
		element.setAttributeNS(null, i, attributes[i]);
}

/**
 * Handle mouse wheel event.
 */
function handleMouseWheel(evt) {
	if(!enableZoom)
		return;

	if(evt.preventDefault)
		evt.preventDefault();

	evt.returnValue = false;

	var svgDoc = evt.target.ownerDocument;

	var delta;

	if(evt.wheelDelta)
		delta = evt.wheelDelta / 3600; // Chrome/Safari
	else
		delta = evt.detail / -90; // Mozilla

	var z = 1 + delta; // Zoom factor: 0.9/1.1

	var g = getRoot(svgDoc);

	var p = getEventPoint(evt);

	p = p.matrixTransform(g.getCTM().inverse());

	// Compute new scale matrix in current mouse position
	var k = root.createSVGMatrix().translate(p.x, p.y).scale(z).translate(-p.x, -p.y);

        setCTM(g, g.getCTM().multiply(k));

	if(typeof(stateTf) == "undefined")
		stateTf = g.getCTM().inverse();

	stateTf = stateTf.multiply(k.inverse());
}

/**
 * Handle mouse move event.
 */
function handleMouseMove(evt) {
	if(evt.preventDefault)
		evt.preventDefault();

	evt.returnValue = false;

	var svgDoc = evt.target.ownerDocument;

	var g = getRoot(svgDoc);

	if(state == 'pan' && enablePan) {
		// Pan mode
		var p = getEventPoint(evt).matrixTransform(stateTf);

		setCTM(g, stateTf.inverse().translate(p.x - stateOrigin.x, p.y - stateOrigin.y));
	} else if(state == 'drag' && enableDrag) {
		// Drag mode
		var p = getEventPoint(evt).matrixTransform(g.getCTM().inverse());

		setCTM(stateTarget, root.createSVGMatrix().translate(p.x - stateOrigin.x, p.y - stateOrigin.y).multiply(g.getCTM().inverse()).multiply(stateTarget.getCTM()));

		stateOrigin = p;
	}
}

/**
 * Handle click event.
 */
function handleMouseDown(evt) {
	if(evt.preventDefault)
		evt.preventDefault();

	evt.returnValue = false;

	var svgDoc = evt.target.ownerDocument;

	var g = getRoot(svgDoc);

	if(
		evt.target.tagName == "svg"
		|| !enableDrag // Pan anyway when drag is disabled and the user clicked on an element
	) {
		// Pan mode
		state = 'pan';

		stateTf = g.getCTM().inverse();

		stateOrigin = getEventPoint(evt).matrixTransform(stateTf);
	} else {
		// Drag mode
		state = 'drag';

		stateTarget = evt.target;

		stateTf = g.getCTM().inverse();

		stateOrigin = getEventPoint(evt).matrixTransform(stateTf);
	}
}

/**
 * Handle mouse button release event.
 */
function handleMouseUp(evt) {
	if(evt.preventDefault)
		evt.preventDefault();

	evt.returnValue = false;

	var svgDoc = evt.target.ownerDocument;

	if(state == 'pan' || state == 'drag') {
		// Quit pan mode
		state = '';
	}
}

]]></script><g id="viewport" transform="scale(0.5,0.5) translate(0,0)"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2858)">
<title>unnamed</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-2858 822.5,-2858 822.5,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_L</title>
<polygon fill="none" stroke="#000000" points="8,-2750 8,-2846 316,-2846 316,-2750 8,-2750"/>
</g>
<!-- Type: cpu -->
<g id="node1" class="node">
<title>Type: cpu</title>
<polygon fill="#f8f8f8" stroke="#000000" points="307.5,-2838 16.5,-2838 16.5,-2758 307.5,-2758 307.5,-2838"/>
<text text-anchor="start" x="24.5" y="-2821.2" font-family="Times,serif" font-size="16.00" fill="#000000">Type: cpu</text>
<text text-anchor="start" x="24.5" y="-2803.2" font-family="Times,serif" font-size="16.00" fill="#000000">Time: Sep 17, 2017 at 12:22pm (AEST)</text>
<text text-anchor="start" x="24.5" y="-2785.2" font-family="Times,serif" font-size="16.00" fill="#000000">Duration: 1.81s, Total samples = 1.53s (84.33%)</text>
<text text-anchor="start" x="24.5" y="-2767.2" font-family="Times,serif" font-size="16.00" fill="#000000">Showing nodes accounting for 1.53s, 100% of 1.53s total</text>
</g>
<!-- N1 -->
<g id="node2" class="node">
<title>N1</title>
<g id="a_node2"><a xlink:title="main.paint /Users/dfc/devel/understanding&#45;the&#45;execution&#45;tracer/examples/mandelbrot&#45;pkg&#45;profile/mandelbrot.go (1s)">
<polygon fill="#edd8d5" stroke="#b21500" points="416.5,-2348 295.5,-2348 295.5,-2236 416.5,-2236 416.5,-2348"/>
<text text-anchor="middle" x="356" y="-2324.8" font-family="Times,serif" font-size="24.00" fill="#000000">main</text>
<text text-anchor="middle" x="356" y="-2298.8" font-family="Times,serif" font-size="24.00" fill="#000000">paint</text>
<text text-anchor="middle" x="356" y="-2272.8" font-family="Times,serif" font-size="24.00" fill="#000000">mandelbrot.go</text>
<text text-anchor="middle" x="356" y="-2246.8" font-family="Times,serif" font-size="24.00" fill="#000000">1s (65.36%)</text>
</a>
</g>
</g>
<!-- N2 -->
<g id="node3" class="node">
<title>N2</title>
<g id="a_node3"><a xlink:title="runtime.main /Users/dfc/go/src/runtime/proc.go (1.53s)">
<polygon fill="#edd5d5" stroke="#b20000" points="386,-2820 326,-2820 326,-2776 386,-2776 386,-2820"/>
<text text-anchor="middle" x="356" y="-2809.6" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="356" y="-2800.6" font-family="Times,serif" font-size="8.00" fill="#000000">main</text>
<text text-anchor="middle" x="356" y="-2791.6" font-family="Times,serif" font-size="8.00" fill="#000000">proc.go</text>
<text text-anchor="middle" x="356" y="-2782.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 1.53s (100%)</text>
</a>
</g>
</g>
<!-- N4 -->
<g id="node5" class="node">
<title>N4</title>
<g id="a_node5"><a xlink:title="main.main /Users/dfc/devel/understanding&#45;the&#45;execution&#45;tracer/examples/mandelbrot&#45;pkg&#45;profile/mandelbrot.go (1.53s)">
<polygon fill="#edd5d5" stroke="#b20000" points="386,-2707 326,-2707 326,-2663 386,-2663 386,-2707"/>
<text text-anchor="middle" x="356" y="-2696.6" font-family="Times,serif" font-size="8.00" fill="#000000">main</text>
<text text-anchor="middle" x="356" y="-2687.6" font-family="Times,serif" font-size="8.00" fill="#000000">main</text>
<text text-anchor="middle" x="356" y="-2678.6" font-family="Times,serif" font-size="8.00" fill="#000000">mandelbrot.go</text>
<text text-anchor="middle" x="356" y="-2669.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 1.53s (100%)</text>
</a>
</g>
</g>
<!-- N2&#45;&gt;N4 -->
<g id="edge1" class="edge">
<title>N2&#45;&gt;N4</title>
<g id="a_edge1"><a xlink:title="runtime.main /Users/dfc/go/src/runtime/proc.go &#45;&gt; main.main /Users/dfc/devel/understanding&#45;the&#45;execution&#45;tracer/examples/mandelbrot&#45;pkg&#45;profile/mandelbrot.go (1.53s)">
<path fill="none" stroke="#b20000" stroke-width="6" d="M356,-2775.9442C356,-2759.2222 356,-2735.9909 356,-2717.194"/>
<polygon fill="#b20000" stroke="#b20000" stroke-width="6" points="361.2501,-2717.0001 356,-2707.0002 350.7501,-2717.0002 361.2501,-2717.0001"/>
</a>
</g>
<g id="a_edge1&#45;label"><a xlink:title="runtime.main /Users/dfc/go/src/runtime/proc.go &#45;&gt; main.main /Users/dfc/devel/understanding&#45;the&#45;execution&#45;tracer/examples/mandelbrot&#45;pkg&#45;profile/mandelbrot.go (1.53s)">
<text text-anchor="middle" x="369" y="-2728.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1.53s</text>
</a>
</g>
</g>
<!-- N3 -->
<g id="node4" class="node">
<title>N3</title>
<g id="a_node4"><a xlink:title="main.fillPixel /Users/dfc/devel/understanding&#45;the&#45;execution&#45;tracer/examples/mandelbrot&#45;pkg&#45;profile/mandelbrot.go (1.27s)">
<polygon fill="#edd6d5" stroke="#b20900" points="410.5,-2517 301.5,-2517 301.5,-2414 410.5,-2414 410.5,-2517"/>
<text text-anchor="middle" x="356" y="-2499.4" font-family="Times,serif" font-size="17.00" fill="#000000">main</text>
<text text-anchor="middle" x="356" y="-2480.4" font-family="Times,serif" font-size="17.00" fill="#000000">fillPixel</text>
<text text-anchor="middle" x="356" y="-2461.4" font-family="Times,serif" font-size="17.00" fill="#000000">mandelbrot.go</text>
<text text-anchor="middle" x="356" y="-2442.4" font-family="Times,serif" font-size="17.00" fill="#000000">0.27s (17.65%)</text>
<text text-anchor="middle" x="356" y="-2423.4" font-family="Times,serif" font-size="17.00" fill="#000000">of 1.27s (83.01%)</text>
</a>
</g>
</g>
<!-- N3&#45;&gt;N1 -->
<g id="edge4" class="edge">
<title>N3&#45;&gt;N1</title>
<g id="a_edge4"><a xlink:title="main.fillPixel /Users/dfc/devel/understanding&#45;the&#45;execution&#45;tracer/examples/mandelbrot&#45;pkg&#45;profile/mandelbrot.go &#45;&gt; main.paint /Users/dfc/devel/understanding&#45;the&#45;execution&#45;tracer/examples/mandelbrot&#45;pkg&#45;profile/mandelbrot.go (1s)">
<path fill="none" stroke="#b21500" stroke-width="4" d="M356,-2413.914C356,-2396.4678 356,-2376.7376 356,-2358.3118"/>
<polygon fill="#b21500" stroke="#b21500" stroke-width="4" points="359.5001,-2358.2321 356,-2348.2322 352.5001,-2358.2322 359.5001,-2358.2321"/>
</a>
</g>
<g id="a_edge4&#45;label"><a xlink:title="main.fillPixel /Users/dfc/devel/understanding&#45;the&#45;execution&#45;tracer/examples/mandelbrot&#45;pkg&#45;profile/mandelbrot.go &#45;&gt; main.paint /Users/dfc/devel/understanding&#45;the&#45;execution&#45;tracer/examples/mandelbrot&#45;pkg&#45;profile/mandelbrot.go (1s)">
<text text-anchor="middle" x="373" y="-2384.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1s</text>
<text text-anchor="middle" x="373" y="-2369.8" font-family="Times,serif" font-size="14.00" fill="#000000"> (inline)</text>
</a>
</g>
</g>
<!-- N35 -->
<g id="node36" class="node">
<title>N35</title>
<g id="a_node36"><a xlink:title="image/png.Encode /Users/dfc/go/src/image/png/writer.go (0.26s)">
<polygon fill="#ede1d9" stroke="#b2591a" points="484,-2612 420,-2612 420,-2568 484,-2568 484,-2612"/>
<text text-anchor="middle" x="452" y="-2601.6" font-family="Times,serif" font-size="8.00" fill="#000000">image/png</text>
<text text-anchor="middle" x="452" y="-2592.6" font-family="Times,serif" font-size="8.00" fill="#000000">Encode</text>
<text text-anchor="middle" x="452" y="-2583.6" font-family="Times,serif" font-size="8.00" fill="#000000">writer.go</text>
<text text-anchor="middle" x="452" y="-2574.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.26s (16.99%)</text>
</a>
</g>
</g>
<!-- N4&#45;&gt;N35 -->
<g id="edge6" class="edge">
<title>N4&#45;&gt;N35</title>
<g id="a_edge6"><a xlink:title="main.main /Users/dfc/devel/understanding&#45;the&#45;execution&#45;tracer/examples/mandelbrot&#45;pkg&#45;profile/mandelbrot.go &#45;&gt; image/png.Encode /Users/dfc/go/src/image/png/writer.go (0.26s)">
<path fill="none" stroke="#b2591a" d="M378.2656,-2662.9663C391.3782,-2649.9903 408.1285,-2633.4145 422.3493,-2619.3419"/>
<polygon fill="#b2591a" stroke="#b2591a" points="424.8764,-2621.7651 429.5226,-2612.2433 419.9527,-2616.7895 424.8764,-2621.7651"/>
</a>
</g>
<g id="a_edge6&#45;label"><a xlink:title="main.main /Users/dfc/devel/understanding&#45;the&#45;execution&#45;tracer/examples/mandelbrot&#45;pkg&#45;profile/mandelbrot.go &#45;&gt; image/png.Encode /Users/dfc/go/src/image/png/writer.go (0.26s)">
<text text-anchor="middle" x="422" y="-2633.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.26s</text>
</a>
</g>
</g>
<!-- N38 -->
<g id="node39" class="node">
<title>N38</title>
<g id="a_node39"><a xlink:title="main.seqFillImg /Users/dfc/devel/understanding&#45;the&#45;execution&#45;tracer/examples/mandelbrot&#45;pkg&#45;profile/mandelbrot.go (1.27s)">
<polygon fill="#edd6d5" stroke="#b20900" points="388,-2612 324,-2612 324,-2568 388,-2568 388,-2612"/>
<text text-anchor="middle" x="356" y="-2601.6" font-family="Times,serif" font-size="8.00" fill="#000000">main</text>
<text text-anchor="middle" x="356" y="-2592.6" font-family="Times,serif" font-size="8.00" fill="#000000">seqFillImg</text>
<text text-anchor="middle" x="356" y="-2583.6" font-family="Times,serif" font-size="8.00" fill="#000000">mandelbrot.go</text>
<text text-anchor="middle" x="356" y="-2574.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 1.27s (83.01%)</text>
</a>
</g>
</g>
<!-- N4&#45;&gt;N38 -->
<g id="edge2" class="edge">
<title>N4&#45;&gt;N38</title>
<g id="a_edge2"><a xlink:title="main.main /Users/dfc/devel/understanding&#45;the&#45;execution&#45;tracer/examples/mandelbrot&#45;pkg&#45;profile/mandelbrot.go &#45;&gt; main.seqFillImg /Users/dfc/devel/understanding&#45;the&#45;execution&#45;tracer/examples/mandelbrot&#45;pkg&#45;profile/mandelbrot.go (1.27s)">
<path fill="none" stroke="#b20900" stroke-width="5" d="M356,-2662.9663C356,-2650.9427 356,-2635.8283 356,-2622.4785"/>
<polygon fill="#b20900" stroke="#b20900" stroke-width="5" points="360.3751,-2622.2432 356,-2612.2433 351.6251,-2622.2433 360.3751,-2622.2432"/>
</a>
</g>
<g id="a_edge2&#45;label"><a xlink:title="main.main /Users/dfc/devel/understanding&#45;the&#45;execution&#45;tracer/examples/mandelbrot&#45;pkg&#45;profile/mandelbrot.go &#45;&gt; main.seqFillImg /Users/dfc/devel/understanding&#45;the&#45;execution&#45;tracer/examples/mandelbrot&#45;pkg&#45;profile/mandelbrot.go (1.27s)">
<text text-anchor="middle" x="369" y="-2633.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1.27s</text>
</a>
</g>
</g>
<!-- N5 -->
<g id="node6" class="node">
<title>N5</title>
<g id="a_node6"><a xlink:title="runtime.mallocgc /Users/dfc/go/src/runtime/malloc.go (0.16s)">
<polygon fill="#ede6e0" stroke="#b28355" points="594,-1873 502,-1873 502,-1790 594,-1790 594,-1873"/>
<text text-anchor="middle" x="548" y="-1857.8" font-family="Times,serif" font-size="14.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="548" y="-1842.8" font-family="Times,serif" font-size="14.00" fill="#000000">mallocgc</text>
<text text-anchor="middle" x="548" y="-1827.8" font-family="Times,serif" font-size="14.00" fill="#000000">malloc.go</text>
<text text-anchor="middle" x="548" y="-1812.8" font-family="Times,serif" font-size="14.00" fill="#000000">0.13s (8.50%)</text>
<text text-anchor="middle" x="548" y="-1797.8" font-family="Times,serif" font-size="14.00" fill="#000000">of 0.16s (10.46%)</text>
</a>
</g>
</g>
<!-- N41 -->
<g id="node42" class="node">
<title>N41</title>
<g id="a_node42"><a xlink:title="runtime.(*mcache).nextFree /Users/dfc/go/src/runtime/malloc.go (0.03s)">
<polygon fill="#edecea" stroke="#b2ada1" points="600.5,-1728.5 539.5,-1728.5 539.5,-1675.5 600.5,-1675.5 600.5,-1728.5"/>
<text text-anchor="middle" x="570" y="-1718.1" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="570" y="-1709.1" font-family="Times,serif" font-size="8.00" fill="#000000">(*mcache)</text>
<text text-anchor="middle" x="570" y="-1700.1" font-family="Times,serif" font-size="8.00" fill="#000000">nextFree</text>
<text text-anchor="middle" x="570" y="-1691.1" font-family="Times,serif" font-size="8.00" fill="#000000">malloc.go</text>
<text text-anchor="middle" x="570" y="-1682.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.03s (1.96%)</text>
</a>
</g>
</g>
<!-- N5&#45;&gt;N41 -->
<g id="edge35" class="edge">
<title>N5&#45;&gt;N41</title>
<g id="a_edge35"><a xlink:title="runtime.mallocgc /Users/dfc/go/src/runtime/malloc.go &#45;&gt; runtime.(*mcache).nextFree /Users/dfc/go/src/runtime/malloc.go (0.03s)">
<path fill="none" stroke="#b2ada1" d="M555.082,-1789.8126C557.8847,-1773.3148 561.0778,-1754.5194 563.7887,-1738.5621"/>
<polygon fill="#b2ada1" stroke="#b2ada1" points="567.2672,-1738.9833 565.4916,-1728.5383 560.3661,-1737.8108 567.2672,-1738.9833"/>
</a>
</g>
<g id="a_edge35&#45;label"><a xlink:title="runtime.mallocgc /Users/dfc/go/src/runtime/malloc.go &#45;&gt; runtime.(*mcache).nextFree /Users/dfc/go/src/runtime/malloc.go (0.03s)">
<text text-anchor="middle" x="573" y="-1760.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.03s</text>
</a>
</g>
</g>
<!-- N6 -->
<g id="node7" class="node">
<title>N6</title>
<g id="a_node7"><a xlink:title="image/png.(*encoder).writeImage /Users/dfc/go/src/image/png/writer.go (0.19s)">
<polygon fill="#ede5de" stroke="#b27743" points="499,-2185 435,-2185 435,-2132 499,-2132 499,-2185"/>
<text text-anchor="middle" x="467" y="-2174.6" font-family="Times,serif" font-size="8.00" fill="#000000">image/png</text>
<text text-anchor="middle" x="467" y="-2165.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*encoder)</text>
<text text-anchor="middle" x="467" y="-2156.6" font-family="Times,serif" font-size="8.00" fill="#000000">writeImage</text>
<text text-anchor="middle" x="467" y="-2147.6" font-family="Times,serif" font-size="8.00" fill="#000000">writer.go</text>
<text text-anchor="middle" x="467" y="-2138.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.19s (12.42%)</text>
</a>
</g>
</g>
<!-- N8 -->
<g id="node9" class="node">
<title>N8</title>
<g id="a_node9"><a xlink:title="main.(*img).At /Users/dfc/devel/understanding&#45;the&#45;execution&#45;tracer/examples/mandelbrot&#45;pkg&#45;profile/mandelbrot.go (0.18s)">
<polygon fill="#ede5df" stroke="#b27b49" points="580,-2081 516,-2081 516,-2028 580,-2028 580,-2081"/>
<text text-anchor="middle" x="548" y="-2070.6" font-family="Times,serif" font-size="8.00" fill="#000000">main</text>
<text text-anchor="middle" x="548" y="-2061.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*img)</text>
<text text-anchor="middle" x="548" y="-2052.6" font-family="Times,serif" font-size="8.00" fill="#000000">At</text>
<text text-anchor="middle" x="548" y="-2043.6" font-family="Times,serif" font-size="8.00" fill="#000000">mandelbrot.go</text>
<text text-anchor="middle" x="548" y="-2034.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.18s (11.76%)</text>
</a>
</g>
</g>
<!-- N6&#45;&gt;N8 -->
<g id="edge11" class="edge">
<title>N6&#45;&gt;N8</title>
<g id="a_edge11"><a xlink:title="image/png.(*encoder).writeImage /Users/dfc/go/src/image/png/writer.go &#45;&gt; main.(*img).At /Users/dfc/devel/understanding&#45;the&#45;execution&#45;tracer/examples/mandelbrot&#45;pkg&#45;profile/mandelbrot.go (0.11s)">
<path fill="none" stroke="#b29572" d="M484.252,-2131.9097C491.321,-2121.437 499.7656,-2109.4412 508,-2099 510.6052,-2095.6965 513.3873,-2092.3245 516.225,-2088.9884"/>
<polygon fill="#b29572" stroke="#b29572" points="518.9729,-2091.1622 522.8904,-2081.3182 513.6891,-2086.5706 518.9729,-2091.1622"/>
</a>
</g>
<g id="a_edge11&#45;label"><a xlink:title="image/png.(*encoder).writeImage /Users/dfc/go/src/image/png/writer.go &#45;&gt; main.(*img).At /Users/dfc/devel/understanding&#45;the&#45;execution&#45;tracer/examples/mandelbrot&#45;pkg&#45;profile/mandelbrot.go (0.11s)">
<text text-anchor="middle" x="521" y="-2102.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.11s</text>
</a>
</g>
</g>
<!-- N18 -->
<g id="node19" class="node">
<title>N18</title>
<g id="a_node19"><a xlink:title="image/png.filter /Users/dfc/go/src/image/png/writer.go (0.01s)">
<polygon fill="#edecec" stroke="#b2b1ac" points="409.5,-2080.5 350.5,-2080.5 350.5,-2028.5 409.5,-2028.5 409.5,-2080.5"/>
<text text-anchor="middle" x="380" y="-2068.5" font-family="Times,serif" font-size="10.00" fill="#000000">image/png</text>
<text text-anchor="middle" x="380" y="-2057.5" font-family="Times,serif" font-size="10.00" fill="#000000">filter</text>
<text text-anchor="middle" x="380" y="-2046.5" font-family="Times,serif" font-size="10.00" fill="#000000">writer.go</text>
<text text-anchor="middle" x="380" y="-2035.5" font-family="Times,serif" font-size="10.00" fill="#000000">0.01s (0.65%)</text>
</a>
</g>
</g>
<!-- N6&#45;&gt;N18 -->
<g id="edge45" class="edge">
<title>N6&#45;&gt;N18</title>
<g id="a_edge45"><a xlink:title="image/png.(*encoder).writeImage /Users/dfc/go/src/image/png/writer.go &#45;&gt; image/png.filter /Users/dfc/go/src/image/png/writer.go (0.01s)">
<path fill="none" stroke="#b2b1ac" d="M442.607,-2131.9174C437.3869,-2126.0755 431.9544,-2119.8776 427,-2114 420.1205,-2105.8386 412.8838,-2096.878 406.2063,-2088.4432"/>
<polygon fill="#b2b1ac" stroke="#b2b1ac" points="408.9391,-2086.2563 400.0054,-2080.5606 403.4374,-2090.5842 408.9391,-2086.2563"/>
</a>
</g>
<g id="a_edge45&#45;label"><a xlink:title="image/png.(*encoder).writeImage /Users/dfc/go/src/image/png/writer.go &#45;&gt; image/png.filter /Users/dfc/go/src/image/png/writer.go (0.01s)">
<text text-anchor="middle" x="440" y="-2102.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.01s</text>
</a>
</g>
</g>
<!-- N31 -->
<g id="node32" class="node">
<title>N31</title>
<g id="a_node32"><a xlink:title="compress/zlib.(*Writer).Write /Users/dfc/go/src/compress/zlib/writer.go (0.07s)">
<polygon fill="#edeae7" stroke="#b2a289" points="488.5,-2081 427.5,-2081 427.5,-2028 488.5,-2028 488.5,-2081"/>
<text text-anchor="middle" x="458" y="-2070.6" font-family="Times,serif" font-size="8.00" fill="#000000">compress/zlib</text>
<text text-anchor="middle" x="458" y="-2061.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*Writer)</text>
<text text-anchor="middle" x="458" y="-2052.6" font-family="Times,serif" font-size="8.00" fill="#000000">Write</text>
<text text-anchor="middle" x="458" y="-2043.6" font-family="Times,serif" font-size="8.00" fill="#000000">writer.go</text>
<text text-anchor="middle" x="458" y="-2034.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.07s (4.58%)</text>
</a>
</g>
</g>
<!-- N6&#45;&gt;N31 -->
<g id="edge16" class="edge">
<title>N6&#45;&gt;N31</title>
<g id="a_edge16"><a xlink:title="image/png.(*encoder).writeImage /Users/dfc/go/src/image/png/writer.go &#45;&gt; compress/zlib.(*Writer).Write /Users/dfc/go/src/compress/zlib/writer.go (0.07s)">
<path fill="none" stroke="#b2a289" d="M461.4749,-2131.7712C460.4711,-2125.9384 459.5645,-2119.7812 459,-2114 458.2821,-2106.6481 457.8872,-2098.7615 457.6909,-2091.2124"/>
<polygon fill="#b2a289" stroke="#b2a289" points="461.1905,-2091.1533 457.5346,-2081.2093 454.1913,-2091.2628 461.1905,-2091.1533"/>
</a>
</g>
<g id="a_edge16&#45;label"><a xlink:title="image/png.(*encoder).writeImage /Users/dfc/go/src/image/png/writer.go &#45;&gt; compress/zlib.(*Writer).Write /Users/dfc/go/src/compress/zlib/writer.go (0.07s)">
<text text-anchor="middle" x="472" y="-2102.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.07s</text>
</a>
</g>
</g>
<!-- N7 -->
<g id="node8" class="node">
<title>N7</title>
<g id="a_node8"><a xlink:title="image/png.(*Encoder).Encode /Users/dfc/go/src/image/png/writer.go (0.26s)">
<polygon fill="#ede1d9" stroke="#b2591a" points="499,-2492 435,-2492 435,-2439 499,-2439 499,-2492"/>
<text text-anchor="middle" x="467" y="-2481.6" font-family="Times,serif" font-size="8.00" fill="#000000">image/png</text>
<text text-anchor="middle" x="467" y="-2472.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*Encoder)</text>
<text text-anchor="middle" x="467" y="-2463.6" font-family="Times,serif" font-size="8.00" fill="#000000">Encode</text>
<text text-anchor="middle" x="467" y="-2454.6" font-family="Times,serif" font-size="8.00" fill="#000000">writer.go</text>
<text text-anchor="middle" x="467" y="-2445.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.26s (16.99%)</text>
</a>
</g>
</g>
<!-- N34 -->
<g id="node35" class="node">
<title>N34</title>
<g id="a_node35"><a xlink:title="image/png.(*encoder).writeIDATs /Users/dfc/go/src/image/png/writer.go (0.19s)">
<polygon fill="#ede5de" stroke="#b27743" points="499,-2318.5 435,-2318.5 435,-2265.5 499,-2265.5 499,-2318.5"/>
<text text-anchor="middle" x="467" y="-2308.1" font-family="Times,serif" font-size="8.00" fill="#000000">image/png</text>
<text text-anchor="middle" x="467" y="-2299.1" font-family="Times,serif" font-size="8.00" fill="#000000">(*encoder)</text>
<text text-anchor="middle" x="467" y="-2290.1" font-family="Times,serif" font-size="8.00" fill="#000000">writeIDATs</text>
<text text-anchor="middle" x="467" y="-2281.1" font-family="Times,serif" font-size="8.00" fill="#000000">writer.go</text>
<text text-anchor="middle" x="467" y="-2272.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.19s (12.42%)</text>
</a>
</g>
</g>
<!-- N7&#45;&gt;N34 -->
<g id="edge7" class="edge">
<title>N7&#45;&gt;N34</title>
<g id="a_edge7"><a xlink:title="image/png.(*Encoder).Encode /Users/dfc/go/src/image/png/writer.go &#45;&gt; image/png.(*encoder).writeIDATs /Users/dfc/go/src/image/png/writer.go (0.19s)">
<path fill="none" stroke="#b27743" d="M467,-2438.7709C467,-2409.351 467,-2361.8667 467,-2328.9085"/>
<polygon fill="#b27743" stroke="#b27743" points="470.5001,-2328.7595 467,-2318.7595 463.5001,-2328.7596 470.5001,-2328.7595"/>
</a>
</g>
<g id="a_edge7&#45;label"><a xlink:title="image/png.(*Encoder).Encode /Users/dfc/go/src/image/png/writer.go &#45;&gt; image/png.(*encoder).writeIDATs /Users/dfc/go/src/image/png/writer.go (0.19s)">
<text text-anchor="middle" x="480" y="-2377.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.19s</text>
</a>
</g>
</g>
<!-- N36 -->
<g id="node37" class="node">
<title>N36</title>
<g id="a_node37"><a xlink:title="image/png.opaque /Users/dfc/go/src/image/png/writer.go (0.07s)">
<polygon fill="#edeae7" stroke="#b2a289" points="578.5,-2314 517.5,-2314 517.5,-2270 578.5,-2270 578.5,-2314"/>
<text text-anchor="middle" x="548" y="-2303.6" font-family="Times,serif" font-size="8.00" fill="#000000">image/png</text>
<text text-anchor="middle" x="548" y="-2294.6" font-family="Times,serif" font-size="8.00" fill="#000000">opaque</text>
<text text-anchor="middle" x="548" y="-2285.6" font-family="Times,serif" font-size="8.00" fill="#000000">writer.go</text>
<text text-anchor="middle" x="548" y="-2276.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.07s (4.58%)</text>
</a>
</g>
</g>
<!-- N7&#45;&gt;N36 -->
<g id="edge15" class="edge">
<title>N7&#45;&gt;N36</title>
<g id="a_edge15"><a xlink:title="image/png.(*Encoder).Encode /Users/dfc/go/src/image/png/writer.go &#45;&gt; image/png.opaque /Users/dfc/go/src/image/png/writer.go (0.07s)">
<path fill="none" stroke="#b2a289" d="M479.4787,-2438.7709C494.0192,-2407.6255 518.0115,-2356.2347 533.4032,-2323.266"/>
<polygon fill="#b2a289" stroke="#b2a289" points="536.6335,-2324.6203 537.6925,-2314.0785 530.2907,-2321.659 536.6335,-2324.6203"/>
</a>
</g>
<g id="a_edge15&#45;label"><a xlink:title="image/png.(*Encoder).Encode /Users/dfc/go/src/image/png/writer.go &#45;&gt; image/png.opaque /Users/dfc/go/src/image/png/writer.go (0.07s)">
<text text-anchor="middle" x="525" y="-2377.3" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.07s</text>
</a>
</g>
</g>
<!-- N10 -->
<g id="node11" class="node">
<title>N10</title>
<g id="a_node11"><a xlink:title="runtime.convT2Inoptr /Users/dfc/go/src/runtime/iface.go (0.18s)">
<polygon fill="#ede5df" stroke="#b27b49" points="580,-1972.5 516,-1972.5 516,-1928.5 580,-1928.5 580,-1972.5"/>
<text text-anchor="middle" x="548" y="-1962.1" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="548" y="-1953.1" font-family="Times,serif" font-size="8.00" fill="#000000">convT2Inoptr</text>
<text text-anchor="middle" x="548" y="-1944.1" font-family="Times,serif" font-size="8.00" fill="#000000">iface.go</text>
<text text-anchor="middle" x="548" y="-1935.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.18s (11.76%)</text>
</a>
</g>
</g>
<!-- N8&#45;&gt;N10 -->
<g id="edge9" class="edge">
<title>N8&#45;&gt;N10</title>
<g id="a_edge9"><a xlink:title="main.(*img).At /Users/dfc/devel/understanding&#45;the&#45;execution&#45;tracer/examples/mandelbrot&#45;pkg&#45;profile/mandelbrot.go &#45;&gt; runtime.convT2Inoptr /Users/dfc/go/src/runtime/iface.go (0.18s)">
<path fill="none" stroke="#b27b49" d="M548,-2027.9873C548,-2014.2341 548,-1997.3207 548,-1982.8083"/>
<polygon fill="#b27b49" stroke="#b27b49" points="551.5001,-1982.7448 548,-1972.7448 544.5001,-1982.7448 551.5001,-1982.7448"/>
</a>
</g>
<g id="a_edge9&#45;label"><a xlink:title="main.(*img).At /Users/dfc/devel/understanding&#45;the&#45;execution&#45;tracer/examples/mandelbrot&#45;pkg&#45;profile/mandelbrot.go &#45;&gt; runtime.convT2Inoptr /Users/dfc/go/src/runtime/iface.go (0.18s)">
<text text-anchor="middle" x="561" y="-1998.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.18s</text>
</a>
</g>
</g>
<!-- N9 -->
<g id="node10" class="node">
<title>N9</title>
<g id="a_node10"><a xlink:title="syscall.Syscall /Users/dfc/go/src/syscall/asm_darwin_amd64.s (0.05s)">
<polygon fill="#edebe9" stroke="#b2a895" points="500.5,-60 405.5,-60 405.5,0 500.5,0 500.5,-60"/>
<text text-anchor="middle" x="453" y="-46.4" font-family="Times,serif" font-size="12.00" fill="#000000">syscall</text>
<text text-anchor="middle" x="453" y="-33.4" font-family="Times,serif" font-size="12.00" fill="#000000">Syscall</text>
<text text-anchor="middle" x="453" y="-20.4" font-family="Times,serif" font-size="12.00" fill="#000000">asm_darwin_amd64.s</text>
<text text-anchor="middle" x="453" y="-7.4" font-family="Times,serif" font-size="12.00" fill="#000000">0.05s (3.27%)</text>
</a>
</g>
</g>
<!-- N10&#45;&gt;N5 -->
<g id="edge10" class="edge">
<title>N10&#45;&gt;N5</title>
<g id="a_edge10"><a xlink:title="runtime.convT2Inoptr /Users/dfc/go/src/runtime/iface.go &#45;&gt; runtime.mallocgc /Users/dfc/go/src/runtime/malloc.go (0.16s)">
<path fill="none" stroke="#b28355" d="M548,-1928.3959C548,-1915.7144 548,-1899.2214 548,-1883.4481"/>
<polygon fill="#b28355" stroke="#b28355" points="551.5001,-1883.234 548,-1873.234 544.5001,-1883.2341 551.5001,-1883.234"/>
</a>
</g>
<g id="a_edge10&#45;label"><a xlink:title="runtime.convT2Inoptr /Users/dfc/go/src/runtime/iface.go &#45;&gt; runtime.mallocgc /Users/dfc/go/src/runtime/malloc.go (0.16s)">
<text text-anchor="middle" x="561" y="-1894.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.16s</text>
</a>
</g>
</g>
<!-- N13 -->
<g id="node14" class="node">
<title>N13</title>
<g id="a_node14"><a xlink:title="runtime.memmove /Users/dfc/go/src/runtime/memmove_amd64.s (0.02s)">
<polygon fill="#edeceb" stroke="#b2afa6" points="695.5,-1859.5 612.5,-1859.5 612.5,-1803.5 695.5,-1803.5 695.5,-1859.5"/>
<text text-anchor="middle" x="654" y="-1846.7" font-family="Times,serif" font-size="11.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="654" y="-1834.7" font-family="Times,serif" font-size="11.00" fill="#000000">memmove</text>
<text text-anchor="middle" x="654" y="-1822.7" font-family="Times,serif" font-size="11.00" fill="#000000">memmove_amd64.s</text>
<text text-anchor="middle" x="654" y="-1810.7" font-family="Times,serif" font-size="11.00" fill="#000000">0.02s (1.31%)</text>
</a>
</g>
</g>
<!-- N10&#45;&gt;N13 -->
<g id="edge39" class="edge">
<title>N10&#45;&gt;N13</title>
<g id="a_edge39"><a xlink:title="runtime.convT2Inoptr /Users/dfc/go/src/runtime/iface.go &#45;&gt; runtime.memmove /Users/dfc/go/src/runtime/memmove_amd64.s (0.02s)">
<path fill="none" stroke="#b2afa6" d="M567.6894,-1928.3959C582.9118,-1911.3066 604.2995,-1887.2958 621.9756,-1867.4519"/>
<polygon fill="#b2afa6" stroke="#b2afa6" points="624.7575,-1869.5908 628.7955,-1859.7956 619.5305,-1864.9348 624.7575,-1869.5908"/>
</a>
</g>
<g id="a_edge39&#45;label"><a xlink:title="runtime.convT2Inoptr /Users/dfc/go/src/runtime/iface.go &#45;&gt; runtime.memmove /Users/dfc/go/src/runtime/memmove_amd64.s (0.02s)">
<text text-anchor="middle" x="614" y="-1894.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.02s</text>
</a>
</g>
</g>
<!-- N11 -->
<g id="node12" class="node">
<title>N11</title>
<g id="a_node12"><a xlink:title="compress/flate.(*compressor).deflate /Users/dfc/go/src/compress/flate/deflate.go (0.07s)">
<polygon fill="#edeae7" stroke="#b2a289" points="486.5,-1739 419.5,-1739 419.5,-1665 486.5,-1665 486.5,-1739"/>
<text text-anchor="middle" x="453" y="-1727" font-family="Times,serif" font-size="10.00" fill="#000000">compress/flate</text>
<text text-anchor="middle" x="453" y="-1716" font-family="Times,serif" font-size="10.00" fill="#000000">(*compressor)</text>
<text text-anchor="middle" x="453" y="-1705" font-family="Times,serif" font-size="10.00" fill="#000000">deflate</text>
<text text-anchor="middle" x="453" y="-1694" font-family="Times,serif" font-size="10.00" fill="#000000">deflate.go</text>
<text text-anchor="middle" x="453" y="-1683" font-family="Times,serif" font-size="10.00" fill="#000000">0.01s (0.65%)</text>
<text text-anchor="middle" x="453" y="-1672" font-family="Times,serif" font-size="10.00" fill="#000000">of 0.07s (4.58%)</text>
</a>
</g>
</g>
<!-- N24 -->
<g id="node25" class="node">
<title>N24</title>
<g id="a_node25"><a xlink:title="compress/flate.(*compressor).findMatch /Users/dfc/go/src/compress/flate/deflate.go (0.01s)">
<polygon fill="#edecec" stroke="#b2b1ac" points="565.5,-1614 504.5,-1614 504.5,-1561 565.5,-1561 565.5,-1614"/>
<text text-anchor="middle" x="535" y="-1603.6" font-family="Times,serif" font-size="8.00" fill="#000000">compress/flate</text>
<text text-anchor="middle" x="535" y="-1594.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*compressor)</text>
<text text-anchor="middle" x="535" y="-1585.6" font-family="Times,serif" font-size="8.00" fill="#000000">findMatch</text>
<text text-anchor="middle" x="535" y="-1576.6" font-family="Times,serif" font-size="8.00" fill="#000000">deflate.go</text>
<text text-anchor="middle" x="535" y="-1567.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.01s (0.65%)</text>
</a>
</g>
</g>
<!-- N11&#45;&gt;N24 -->
<g id="edge41" class="edge">
<title>N11&#45;&gt;N24</title>
<g id="a_edge41"><a xlink:title="compress/flate.(*compressor).deflate /Users/dfc/go/src/compress/flate/deflate.go &#45;&gt; compress/flate.(*compressor).findMatch /Users/dfc/go/src/compress/flate/deflate.go (0.01s)">
<path fill="none" stroke="#b2b1ac" d="M479.6231,-1664.8251C489.2902,-1651.3265 500.1782,-1636.1231 509.7255,-1622.7918"/>
<polygon fill="#b2b1ac" stroke="#b2b1ac" points="512.8026,-1624.5064 515.7795,-1614.3384 507.1115,-1620.4307 512.8026,-1624.5064"/>
</a>
</g>
<g id="a_edge41&#45;label"><a xlink:title="compress/flate.(*compressor).deflate /Users/dfc/go/src/compress/flate/deflate.go &#45;&gt; compress/flate.(*compressor).findMatch /Users/dfc/go/src/compress/flate/deflate.go (0.01s)">
<text text-anchor="middle" x="514" y="-1635.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.01s</text>
</a>
</g>
</g>
<!-- N26 -->
<g id="node27" class="node">
<title>N26</title>
<g id="a_node27"><a xlink:title="compress/flate.(*compressor).writeBlock /Users/dfc/go/src/compress/flate/deflate.go (0.05s)">
<polygon fill="#edebe9" stroke="#b2a895" points="483.5,-1614 422.5,-1614 422.5,-1561 483.5,-1561 483.5,-1614"/>
<text text-anchor="middle" x="453" y="-1603.6" font-family="Times,serif" font-size="8.00" fill="#000000">compress/flate</text>
<text text-anchor="middle" x="453" y="-1594.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*compressor)</text>
<text text-anchor="middle" x="453" y="-1585.6" font-family="Times,serif" font-size="8.00" fill="#000000">writeBlock</text>
<text text-anchor="middle" x="453" y="-1576.6" font-family="Times,serif" font-size="8.00" fill="#000000">deflate.go</text>
<text text-anchor="middle" x="453" y="-1567.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.05s (3.27%)</text>
</a>
</g>
</g>
<!-- N11&#45;&gt;N26 -->
<g id="edge20" class="edge">
<title>N11&#45;&gt;N26</title>
<g id="a_edge20"><a xlink:title="compress/flate.(*compressor).deflate /Users/dfc/go/src/compress/flate/deflate.go &#45;&gt; compress/flate.(*compressor).writeBlock /Users/dfc/go/src/compress/flate/deflate.go (0.05s)">
<path fill="none" stroke="#b2a895" d="M453,-1664.8251C453,-1651.9693 453,-1637.5671 453,-1624.7086"/>
<polygon fill="#b2a895" stroke="#b2a895" points="456.5001,-1624.3383 453,-1614.3384 449.5001,-1624.3384 456.5001,-1624.3383"/>
</a>
</g>
<g id="a_edge20&#45;label"><a xlink:title="compress/flate.(*compressor).deflate /Users/dfc/go/src/compress/flate/deflate.go &#45;&gt; compress/flate.(*compressor).writeBlock /Users/dfc/go/src/compress/flate/deflate.go (0.05s)">
<text text-anchor="middle" x="466" y="-1635.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.05s</text>
</a>
</g>
</g>
<!-- N12 -->
<g id="node13" class="node">
<title>N12</title>
<g id="a_node13"><a xlink:title="runtime.mmap /Users/dfc/go/src/runtime/sys_darwin_amd64.s (0.02s)">
<polygon fill="#edeceb" stroke="#b2afa6" points="683,-669 597,-669 597,-613 683,-613 683,-669"/>
<text text-anchor="middle" x="640" y="-656.2" font-family="Times,serif" font-size="11.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="640" y="-644.2" font-family="Times,serif" font-size="11.00" fill="#000000">mmap</text>
<text text-anchor="middle" x="640" y="-632.2" font-family="Times,serif" font-size="11.00" fill="#000000">sys_darwin_amd64.s</text>
<text text-anchor="middle" x="640" y="-620.2" font-family="Times,serif" font-size="11.00" fill="#000000">0.02s (1.31%)</text>
</a>
</g>
</g>
<!-- N14 -->
<g id="node15" class="node">
<title>N14</title>
<g id="a_node15"><a xlink:title="compress/flate.(*huffmanBitWriter).write /Users/dfc/go/src/compress/flate/huffman_bit_writer.go (0.05s)">
<polygon fill="#edebe9" stroke="#b2a895" points="488.5,-1189 417.5,-1189 417.5,-1136 488.5,-1136 488.5,-1189"/>
<text text-anchor="middle" x="453" y="-1178.6" font-family="Times,serif" font-size="8.00" fill="#000000">compress/flate</text>
<text text-anchor="middle" x="453" y="-1169.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*huffmanBitWriter)</text>
<text text-anchor="middle" x="453" y="-1160.6" font-family="Times,serif" font-size="8.00" fill="#000000">write</text>
<text text-anchor="middle" x="453" y="-1151.6" font-family="Times,serif" font-size="8.00" fill="#000000">huffman_bit_writer.go</text>
<text text-anchor="middle" x="453" y="-1142.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.05s (3.27%)</text>
</a>
</g>
</g>
<!-- N27 -->
<g id="node28" class="node">
<title>N27</title>
<g id="a_node28"><a xlink:title="compress/flate.(*dictWriter).Write /Users/dfc/go/src/compress/flate/deflate.go (0.05s)">
<polygon fill="#edebe9" stroke="#b2a895" points="483.5,-1085 422.5,-1085 422.5,-1032 483.5,-1032 483.5,-1085"/>
<text text-anchor="middle" x="453" y="-1074.6" font-family="Times,serif" font-size="8.00" fill="#000000">compress/flate</text>
<text text-anchor="middle" x="453" y="-1065.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*dictWriter)</text>
<text text-anchor="middle" x="453" y="-1056.6" font-family="Times,serif" font-size="8.00" fill="#000000">Write</text>
<text text-anchor="middle" x="453" y="-1047.6" font-family="Times,serif" font-size="8.00" fill="#000000">deflate.go</text>
<text text-anchor="middle" x="453" y="-1038.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.05s (3.27%)</text>
</a>
</g>
</g>
<!-- N14&#45;&gt;N27 -->
<g id="edge23" class="edge">
<title>N14&#45;&gt;N27</title>
<g id="a_edge23"><a xlink:title="compress/flate.(*huffmanBitWriter).write /Users/dfc/go/src/compress/flate/huffman_bit_writer.go &#45;&gt; compress/flate.(*dictWriter).Write /Users/dfc/go/src/compress/flate/deflate.go (0.05s)">
<path fill="none" stroke="#b2a895" d="M453,-1135.9873C453,-1123.7358 453,-1108.9766 453,-1095.6407"/>
<polygon fill="#b2a895" stroke="#b2a895" points="456.5001,-1095.3259 453,-1085.3259 449.5001,-1095.3259 456.5001,-1095.3259"/>
</a>
</g>
<g id="a_edge23&#45;label"><a xlink:title="compress/flate.(*huffmanBitWriter).write /Users/dfc/go/src/compress/flate/huffman_bit_writer.go &#45;&gt; compress/flate.(*dictWriter).Write /Users/dfc/go/src/compress/flate/deflate.go (0.05s)">
<text text-anchor="middle" x="466" y="-1106.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.05s</text>
</a>
</g>
</g>
<!-- N15 -->
<g id="node16" class="node">
<title>N15</title>
<g id="a_node16"><a xlink:title="compress/flate.(*huffmanBitWriter).writeTokens /Users/dfc/go/src/compress/flate/huffman_bit_writer.go (0.05s)">
<polygon fill="#edebe9" stroke="#b2a895" points="488.5,-1397 417.5,-1397 417.5,-1344 488.5,-1344 488.5,-1397"/>
<text text-anchor="middle" x="453" y="-1386.6" font-family="Times,serif" font-size="8.00" fill="#000000">compress/flate</text>
<text text-anchor="middle" x="453" y="-1377.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*huffmanBitWriter)</text>
<text text-anchor="middle" x="453" y="-1368.6" font-family="Times,serif" font-size="8.00" fill="#000000">writeTokens</text>
<text text-anchor="middle" x="453" y="-1359.6" font-family="Times,serif" font-size="8.00" fill="#000000">huffman_bit_writer.go</text>
<text text-anchor="middle" x="453" y="-1350.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.05s (3.27%)</text>
</a>
</g>
</g>
<!-- N28 -->
<g id="node29" class="node">
<title>N28</title>
<g id="a_node29"><a xlink:title="compress/flate.(*huffmanBitWriter).writeBits /Users/dfc/go/src/compress/flate/huffman_bit_writer.go (0.01s)">
<polygon fill="#edecec" stroke="#b2b1ac" points="399.5,-1293 328.5,-1293 328.5,-1240 399.5,-1240 399.5,-1293"/>
<text text-anchor="middle" x="364" y="-1282.6" font-family="Times,serif" font-size="8.00" fill="#000000">compress/flate</text>
<text text-anchor="middle" x="364" y="-1273.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*huffmanBitWriter)</text>
<text text-anchor="middle" x="364" y="-1264.6" font-family="Times,serif" font-size="8.00" fill="#000000">writeBits</text>
<text text-anchor="middle" x="364" y="-1255.6" font-family="Times,serif" font-size="8.00" fill="#000000">huffman_bit_writer.go</text>
<text text-anchor="middle" x="364" y="-1246.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.01s (0.65%)</text>
</a>
</g>
</g>
<!-- N15&#45;&gt;N28 -->
<g id="edge44" class="edge">
<title>N15&#45;&gt;N28</title>
<g id="a_edge44"><a xlink:title="compress/flate.(*huffmanBitWriter).writeTokens /Users/dfc/go/src/compress/flate/huffman_bit_writer.go &#45;&gt; compress/flate.(*huffmanBitWriter).writeBits /Users/dfc/go/src/compress/flate/huffman_bit_writer.go (0.01s)">
<path fill="none" stroke="#b2b1ac" d="M430.3113,-1343.9873C419.204,-1331.008 405.6881,-1315.2141 393.7636,-1301.2799"/>
<polygon fill="#b2b1ac" stroke="#b2b1ac" points="396.1179,-1298.648 386.9568,-1293.3259 390.7995,-1303.1993 396.1179,-1298.648"/>
</a>
</g>
<g id="a_edge44&#45;label"><a xlink:title="compress/flate.(*huffmanBitWriter).writeTokens /Users/dfc/go/src/compress/flate/huffman_bit_writer.go &#45;&gt; compress/flate.(*huffmanBitWriter).writeBits /Users/dfc/go/src/compress/flate/huffman_bit_writer.go (0.01s)">
<text text-anchor="middle" x="426" y="-1314.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.01s</text>
</a>
</g>
</g>
<!-- N30 -->
<g id="node31" class="node">
<title>N30</title>
<g id="a_node31"><a xlink:title="compress/flate.(*huffmanBitWriter).writeCode /Users/dfc/go/src/compress/flate/huffman_bit_writer.go (0.04s)">
<polygon fill="#edecea" stroke="#b2aa9b" points="488.5,-1293 417.5,-1293 417.5,-1240 488.5,-1240 488.5,-1293"/>
<text text-anchor="middle" x="453" y="-1282.6" font-family="Times,serif" font-size="8.00" fill="#000000">compress/flate</text>
<text text-anchor="middle" x="453" y="-1273.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*huffmanBitWriter)</text>
<text text-anchor="middle" x="453" y="-1264.6" font-family="Times,serif" font-size="8.00" fill="#000000">writeCode</text>
<text text-anchor="middle" x="453" y="-1255.6" font-family="Times,serif" font-size="8.00" fill="#000000">huffman_bit_writer.go</text>
<text text-anchor="middle" x="453" y="-1246.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.04s (2.61%)</text>
</a>
</g>
</g>
<!-- N15&#45;&gt;N30 -->
<g id="edge33" class="edge">
<title>N15&#45;&gt;N30</title>
<g id="a_edge33"><a xlink:title="compress/flate.(*huffmanBitWriter).writeTokens /Users/dfc/go/src/compress/flate/huffman_bit_writer.go &#45;&gt; compress/flate.(*huffmanBitWriter).writeCode /Users/dfc/go/src/compress/flate/huffman_bit_writer.go (0.04s)">
<path fill="none" stroke="#b2aa9b" d="M453,-1343.9873C453,-1331.7358 453,-1316.9766 453,-1303.6407"/>
<polygon fill="#b2aa9b" stroke="#b2aa9b" points="456.5001,-1303.3259 453,-1293.3259 449.5001,-1303.3259 456.5001,-1303.3259"/>
</a>
</g>
<g id="a_edge33&#45;label"><a xlink:title="compress/flate.(*huffmanBitWriter).writeTokens /Users/dfc/go/src/compress/flate/huffman_bit_writer.go &#45;&gt; compress/flate.(*huffmanBitWriter).writeCode /Users/dfc/go/src/compress/flate/huffman_bit_writer.go (0.04s)">
<text text-anchor="middle" x="466" y="-1314.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.04s</text>
</a>
</g>
</g>
<!-- N16 -->
<g id="node17" class="node">
<title>N16</title>
<g id="a_node17"><a xlink:title="runtime.systemstack /Users/dfc/go/src/runtime/asm_amd64.s (0.03s)">
<polygon fill="#edecea" stroke="#b2ada1" points="646.5,-1609.5 585.5,-1609.5 585.5,-1565.5 646.5,-1565.5 646.5,-1609.5"/>
<text text-anchor="middle" x="616" y="-1599.1" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="616" y="-1590.1" font-family="Times,serif" font-size="8.00" fill="#000000">systemstack</text>
<text text-anchor="middle" x="616" y="-1581.1" font-family="Times,serif" font-size="8.00" fill="#000000">asm_amd64.s</text>
<text text-anchor="middle" x="616" y="-1572.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.03s (1.96%)</text>
</a>
</g>
</g>
<!-- N42 -->
<g id="node43" class="node">
<title>N42</title>
<g id="a_node43"><a xlink:title="runtime.(*mcache).nextFree.func1 /Users/dfc/go/src/runtime/malloc.go (0.02s)">
<polygon fill="#edeceb" stroke="#b2afa6" points="725.5,-1510 664.5,-1510 664.5,-1448 725.5,-1448 725.5,-1510"/>
<text text-anchor="middle" x="695" y="-1499.6" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="695" y="-1490.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*mcache)</text>
<text text-anchor="middle" x="695" y="-1481.6" font-family="Times,serif" font-size="8.00" fill="#000000">nextFree</text>
<text text-anchor="middle" x="695" y="-1472.6" font-family="Times,serif" font-size="8.00" fill="#000000">func1</text>
<text text-anchor="middle" x="695" y="-1463.6" font-family="Times,serif" font-size="8.00" fill="#000000">malloc.go</text>
<text text-anchor="middle" x="695" y="-1454.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.02s (1.31%)</text>
</a>
</g>
</g>
<!-- N16&#45;&gt;N42 -->
<g id="edge40" class="edge">
<title>N16&#45;&gt;N42</title>
<g id="a_edge40"><a xlink:title="runtime.systemstack /Users/dfc/go/src/runtime/asm_amd64.s &#45;&gt; runtime.(*mcache).nextFree.func1 /Users/dfc/go/src/runtime/malloc.go (0.02s)">
<path fill="none" stroke="#b2afa6" d="M632.1775,-1565.2816C641.928,-1551.89 654.6326,-1534.4413 666.0634,-1518.742"/>
<polygon fill="#b2afa6" stroke="#b2afa6" points="669.1992,-1520.3815 672.2559,-1510.2371 663.5403,-1516.2611 669.1992,-1520.3815"/>
</a>
</g>
<g id="a_edge40&#45;label"><a xlink:title="runtime.systemstack /Users/dfc/go/src/runtime/asm_amd64.s &#45;&gt; runtime.(*mcache).nextFree.func1 /Users/dfc/go/src/runtime/malloc.go (0.02s)">
<text text-anchor="middle" x="670" y="-1531.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.02s</text>
</a>
</g>
</g>
<!-- N46 -->
<g id="node47" class="node">
<title>N46</title>
<g id="a_node47"><a xlink:title="runtime.(*mheap).alloc.func1 /Users/dfc/go/src/runtime/mheap.go (0.01s)">
<polygon fill="#edecec" stroke="#b2b1ac" points="646.5,-1510 585.5,-1510 585.5,-1448 646.5,-1448 646.5,-1510"/>
<text text-anchor="middle" x="616" y="-1499.6" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="616" y="-1490.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*mheap)</text>
<text text-anchor="middle" x="616" y="-1481.6" font-family="Times,serif" font-size="8.00" fill="#000000">alloc</text>
<text text-anchor="middle" x="616" y="-1472.6" font-family="Times,serif" font-size="8.00" fill="#000000">func1</text>
<text text-anchor="middle" x="616" y="-1463.6" font-family="Times,serif" font-size="8.00" fill="#000000">mheap.go</text>
<text text-anchor="middle" x="616" y="-1454.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.01s (0.65%)</text>
</a>
</g>
</g>
<!-- N16&#45;&gt;N46 -->
<g id="edge59" class="edge">
<title>N16&#45;&gt;N46</title>
<g id="a_edge59"><a xlink:title="runtime.systemstack /Users/dfc/go/src/runtime/asm_amd64.s &#45;&gt; runtime.(*mheap).alloc.func1 /Users/dfc/go/src/runtime/mheap.go (0.01s)">
<path fill="none" stroke="#b2b1ac" d="M616,-1565.2816C616,-1552.386 616,-1535.7282 616,-1520.4933"/>
<polygon fill="#b2b1ac" stroke="#b2b1ac" points="619.5001,-1520.2371 616,-1510.2371 612.5001,-1520.2372 619.5001,-1520.2371"/>
</a>
</g>
<g id="a_edge59&#45;label"><a xlink:title="runtime.systemstack /Users/dfc/go/src/runtime/asm_amd64.s &#45;&gt; runtime.(*mheap).alloc.func1 /Users/dfc/go/src/runtime/mheap.go (0.01s)">
<text text-anchor="middle" x="629" y="-1531.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.01s</text>
</a>
</g>
</g>
<!-- N17 -->
<g id="node18" class="node">
<title>N17</title>
<g id="a_node18"><a xlink:title="compress/flate.matchLen /Users/dfc/go/src/compress/flate/deflate.go (0.01s)">
<polygon fill="#edecec" stroke="#b2b1ac" points="567,-1505 507,-1505 507,-1453 567,-1453 567,-1505"/>
<text text-anchor="middle" x="537" y="-1493" font-family="Times,serif" font-size="10.00" fill="#000000">compress/flate</text>
<text text-anchor="middle" x="537" y="-1482" font-family="Times,serif" font-size="10.00" fill="#000000">matchLen</text>
<text text-anchor="middle" x="537" y="-1471" font-family="Times,serif" font-size="10.00" fill="#000000">deflate.go</text>
<text text-anchor="middle" x="537" y="-1460" font-family="Times,serif" font-size="10.00" fill="#000000">0.01s (0.65%)</text>
</a>
</g>
</g>
<!-- N19 -->
<g id="node20" class="node">
<title>N19</title>
<g id="a_node20"><a xlink:title="runtime.(*mcentral).grow /Users/dfc/go/src/runtime/mcentral.go (0.02s)">
<polygon fill="#edeceb" stroke="#b2afa6" points="725.5,-1189 664.5,-1189 664.5,-1136 725.5,-1136 725.5,-1189"/>
<text text-anchor="middle" x="695" y="-1178.6" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="695" y="-1169.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*mcentral)</text>
<text text-anchor="middle" x="695" y="-1160.6" font-family="Times,serif" font-size="8.00" fill="#000000">grow</text>
<text text-anchor="middle" x="695" y="-1151.6" font-family="Times,serif" font-size="8.00" fill="#000000">mcentral.go</text>
<text text-anchor="middle" x="695" y="-1142.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.02s (1.31%)</text>
</a>
</g>
</g>
<!-- N45 -->
<g id="node46" class="node">
<title>N45</title>
<g id="a_node46"><a xlink:title="runtime.(*mheap).alloc /Users/dfc/go/src/runtime/mheap.go (0.01s)">
<polygon fill="#edecec" stroke="#b2b1ac" points="725.5,-1085 664.5,-1085 664.5,-1032 725.5,-1032 725.5,-1085"/>
<text text-anchor="middle" x="695" y="-1074.6" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="695" y="-1065.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*mheap)</text>
<text text-anchor="middle" x="695" y="-1056.6" font-family="Times,serif" font-size="8.00" fill="#000000">alloc</text>
<text text-anchor="middle" x="695" y="-1047.6" font-family="Times,serif" font-size="8.00" fill="#000000">mheap.go</text>
<text text-anchor="middle" x="695" y="-1038.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.01s (0.65%)</text>
</a>
</g>
</g>
<!-- N19&#45;&gt;N45 -->
<g id="edge46" class="edge">
<title>N19&#45;&gt;N45</title>
<g id="a_edge46"><a xlink:title="runtime.(*mcentral).grow /Users/dfc/go/src/runtime/mcentral.go &#45;&gt; runtime.(*mheap).alloc /Users/dfc/go/src/runtime/mheap.go (0.01s)">
<path fill="none" stroke="#b2b1ac" d="M695,-1135.9873C695,-1123.7358 695,-1108.9766 695,-1095.6407"/>
<polygon fill="#b2b1ac" stroke="#b2b1ac" points="698.5001,-1095.3259 695,-1085.3259 691.5001,-1095.3259 698.5001,-1095.3259"/>
</a>
</g>
<g id="a_edge46&#45;label"><a xlink:title="runtime.(*mcentral).grow /Users/dfc/go/src/runtime/mcentral.go &#45;&gt; runtime.(*mheap).alloc /Users/dfc/go/src/runtime/mheap.go (0.01s)">
<text text-anchor="middle" x="708" y="-1106.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.01s</text>
</a>
</g>
</g>
<!-- N51 -->
<g id="node52" class="node">
<title>N51</title>
<g id="a_node52"><a xlink:title="runtime.heapBits.initSpan /Users/dfc/go/src/runtime/mbitmap.go (0.01s)">
<polygon fill="#edecec" stroke="#b2b1ac" points="811.5,-1085 750.5,-1085 750.5,-1032 811.5,-1032 811.5,-1085"/>
<text text-anchor="middle" x="781" y="-1074.6" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="781" y="-1065.6" font-family="Times,serif" font-size="8.00" fill="#000000">heapBits</text>
<text text-anchor="middle" x="781" y="-1056.6" font-family="Times,serif" font-size="8.00" fill="#000000">initSpan</text>
<text text-anchor="middle" x="781" y="-1047.6" font-family="Times,serif" font-size="8.00" fill="#000000">mbitmap.go</text>
<text text-anchor="middle" x="781" y="-1038.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.01s (0.65%)</text>
</a>
</g>
</g>
<!-- N19&#45;&gt;N51 -->
<g id="edge47" class="edge">
<title>N19&#45;&gt;N51</title>
<g id="a_edge47"><a xlink:title="runtime.(*mcentral).grow /Users/dfc/go/src/runtime/mcentral.go &#45;&gt; runtime.heapBits.initSpan /Users/dfc/go/src/runtime/mbitmap.go (0.01s)">
<path fill="none" stroke="#b2b1ac" d="M716.9239,-1135.9873C727.6568,-1123.008 740.7172,-1107.2141 752.2397,-1093.2799"/>
<polygon fill="#b2b1ac" stroke="#b2b1ac" points="755.1416,-1095.2628 758.8171,-1085.3259 749.7471,-1090.8019 755.1416,-1095.2628"/>
</a>
</g>
<g id="a_edge47&#45;label"><a xlink:title="runtime.(*mcentral).grow /Users/dfc/go/src/runtime/mcentral.go &#45;&gt; runtime.heapBits.initSpan /Users/dfc/go/src/runtime/mbitmap.go (0.01s)">
<text text-anchor="middle" x="756" y="-1106.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.01s</text>
</a>
</g>
</g>
<!-- N20 -->
<g id="node21" class="node">
<title>N20</title>
<g id="a_node21"><a xlink:title="runtime.memclrNoHeapPointers /Users/dfc/go/src/runtime/memclr_amd64.s (0.01s)">
<polygon fill="#edecec" stroke="#b2b1ac" points="739.5,-980.5 650.5,-980.5 650.5,-928.5 739.5,-928.5 739.5,-980.5"/>
<text text-anchor="middle" x="695" y="-968.5" font-family="Times,serif" font-size="10.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="695" y="-957.5" font-family="Times,serif" font-size="10.00" fill="#000000">memclrNoHeapPointers</text>
<text text-anchor="middle" x="695" y="-946.5" font-family="Times,serif" font-size="10.00" fill="#000000">memclr_amd64.s</text>
<text text-anchor="middle" x="695" y="-935.5" font-family="Times,serif" font-size="10.00" fill="#000000">0.01s (0.65%)</text>
</a>
</g>
</g>
<!-- N21 -->
<g id="node22" class="node">
<title>N21</title>
<g id="a_node22"><a xlink:title="bufio.(*Writer).Flush /Users/dfc/go/src/bufio/bufio.go (0.05s)">
<polygon fill="#edebe9" stroke="#b2a895" points="483.5,-877 422.5,-877 422.5,-824 483.5,-824 483.5,-877"/>
<text text-anchor="middle" x="453" y="-866.6" font-family="Times,serif" font-size="8.00" fill="#000000">bufio</text>
<text text-anchor="middle" x="453" y="-857.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*Writer)</text>
<text text-anchor="middle" x="453" y="-848.6" font-family="Times,serif" font-size="8.00" fill="#000000">Flush</text>
<text text-anchor="middle" x="453" y="-839.6" font-family="Times,serif" font-size="8.00" fill="#000000">bufio.go</text>
<text text-anchor="middle" x="453" y="-830.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.05s (3.27%)</text>
</a>
</g>
</g>
<!-- N32 -->
<g id="node33" class="node">
<title>N32</title>
<g id="a_node33"><a xlink:title="image/png.(*encoder).Write /Users/dfc/go/src/image/png/writer.go (0.05s)">
<polygon fill="#edebe9" stroke="#b2a895" points="483.5,-773 422.5,-773 422.5,-720 483.5,-720 483.5,-773"/>
<text text-anchor="middle" x="453" y="-762.6" font-family="Times,serif" font-size="8.00" fill="#000000">image/png</text>
<text text-anchor="middle" x="453" y="-753.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*encoder)</text>
<text text-anchor="middle" x="453" y="-744.6" font-family="Times,serif" font-size="8.00" fill="#000000">Write</text>
<text text-anchor="middle" x="453" y="-735.6" font-family="Times,serif" font-size="8.00" fill="#000000">writer.go</text>
<text text-anchor="middle" x="453" y="-726.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.05s (3.27%)</text>
</a>
</g>
</g>
<!-- N21&#45;&gt;N32 -->
<g id="edge18" class="edge">
<title>N21&#45;&gt;N32</title>
<g id="a_edge18"><a xlink:title="bufio.(*Writer).Flush /Users/dfc/go/src/bufio/bufio.go &#45;&gt; image/png.(*encoder).Write /Users/dfc/go/src/image/png/writer.go (0.05s)">
<path fill="none" stroke="#b2a895" d="M453,-823.9873C453,-811.7358 453,-796.9766 453,-783.6407"/>
<polygon fill="#b2a895" stroke="#b2a895" points="456.5001,-783.3259 453,-773.3259 449.5001,-783.3259 456.5001,-783.3259"/>
</a>
</g>
<g id="a_edge18&#45;label"><a xlink:title="bufio.(*Writer).Flush /Users/dfc/go/src/bufio/bufio.go &#45;&gt; image/png.(*encoder).Write /Users/dfc/go/src/image/png/writer.go (0.05s)">
<text text-anchor="middle" x="466" y="-794.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.05s</text>
</a>
</g>
</g>
<!-- N22 -->
<g id="node23" class="node">
<title>N22</title>
<g id="a_node23"><a xlink:title="bufio.(*Writer).Write /Users/dfc/go/src/bufio/bufio.go (0.05s)">
<polygon fill="#edebe9" stroke="#b2a895" points="483.5,-981 422.5,-981 422.5,-928 483.5,-928 483.5,-981"/>
<text text-anchor="middle" x="453" y="-970.6" font-family="Times,serif" font-size="8.00" fill="#000000">bufio</text>
<text text-anchor="middle" x="453" y="-961.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*Writer)</text>
<text text-anchor="middle" x="453" y="-952.6" font-family="Times,serif" font-size="8.00" fill="#000000">Write</text>
<text text-anchor="middle" x="453" y="-943.6" font-family="Times,serif" font-size="8.00" fill="#000000">bufio.go</text>
<text text-anchor="middle" x="453" y="-934.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.05s (3.27%)</text>
</a>
</g>
</g>
<!-- N22&#45;&gt;N21 -->
<g id="edge19" class="edge">
<title>N22&#45;&gt;N21</title>
<g id="a_edge19"><a xlink:title="bufio.(*Writer).Write /Users/dfc/go/src/bufio/bufio.go &#45;&gt; bufio.(*Writer).Flush /Users/dfc/go/src/bufio/bufio.go (0.05s)">
<path fill="none" stroke="#b2a895" d="M453,-927.9873C453,-915.7358 453,-900.9766 453,-887.6407"/>
<polygon fill="#b2a895" stroke="#b2a895" points="456.5001,-887.3259 453,-877.3259 449.5001,-887.3259 456.5001,-887.3259"/>
</a>
</g>
<g id="a_edge19&#45;label"><a xlink:title="bufio.(*Writer).Write /Users/dfc/go/src/bufio/bufio.go &#45;&gt; bufio.(*Writer).Flush /Users/dfc/go/src/bufio/bufio.go (0.05s)">
<text text-anchor="middle" x="466" y="-898.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.05s</text>
</a>
</g>
</g>
<!-- N23 -->
<g id="node24" class="node">
<title>N23</title>
<g id="a_node24"><a xlink:title="compress/flate.(*Writer).Write /Users/dfc/go/src/compress/flate/deflate.go (0.07s)">
<polygon fill="#edeae7" stroke="#b2a289" points="486.5,-1977 425.5,-1977 425.5,-1924 486.5,-1924 486.5,-1977"/>
<text text-anchor="middle" x="456" y="-1966.6" font-family="Times,serif" font-size="8.00" fill="#000000">compress/flate</text>
<text text-anchor="middle" x="456" y="-1957.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*Writer)</text>
<text text-anchor="middle" x="456" y="-1948.6" font-family="Times,serif" font-size="8.00" fill="#000000">Write</text>
<text text-anchor="middle" x="456" y="-1939.6" font-family="Times,serif" font-size="8.00" fill="#000000">deflate.go</text>
<text text-anchor="middle" x="456" y="-1930.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.07s (4.58%)</text>
</a>
</g>
</g>
<!-- N25 -->
<g id="node26" class="node">
<title>N25</title>
<g id="a_node26"><a xlink:title="compress/flate.(*compressor).write /Users/dfc/go/src/compress/flate/deflate.go (0.07s)">
<polygon fill="#edeae7" stroke="#b2a289" points="483.5,-1858 422.5,-1858 422.5,-1805 483.5,-1805 483.5,-1858"/>
<text text-anchor="middle" x="453" y="-1847.6" font-family="Times,serif" font-size="8.00" fill="#000000">compress/flate</text>
<text text-anchor="middle" x="453" y="-1838.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*compressor)</text>
<text text-anchor="middle" x="453" y="-1829.6" font-family="Times,serif" font-size="8.00" fill="#000000">write</text>
<text text-anchor="middle" x="453" y="-1820.6" font-family="Times,serif" font-size="8.00" fill="#000000">deflate.go</text>
<text text-anchor="middle" x="453" y="-1811.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.07s (4.58%)</text>
</a>
</g>
</g>
<!-- N23&#45;&gt;N25 -->
<g id="edge12" class="edge">
<title>N23&#45;&gt;N25</title>
<g id="a_edge12"><a xlink:title="compress/flate.(*Writer).Write /Users/dfc/go/src/compress/flate/deflate.go &#45;&gt; compress/flate.(*compressor).write /Users/dfc/go/src/compress/flate/deflate.go (0.07s)">
<path fill="none" stroke="#b2a289" d="M455.3267,-1923.7941C454.9137,-1907.4111 454.3791,-1886.2042 453.9265,-1868.2506"/>
<polygon fill="#b2a289" stroke="#b2a289" points="457.422,-1868.0254 453.671,-1858.1168 450.4242,-1868.2019 457.422,-1868.0254"/>
</a>
</g>
<g id="a_edge12&#45;label"><a xlink:title="compress/flate.(*Writer).Write /Users/dfc/go/src/compress/flate/deflate.go &#45;&gt; compress/flate.(*compressor).write /Users/dfc/go/src/compress/flate/deflate.go (0.07s)">
<text text-anchor="middle" x="467" y="-1894.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.07s</text>
</a>
</g>
</g>
<!-- N24&#45;&gt;N17 -->
<g id="edge42" class="edge">
<title>N24&#45;&gt;N17</title>
<g id="a_edge42"><a xlink:title="compress/flate.(*compressor).findMatch /Users/dfc/go/src/compress/flate/deflate.go &#45;&gt; compress/flate.matchLen /Users/dfc/go/src/compress/flate/deflate.go (0.01s)">
<path fill="none" stroke="#b2b1ac" d="M535.4893,-1560.9579C535.7405,-1547.3274 536.0506,-1530.5068 536.3243,-1515.658"/>
<polygon fill="#b2b1ac" stroke="#b2b1ac" points="539.8308,-1515.3309 536.5158,-1505.2681 532.832,-1515.2018 539.8308,-1515.3309"/>
</a>
</g>
<g id="a_edge42&#45;label"><a xlink:title="compress/flate.(*compressor).findMatch /Users/dfc/go/src/compress/flate/deflate.go &#45;&gt; compress/flate.matchLen /Users/dfc/go/src/compress/flate/deflate.go (0.01s)">
<text text-anchor="middle" x="549" y="-1531.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.01s</text>
</a>
</g>
</g>
<!-- N25&#45;&gt;N11 -->
<g id="edge13" class="edge">
<title>N25&#45;&gt;N11</title>
<g id="a_edge13"><a xlink:title="compress/flate.(*compressor).write /Users/dfc/go/src/compress/flate/deflate.go &#45;&gt; compress/flate.(*compressor).deflate /Users/dfc/go/src/compress/flate/deflate.go (0.07s)">
<path fill="none" stroke="#b2a289" d="M453,-1804.9812C453,-1788.9977 453,-1768.1718 453,-1749.4341"/>
<polygon fill="#b2a289" stroke="#b2a289" points="456.5001,-1749.283 453,-1739.283 449.5001,-1749.2831 456.5001,-1749.283"/>
</a>
</g>
<g id="a_edge13&#45;label"><a xlink:title="compress/flate.(*compressor).write /Users/dfc/go/src/compress/flate/deflate.go &#45;&gt; compress/flate.(*compressor).deflate /Users/dfc/go/src/compress/flate/deflate.go (0.07s)">
<text text-anchor="middle" x="466" y="-1760.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.07s</text>
</a>
</g>
</g>
<!-- N29 -->
<g id="node30" class="node">
<title>N29</title>
<g id="a_node30"><a xlink:title="compress/flate.(*huffmanBitWriter).writeBlock /Users/dfc/go/src/compress/flate/huffman_bit_writer.go (0.05s)">
<polygon fill="#edebe9" stroke="#b2a895" points="488.5,-1505.5 417.5,-1505.5 417.5,-1452.5 488.5,-1452.5 488.5,-1505.5"/>
<text text-anchor="middle" x="453" y="-1495.1" font-family="Times,serif" font-size="8.00" fill="#000000">compress/flate</text>
<text text-anchor="middle" x="453" y="-1486.1" font-family="Times,serif" font-size="8.00" fill="#000000">(*huffmanBitWriter)</text>
<text text-anchor="middle" x="453" y="-1477.1" font-family="Times,serif" font-size="8.00" fill="#000000">writeBlock</text>
<text text-anchor="middle" x="453" y="-1468.1" font-family="Times,serif" font-size="8.00" fill="#000000">huffman_bit_writer.go</text>
<text text-anchor="middle" x="453" y="-1459.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.05s (3.27%)</text>
</a>
</g>
</g>
<!-- N26&#45;&gt;N29 -->
<g id="edge21" class="edge">
<title>N26&#45;&gt;N29</title>
<g id="a_edge21"><a xlink:title="compress/flate.(*compressor).writeBlock /Users/dfc/go/src/compress/flate/deflate.go &#45;&gt; compress/flate.(*huffmanBitWriter).writeBlock /Users/dfc/go/src/compress/flate/huffman_bit_writer.go (0.05s)">
<path fill="none" stroke="#b2a895" d="M453,-1560.9579C453,-1547.4283 453,-1530.7558 453,-1515.9883"/>
<polygon fill="#b2a895" stroke="#b2a895" points="456.5001,-1515.6441 453,-1505.6441 449.5001,-1515.6441 456.5001,-1515.6441"/>
</a>
</g>
<g id="a_edge21&#45;label"><a xlink:title="compress/flate.(*compressor).writeBlock /Users/dfc/go/src/compress/flate/deflate.go &#45;&gt; compress/flate.(*huffmanBitWriter).writeBlock /Users/dfc/go/src/compress/flate/huffman_bit_writer.go (0.05s)">
<text text-anchor="middle" x="466" y="-1531.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.05s</text>
</a>
</g>
</g>
<!-- N27&#45;&gt;N22 -->
<g id="edge22" class="edge">
<title>N27&#45;&gt;N22</title>
<g id="a_edge22"><a xlink:title="compress/flate.(*dictWriter).Write /Users/dfc/go/src/compress/flate/deflate.go &#45;&gt; bufio.(*Writer).Write /Users/dfc/go/src/bufio/bufio.go (0.05s)">
<path fill="none" stroke="#b2a895" d="M453,-1031.9873C453,-1019.7358 453,-1004.9766 453,-991.6407"/>
<polygon fill="#b2a895" stroke="#b2a895" points="456.5001,-991.3259 453,-981.3259 449.5001,-991.3259 456.5001,-991.3259"/>
</a>
</g>
<g id="a_edge22&#45;label"><a xlink:title="compress/flate.(*dictWriter).Write /Users/dfc/go/src/compress/flate/deflate.go &#45;&gt; bufio.(*Writer).Write /Users/dfc/go/src/bufio/bufio.go (0.05s)">
<text text-anchor="middle" x="466" y="-1002.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.05s</text>
</a>
</g>
</g>
<!-- N28&#45;&gt;N14 -->
<g id="edge43" class="edge">
<title>N28&#45;&gt;N14</title>
<g id="a_edge43"><a xlink:title="compress/flate.(*huffmanBitWriter).writeBits /Users/dfc/go/src/compress/flate/huffman_bit_writer.go &#45;&gt; compress/flate.(*huffmanBitWriter).write /Users/dfc/go/src/compress/flate/huffman_bit_writer.go (0.01s)">
<path fill="none" stroke="#b2b1ac" d="M386.6887,-1239.9873C397.796,-1227.008 411.3119,-1211.2141 423.2364,-1197.2799"/>
<polygon fill="#b2b1ac" stroke="#b2b1ac" points="426.2005,-1199.1993 430.0432,-1189.3259 420.8821,-1194.648 426.2005,-1199.1993"/>
</a>
</g>
<g id="a_edge43&#45;label"><a xlink:title="compress/flate.(*huffmanBitWriter).writeBits /Users/dfc/go/src/compress/flate/huffman_bit_writer.go &#45;&gt; compress/flate.(*huffmanBitWriter).write /Users/dfc/go/src/compress/flate/huffman_bit_writer.go (0.01s)">
<text text-anchor="middle" x="426" y="-1210.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.01s</text>
</a>
</g>
</g>
<!-- N29&#45;&gt;N15 -->
<g id="edge24" class="edge">
<title>N29&#45;&gt;N15</title>
<g id="a_edge24"><a xlink:title="compress/flate.(*huffmanBitWriter).writeBlock /Users/dfc/go/src/compress/flate/huffman_bit_writer.go &#45;&gt; compress/flate.(*huffmanBitWriter).writeTokens /Users/dfc/go/src/compress/flate/huffman_bit_writer.go (0.05s)">
<path fill="none" stroke="#b2a895" d="M453,-1452.4579C453,-1438.9283 453,-1422.2558 453,-1407.4883"/>
<polygon fill="#b2a895" stroke="#b2a895" points="456.5001,-1407.1441 453,-1397.1441 449.5001,-1407.1441 456.5001,-1407.1441"/>
</a>
</g>
<g id="a_edge24&#45;label"><a xlink:title="compress/flate.(*huffmanBitWriter).writeBlock /Users/dfc/go/src/compress/flate/huffman_bit_writer.go &#45;&gt; compress/flate.(*huffmanBitWriter).writeTokens /Users/dfc/go/src/compress/flate/huffman_bit_writer.go (0.05s)">
<text text-anchor="middle" x="466" y="-1418.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.05s</text>
</a>
</g>
</g>
<!-- N30&#45;&gt;N14 -->
<g id="edge32" class="edge">
<title>N30&#45;&gt;N14</title>
<g id="a_edge32"><a xlink:title="compress/flate.(*huffmanBitWriter).writeCode /Users/dfc/go/src/compress/flate/huffman_bit_writer.go &#45;&gt; compress/flate.(*huffmanBitWriter).write /Users/dfc/go/src/compress/flate/huffman_bit_writer.go (0.04s)">
<path fill="none" stroke="#b2aa9b" d="M453,-1239.9873C453,-1227.7358 453,-1212.9766 453,-1199.6407"/>
<polygon fill="#b2aa9b" stroke="#b2aa9b" points="456.5001,-1199.3259 453,-1189.3259 449.5001,-1199.3259 456.5001,-1199.3259"/>
</a>
</g>
<g id="a_edge32&#45;label"><a xlink:title="compress/flate.(*huffmanBitWriter).writeCode /Users/dfc/go/src/compress/flate/huffman_bit_writer.go &#45;&gt; compress/flate.(*huffmanBitWriter).write /Users/dfc/go/src/compress/flate/huffman_bit_writer.go (0.04s)">
<text text-anchor="middle" x="466" y="-1210.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.04s</text>
</a>
</g>
</g>
<!-- N31&#45;&gt;N23 -->
<g id="edge14" class="edge">
<title>N31&#45;&gt;N23</title>
<g id="a_edge14"><a xlink:title="compress/zlib.(*Writer).Write /Users/dfc/go/src/compress/zlib/writer.go &#45;&gt; compress/flate.(*Writer).Write /Users/dfc/go/src/compress/flate/deflate.go (0.07s)">
<path fill="none" stroke="#b2a289" d="M457.4901,-2027.9873C457.2545,-2015.7358 456.9707,-2000.9766 456.7142,-1987.6407"/>
<polygon fill="#b2a289" stroke="#b2a289" points="460.2076,-1987.2567 456.5159,-1977.3259 453.2089,-1987.3914 460.2076,-1987.2567"/>
</a>
</g>
<g id="a_edge14&#45;label"><a xlink:title="compress/zlib.(*Writer).Write /Users/dfc/go/src/compress/zlib/writer.go &#45;&gt; compress/flate.(*Writer).Write /Users/dfc/go/src/compress/flate/deflate.go (0.07s)">
<text text-anchor="middle" x="470" y="-1998.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.07s</text>
</a>
</g>
</g>
<!-- N33 -->
<g id="node34" class="node">
<title>N33</title>
<g id="a_node34"><a xlink:title="image/png.(*encoder).writeChunk /Users/dfc/go/src/image/png/writer.go (0.05s)">
<polygon fill="#edebe9" stroke="#b2a895" points="483.5,-667.5 422.5,-667.5 422.5,-614.5 483.5,-614.5 483.5,-667.5"/>
<text text-anchor="middle" x="453" y="-657.1" font-family="Times,serif" font-size="8.00" fill="#000000">image/png</text>
<text text-anchor="middle" x="453" y="-648.1" font-family="Times,serif" font-size="8.00" fill="#000000">(*encoder)</text>
<text text-anchor="middle" x="453" y="-639.1" font-family="Times,serif" font-size="8.00" fill="#000000">writeChunk</text>
<text text-anchor="middle" x="453" y="-630.1" font-family="Times,serif" font-size="8.00" fill="#000000">writer.go</text>
<text text-anchor="middle" x="453" y="-621.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.05s (3.27%)</text>
</a>
</g>
</g>
<!-- N32&#45;&gt;N33 -->
<g id="edge25" class="edge">
<title>N32&#45;&gt;N33</title>
<g id="a_edge25"><a xlink:title="image/png.(*encoder).Write /Users/dfc/go/src/image/png/writer.go &#45;&gt; image/png.(*encoder).writeChunk /Users/dfc/go/src/image/png/writer.go (0.05s)">
<path fill="none" stroke="#b2a895" d="M453,-719.8779C453,-707.1335 453,-691.6669 453,-677.8173"/>
<polygon fill="#b2a895" stroke="#b2a895" points="456.5001,-677.6136 453,-667.6136 449.5001,-677.6136 456.5001,-677.6136"/>
</a>
</g>
<g id="a_edge25&#45;label"><a xlink:title="image/png.(*encoder).Write /Users/dfc/go/src/image/png/writer.go &#45;&gt; image/png.(*encoder).writeChunk /Users/dfc/go/src/image/png/writer.go (0.05s)">
<text text-anchor="middle" x="466" y="-690.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.05s</text>
</a>
</g>
</g>
<!-- N39 -->
<g id="node40" class="node">
<title>N39</title>
<g id="a_node40"><a xlink:title="os.(*File).Write /Users/dfc/go/src/os/file.go (0.05s)">
<polygon fill="#edebe9" stroke="#b2a895" points="483.5,-562 422.5,-562 422.5,-509 483.5,-509 483.5,-562"/>
<text text-anchor="middle" x="453" y="-551.6" font-family="Times,serif" font-size="8.00" fill="#000000">os</text>
<text text-anchor="middle" x="453" y="-542.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*File)</text>
<text text-anchor="middle" x="453" y="-533.6" font-family="Times,serif" font-size="8.00" fill="#000000">Write</text>
<text text-anchor="middle" x="453" y="-524.6" font-family="Times,serif" font-size="8.00" fill="#000000">file.go</text>
<text text-anchor="middle" x="453" y="-515.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.05s (3.27%)</text>
</a>
</g>
</g>
<!-- N33&#45;&gt;N39 -->
<g id="edge26" class="edge">
<title>N33&#45;&gt;N39</title>
<g id="a_edge26"><a xlink:title="image/png.(*encoder).writeChunk /Users/dfc/go/src/image/png/writer.go &#45;&gt; os.(*File).Write /Users/dfc/go/src/os/file.go (0.05s)">
<path fill="none" stroke="#b2a895" d="M453,-614.3779C453,-601.6335 453,-586.1669 453,-572.3173"/>
<polygon fill="#b2a895" stroke="#b2a895" points="456.5001,-572.1136 453,-562.1136 449.5001,-572.1136 456.5001,-572.1136"/>
</a>
</g>
<g id="a_edge26&#45;label"><a xlink:title="image/png.(*encoder).writeChunk /Users/dfc/go/src/image/png/writer.go &#45;&gt; os.(*File).Write /Users/dfc/go/src/os/file.go (0.05s)">
<text text-anchor="middle" x="466" y="-583.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.05s</text>
</a>
</g>
</g>
<!-- N34&#45;&gt;N6 -->
<g id="edge8" class="edge">
<title>N34&#45;&gt;N6</title>
<g id="a_edge8"><a xlink:title="image/png.(*encoder).writeIDATs /Users/dfc/go/src/image/png/writer.go &#45;&gt; image/png.(*encoder).writeImage /Users/dfc/go/src/image/png/writer.go (0.19s)">
<path fill="none" stroke="#b27743" d="M467,-2265.3051C467,-2245.2046 467,-2217.4141 467,-2195.2196"/>
<polygon fill="#b27743" stroke="#b27743" points="470.5001,-2195.1486 467,-2185.1486 463.5001,-2195.1486 470.5001,-2195.1486"/>
</a>
</g>
<g id="a_edge8&#45;label"><a xlink:title="image/png.(*encoder).writeIDATs /Users/dfc/go/src/image/png/writer.go &#45;&gt; image/png.(*encoder).writeImage /Users/dfc/go/src/image/png/writer.go (0.19s)">
<text text-anchor="middle" x="480" y="-2206.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.19s</text>
</a>
</g>
</g>
<!-- N35&#45;&gt;N7 -->
<g id="edge5" class="edge">
<title>N35&#45;&gt;N7</title>
<g id="a_edge5"><a xlink:title="image/png.Encode /Users/dfc/go/src/image/png/writer.go &#45;&gt; image/png.(*Encoder).Encode /Users/dfc/go/src/image/png/writer.go (0.26s)">
<path fill="none" stroke="#b2591a" d="M454.6817,-2567.7419C456.8687,-2549.5896 460.0037,-2523.5695 462.5636,-2502.3221"/>
<polygon fill="#b2591a" stroke="#b2591a" points="466.0461,-2502.6772 463.7674,-2492.3303 459.0963,-2501.8398 466.0461,-2502.6772"/>
</a>
</g>
<g id="a_edge5&#45;label"><a xlink:title="image/png.Encode /Users/dfc/go/src/image/png/writer.go &#45;&gt; image/png.(*Encoder).Encode /Users/dfc/go/src/image/png/writer.go (0.26s)">
<text text-anchor="middle" x="471" y="-2538.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.26s</text>
</a>
</g>
</g>
<!-- N36&#45;&gt;N8 -->
<g id="edge17" class="edge">
<title>N36&#45;&gt;N8</title>
<g id="a_edge17"><a xlink:title="image/png.opaque /Users/dfc/go/src/image/png/writer.go &#45;&gt; main.(*img).At /Users/dfc/devel/understanding&#45;the&#45;execution&#45;tracer/examples/mandelbrot&#45;pkg&#45;profile/mandelbrot.go (0.07s)">
<path fill="none" stroke="#b2a289" d="M548,-2269.6566C548,-2228.6906 548,-2141.196 548,-2091.3206"/>
<polygon fill="#b2a289" stroke="#b2a289" points="551.5001,-2091.279 548,-2081.279 544.5001,-2091.279 551.5001,-2091.279"/>
</a>
</g>
<g id="a_edge17&#45;label"><a xlink:title="image/png.opaque /Users/dfc/go/src/image/png/writer.go &#45;&gt; main.(*img).At /Users/dfc/devel/understanding&#45;the&#45;execution&#45;tracer/examples/mandelbrot&#45;pkg&#45;profile/mandelbrot.go (0.07s)">
<text text-anchor="middle" x="561" y="-2154.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.07s</text>
</a>
</g>
</g>
<!-- N37 -->
<g id="node38" class="node">
<title>N37</title>
<g id="a_node38"><a xlink:title="internal/poll.(*FD).Write /Users/dfc/go/src/internal/poll/fd_unix.go (0.05s)">
<polygon fill="#edebe9" stroke="#b2a895" points="483.5,-354 422.5,-354 422.5,-301 483.5,-301 483.5,-354"/>
<text text-anchor="middle" x="453" y="-343.6" font-family="Times,serif" font-size="8.00" fill="#000000">internal/poll</text>
<text text-anchor="middle" x="453" y="-334.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*FD)</text>
<text text-anchor="middle" x="453" y="-325.6" font-family="Times,serif" font-size="8.00" fill="#000000">Write</text>
<text text-anchor="middle" x="453" y="-316.6" font-family="Times,serif" font-size="8.00" fill="#000000">fd_unix.go</text>
<text text-anchor="middle" x="453" y="-307.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.05s (3.27%)</text>
</a>
</g>
</g>
<!-- N56 -->
<g id="node57" class="node">
<title>N56</title>
<g id="a_node57"><a xlink:title="syscall.Write /Users/dfc/go/src/syscall/syscall_unix.go (0.05s)">
<polygon fill="#edebe9" stroke="#b2a895" points="483.5,-250 422.5,-250 422.5,-206 483.5,-206 483.5,-250"/>
<text text-anchor="middle" x="453" y="-239.6" font-family="Times,serif" font-size="8.00" fill="#000000">syscall</text>
<text text-anchor="middle" x="453" y="-230.6" font-family="Times,serif" font-size="8.00" fill="#000000">Write</text>
<text text-anchor="middle" x="453" y="-221.6" font-family="Times,serif" font-size="8.00" fill="#000000">syscall_unix.go</text>
<text text-anchor="middle" x="453" y="-212.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.05s (3.27%)</text>
</a>
</g>
</g>
<!-- N37&#45;&gt;N56 -->
<g id="edge27" class="edge">
<title>N37&#45;&gt;N56</title>
<g id="a_edge27"><a xlink:title="internal/poll.(*FD).Write /Users/dfc/go/src/internal/poll/fd_unix.go &#45;&gt; syscall.Write /Users/dfc/go/src/syscall/syscall_unix.go (0.05s)">
<path fill="none" stroke="#b2a895" d="M453,-300.8358C453,-288.2993 453,-273.2498 453,-260.0933"/>
<polygon fill="#b2a895" stroke="#b2a895" points="456.5001,-260.0321 453,-250.0321 449.5001,-260.0322 456.5001,-260.0321"/>
</a>
</g>
<g id="a_edge27&#45;label"><a xlink:title="internal/poll.(*FD).Write /Users/dfc/go/src/internal/poll/fd_unix.go &#45;&gt; syscall.Write /Users/dfc/go/src/syscall/syscall_unix.go (0.05s)">
<text text-anchor="middle" x="466" y="-271.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.05s</text>
</a>
</g>
</g>
<!-- N38&#45;&gt;N3 -->
<g id="edge3" class="edge">
<title>N38&#45;&gt;N3</title>
<g id="a_edge3"><a xlink:title="main.seqFillImg /Users/dfc/devel/understanding&#45;the&#45;execution&#45;tracer/examples/mandelbrot&#45;pkg&#45;profile/mandelbrot.go &#45;&gt; main.fillPixel /Users/dfc/devel/understanding&#45;the&#45;execution&#45;tracer/examples/mandelbrot&#45;pkg&#45;profile/mandelbrot.go (1.27s)">
<path fill="none" stroke="#b20900" stroke-width="5" d="M356,-2567.7419C356,-2556.2626 356,-2541.6368 356,-2527.0613"/>
<polygon fill="#b20900" stroke="#b20900" stroke-width="5" points="360.3751,-2527.0179 356,-2517.0179 351.6251,-2527.018 360.3751,-2527.0179"/>
</a>
</g>
<g id="a_edge3&#45;label"><a xlink:title="main.seqFillImg /Users/dfc/devel/understanding&#45;the&#45;execution&#45;tracer/examples/mandelbrot&#45;pkg&#45;profile/mandelbrot.go &#45;&gt; main.fillPixel /Users/dfc/devel/understanding&#45;the&#45;execution&#45;tracer/examples/mandelbrot&#45;pkg&#45;profile/mandelbrot.go (1.27s)">
<text text-anchor="middle" x="369" y="-2538.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 1.27s</text>
</a>
</g>
</g>
<!-- N40 -->
<g id="node41" class="node">
<title>N40</title>
<g id="a_node41"><a xlink:title="os.(*File).write /Users/dfc/go/src/os/file_unix.go (0.05s)">
<polygon fill="#edebe9" stroke="#b2a895" points="483.5,-458 422.5,-458 422.5,-405 483.5,-405 483.5,-458"/>
<text text-anchor="middle" x="453" y="-447.6" font-family="Times,serif" font-size="8.00" fill="#000000">os</text>
<text text-anchor="middle" x="453" y="-438.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*File)</text>
<text text-anchor="middle" x="453" y="-429.6" font-family="Times,serif" font-size="8.00" fill="#000000">write</text>
<text text-anchor="middle" x="453" y="-420.6" font-family="Times,serif" font-size="8.00" fill="#000000">file_unix.go</text>
<text text-anchor="middle" x="453" y="-411.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.05s (3.27%)</text>
</a>
</g>
</g>
<!-- N39&#45;&gt;N40 -->
<g id="edge28" class="edge">
<title>N39&#45;&gt;N40</title>
<g id="a_edge28"><a xlink:title="os.(*File).Write /Users/dfc/go/src/os/file.go &#45;&gt; os.(*File).write /Users/dfc/go/src/os/file_unix.go (0.05s)">
<path fill="none" stroke="#b2a895" d="M453,-508.9873C453,-496.7358 453,-481.9766 453,-468.6407"/>
<polygon fill="#b2a895" stroke="#b2a895" points="456.5001,-468.3259 453,-458.3259 449.5001,-468.3259 456.5001,-468.3259"/>
</a>
</g>
<g id="a_edge28&#45;label"><a xlink:title="os.(*File).Write /Users/dfc/go/src/os/file.go &#45;&gt; os.(*File).write /Users/dfc/go/src/os/file_unix.go (0.05s)">
<text text-anchor="middle" x="466" y="-479.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.05s</text>
</a>
</g>
</g>
<!-- N40&#45;&gt;N37 -->
<g id="edge29" class="edge">
<title>N40&#45;&gt;N37</title>
<g id="a_edge29"><a xlink:title="os.(*File).write /Users/dfc/go/src/os/file_unix.go &#45;&gt; internal/poll.(*FD).Write /Users/dfc/go/src/internal/poll/fd_unix.go (0.05s)">
<path fill="none" stroke="#b2a895" d="M453,-404.9873C453,-392.7358 453,-377.9766 453,-364.6407"/>
<polygon fill="#b2a895" stroke="#b2a895" points="456.5001,-364.3259 453,-354.3259 449.5001,-364.3259 456.5001,-364.3259"/>
</a>
</g>
<g id="a_edge29&#45;label"><a xlink:title="os.(*File).write /Users/dfc/go/src/os/file_unix.go &#45;&gt; internal/poll.(*FD).Write /Users/dfc/go/src/internal/poll/fd_unix.go (0.05s)">
<text text-anchor="middle" x="466" y="-375.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.05s</text>
</a>
</g>
</g>
<!-- N41&#45;&gt;N16 -->
<g id="edge34" class="edge">
<title>N41&#45;&gt;N16</title>
<g id="a_edge34"><a xlink:title="runtime.(*mcache).nextFree /Users/dfc/go/src/runtime/malloc.go &#45;&gt; runtime.systemstack /Users/dfc/go/src/runtime/asm_amd64.s (0.03s)">
<path fill="none" stroke="#b2ada1" d="M580.6689,-1675.4436C587.4319,-1658.6098 596.2142,-1636.7493 603.3309,-1619.035"/>
<polygon fill="#b2ada1" stroke="#b2ada1" points="606.6096,-1620.2625 607.0898,-1609.6785 600.1142,-1617.6529 606.6096,-1620.2625"/>
</a>
</g>
<g id="a_edge34&#45;label"><a xlink:title="runtime.(*mcache).nextFree /Users/dfc/go/src/runtime/malloc.go &#45;&gt; runtime.systemstack /Users/dfc/go/src/runtime/asm_amd64.s (0.03s)">
<text text-anchor="middle" x="610" y="-1635.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.03s</text>
</a>
</g>
</g>
<!-- N43 -->
<g id="node44" class="node">
<title>N43</title>
<g id="a_node44"><a xlink:title="runtime.(*mcache).refill /Users/dfc/go/src/runtime/mcache.go (0.02s)">
<polygon fill="#edeceb" stroke="#b2afa6" points="725.5,-1397 664.5,-1397 664.5,-1344 725.5,-1344 725.5,-1397"/>
<text text-anchor="middle" x="695" y="-1386.6" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="695" y="-1377.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*mcache)</text>
<text text-anchor="middle" x="695" y="-1368.6" font-family="Times,serif" font-size="8.00" fill="#000000">refill</text>
<text text-anchor="middle" x="695" y="-1359.6" font-family="Times,serif" font-size="8.00" fill="#000000">mcache.go</text>
<text text-anchor="middle" x="695" y="-1350.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.02s (1.31%)</text>
</a>
</g>
</g>
<!-- N42&#45;&gt;N43 -->
<g id="edge36" class="edge">
<title>N42&#45;&gt;N43</title>
<g id="a_edge36"><a xlink:title="runtime.(*mcache).nextFree.func1 /Users/dfc/go/src/runtime/malloc.go &#45;&gt; runtime.(*mcache).refill /Users/dfc/go/src/runtime/mcache.go (0.02s)">
<path fill="none" stroke="#b2afa6" d="M695,-1447.9083C695,-1435.259 695,-1420.5418 695,-1407.3573"/>
<polygon fill="#b2afa6" stroke="#b2afa6" points="698.5001,-1407.181 695,-1397.181 691.5001,-1407.1811 698.5001,-1407.181"/>
</a>
</g>
<g id="a_edge36&#45;label"><a xlink:title="runtime.(*mcache).nextFree.func1 /Users/dfc/go/src/runtime/malloc.go &#45;&gt; runtime.(*mcache).refill /Users/dfc/go/src/runtime/mcache.go (0.02s)">
<text text-anchor="middle" x="708" y="-1418.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.02s</text>
</a>
</g>
</g>
<!-- N44 -->
<g id="node45" class="node">
<title>N44</title>
<g id="a_node45"><a xlink:title="runtime.(*mcentral).cacheSpan /Users/dfc/go/src/runtime/mcentral.go (0.02s)">
<polygon fill="#edeceb" stroke="#b2afa6" points="725.5,-1293 664.5,-1293 664.5,-1240 725.5,-1240 725.5,-1293"/>
<text text-anchor="middle" x="695" y="-1282.6" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="695" y="-1273.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*mcentral)</text>
<text text-anchor="middle" x="695" y="-1264.6" font-family="Times,serif" font-size="8.00" fill="#000000">cacheSpan</text>
<text text-anchor="middle" x="695" y="-1255.6" font-family="Times,serif" font-size="8.00" fill="#000000">mcentral.go</text>
<text text-anchor="middle" x="695" y="-1246.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.02s (1.31%)</text>
</a>
</g>
</g>
<!-- N43&#45;&gt;N44 -->
<g id="edge37" class="edge">
<title>N43&#45;&gt;N44</title>
<g id="a_edge37"><a xlink:title="runtime.(*mcache).refill /Users/dfc/go/src/runtime/mcache.go &#45;&gt; runtime.(*mcentral).cacheSpan /Users/dfc/go/src/runtime/mcentral.go (0.02s)">
<path fill="none" stroke="#b2afa6" d="M695,-1343.9873C695,-1331.7358 695,-1316.9766 695,-1303.6407"/>
<polygon fill="#b2afa6" stroke="#b2afa6" points="698.5001,-1303.3259 695,-1293.3259 691.5001,-1303.3259 698.5001,-1303.3259"/>
</a>
</g>
<g id="a_edge37&#45;label"><a xlink:title="runtime.(*mcache).refill /Users/dfc/go/src/runtime/mcache.go &#45;&gt; runtime.(*mcentral).cacheSpan /Users/dfc/go/src/runtime/mcentral.go (0.02s)">
<text text-anchor="middle" x="708" y="-1314.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.02s</text>
</a>
</g>
</g>
<!-- N44&#45;&gt;N19 -->
<g id="edge38" class="edge">
<title>N44&#45;&gt;N19</title>
<g id="a_edge38"><a xlink:title="runtime.(*mcentral).cacheSpan /Users/dfc/go/src/runtime/mcentral.go &#45;&gt; runtime.(*mcentral).grow /Users/dfc/go/src/runtime/mcentral.go (0.02s)">
<path fill="none" stroke="#b2afa6" d="M695,-1239.9873C695,-1227.7358 695,-1212.9766 695,-1199.6407"/>
<polygon fill="#b2afa6" stroke="#b2afa6" points="698.5001,-1199.3259 695,-1189.3259 691.5001,-1199.3259 698.5001,-1199.3259"/>
</a>
</g>
<g id="a_edge38&#45;label"><a xlink:title="runtime.(*mcentral).cacheSpan /Users/dfc/go/src/runtime/mcentral.go &#45;&gt; runtime.(*mcentral).grow /Users/dfc/go/src/runtime/mcentral.go (0.02s)">
<text text-anchor="middle" x="708" y="-1210.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.02s</text>
</a>
</g>
</g>
<!-- N45&#45;&gt;N20 -->
<g id="edge48" class="edge">
<title>N45&#45;&gt;N20</title>
<g id="a_edge48"><a xlink:title="runtime.(*mheap).alloc /Users/dfc/go/src/runtime/mheap.go &#45;&gt; runtime.memclrNoHeapPointers /Users/dfc/go/src/runtime/memclr_amd64.s (0.01s)">
<path fill="none" stroke="#b2b1ac" d="M695,-1031.9873C695,-1019.4227 695,-1004.2205 695,-990.621"/>
<polygon fill="#b2b1ac" stroke="#b2b1ac" points="698.5001,-990.6041 695,-980.6041 691.5001,-990.6041 698.5001,-990.6041"/>
</a>
</g>
<g id="a_edge48&#45;label"><a xlink:title="runtime.(*mheap).alloc /Users/dfc/go/src/runtime/mheap.go &#45;&gt; runtime.memclrNoHeapPointers /Users/dfc/go/src/runtime/memclr_amd64.s (0.01s)">
<text text-anchor="middle" x="708" y="-1002.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.01s</text>
</a>
</g>
</g>
<!-- N48 -->
<g id="node49" class="node">
<title>N48</title>
<g id="a_node49"><a xlink:title="runtime.(*mheap).alloc_m /Users/dfc/go/src/runtime/mheap.go (0.01s)">
<polygon fill="#edecec" stroke="#b2b1ac" points="645.5,-1397 584.5,-1397 584.5,-1344 645.5,-1344 645.5,-1397"/>
<text text-anchor="middle" x="615" y="-1386.6" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="615" y="-1377.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*mheap)</text>
<text text-anchor="middle" x="615" y="-1368.6" font-family="Times,serif" font-size="8.00" fill="#000000">alloc_m</text>
<text text-anchor="middle" x="615" y="-1359.6" font-family="Times,serif" font-size="8.00" fill="#000000">mheap.go</text>
<text text-anchor="middle" x="615" y="-1350.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.01s (0.65%)</text>
</a>
</g>
</g>
<!-- N46&#45;&gt;N48 -->
<g id="edge49" class="edge">
<title>N46&#45;&gt;N48</title>
<g id="a_edge49"><a xlink:title="runtime.(*mheap).alloc.func1 /Users/dfc/go/src/runtime/mheap.go &#45;&gt; runtime.(*mheap).alloc_m /Users/dfc/go/src/runtime/mheap.go (0.01s)">
<path fill="none" stroke="#b2b1ac" d="M615.7134,-1447.9083C615.5969,-1435.259 615.4612,-1420.5418 615.3397,-1407.3573"/>
<polygon fill="#b2b1ac" stroke="#b2b1ac" points="618.838,-1407.1483 615.2459,-1397.181 611.8383,-1407.2129 618.838,-1407.1483"/>
</a>
</g>
<g id="a_edge49&#45;label"><a xlink:title="runtime.(*mheap).alloc.func1 /Users/dfc/go/src/runtime/mheap.go &#45;&gt; runtime.(*mheap).alloc_m /Users/dfc/go/src/runtime/mheap.go (0.01s)">
<text text-anchor="middle" x="628" y="-1418.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.01s</text>
</a>
</g>
</g>
<!-- N47 -->
<g id="node48" class="node">
<title>N47</title>
<g id="a_node48"><a xlink:title="runtime.(*mheap).allocSpanLocked /Users/dfc/go/src/runtime/mheap.go (0.01s)">
<polygon fill="#edecec" stroke="#b2b1ac" points="643.5,-1293 582.5,-1293 582.5,-1240 643.5,-1240 643.5,-1293"/>
<text text-anchor="middle" x="613" y="-1282.6" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="613" y="-1273.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*mheap)</text>
<text text-anchor="middle" x="613" y="-1264.6" font-family="Times,serif" font-size="8.00" fill="#000000">allocSpanLocked</text>
<text text-anchor="middle" x="613" y="-1255.6" font-family="Times,serif" font-size="8.00" fill="#000000">mheap.go</text>
<text text-anchor="middle" x="613" y="-1246.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.01s (0.65%)</text>
</a>
</g>
</g>
<!-- N49 -->
<g id="node50" class="node">
<title>N49</title>
<g id="a_node50"><a xlink:title="runtime.(*mheap).grow /Users/dfc/go/src/runtime/mheap.go (0.01s)">
<polygon fill="#edecec" stroke="#b2b1ac" points="634.5,-1189 573.5,-1189 573.5,-1136 634.5,-1136 634.5,-1189"/>
<text text-anchor="middle" x="604" y="-1178.6" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="604" y="-1169.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*mheap)</text>
<text text-anchor="middle" x="604" y="-1160.6" font-family="Times,serif" font-size="8.00" fill="#000000">grow</text>
<text text-anchor="middle" x="604" y="-1151.6" font-family="Times,serif" font-size="8.00" fill="#000000">mheap.go</text>
<text text-anchor="middle" x="604" y="-1142.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.01s (0.65%)</text>
</a>
</g>
</g>
<!-- N47&#45;&gt;N49 -->
<g id="edge50" class="edge">
<title>N47&#45;&gt;N49</title>
<g id="a_edge50"><a xlink:title="runtime.(*mheap).allocSpanLocked /Users/dfc/go/src/runtime/mheap.go &#45;&gt; runtime.(*mheap).grow /Users/dfc/go/src/runtime/mheap.go (0.01s)">
<path fill="none" stroke="#b2b1ac" d="M610.7056,-1239.9873C609.6454,-1227.7358 608.3682,-1212.9766 607.2141,-1199.6407"/>
<polygon fill="#b2b1ac" stroke="#b2b1ac" points="610.6707,-1198.9869 606.3215,-1189.3259 603.6968,-1199.5904 610.6707,-1198.9869"/>
</a>
</g>
<g id="a_edge50&#45;label"><a xlink:title="runtime.(*mheap).allocSpanLocked /Users/dfc/go/src/runtime/mheap.go &#45;&gt; runtime.(*mheap).grow /Users/dfc/go/src/runtime/mheap.go (0.01s)">
<text text-anchor="middle" x="622" y="-1210.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.01s</text>
</a>
</g>
</g>
<!-- N48&#45;&gt;N47 -->
<g id="edge51" class="edge">
<title>N48&#45;&gt;N47</title>
<g id="a_edge51"><a xlink:title="runtime.(*mheap).alloc_m /Users/dfc/go/src/runtime/mheap.go &#45;&gt; runtime.(*mheap).allocSpanLocked /Users/dfc/go/src/runtime/mheap.go (0.01s)">
<path fill="none" stroke="#b2b1ac" d="M614.4901,-1343.9873C614.2545,-1331.7358 613.9707,-1316.9766 613.7142,-1303.6407"/>
<polygon fill="#b2b1ac" stroke="#b2b1ac" points="617.2076,-1303.2567 613.5159,-1293.3259 610.2089,-1303.3914 617.2076,-1303.2567"/>
</a>
</g>
<g id="a_edge51&#45;label"><a xlink:title="runtime.(*mheap).alloc_m /Users/dfc/go/src/runtime/mheap.go &#45;&gt; runtime.(*mheap).allocSpanLocked /Users/dfc/go/src/runtime/mheap.go (0.01s)">
<text text-anchor="middle" x="627" y="-1314.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.01s</text>
</a>
</g>
</g>
<!-- N50 -->
<g id="node51" class="node">
<title>N50</title>
<g id="a_node51"><a xlink:title="runtime.(*mheap).sysAlloc /Users/dfc/go/src/runtime/malloc.go (0.01s)">
<polygon fill="#edecec" stroke="#b2b1ac" points="633.5,-1085 572.5,-1085 572.5,-1032 633.5,-1032 633.5,-1085"/>
<text text-anchor="middle" x="603" y="-1074.6" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="603" y="-1065.6" font-family="Times,serif" font-size="8.00" fill="#000000">(*mheap)</text>
<text text-anchor="middle" x="603" y="-1056.6" font-family="Times,serif" font-size="8.00" fill="#000000">sysAlloc</text>
<text text-anchor="middle" x="603" y="-1047.6" font-family="Times,serif" font-size="8.00" fill="#000000">malloc.go</text>
<text text-anchor="middle" x="603" y="-1038.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.01s (0.65%)</text>
</a>
</g>
</g>
<!-- N49&#45;&gt;N50 -->
<g id="edge52" class="edge">
<title>N49&#45;&gt;N50</title>
<g id="a_edge52"><a xlink:title="runtime.(*mheap).grow /Users/dfc/go/src/runtime/mheap.go &#45;&gt; runtime.(*mheap).sysAlloc /Users/dfc/go/src/runtime/malloc.go (0.01s)">
<path fill="none" stroke="#b2b1ac" d="M603.7451,-1135.9873C603.6273,-1123.7358 603.4854,-1108.9766 603.3571,-1095.6407"/>
<polygon fill="#b2b1ac" stroke="#b2b1ac" points="606.854,-1095.2917 603.2579,-1085.3259 599.8543,-1095.3591 606.854,-1095.2917"/>
</a>
</g>
<g id="a_edge52&#45;label"><a xlink:title="runtime.(*mheap).grow /Users/dfc/go/src/runtime/mheap.go &#45;&gt; runtime.(*mheap).sysAlloc /Users/dfc/go/src/runtime/malloc.go (0.01s)">
<text text-anchor="middle" x="616" y="-1106.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.01s</text>
</a>
</g>
</g>
<!-- N55 -->
<g id="node56" class="node">
<title>N55</title>
<g id="a_node56"><a xlink:title="runtime.sysMap /Users/dfc/go/src/runtime/mem_darwin.go (0.01s)">
<polygon fill="#edecec" stroke="#b2b1ac" points="632.5,-976.5 571.5,-976.5 571.5,-932.5 632.5,-932.5 632.5,-976.5"/>
<text text-anchor="middle" x="602" y="-966.1" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="602" y="-957.1" font-family="Times,serif" font-size="8.00" fill="#000000">sysMap</text>
<text text-anchor="middle" x="602" y="-948.1" font-family="Times,serif" font-size="8.00" fill="#000000">mem_darwin.go</text>
<text text-anchor="middle" x="602" y="-939.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.01s (0.65%)</text>
</a>
</g>
</g>
<!-- N50&#45;&gt;N55 -->
<g id="edge53" class="edge">
<title>N50&#45;&gt;N55</title>
<g id="a_edge53"><a xlink:title="runtime.(*mheap).sysAlloc /Users/dfc/go/src/runtime/malloc.go &#45;&gt; runtime.sysMap /Users/dfc/go/src/runtime/mem_darwin.go (0.01s)">
<path fill="none" stroke="#b2b1ac" d="M602.7451,-1031.9873C602.6128,-1018.2341 602.4502,-1001.3207 602.3107,-986.8083"/>
<polygon fill="#b2b1ac" stroke="#b2b1ac" points="605.81,-986.7107 602.2139,-976.7448 598.8103,-986.778 605.81,-986.7107"/>
</a>
</g>
<g id="a_edge53&#45;label"><a xlink:title="runtime.(*mheap).sysAlloc /Users/dfc/go/src/runtime/malloc.go &#45;&gt; runtime.sysMap /Users/dfc/go/src/runtime/mem_darwin.go (0.01s)">
<text text-anchor="middle" x="615" y="-1002.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.01s</text>
</a>
</g>
</g>
<!-- N53 -->
<g id="node54" class="node">
<title>N53</title>
<g id="a_node54"><a xlink:title="runtime.newMarkBits /Users/dfc/go/src/runtime/mheap.go (0.01s)">
<polygon fill="#edecec" stroke="#b2b1ac" points="818.5,-976.5 757.5,-976.5 757.5,-932.5 818.5,-932.5 818.5,-976.5"/>
<text text-anchor="middle" x="788" y="-966.1" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="788" y="-957.1" font-family="Times,serif" font-size="8.00" fill="#000000">newMarkBits</text>
<text text-anchor="middle" x="788" y="-948.1" font-family="Times,serif" font-size="8.00" fill="#000000">mheap.go</text>
<text text-anchor="middle" x="788" y="-939.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.01s (0.65%)</text>
</a>
</g>
</g>
<!-- N51&#45;&gt;N53 -->
<g id="edge54" class="edge">
<title>N51&#45;&gt;N53</title>
<g id="a_edge54"><a xlink:title="runtime.heapBits.initSpan /Users/dfc/go/src/runtime/mbitmap.go &#45;&gt; runtime.newMarkBits /Users/dfc/go/src/runtime/mheap.go (0.01s)">
<path fill="none" stroke="#b2b1ac" d="M782.7845,-1031.9873C783.7102,-1018.2341 784.8486,-1001.3207 785.8254,-986.8083"/>
<polygon fill="#b2b1ac" stroke="#b2b1ac" points="789.3232,-986.9573 786.5028,-976.7448 782.339,-986.4872 789.3232,-986.9573"/>
</a>
</g>
<g id="a_edge54&#45;label"><a xlink:title="runtime.heapBits.initSpan /Users/dfc/go/src/runtime/mbitmap.go &#45;&gt; runtime.newMarkBits /Users/dfc/go/src/runtime/mheap.go (0.01s)">
<text text-anchor="middle" x="797" y="-1002.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.01s</text>
</a>
</g>
</g>
<!-- N52 -->
<g id="node53" class="node">
<title>N52</title>
<g id="a_node53"><a xlink:title="runtime.newArenaMayUnlock /Users/dfc/go/src/runtime/mheap.go (0.01s)">
<polygon fill="#edecec" stroke="#b2b1ac" points="776,-872.5 706,-872.5 706,-828.5 776,-828.5 776,-872.5"/>
<text text-anchor="middle" x="741" y="-862.1" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="741" y="-853.1" font-family="Times,serif" font-size="8.00" fill="#000000">newArenaMayUnlock</text>
<text text-anchor="middle" x="741" y="-844.1" font-family="Times,serif" font-size="8.00" fill="#000000">mheap.go</text>
<text text-anchor="middle" x="741" y="-835.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.01s (0.65%)</text>
</a>
</g>
</g>
<!-- N54 -->
<g id="node55" class="node">
<title>N54</title>
<g id="a_node55"><a xlink:title="runtime.sysAlloc /Users/dfc/go/src/runtime/mem_darwin.go (0.01s)">
<polygon fill="#edecec" stroke="#b2b1ac" points="708.5,-768.5 647.5,-768.5 647.5,-724.5 708.5,-724.5 708.5,-768.5"/>
<text text-anchor="middle" x="678" y="-758.1" font-family="Times,serif" font-size="8.00" fill="#000000">runtime</text>
<text text-anchor="middle" x="678" y="-749.1" font-family="Times,serif" font-size="8.00" fill="#000000">sysAlloc</text>
<text text-anchor="middle" x="678" y="-740.1" font-family="Times,serif" font-size="8.00" fill="#000000">mem_darwin.go</text>
<text text-anchor="middle" x="678" y="-731.1" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.01s (0.65%)</text>
</a>
</g>
</g>
<!-- N52&#45;&gt;N54 -->
<g id="edge55" class="edge">
<title>N52&#45;&gt;N54</title>
<g id="a_edge55"><a xlink:title="runtime.newArenaMayUnlock /Users/dfc/go/src/runtime/mheap.go &#45;&gt; runtime.sysAlloc /Users/dfc/go/src/runtime/mem_darwin.go (0.01s)">
<path fill="none" stroke="#b2b1ac" d="M727.6393,-828.4443C718.6185,-813.5528 706.587,-793.6913 696.6284,-777.2517"/>
<polygon fill="#b2b1ac" stroke="#b2b1ac" points="699.5162,-775.2636 691.3414,-768.5239 693.5291,-778.8905 699.5162,-775.2636"/>
</a>
</g>
<g id="a_edge55&#45;label"><a xlink:title="runtime.newArenaMayUnlock /Users/dfc/go/src/runtime/mheap.go &#45;&gt; runtime.sysAlloc /Users/dfc/go/src/runtime/mem_darwin.go (0.01s)">
<text text-anchor="middle" x="726" y="-794.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.01s</text>
</a>
</g>
</g>
<!-- N53&#45;&gt;N52 -->
<g id="edge56" class="edge">
<title>N53&#45;&gt;N52</title>
<g id="a_edge56"><a xlink:title="runtime.newMarkBits /Users/dfc/go/src/runtime/mheap.go &#45;&gt; runtime.newArenaMayUnlock /Users/dfc/go/src/runtime/mheap.go (0.01s)">
<path fill="none" stroke="#b2b1ac" d="M778.0325,-932.4443C771.365,-917.6907 762.4928,-898.0586 755.1042,-881.7092"/>
<polygon fill="#b2b1ac" stroke="#b2b1ac" points="758.2608,-880.1952 750.9531,-872.5239 751.882,-883.078 758.2608,-880.1952"/>
</a>
</g>
<g id="a_edge56&#45;label"><a xlink:title="runtime.newMarkBits /Users/dfc/go/src/runtime/mheap.go &#45;&gt; runtime.newArenaMayUnlock /Users/dfc/go/src/runtime/mheap.go (0.01s)">
<text text-anchor="middle" x="780" y="-898.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.01s</text>
</a>
</g>
</g>
<!-- N54&#45;&gt;N12 -->
<g id="edge57" class="edge">
<title>N54&#45;&gt;N12</title>
<g id="a_edge57"><a xlink:title="runtime.sysAlloc /Users/dfc/go/src/runtime/mem_darwin.go &#45;&gt; runtime.mmap /Users/dfc/go/src/runtime/sys_darwin_amd64.s (0.01s)">
<path fill="none" stroke="#b2b1ac" d="M670.034,-724.3837C665.2851,-711.1995 659.129,-694.1081 653.6276,-678.8345"/>
<polygon fill="#b2b1ac" stroke="#b2b1ac" points="656.8101,-677.3416 650.1283,-669.1194 650.2242,-679.7138 656.8101,-677.3416"/>
</a>
</g>
<g id="a_edge57&#45;label"><a xlink:title="runtime.sysAlloc /Users/dfc/go/src/runtime/mem_darwin.go &#45;&gt; runtime.mmap /Users/dfc/go/src/runtime/sys_darwin_amd64.s (0.01s)">
<text text-anchor="middle" x="674" y="-690.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.01s</text>
</a>
</g>
</g>
<!-- N55&#45;&gt;N12 -->
<g id="edge58" class="edge">
<title>N55&#45;&gt;N12</title>
<g id="a_edge58"><a xlink:title="runtime.sysMap /Users/dfc/go/src/runtime/mem_darwin.go &#45;&gt; runtime.mmap /Users/dfc/go/src/runtime/sys_darwin_amd64.s (0.01s)">
<path fill="none" stroke="#b2b1ac" d="M604.6721,-932.4553C611.0704,-879.6692 627.3338,-745.4958 635.3664,-679.2272"/>
<polygon fill="#b2b1ac" stroke="#b2b1ac" points="638.8533,-679.546 636.5821,-669.1974 631.9042,-678.7036 638.8533,-679.546"/>
</a>
</g>
<g id="a_edge58&#45;label"><a xlink:title="runtime.sysMap /Users/dfc/go/src/runtime/mem_darwin.go &#45;&gt; runtime.mmap /Users/dfc/go/src/runtime/sys_darwin_amd64.s (0.01s)">
<text text-anchor="middle" x="634" y="-794.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.01s</text>
</a>
</g>
</g>
<!-- N57 -->
<g id="node58" class="node">
<title>N57</title>
<g id="a_node58"><a xlink:title="syscall.write /Users/dfc/go/src/syscall/zsyscall_darwin_amd64.go (0.05s)">
<polygon fill="#edebe9" stroke="#b2a895" points="494,-155 412,-155 412,-111 494,-111 494,-155"/>
<text text-anchor="middle" x="453" y="-144.6" font-family="Times,serif" font-size="8.00" fill="#000000">syscall</text>
<text text-anchor="middle" x="453" y="-135.6" font-family="Times,serif" font-size="8.00" fill="#000000">write</text>
<text text-anchor="middle" x="453" y="-126.6" font-family="Times,serif" font-size="8.00" fill="#000000">zsyscall_darwin_amd64.go</text>
<text text-anchor="middle" x="453" y="-117.6" font-family="Times,serif" font-size="8.00" fill="#000000">0 of 0.05s (3.27%)</text>
</a>
</g>
</g>
<!-- N56&#45;&gt;N57 -->
<g id="edge30" class="edge">
<title>N56&#45;&gt;N57</title>
<g id="a_edge30"><a xlink:title="syscall.Write /Users/dfc/go/src/syscall/syscall_unix.go &#45;&gt; syscall.write /Users/dfc/go/src/syscall/zsyscall_darwin_amd64.go (0.05s)">
<path fill="none" stroke="#b2a895" d="M453,-205.9663C453,-193.9427 453,-178.8283 453,-165.4785"/>
<polygon fill="#b2a895" stroke="#b2a895" points="456.5001,-165.2433 453,-155.2433 449.5001,-165.2433 456.5001,-165.2433"/>
</a>
</g>
<g id="a_edge30&#45;label"><a xlink:title="syscall.Write /Users/dfc/go/src/syscall/syscall_unix.go &#45;&gt; syscall.write /Users/dfc/go/src/syscall/zsyscall_darwin_amd64.go (0.05s)">
<text text-anchor="middle" x="466" y="-176.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.05s</text>
</a>
</g>
</g>
<!-- N57&#45;&gt;N9 -->
<g id="edge31" class="edge">
<title>N57&#45;&gt;N9</title>
<g id="a_edge31"><a xlink:title="syscall.write /Users/dfc/go/src/syscall/zsyscall_darwin_amd64.go &#45;&gt; syscall.Syscall /Users/dfc/go/src/syscall/asm_darwin_amd64.s (0.05s)">
<path fill="none" stroke="#b2a895" d="M453,-110.9039C453,-99.1279 453,-84.2673 453,-70.5053"/>
<polygon fill="#b2a895" stroke="#b2a895" points="456.5001,-70.2649 453,-60.2649 449.5001,-70.265 456.5001,-70.2649"/>
</a>
</g>
<g id="a_edge31&#45;label"><a xlink:title="syscall.write /Users/dfc/go/src/syscall/zsyscall_darwin_amd64.go &#45;&gt; syscall.Syscall /Users/dfc/go/src/syscall/asm_darwin_amd64.s (0.05s)">
<text text-anchor="middle" x="466" y="-81.8" font-family="Times,serif" font-size="14.00" fill="#000000"> 0.05s</text>
</a>
</g>
</g>
</g>
</g></svg>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tracing_vs_profiling"><a class="anchor" href="#tracing_vs_profiling"></a><a class="link" href="#tracing_vs_profiling">5.4. Tracing vs Profiling</a></h3>
<div class="paragraph">
<p>Hopefully this example shows the limitations of profiling.
Profiling told us what the profiler saw; <code>fillPixel</code> was doing all the work. There didn&#8217;t look like there was much that could be done about that.</p>
</div>
<div class="paragraph">
<p>So now it&#8217;s a good time to introduce the execution tracer which gives a different view of the same program.</p>
</div>
<div class="sect3">
<h4 id="using_the_execution_tracer"><a class="anchor" href="#using_the_execution_tracer"></a><a class="link" href="#using_the_execution_tracer">5.4.1. Using the execution tracer</a></h4>
<div class="paragraph">
<p>Using the tracer is as simple as asking for a <code>profile.TraceProfile</code>, nothing else changes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span>
<span class="tok-kn">import</span> <span class="tok-s">&quot;github.com/pkg/profile&quot;</span>

<span class="tok-kd">func</span> <span class="tok-nx">main</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-k">defer</span> <span class="tok-nx">profile</span><span class="tok-p">.</span><span class="tok-nx">Start</span><span class="tok-p">(</span><span class="tok-nx">profile</span><span class="tok-p">.</span><span class="tok-nx">TraceProfile</span><span class="tok-p">,</span> <span class="tok-nx">profile</span><span class="tok-p">.</span><span class="tok-nx">ProfilePath</span><span class="tok-p">(</span><span class="tok-s">&quot;.&quot;</span><span class="tok-p">)).</span><span class="tok-nx">Stop</span><span class="tok-p">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When we run the program, we get a <code>trace.out</code> file in the current working directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% go build mandelbrot.go
% % time ./mandelbrot
2017/09/17 13:19:10 profile: trace enabled, trace.out
2017/09/17 13:19:12 profile: trace disabled, trace.out

real    0m1.740s
user    0m1.707s
sys     0m0.020s</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just like pprof, there is a tool in the <code>go</code> command to analyse the trace.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% go tool trace trace.out
2017/09/17 12:41:39 Parsing trace...
2017/09/17 12:41:40 Serializing trace...
2017/09/17 12:41:40 Splitting trace...
2017/09/17 12:41:40 Opening browser. Trace viewer s listening on http://127.0.0.1:57842</code></pre>
</div>
</div>
<div class="paragraph">
<p>This tool is a little bit different to <code>go tool pprof</code>. The execution tracer is reusing a lot of the profile visualisation infrastructure built into Chrome, so <code>go tool trace</code> acts as a server to translate the raw execution trace into data which Chome can display natively.</p>
</div>
</div>
<div class="sect3">
<h4 id="analysing_the_trace"><a class="anchor" href="#analysing_the_trace"></a><a class="link" href="#analysing_the_trace">5.4.2. Analysing the trace</a></h4>
<div class="paragraph">
<p>We can see from the trace that the program is only using one cpu.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span><span class="tok-kd">func</span> <span class="tok-nx">seqFillImg</span><span class="tok-p">(</span><span class="tok-nx">m</span> <span class="tok-o">*</span><span class="tok-nx">img</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-k">for</span> <span class="tok-nx">i</span><span class="tok-p">,</span> <span class="tok-nx">row</span> <span class="tok-o">:=</span> <span class="tok-k">range</span> <span class="tok-nx">m</span><span class="tok-p">.</span><span class="tok-nx">m</span> <span class="tok-p">{</span>
		<span class="tok-k">for</span> <span class="tok-nx">j</span> <span class="tok-o">:=</span> <span class="tok-k">range</span> <span class="tok-nx">row</span> <span class="tok-p">{</span>
			<span class="tok-nx">fillPixel</span><span class="tok-p">(</span><span class="tok-nx">m</span><span class="tok-p">,</span> <span class="tok-nx">i</span><span class="tok-p">,</span> <span class="tok-nx">j</span><span class="tok-p">)</span>
		<span class="tok-p">}</span>
	<span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This isn&#8217;t a surprise, by default <code>mandelbrot.go</code> calls <code>fillPixel</code> for each pixel in each row in sequence.</p>
</div>
<div class="paragraph">
<p>Once the image is painted, see the execution switches to writing the <code>.png</code> file.
This generates garbage on the heap, and so the trace changes at that point, we can see the classic saw tooth pattern of a garbage collected heap.</p>
</div>
<div class="paragraph">
<p>The trace profile offers timing resolution down to the <em>microsecond</em> level.
This is something you just can&#8217;t get with external profiling.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">go tool trace</div>
<div class="paragraph">
<p>Before we go on there are some things we should talk about the usage of the trace tool.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The tool uses the javascript debugging support built into Chrome. Trace profiles can only be viewed in Chrome, they won&#8217;t work in Firefox, Safari, IE/Edge. Sorry.</p>
</li>
<li>
<p>Because this is a Google product, it supports keyboard shortcuts; use <code>WASD</code> to navigate, use <code>?</code> to get a list.</p>
</li>
<li>
<p>Viewing traces can take a <strong>lot</strong> of memory. Seriously, 4Gb won&#8217;t cut it, 8Gb is probably the minimum, more is definitely better.</p>
</li>
<li>
<p>If you&#8217;ve installed Go from an OS distribution like Fedora, the support files for the trace viewer may not be part of the main <code>golang</code> deb/rpm, they might be in some <code>-extra</code> package.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using_more_than_one_cpu"><a class="anchor" href="#using_more_than_one_cpu"></a><a class="link" href="#using_more_than_one_cpu">5.5. Using more than one CPU</a></h3>
<div class="paragraph">
<p>We saw from the previous trace that the program is running sequentially and not taking advantage of the other CPUs on this machine.</p>
</div>
<div class="paragraph">
<p>Mandelbrot generation is known as <em>embarassingly_parallel</em>.
Each pixel is independant of any other, they could all be computed in parallel.
So, let&#8217;s try that.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% go build mandelbrot.go
% time ./mandelbrot -mode px
2017/09/17 13:19:48 profile: trace enabled, trace.out
2017/09/17 13:19:50 profile: trace disabled, trace.out

real    0m1.764s
user    0m4.031s
sys     0m0.865s</code></pre>
</div>
</div>
<div class="paragraph">
<p>So the runtime was basically the same. There was more user time, which makes sense, we were using all the CPUs, but the real (wall clock) time was about the same.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s look a the trace.</p>
</div>
<div class="paragraph">
<p>As you can see this trace generated <em>much</em> more data.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It looks like lots of work is being done, but if you zoom right in, there are gaps. This is believed to be the scheduler.</p>
</li>
<li>
<p>While we&#8217;re using all four cores, because each <code>fillPixel</code> is a relatively small amount of work, we&#8217;re spending a lot of time in scheduling overhead.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="batching_up_work"><a class="anchor" href="#batching_up_work"></a><a class="link" href="#batching_up_work">5.6. Batching up work</a></h3>
<div class="paragraph">
<p>Using one goroutine per pixel was too fine grained. There wasn&#8217;t enough work to justify the cost of the goroutine.</p>
</div>
<div class="paragraph">
<p>Instead, let&#8217;s try processing one row per goroutine.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% go build mandelbrot.go
% time ./mandelbrot -mode row
2017/09/17 13:41:55 profile: trace enabled, trace.out
2017/09/17 13:41:55 profile: trace disabled, trace.out

real    0m0.764s
user    0m1.907s
sys     0m0.025s</code></pre>
</div>
</div>
<div class="paragraph">
<p>This looks like a good improvement, we almost halved the runtime of the program. Let&#8217;s look at the trace.</p>
</div>
<div class="paragraph">
<p>As you can see the trace is now smaller and easier to work with.
We get to see the whole trace in span, which is a nice bonus.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>At the start of the program we see the number of goroutines ramp up to around 1,000. This is an improvement over the 1 &lt;&lt; 20 that we saw in the previous trace.</p>
</li>
<li>
<p>Zooming in we see <code>onePerRowFillImg</code> runs for longer, and as the goroutine <em>producing</em> work is done early, the scheduler efficiently works through the remaining runnable goroutines.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="using_workers"><a class="anchor" href="#using_workers"></a><a class="link" href="#using_workers">5.7. Using workers</a></h3>
<div class="paragraph">
<p><code>mandelbrot.go</code> supports one other mode, let&#8217;s try it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% go build mandelbrot.go
% time ./mandelbrot -mode workers
2017/09/17 13:49:46 profile: trace enabled, trace.out
2017/09/17 13:49:50 profile: trace disabled, trace.out

real    0m4.207s
user    0m4.459s
sys     0m1.284s</code></pre>
</div>
</div>
<div class="paragraph">
<p>So, the runtime was much worse than any previous. Let&#8217;s look at the trace and see if we can figure out what happened.</p>
</div>
<div class="paragraph">
<p>Looking at the trace you can see that with only one worker process the producer and consumer tend to alternate because there is only one worker and one consumer. Let&#8217;s increase the number of workers</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% go build mandelbrot.go
% time ./mandelbrot -mode workers -workers 4
2017/09/17 13:52:51 profile: trace enabled, trace.out
2017/09/17 13:52:57 profile: trace disabled, trace.out

real    0m5.528s
user    0m7.307s
sys     0m4.311s</code></pre>
</div>
</div>
<div class="paragraph">
<p>So that made it worse!
More real time, more CPU time.
Let&#8217;s look at the trace to see what happened.</p>
</div>
<div class="paragraph">
<p>That trace is a mess.
There were more workers available, but the seemed to spend all their time fighting over the work to do.</p>
</div>
<div class="paragraph">
<p>This is because the channel is <em>unbuffered</em>.
An unbuffered channel cannot send until there is someone ready to receive.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The producer cannot send work until there is a worker ready to receive it.</p>
</li>
<li>
<p>Workers cannot receive work until there is someone ready to send, so they compete with each other when they are waiting.</p>
</li>
<li>
<p>The sender is not privileged, it cannot take priority over a worker that is already running.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>What we see here is a lot of latency introduced by the unbuffered channel.
There are lots of stops and starts inside the scheduler, and potentially locks and mutexes while waiting for work, this is why we see the <code>sys</code> time higher.</p>
</div>
</div>
<div class="sect2">
<h3 id="using_buffered_channels"><a class="anchor" href="#using_buffered_channels"></a><a class="link" href="#using_buffered_channels">5.8. Using buffered channels</a></h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span>
<span class="tok-kn">import</span> <span class="tok-s">&quot;github.com/pkg/profile&quot;</span>

<span class="tok-kd">func</span> <span class="tok-nx">main</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-k">defer</span> <span class="tok-nx">profile</span><span class="tok-p">.</span><span class="tok-nx">Start</span><span class="tok-p">(</span><span class="tok-nx">profile</span><span class="tok-p">.</span><span class="tok-nx">TraceProfile</span><span class="tok-p">,</span> <span class="tok-nx">profile</span><span class="tok-p">.</span><span class="tok-nx">ProfilePath</span><span class="tok-p">(</span><span class="tok-s">&quot;.&quot;</span><span class="tok-p">)).</span><span class="tok-nx">Stop</span><span class="tok-p">()</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% go build mandelbrot.go
% time ./mandelbrot -mode workers -workers 4
2017/09/17 14:23:56 profile: trace enabled, trace.out
2017/09/17 14:23:57 profile: trace disabled, trace.out

real    0m0.905s
user    0m2.150s
sys     0m0.121s</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which is pretty close to the per row mode above.</p>
</div>
<div class="paragraph">
<p>Using a buffered channel the trace showed us that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The producer doesn&#8217;t have to wait for a worker to arrive, it can fill up the channel quickly.</p>
</li>
<li>
<p>The worker can quickly take the next item from the channel without having to sleep waiting on work to be produced.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using this method we got nearly the same speed using a channel to hand off work per pixel than we did previously scheduling on goroutine per row.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Modify <code>nWorkersFillImg</code> to work per row. Time the result and analyse the trace.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mandelbrot_microservice"><a class="anchor" href="#mandelbrot_microservice"></a><a class="link" href="#mandelbrot_microservice">5.9. Mandelbrot microservice</a></h3>
<div class="paragraph">
<p>It&#8217;s 2019, generating Mandelbrots is pointless unless you can offer them on the internet as a serverless microservice.
Thus, I present to you, <em>Mandelweb</em></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% go run examples/mandelweb/mandelweb.go
2017/09/17 15:29:21 listening on http://127.0.0.1:8080/</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="http://127.0.0.1:8080/mandelbrot" class="bare">http://127.0.0.1:8080/mandelbrot</a></p>
</div>
<div class="sect3">
<h4 id="tracing_running_applications"><a class="anchor" href="#tracing_running_applications"></a><a class="link" href="#tracing_running_applications">5.9.1. Tracing running applications</a></h4>
<div class="paragraph">
<p>In the previous example we ran the trace over the whole program.</p>
</div>
<div class="paragraph">
<p>As you saw, traces can be very large, even for small amounts of time, so collecting trace data continually would generate far too much data.
Also, tracing can have an impact on the speed of your program, especially if there is a lot of activity.</p>
</div>
<div class="paragraph">
<p>What we want is a way to collect a short trace from a running program.</p>
</div>
<div class="paragraph">
<p>Fortuntately, the <code>net/http/pprof</code> package has just such a facility.</p>
</div>
</div>
<div class="sect3">
<h4 id="collecting_traces_via_http"><a class="anchor" href="#collecting_traces_via_http"></a><a class="link" href="#collecting_traces_via_http">5.9.2. Collecting traces via http</a></h4>
<div class="paragraph">
<p>Hopefully everyone knows about the <code>net/http/pprof</code> package.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="go"><span></span><span class="tok-kn">import</span> <span class="tok-nx">_</span> <span class="tok-s">&quot;net/http/pprof&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When imported, the <code>net/http/pprof</code> will register tracing and profiling routes with <code>http.DefaultServeMux</code>.
Since Go 1.5 this includes the trace profiler.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<code>net/http/pprof</code> registers with <code>http.DefaultServeMux</code>. If you are using that <code>ServeMux</code> implicitly, or explicitly, you may inadvertently expose the pprof endpoints to the internet. This can lead to source code disclosure. You probably don&#8217;t want to do this.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We can grab a five second trace from mandelweb with <code>curl</code> (or <code>wget</code>)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>% curl -o trace.out http://127.0.0.1:8080/debug/pprof/trace?seconds=5</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="generating_some_load"><a class="anchor" href="#generating_some_load"></a><a class="link" href="#generating_some_load">5.9.3. Generating some load</a></h4>
<div class="paragraph">
<p>The previous example was interesting, but an idle webserver has, by definition, no performance issues. We need to generate some load. For this I&#8217;m using <a href="https://github.com/rakyll/hey"><code>hey</code> by JBD</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>% go get -u github.com/rakyll/hey</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s start with one request per second.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>% hey -c 1 -n 1000 -q 1 http://127.0.0.1:8080/mandelbrot</code></pre>
</div>
</div>
<div class="paragraph">
<p>And with that running, in another window collect the trace</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% curl -o trace.out http://127.0.0.1:8080/debug/pprof/trace?seconds=5
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 66169    0 66169    0     0  13233      0 --:--:--  0:00:05 --:--:-- 17390
% go tool trace trace.out
2017/09/17 16:09:30 Parsing trace...
2017/09/17 16:09:30 Serializing trace...
2017/09/17 16:09:30 Splitting trace...
2017/09/17 16:09:30 Opening browser.
Trace viewer is listening on http://127.0.0.1:60301</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="simulating_overload"><a class="anchor" href="#simulating_overload"></a><a class="link" href="#simulating_overload">5.9.4. Simulating overload</a></h4>
<div class="paragraph">
<p>Let&#8217;s increase the rate to 5 requests per second.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>% hey -c 5 -n 1000 -q 5 http://127.0.0.1:8080/mandelbrot</code></pre>
</div>
</div>
<div class="paragraph">
<p>And with that running, in another window collect the trace</p>
</div>
<div class="literalblock">
<div class="content">
<pre>% curl -o trace.out http://127.0.0.1:8080/debug/pprof/trace?seconds=5
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                Dload  Upload   Total   Spent    Left  Speed
100 66169    0 66169    0     0  13233      0 --:--:--  0:00:05 --:--:-- 17390
% go tool trace trace.out
2017/09/17 16:09:30 Parsing trace...
2017/09/17 16:09:30 Serializing trace...
2017/09/17 16:09:30 Splitting trace...
2017/09/17 16:09:30 Opening browser. Trace viewer is listening on http://127.0.0.1:60301</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="extra_credit_the_sieve_of_eratosthenes"><a class="anchor" href="#extra_credit_the_sieve_of_eratosthenes"></a><a class="link" href="#extra_credit_the_sieve_of_eratosthenes">5.9.5. Extra credit, the Sieve of Eratosthenes</a></h4>
<div class="paragraph">
<p>The <a href="https://github.com/golang/go/blob/master/doc/play/sieve.go">concurrent prime sieve</a> is one of the first Go programs written.</p>
</div>
<div class="paragraph">
<p>Ivan Daniluk <a href="http://divan.github.io/posts/go_concurrency_visualize/">wrote a great post on visualising</a> it.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s take a look at its operation using the execution tracer.</p>
</div>
</div>
<div class="sect3">
<h4 id="more_resources"><a class="anchor" href="#more_resources"></a><a class="link" href="#more_resources">5.9.6. More resources</a></h4>
<div class="ulist">
<ul>
<li>
<p>Rhys Hiltner, <a href="https://www.youtube.com/watch?v=mmqDlbWk_XA">Go&#8217;s execution tracer</a> (dotGo 2016)</p>
</li>
<li>
<p>Rhys Hiltner, <a href="https://www.youtube.com/watch?v=V74JnrGTwKA">An Introduction to "go tool trace"</a> (GopherCon 2017)</p>
</li>
<li>
<p>Dave Cheney, <a href="https://www.youtube.com/watch?v=2h_NFBFrciI">Seven ways to profile Go programs</a> (GolangUK 2016)</p>
</li>
<li>
<p>Dave Cheney, <a href="https://dave.cheney.net/training#high-performance-go">High performance Go workshop</a>]</p>
</li>
<li>
<p>Ivan Daniluk, <a href="https://www.youtube.com/watch?v=KyuFeiG3Y60">Visualizing Concurrency in Go</a> (GopherCon 2016)</p>
</li>
<li>
<p>Kavya Joshi, <a href="https://www.youtube.com/watch?v=KBZlN0izeiY">Understanding Channels</a> (GopherCon 2017)</p>
</li>
<li>
<p>Francesc Campoy, <a href="https://www.youtube.com/watch?v=ySy3sR1LFCQ">Using the Go execution tracer</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="memory-and-gc"><a class="anchor" href="#memory-and-gc"></a><a class="link" href="#memory-and-gc">6. Memory and Garbage Collector</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Go is a garbage collected language.
This is a design principle, it will not change.</p>
</div>
<div class="paragraph">
<p>As a garbage collected language, the performance of Go programs is often determined by their interaction with the garbage collector.</p>
</div>
<div class="paragraph">
<p>Next to your choice of algorithms, memory consumption is the most important factor that determines the performance and scalability of your application.</p>
</div>
<div class="paragraph">
<p>This section discusses the operation of the garbage collector, how to measure the memory usage of your program and strategies for lowering memory usage if garbage collector performance is a bottleneck.</p>
</div>
<div class="sect2">
<h3 id="garbage_collector_world_view"><a class="anchor" href="#garbage_collector_world_view"></a><a class="link" href="#garbage_collector_world_view">6.1. Garbage collector world view</a></h3>
<div class="paragraph">
<p>The purpose of any garbage collector is to present the illusion that there is an infinite amount of memory available to the program.</p>
</div>
<div class="paragraph">
<p>You may disagree with this statement, but this is the base assumption of how garbage collector designers work.</p>
</div>
<div class="paragraph">
<p>A stop the world, mark sweep GC is the most efficient in terms of total run time; good for batch processing, simulation, etc.
However, over time the Go GC has moved from a pure stop the world collector to a concurrent, non compacting, collector.
This is because the Go GC is designed for low latency servers and interactive applications.</p>
</div>
<div class="paragraph">
<p>The design of the Go GC favors <em>lower_latency</em> over <em>maximum_throughput</em>; it moves some of the allocation cost to the mutator to reduce the cost of cleanup later.</p>
</div>
</div>
<div class="sect2">
<h3 id="garbage_collector_design"><a class="anchor" href="#garbage_collector_design"></a><a class="link" href="#garbage_collector_design">6.2. Garbage collector design</a></h3>
<div class="paragraph">
<p>The design of the Go GC has changed over the years</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go 1.0, stop the world mark sweep collector based heavily on tcmalloc.</p>
</li>
<li>
<p>Go 1.3, fully precise collector, wouldn&#8217;t mistake big numbers on the heap for pointers, thus leaking memory.</p>
</li>
<li>
<p>Go 1.5, new GC design, focusing on <em>latency</em> over <em>throughput</em>.</p>
</li>
<li>
<p>Go 1.6, GC improvements, handling larger heaps with lower latency.</p>
</li>
<li>
<p>Go 1.7, small GC improvements, mainly refactoring.</p>
</li>
<li>
<p>Go 1.8, further work to reduce STW times, now down to the 100 microsecond range.</p>
</li>
<li>
<p>Go 1.10+, <a href="https://github.com/golang/proposal/blob/master/design/24543-non-cooperative-preemption.md">move away from pure cooprerative goroutine scheduling</a> to lower the latency when triggering a full GC cycle.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="garbage_collector_monitoring"><a class="anchor" href="#garbage_collector_monitoring"></a><a class="link" href="#garbage_collector_monitoring">6.3. Garbage collector monitoring</a></h3>
<div class="paragraph">
<p>A simple way to obtain a general idea of how hard the garbage collector is working is to enable the output of GC logging.</p>
</div>
<div class="paragraph">
<p>These stats are always collected, but normally suppressed, you can enable their display by setting the <code>GODEBUG</code> environment variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code>% env GODEBUG=gctrace=1 godoc -http=:8080
gc 1 @0.012s 2%: 0.026+0.39+0.10 ms clock, 0.21+0.88/0.52/0+0.84 ms cpu, 4-&gt;4-&gt;0 MB, 5 MB goal, 8 P
gc 2 @0.016s 3%: 0.038+0.41+0.042 ms clock, 0.30+1.2/0.59/0+0.33 ms cpu, 4-&gt;4-&gt;1 MB, 5 MB goal, 8 P
gc 3 @0.020s 4%: 0.054+0.56+0.054 ms clock, 0.43+1.0/0.59/0+0.43 ms cpu, 4-&gt;4-&gt;1 MB, 5 MB goal, 8 P
gc 4 @0.025s 4%: 0.043+0.52+0.058 ms clock, 0.34+1.3/0.64/0+0.46 ms cpu, 4-&gt;4-&gt;1 MB, 5 MB goal, 8 P
gc 5 @0.029s 5%: 0.058+0.64+0.053 ms clock, 0.46+1.3/0.89/0+0.42 ms cpu, 4-&gt;4-&gt;1 MB, 5 MB goal, 8 P
gc 6 @0.034s 5%: 0.062+0.42+0.050 ms clock, 0.50+1.2/0.63/0+0.40 ms cpu, 4-&gt;4-&gt;1 MB, 5 MB goal, 8 P
gc 7 @0.038s 6%: 0.057+0.47+0.046 ms clock, 0.46+1.2/0.67/0+0.37 ms cpu, 4-&gt;4-&gt;1 MB, 5 MB goal, 8 P
gc 8 @0.041s 6%: 0.049+0.42+0.057 ms clock, 0.39+1.1/0.57/0+0.46 ms cpu, 4-&gt;4-&gt;1 MB, 5 MB goal, 8 P
gc 9 @0.045s 6%: 0.047+0.38+0.042 ms clock, 0.37+0.94/0.61/0+0.33 ms cpu, 4-&gt;4-&gt;1 MB, 5 MB goal, 8 P</code></pre>
</div>
</div>
<div class="paragraph">
<p>The trace output gives a general measure of GC activity.
The output format of <code>gctrace=1</code> is described in <a href="https://golang.org/pkg/runtime/#hdr-Environment_Variables">the <code>runtime</code> package documentation</a>.</p>
</div>
<div class="paragraph">
<p>DEMO: Show <code>godoc</code> with <code>GODEBUG=gctrace=1</code> enabled</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Use this env var in production, it has no performance impact.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using <code>GODEBUG=gctrace=1</code> is good when you <em>know</em> there is a problem, but for general telemetry on your Go application I recommend the <code>net/http/pprof</code> interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>import _ "net/http/pprof"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Importing the <code>net/http/pprof</code> package will register a handler at <code>/debug/pprof</code> with various runtime metrics, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A list of all the running goroutines, <code>/debug/pprof/heap?debug=1</code>.</p>
</li>
<li>
<p>A report on the memory allocation statistics, <code>/debug/pprof/heap?debug=1</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>net/http/pprof</code> will register itself with your default <code>http.ServeMux</code>.</p>
</div>
<div class="paragraph">
<p>Be careful as this will be visible if you use <code>http.ListenAndServe(address, nil)</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>DEMO: <code>godoc -http=:8080</code>, show <code>/debug/pprof</code>.</p>
</div>
<div class="sect3">
<h4 id="garbage_collector_tuning"><a class="anchor" href="#garbage_collector_tuning"></a><a class="link" href="#garbage_collector_tuning">6.3.1. Garbage collector tuning</a></h4>
<div class="paragraph">
<p>The Go runtime provides one environment variable to tune the GC, <code>GOGC</code>.</p>
</div>
<div class="paragraph">
<p>The formula for GOGC is</p>
</div>
<div class="paragraph">
<p>\$goal = reachabl\e * (1 + (GOGC)/100)\$</p>
</div>
<div class="paragraph">
<p>For example, if we currently have a 256MB heap, and <code>GOGC=100</code> (the default), when the heap fills up it will grow to</p>
</div>
<div class="paragraph">
<p>\$512MB = 256MB * (1 + 100/100)\$</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Values of <code>GOGC</code> greater than 100 causes the heap to grow faster, reducing the pressure on the GC.</p>
</li>
<li>
<p>Values of <code>GOGC</code> less than 100 cause the heap to grow slowly, increasing the pressure on the GC.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default value of 100 is <em>just_a_guide</em>. you should choose your own value <em>after profiling your application with production loads</em>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="reducing_allocations"><a class="anchor" href="#reducing_allocations"></a><a class="link" href="#reducing_allocations">6.4. Reducing allocations</a></h3>
<div class="paragraph">
<p>Make sure your APIs allow the caller to reduce the amount of garbage generated.</p>
</div>
<div class="paragraph">
<p>Consider these two Read methods</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="go"><span></span><span class="tok-kd">func</span> <span class="tok-p">(</span><span class="tok-nx">r</span> <span class="tok-o">*</span><span class="tok-nx">Reader</span><span class="tok-p">)</span> <span class="tok-nx">Read</span><span class="tok-p">()</span> <span class="tok-p">([]</span><span class="tok-kt">byte</span><span class="tok-p">,</span> <span class="tok-kt">error</span><span class="tok-p">)</span>
<span class="tok-kd">func</span> <span class="tok-p">(</span><span class="tok-nx">r</span> <span class="tok-o">*</span><span class="tok-nx">Reader</span><span class="tok-p">)</span> <span class="tok-nx">Read</span><span class="tok-p">(</span><span class="tok-nx">buf</span> <span class="tok-p">[]</span><span class="tok-kt">byte</span><span class="tok-p">)</span> <span class="tok-p">(</span><span class="tok-kt">int</span><span class="tok-p">,</span> <span class="tok-kt">error</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first Read method takes no arguments and returns some data as a <code>[]byte</code>.
The second takes a <code>[]byte</code> buffer and returns the amount of bytes read.</p>
</div>
<div class="paragraph">
<p>The first Read method will <em>always</em> allocate a buffer, putting pressure on the GC. The second fills the buffer it was given.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Can you name examples in the std lib which follow this pattern?</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="strings_and_bytes"><a class="anchor" href="#strings_and_bytes"></a><a class="link" href="#strings_and_bytes">6.5. strings and []bytes</a></h3>
<div class="paragraph">
<p>In Go <code>string</code> values are immutable, <code>[]byte</code> are mutable.</p>
</div>
<div class="paragraph">
<p>Most programs prefer to work <code>string</code>, but most IO is done with <code>[]byte</code>.</p>
</div>
<div class="paragraph">
<p>Avoid <code>[]byte</code> to string conversions wherever possible, this normally means picking one representation, either a <code>string</code> or a <code>[]byte</code> for a value.
Often this will be <code>[]byte</code> if you read the data from the network or disk.</p>
</div>
<div class="paragraph">
<p>The <a href="https://golang.org/pkg/bytes/"><code>bytes</code></a> package contains many of the same operations&#8201;&#8212;&#8201;<code>Split</code>, <code>Compare</code>, <code>HasPrefix</code>, <code>Trim</code>, etc&#8201;&#8212;&#8201;as the <a href="https://golang.org/pkg/strings/"><code>strings</code></a> package.</p>
</div>
<div class="paragraph">
<p>Under the hood <code>strings</code> uses same assembly primitives as the <code>bytes</code> package.</p>
</div>
</div>
<div class="sect2">
<h3 id="using_byte_as_a_map_key"><a class="anchor" href="#using_byte_as_a_map_key"></a><a class="link" href="#using_byte_as_a_map_key">6.6. Using <code>[]byte</code> as a map key</a></h3>
<div class="paragraph">
<p>It is very common to use a <code>string</code> as a map key, but often you have a <code>[]byte</code>.</p>
</div>
<div class="paragraph">
<p>The compiler implements a specific optimisation for this case</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="go"><span></span><span class="tok-kd">var</span> <span class="tok-nx">m</span> <span class="tok-kd">map</span><span class="tok-p">[</span><span class="tok-kt">string</span><span class="tok-p">]</span><span class="tok-kt">string</span>
<span class="tok-nx">v</span><span class="tok-p">,</span> <span class="tok-nx">ok</span> <span class="tok-o">:=</span> <span class="tok-nx">m</span><span class="tok-p">[</span><span class="tok-nb">string</span><span class="tok-p">(</span><span class="tok-nx">bytes</span><span class="tok-p">)]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This will avoid the conversion of the byte slice to a string for the map lookup. This is very specific, it won&#8217;t work if you do something like</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>key := string(bytes)
val, ok := m[key]</code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Let&#8217;s see if this is still true. Write a benchmark comparing these two methods of using a <code>[]byte</code> as a <code>string</code> map key.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="avoid_string_concatenation"><a class="anchor" href="#avoid_string_concatenation"></a><a class="link" href="#avoid_string_concatenation">6.7. Avoid string concatenation</a></h3>
<div class="paragraph">
<p>Go strings are immutable. Concatenating two strings generates a third. Which of the following is fastest?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span>		<span class="tok-nx">s</span> <span class="tok-o">:=</span> <span class="tok-nx">request</span><span class="tok-p">.</span><span class="tok-nx">ID</span>
		<span class="tok-nx">s</span> <span class="tok-o">+=</span> <span class="tok-s">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">client</span><span class="tok-p">.</span><span class="tok-nx">Addr</span><span class="tok-p">().</span><span class="tok-nx">String</span><span class="tok-p">()</span>
		<span class="tok-nx">s</span> <span class="tok-o">+=</span> <span class="tok-s">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-nx">time</span><span class="tok-p">.</span><span class="tok-nx">Now</span><span class="tok-p">().</span><span class="tok-nx">String</span><span class="tok-p">()</span>
		<span class="tok-nx">r</span> <span class="tok-p">=</span> <span class="tok-nx">s</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span>		<span class="tok-kd">var</span> <span class="tok-nx">b</span> <span class="tok-nx">bytes</span><span class="tok-p">.</span><span class="tok-nx">Buffer</span>
		<span class="tok-nx">fmt</span><span class="tok-p">.</span><span class="tok-nx">Fprintf</span><span class="tok-p">(</span><span class="tok-o">&amp;</span><span class="tok-nx">b</span><span class="tok-p">,</span> <span class="tok-s">&quot;%s %v %v&quot;</span><span class="tok-p">,</span> <span class="tok-nx">request</span><span class="tok-p">.</span><span class="tok-nx">ID</span><span class="tok-p">,</span> <span class="tok-nx">client</span><span class="tok-p">.</span><span class="tok-nx">Addr</span><span class="tok-p">(),</span> <span class="tok-nx">time</span><span class="tok-p">.</span><span class="tok-nx">Now</span><span class="tok-p">())</span>
		<span class="tok-nx">r</span> <span class="tok-p">=</span> <span class="tok-nx">b</span><span class="tok-p">.</span><span class="tok-nx">String</span><span class="tok-p">()</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span>		<span class="tok-nx">r</span> <span class="tok-p">=</span> <span class="tok-nx">fmt</span><span class="tok-p">.</span><span class="tok-nx">Sprintf</span><span class="tok-p">(</span><span class="tok-s">&quot;%s %v %v&quot;</span><span class="tok-p">,</span> <span class="tok-nx">request</span><span class="tok-p">.</span><span class="tok-nx">ID</span><span class="tok-p">,</span> <span class="tok-nx">client</span><span class="tok-p">.</span><span class="tok-nx">Addr</span><span class="tok-p">(),</span> <span class="tok-nx">time</span><span class="tok-p">.</span><span class="tok-nx">Now</span><span class="tok-p">())</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span>		<span class="tok-nx">b</span> <span class="tok-o">:=</span> <span class="tok-nb">make</span><span class="tok-p">([]</span><span class="tok-kt">byte</span><span class="tok-p">,</span> <span class="tok-mi">0</span><span class="tok-p">,</span> <span class="tok-mi">40</span><span class="tok-p">)</span>
		<span class="tok-nx">b</span> <span class="tok-p">=</span> <span class="tok-nb">append</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">,</span> <span class="tok-nx">request</span><span class="tok-p">.</span><span class="tok-nx">ID</span><span class="tok-o">...</span><span class="tok-p">)</span>
		<span class="tok-nx">b</span> <span class="tok-p">=</span> <span class="tok-nb">append</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">,</span> <span class="tok-sc">&#39; &#39;</span><span class="tok-p">)</span>
		<span class="tok-nx">b</span> <span class="tok-p">=</span> <span class="tok-nb">append</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">,</span> <span class="tok-nx">client</span><span class="tok-p">.</span><span class="tok-nx">Addr</span><span class="tok-p">().</span><span class="tok-nx">String</span><span class="tok-p">()</span><span class="tok-o">...</span><span class="tok-p">)</span>
		<span class="tok-nx">b</span> <span class="tok-p">=</span> <span class="tok-nb">append</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">,</span> <span class="tok-sc">&#39; &#39;</span><span class="tok-p">)</span>
		<span class="tok-nx">b</span> <span class="tok-p">=</span> <span class="tok-nx">time</span><span class="tok-p">.</span><span class="tok-nx">Now</span><span class="tok-p">().</span><span class="tok-nx">AppendFormat</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">,</span> <span class="tok-s">&quot;2006-01-02 15:04:05.999999999 -0700 MST&quot;</span><span class="tok-p">)</span>
		<span class="tok-nx">r</span> <span class="tok-p">=</span> <span class="tok-nb">string</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span>		<span class="tok-kd">var</span> <span class="tok-nx">b</span> <span class="tok-nx">strings</span><span class="tok-p">.</span><span class="tok-nx">Builder</span>
		<span class="tok-nx">b</span><span class="tok-p">.</span><span class="tok-nx">WriteString</span><span class="tok-p">(</span><span class="tok-nx">request</span><span class="tok-p">.</span><span class="tok-nx">ID</span><span class="tok-p">)</span>
		<span class="tok-nx">b</span><span class="tok-p">.</span><span class="tok-nx">WriteString</span><span class="tok-p">(</span><span class="tok-s">&quot; &quot;</span><span class="tok-p">)</span>
		<span class="tok-nx">b</span><span class="tok-p">.</span><span class="tok-nx">WriteString</span><span class="tok-p">(</span><span class="tok-nx">client</span><span class="tok-p">.</span><span class="tok-nx">Addr</span><span class="tok-p">().</span><span class="tok-nx">String</span><span class="tok-p">())</span>
		<span class="tok-nx">b</span><span class="tok-p">.</span><span class="tok-nx">WriteString</span><span class="tok-p">(</span><span class="tok-s">&quot; &quot;</span><span class="tok-p">)</span>
		<span class="tok-nx">b</span><span class="tok-p">.</span><span class="tok-nx">WriteString</span><span class="tok-p">(</span><span class="tok-nx">time</span><span class="tok-p">.</span><span class="tok-nx">Now</span><span class="tok-p">().</span><span class="tok-nx">String</span><span class="tok-p">())</span>
		<span class="tok-nx">r</span> <span class="tok-p">=</span> <span class="tok-nx">b</span><span class="tok-p">.</span><span class="tok-nx">String</span><span class="tok-p">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>DEMO: <code>go test -bench=. ./examples/concat</code></p>
</div>
</div>
<div class="sect2">
<h3 id="preallocate_slices_if_the_length_is_known"><a class="anchor" href="#preallocate_slices_if_the_length_is_known"></a><a class="link" href="#preallocate_slices_if_the_length_is_known">6.8. Preallocate slices if the length is known</a></h3>
<div class="paragraph">
<p>Append is convenient, but wasteful.</p>
</div>
<div class="paragraph">
<p>Slices grow by doubling up to 1024 elements, then by approximately 25% after that. What is the capacity of <code>b</code> after we append one more item to it?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span><span class="tok-kd">func</span> <span class="tok-nx">main</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-nx">b</span> <span class="tok-o">:=</span> <span class="tok-nb">make</span><span class="tok-p">([]</span><span class="tok-kt">int</span><span class="tok-p">,</span> <span class="tok-mi">1024</span><span class="tok-p">)</span>
	<span class="tok-nx">b</span> <span class="tok-p">=</span> <span class="tok-nb">append</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">,</span> <span class="tok-mi">99</span><span class="tok-p">)</span>
	<span class="tok-nx">fmt</span><span class="tok-p">.</span><span class="tok-nx">Println</span><span class="tok-p">(</span><span class="tok-s">&quot;len:&quot;</span><span class="tok-p">,</span> <span class="tok-nb">len</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">),</span> <span class="tok-s">&quot;cap:&quot;</span><span class="tok-p">,</span> <span class="tok-nb">cap</span><span class="tok-p">(</span><span class="tok-nx">b</span><span class="tok-p">))</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you use the append pattern you could be copying a lot of data and creating a lot of garbage.</p>
</div>
<div class="paragraph">
<p>If know know the length of the slice beforehand, then pre-allocate the target to avoid copying and to make sure the target is exactly the right size.</p>
</div>
<div class="listingblock">
<div class="title">Before</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="go"><span></span><span class="tok-kd">var</span> <span class="tok-nx">s</span> <span class="tok-p">[]</span><span class="tok-kt">string</span>
<span class="tok-k">for</span> <span class="tok-nx">_</span><span class="tok-p">,</span> <span class="tok-nx">v</span> <span class="tok-o">:=</span> <span class="tok-k">range</span> <span class="tok-nx">fn</span><span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-nx">s</span> <span class="tok-p">=</span> <span class="tok-nb">append</span><span class="tok-p">(</span><span class="tok-nx">s</span><span class="tok-p">,</span> <span class="tok-nx">v</span><span class="tok-p">)</span>
<span class="tok-p">}</span>
<span class="tok-k">return</span> <span class="tok-nx">s</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">After</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="go"><span></span><span class="tok-nx">vals</span> <span class="tok-o">:=</span> <span class="tok-nx">fn</span><span class="tok-p">()</span>
<span class="tok-nx">s</span> <span class="tok-o">:=</span> <span class="tok-nb">make</span><span class="tok-p">([]</span><span class="tok-kt">string</span><span class="tok-p">,</span> <span class="tok-nb">len</span><span class="tok-p">(</span><span class="tok-nx">vals</span><span class="tok-p">))</span>
<span class="tok-k">for</span> <span class="tok-nx">i</span><span class="tok-p">,</span> <span class="tok-nx">v</span> <span class="tok-o">:=</span> <span class="tok-k">range</span> <span class="tok-nx">vals</span> <span class="tok-p">{</span>
        <span class="tok-nx">s</span><span class="tok-p">[</span><span class="tok-nx">i</span><span class="tok-p">]</span> <span class="tok-p">=</span> <span class="tok-nx">v</span>
<span class="tok-p">}</span>
<span class="tok-k">return</span> <span class="tok-nx">s</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using_sync_pool"><a class="anchor" href="#using_sync_pool"></a><a class="link" href="#using_sync_pool">6.9. Using sync.Pool</a></h3>
<div class="paragraph">
<p>The <code>sync</code> package comes with a <code>sync.Pool</code> type which is used to reuse common objects.</p>
</div>
<div class="paragraph">
<p><code>sync.Pool</code> has no fixed size or maximum capacity.
You add to it and take from it until a GC happens, then it is emptied unconditionally.
This is <a href="https://groups.google.com/forum/#!searchin/golang-dev/gc-aware/golang-dev/kJ_R6vYVYHU/LjoGriFTYxMJ">by design</a>:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>If before garbage collection is too early and after garbage collection too late, then the right time to drain the pool must be during garbage collection. That is, the semantics of the Pool type must be that it drains at each garbage collection.&#8201;&#8212;&#8201;Russ Cox</p>
</div>
</blockquote>
</div>
<div class="listingblock">
<div class="title">sync.Pool in action</div>
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span><span class="tok-kd">var</span> <span class="tok-nx">pool</span> <span class="tok-p">=</span> <span class="tok-nx">sync</span><span class="tok-p">.</span><span class="tok-nx">Pool</span><span class="tok-p">{</span><span class="tok-nx">New</span><span class="tok-p">:</span> <span class="tok-kd">func</span><span class="tok-p">()</span> <span class="tok-kd">interface</span><span class="tok-p">{}</span> <span class="tok-p">{</span> <span class="tok-k">return</span> <span class="tok-nb">make</span><span class="tok-p">([]</span><span class="tok-kt">byte</span><span class="tok-p">,</span> <span class="tok-mi">4096</span><span class="tok-p">)</span> <span class="tok-p">}}</span>

<span class="tok-kd">func</span> <span class="tok-nx">fn</span><span class="tok-p">()</span> <span class="tok-p">{</span>
	<span class="tok-nx">buf</span> <span class="tok-o">:=</span> <span class="tok-nx">pool</span><span class="tok-p">.</span><span class="tok-nx">Get</span><span class="tok-p">().([]</span><span class="tok-kt">byte</span><span class="tok-p">)</span> <span class="tok-c1">// takes from pool or calls New</span>
	<span class="tok-c1">// do work</span>
	<span class="tok-nx">pool</span><span class="tok-p">.</span><span class="tok-nx">Put</span><span class="tok-p">(</span><span class="tok-nx">buf</span><span class="tok-p">)</span> <span class="tok-c1">// returns buf to the pool</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>sync.Pool</code> is not a cache. It can and will be emptied <em>at_any_time</em>.</p>
</div>
<div class="paragraph">
<p>Do not place important items in a <code>sync.Pool</code>, they will be discarded.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The design of sync.Pool emptying itself on each GC may change in Go 1.13 which will help improve its utility.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>This CL fixes this by introducing a victim cache mechanism. Instead of
clearing Pools, the victim cache is dropped and the primary cache is
moved to the victim cache. As a result, in steady-state, there are
(roughly) no new allocations, but if Pool usage drops, objects will
still be collected within two GCs (as opposed to one).&#8201;&#8212;&#8201;Austin Clements</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p><a href="https://go-review.googlesource.com/c/go/+/166961/" class="bare">https://go-review.googlesource.com/c/go/+/166961/</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="exercises_3"><a class="anchor" href="#exercises_3"></a><a class="link" href="#exercises_3">6.10. Exercises</a></h3>
<div class="ulist">
<ul>
<li>
<p>Using <code>godoc</code> (or another program) observe the results of changing <code>GOGC</code> using <code>GODEBUG=gctrace=1</code>.</p>
</li>
<li>
<p>Benchmark byte&#8217;s string(byte) map keys</p>
</li>
<li>
<p>Benchmark allocs from different concat strategies.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tips-and-tricks"><a class="anchor" href="#tips-and-tricks"></a><a class="link" href="#tips-and-tricks">7. Tips and trips</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>A random grab back of tips and suggestions</p>
</div>
<div class="paragraph">
<p>This final section contains a number of tips to micro optimise Go code.</p>
</div>
<div class="sect2">
<h3 id="goroutines"><a class="anchor" href="#goroutines"></a><a class="link" href="#goroutines">7.1. Goroutines</a></h3>
<div class="paragraph">
<p>The key feature of Go that makes it a great fit for modern hardware are goroutines.</p>
</div>
<div class="paragraph">
<p>Goroutines are so easy to use, and so cheap to create, you could think of them as <em>almost</em> free.</p>
</div>
<div class="paragraph">
<p>The Go runtime has been written for programs with tens of thousands of goroutines as the norm, hundreds of thousands are not unexpected.</p>
</div>
<div class="paragraph">
<p>However, each goroutine does consume a minimum amount of memory for the goroutine&#8217;s stack which is currently at least 2k.</p>
</div>
<div class="paragraph">
<p>2048 * 1,000,000 goroutines == 2GB of memory, and they haven&#8217;t done anything yet.</p>
</div>
<div class="paragraph">
<p>Maybe this is a lot, maybe it isn&#8217;t given the other usages of your application.</p>
</div>
<div class="sect3">
<h4 id="know_when_to_stop_a_goroutine"><a class="anchor" href="#know_when_to_stop_a_goroutine"></a><a class="link" href="#know_when_to_stop_a_goroutine">7.1.1. Know when to stop a goroutine</a></h4>
<div class="paragraph">
<p>Goroutines are cheap to start and cheap to run, but they do have a finite cost in terms of memory footprint; you cannot create an infinite number of them.</p>
</div>
<div class="paragraph">
<p>Every time you use the <code>go</code> keyword in your program to launch a goroutine, you must <strong>know</strong> how, and when, that goroutine will exit.</p>
</div>
<div class="paragraph">
<p>In your design, some goroutines may run until the program exits. These goroutines are rare enough to not become an exception to the rule.</p>
</div>
<div class="paragraph">
<p>If you don&#8217;t know the answer, that&#8217;s a potential memory leak as the goroutine will pin its stack&#8217;s memory on the heap, as well as any heap allocated variables reachable from the stack.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Never start a goroutine without knowing how it will stop.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="further_reading_6"><a class="anchor" href="#further_reading_6"></a><a class="link" href="#further_reading_6">7.1.2. Further reading</a></h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.youtube.com/watch?v=yKQOunhhf4A&amp;index=16&amp;list=PLq2Nv-Sh8EbZEjZdPLaQt1qh_ohZFMDj8">Concurrency Made Easy</a> (video)</p>
</li>
<li>
<p><a href="https://dave.cheney.net/paste/concurrency-made-easy.pdf">Concurrency Made Easy</a> (slides)</p>
</li>
<li>
<p><a href="https://dave.cheney.net/practical-go/presentations/qcon-china.html#_never_start_a_goroutine_without_knowning_when_it_will_stop">Never start a goroutine without knowning when it will stop</a> (Practical Go, QCon Shanghai 2018)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="go_uses_efficient_network_polling_for_some_requests"><a class="anchor" href="#go_uses_efficient_network_polling_for_some_requests"></a><a class="link" href="#go_uses_efficient_network_polling_for_some_requests">7.2. Go uses efficient network polling for some requests</a></h3>
<div class="paragraph">
<p>The Go runtime handles network IO using an efficient operating system polling mechanism (kqueue, epoll, windows IOCP, etc).
Many waiting goroutines will be serviced by a single operating system thread.</p>
</div>
<div class="paragraph">
<p>However, for local file IO, Go does not implement any IO polling.
Each operation on a <code>*os.File</code> consumes one operating system thread while in progress.</p>
</div>
<div class="paragraph">
<p>Heavy use of local file IO can cause your program to spawn hundreds or thousands of threads; possibly more than your operating system allows.</p>
</div>
<div class="paragraph">
<p>Your disk subsystem does not expect to be able to handle hundreds or thousands of concurrent IO requests.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To limit the amount of concurrent blocking IO, use a pool of worker goroutines, or a buffered channel as a semaphore.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight nowrap"><code data-lang="go"><span></span><span class="tok-kd">var</span> <span class="tok-nx">semaphore</span> <span class="tok-p">=</span> <span class="tok-nb">make</span><span class="tok-p">(</span><span class="tok-kd">chan</span> <span class="tok-kd">struct</span><span class="tok-p">{},</span> <span class="tok-mi">10</span><span class="tok-p">)</span>

<span class="tok-kd">func</span> <span class="tok-nx">processRequest</span><span class="tok-p">(</span><span class="tok-nx">work</span> <span class="tok-o">*</span><span class="tok-nx">Work</span><span class="tok-p">)</span> <span class="tok-p">{</span>
	<span class="tok-nx">semaphore</span> <span class="tok-o">&lt;-</span> <span class="tok-kd">struct</span><span class="tok-p">{}{}</span> <span class="tok-c1">// acquire semaphore</span>
	<span class="tok-c1">// process request</span>
	<span class="tok-o">&lt;-</span><span class="tok-nx">semaphore</span> <span class="tok-c1">// release semaphore</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="watch_out_for_io_multipliers_in_your_application"><a class="anchor" href="#watch_out_for_io_multipliers_in_your_application"></a><a class="link" href="#watch_out_for_io_multipliers_in_your_application">7.3. Watch out for IO multipliers in your application</a></h3>
<div class="paragraph">
<p>If you&#8217;re writing a server process, its primary job is to multiplex clients connected over the network, and data stored in your application.</p>
</div>
<div class="paragraph">
<p>Most server programs take a request, do some processing, then return a result. This sounds simple, but depending on the result it can let the client consume a large (possibly unbounded) amount of resources on your server. Here are some things to pay attention to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The amount of IO requests per incoming request; how many IO events does a single client request generate? It might be on average 1, or possibly less than one if many requests are served out of a cache.</p>
</li>
<li>
<p>The amount of reads required to service a query; is it fixed, N+1, or linear (reading the whole table to generate the last page of results).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If memory is slow, relatively speaking, then IO is so slow that you should avoid doing it at all costs. Most importantly avoid doing IO in the context of a request—don&#8217;t make the user wait for your disk subsystem to write to disk, or even read.</p>
</div>
</div>
<div class="sect2">
<h3 id="use_streaming_io_interfaces"><a class="anchor" href="#use_streaming_io_interfaces"></a><a class="link" href="#use_streaming_io_interfaces">7.4. Use streaming IO interfaces</a></h3>
<div class="paragraph">
<p>Where-ever possible avoid reading data into a <code>[]byte</code> and passing it around.</p>
</div>
<div class="paragraph">
<p>Depending on the request you may end up reading megabytes (or more!) of data into memory. This places huge pressure on the GC, which will increase the average latency of your application.</p>
</div>
<div class="paragraph">
<p>Instead use <code>io.Reader</code> and <code>io.Writer</code> to construct processing pipelines to cap the amount of memory in use per request.</p>
</div>
<div class="paragraph">
<p>For efficiency, consider implementing <code>io.ReaderFrom</code> / <code>io.WriterTo</code> if you use a lot of <code>io.Copy</code>. These interface are more efficient and avoid copying memory into a temporary buffer.</p>
</div>
</div>
<div class="sect2">
<h3 id="timeouts_timeouts_timeouts"><a class="anchor" href="#timeouts_timeouts_timeouts"></a><a class="link" href="#timeouts_timeouts_timeouts">7.5. Timeouts, timeouts, timeouts</a></h3>
<div class="paragraph">
<p>Never start an IO operating without knowing the maximum time it will take.</p>
</div>
<div class="paragraph">
<p>You need to set a timeout on every network request you make with <code>SetDeadline</code>, <code>SetReadDeadline</code>, <code>SetWriteDeadline</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="defer_is_expensive_or_is_it"><a class="anchor" href="#defer_is_expensive_or_is_it"></a><a class="link" href="#defer_is_expensive_or_is_it">7.6. Defer is expensive, or is it?</a></h3>
<div class="paragraph">
<p><code>defer</code> is expensive because it has to record a closure for defer&#8217;s arguments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="go"><span></span><span class="tok-k">defer</span> <span class="tok-nx">mu</span><span class="tok-p">.</span><span class="tok-nx">Unlock</span><span class="tok-p">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is equivalent to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="go"><span></span><span class="tok-k">defer</span> <span class="tok-kd">func</span><span class="tok-p">()</span> <span class="tok-p">{</span>
        <span class="tok-nx">mu</span><span class="tok-p">.</span><span class="tok-nx">Unlock</span><span class="tok-p">()</span>
<span class="tok-p">}()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>defer</code> is expensive if the work being done is small, the classic example is <code>defer</code> ing a mutex unlock around a struct variable or map lookup.
You may choose to avoid <code>defer</code> in those situations.</p>
</div>
<div class="paragraph">
<p>This is a case where readability and maintenance is sacrificed for a performance win.</p>
</div>
<div class="paragraph">
<p>Always revisit these decisions.</p>
</div>
</div>
<div class="sect2">
<h3 id="avoid_finalisers"><a class="anchor" href="#avoid_finalisers"></a><a class="link" href="#avoid_finalisers">7.7. Avoid Finalisers</a></h3>
<div class="paragraph">
<p>Finalisation is a technique to attach behaviour to an object which is just about to be garbage collected.</p>
</div>
<div class="paragraph">
<p>Thus, finalisation is non deterministic.</p>
</div>
<div class="paragraph">
<p>For a finaliser to run, the object must not be reachable by <em>anything</em>. If you accidentally keep a reference to the object in the map, it won&#8217;t be finalised.</p>
</div>
<div class="paragraph">
<p>Finalisers run as part of the gc cycle, which means it is unpredictable when they will run and puts them at odds with the goal of reducing gc operation.</p>
</div>
<div class="paragraph">
<p>A finaliser may not run for a long time if you have a large heap and have tuned your appliation to create minimal garbage.</p>
</div>
</div>
<div class="sect2">
<h3 id="minimise_cgo"><a class="anchor" href="#minimise_cgo"></a><a class="link" href="#minimise_cgo">7.8. Minimise cgo</a></h3>
<div class="paragraph">
<p>cgo allows Go programs to call into C libraries.</p>
</div>
<div class="paragraph">
<p>C code and Go code live in two different universes, cgo traverses the boundary between them.</p>
</div>
<div class="paragraph">
<p>This transition is not free and depending on where it exists in your code, the cost could be substantial.</p>
</div>
<div class="paragraph">
<p>cgo calls are similar to blocking IO, they consume a thread during operation.</p>
</div>
<div class="paragraph">
<p>Do not call out to C code in the middle of a tight loop.</p>
</div>
<div class="sect3">
<h4 id="actually_maybe_avoid_cgo"><a class="anchor" href="#actually_maybe_avoid_cgo"></a><a class="link" href="#actually_maybe_avoid_cgo">7.8.1. Actually, maybe avoid cgo</a></h4>
<div class="paragraph">
<p>cgo has a high overhead.</p>
</div>
<div class="paragraph">
<p>For best performance I recommend avoiding cgo in your applications.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the C code takes a long time, cgo overhead is not as important.</p>
</li>
<li>
<p>If you&#8217;re using cgo to call a very short C function, where the overhead is the most noticeable, rewrite that code in Go&#8201;&#8212;&#8201;by definition it&#8217;s short.</p>
</li>
<li>
<p>If you&#8217;re using a large piece of expensive C code is called in a tight loop, why are you using Go?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Is there anyone who&#8217;s using cgo to call expensive C code frequently?</p>
</div>
<div class="sect4">
<h5 id="further_reading_7"><a class="anchor" href="#further_reading_7"></a><a class="link" href="#further_reading_7">Further reading</a></h5>
<div class="ulist">
<ul>
<li>
<p><a href="http://dave.cheney.net/2016/01/18/cgo-is-not-go">cgo is not Go</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="always_use_the_latest_released_version_of_go"><a class="anchor" href="#always_use_the_latest_released_version_of_go"></a><a class="link" href="#always_use_the_latest_released_version_of_go">7.9. Always use the latest released version of Go</a></h3>
<div class="paragraph">
<p>Old versions of Go will never get better. They will never get bug fixes or optimisations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Go 1.4 should not be used.</p>
</li>
<li>
<p>Go 1.5 and 1.6 had a slower compiler, but it produces faster code, and has a faster GC.</p>
</li>
<li>
<p>Go 1.7 delivered roughly a 30% improvement in compilation speed over 1.6, a 2x improvement in linking speed (better than any previous version of Go).</p>
</li>
<li>
<p>Go 1.8 will deliver a smaller improvement in compilation speed (at this point), but a significant improvement in code quality for non Intel architectures.</p>
</li>
<li>
<p>Go 1.9-1.12 continue to improve the performance of generated code, fix bugs, and improve inlining and improve debuging.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Old version of Go receive no updates. <strong>Do not use them</strong>. Use the latest and you will get the best performance.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="further_reading_8"><a class="anchor" href="#further_reading_8"></a><a class="link" href="#further_reading_8">7.9.1. Further reading</a></h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://dave.cheney.net/2016/04/02/go-1-7-toolchain-improvements">Go 1.7 toolchain improvements</a></p>
</li>
<li>
<p><a href="http://dave.cheney.net/2016/09/18/go-1-8-performance-improvements-one-month-in">Go 1.8 performance improvements</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="move_hot_fields_to_the_top_of_the_struct"><a class="anchor" href="#move_hot_fields_to_the_top_of_the_struct"></a><a class="link" href="#move_hot_fields_to_the_top_of_the_struct">7.9.2. Move hot fields to the top of the struct</a></h4>

</div>
</div>
<div class="sect2">
<h3 id="discussion_3"><a class="anchor" href="#discussion_3"></a><a class="link" href="#discussion_3">7.10. Discussion</a></h3>
<div class="paragraph">
<p>Any questions?</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion"><a class="anchor" href="#conclusion"></a><a class="link" href="#conclusion">Final Questions and Conclusion</a></h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Readable means reliable&#8201;&#8212;&#8201;Rob Pike</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Start with the simplest possible code.</p>
</div>
<div class="paragraph">
<p><em>Measure</em>. Profile your code to identify the bottlenecks, <em>do not guess</em>.</p>
</div>
<div class="paragraph">
<p>If performance is good, <em>stop</em>. You don&#8217;t need to optimise everything, only the hottest parts of your code.</p>
</div>
<div class="paragraph">
<p>As your application grows, or your traffic pattern evolves, the performance hot spots will change.</p>
</div>
<div class="paragraph">
<p>Don&#8217;t leave complex code that is not performance critical, rewrite it with simpler operations if the bottleneck moves elsewhere.</p>
</div>
<div class="paragraph">
<p>Always write the simplest code you can, the compiler is optimised for <em>normal</em> code.</p>
</div>
<div class="paragraph">
<p>Shorter code is faster code; Go is not C++, do not expect the compiler to unravel complicated abstractions.</p>
</div>
<div class="paragraph">
<p>Shorter code is <em>smaller</em> code; which is important for the CPU&#8217;s cache.</p>
</div>
<div class="paragraph">
<p>Pay very close attention to allocations, avoid unnecessary allocation where possible.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>I can make things very fast if they don&#8217;t have to be correct.&#8201;&#8212;&#8201;Russ Cox</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Performance and reliability are equally important.</p>
</div>
<div class="paragraph">
<p>I see little value in making a very fast server that panics, deadlocks or OOMs on a regular basis.</p>
</div>
<div class="paragraph">
<p>Don&#8217;t trade performance for reliability.</p>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Hennessy et al: 1.4x annual performance improvment over 40 years.
</div>
</div>
<div id="footer">
<div id="footer-text">
Version dotgo-2019-3-g660848<br>
Last updated 2019-04-26 02:55:54 UTC
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>